import{j as Ds,r as M,a as $t}from"./react.9f8bb2ca.js";import{b as Ls,c as Qr,t as Rn,a as Th,m as Sd,d as xh}from"./rxjs.bbb58625.js";import{b as Cd}from"./buffer.66f81d03.js";import{b as Ph}from"./buffer-crc32.64f36e84.js";import{s as kh}from"./set-value.9a248538.js";import{r as dr,a as Yt,w as jr,t as Mh,o as xo}from"./mobx.82db3864.js";import{r as Re,g as He,i as Ye,t as k,a as fn,b as Ge,c as Hn,d as gs,e as Aa,f as gt,h as hs,j as _d,w as Rh,k as Ah,l as Td,m as Eh,o as $h,n as Dh}from"./mobx-state-tree.86fcbbc7.js";import{f as Cn}from"./fast-deep-equal.a94972be.js";import{g as xd}from"./get-value.d7d31411.js";import{r as Lh,a as Zr,b as tt,D as Nh,C as ea,M as Fh,c as Bh,A as Ih,d as Oh,e as jh,R as zh,f as qh,g as Pd,h as Vh,L as Hh,i as Ns,j as Fs,k as Bs,l as Is,m as kd,n as Os,o as Wh,p as Rc,T as Ac,q as X,S as Md,s as De,P as Je,t as zt,I as pe,u as Rd,v as Fa,w as Uh,x as Gh,E as Jh,y as fe,z as Xh,B as Yh,F as Kh,G as Qh,H as Zh,J as em,K as tm,N as nm,O as rm,Q as am,U as om,V as im,W as sm,X as lm,Y as cm,Z as um,_ as dm,$ as fm,a0 as pm,a1 as gm,a2 as hm,a3 as mm,a4 as ym,a5 as bm,a6 as vm,a7 as wm,a8 as Sm,a9 as Cm,aa as _m,ab as Tm,ac as xm,ad as Pm,ae as km,af as Mm,ag as Rm,ah as Am,ai as Em,aj as $m,ak as Dm,al as Lm,am as Nm,an as Fm,ao as Bm,ap as Im,aq as Om,ar as jm,as as zm,at as qm,au as Vm,av as Hm,aw as Wm,ax as Um,ay as Gm,az as Jm,aA as Xm,aB as Ym,aC as Km,aD as Qm,aE as Zm,aF as ey,aG as ty,aH as ny,aI as ry,aJ as ay,aK as oy,aL as iy,aM as sy,aN as ly,aO as cy,aP as uy,aQ as dy,aR as fy,aS as py,aT as gy,aU as hy,aV as my,aW as yy,aX as by,aY as vy,aZ as wy,a_ as Sy,a$ as Cy,b0 as _y,b1 as Ty,b2 as Ad,b3 as xy,b4 as Py,b5 as ky,b6 as My,b7 as Ry,b8 as Ay,b9 as Ey,ba as $y,bb as Dy,bc as Ly,bd as Ny,be as Fy,bf as By,bg as Iy,bh as Oy,bi as jy,bj as zy,bk as qy,bl as Vy,bm as fr,bn as Ed,bo as ne,bp as $d,bq as Hy,br as js,bs as $o,bt as Wy,bu as be,bv as Ba,bw as Tn,bx as Uy,by as Dd,bz as Ne,bA as $e,bB as Fe,bC as Pt,bD as jt,bE as qe,bF as Ld,bG as Nd,bH as zs,bI as Gy,bJ as Yo,bK as Jy,bL as Xy,bM as Yy,bN as Ky,bO as Fd,bP as Ft,bQ as un,bR as Qy,bS as Bd,bT as Id,bU as Od,bV as Do,bW as St,bX as jd,bY as Zy,bZ as eb,b_ as tb,b$ as Rt,c0 as nb,c1 as rb,c2 as ab,c3 as ob,c4 as ib,c5 as zr,c6 as sb,c7 as Et,c8 as Ec,c9 as lb,ca as cb,cb as ub,cc as qs,cd as Ko,ce as qr,cf as Ia,cg as Oa,ch as Vr,ci as Lo,cj as Qo,ck as pr,cl as Vs,cm as Kt,cn as db,co as fb,cp as No,cq as Fo,cr as Ea,cs as zd,ct as pb,cu as $c,cv as gb,cw as hb,cx as qd,cy as mb,cz as yb,cA as Dc,cB as bb,cC as vb,cD as wb,cE as Vd,cF as Hd,cG as Wd,cH as Ud,cI as Sb,cJ as Cb,cK as _b,cL as Tb,cM as xb,cN as Pb,cO as Ir,cP as kb,cQ as Mb}from"./@mui.d95a2776.js";import{L as Lc,p as Hs,T as Rb,I as Ab,C as Eb,B as $b,H as Db,a as Lb,b as Nb,c as Ws,d as Us,u as Gs,g as Gd,N as Fb,e as Bb,f as Ib,h as Ob,V as ms}from"./@gmod.89422c98.js";import{r as Dt,o as j}from"./mobx-react.2a8c917b.js";import{m as ft,a as ae}from"./tss-react.d823a444.js";import{c as jb,C as zb}from"./@emotion.97d8af27.js";import{r as qb,u as Vb}from"./react-use-measure.c76e41e7.js";import{c as v,a as Jd}from"./@babel.d3038ccc.js";import{j as Hb}from"./json-stable-stringify.0a3208a5.js";import{e as Wb,_ as Ub}from"./abortable-promise-cache.7cb58d6d.js";import{r as xa,s as Gb,a as Jb}from"./react-dom.55372f0a.js";import{p as on}from"./prop-types.ed5ed641.js";import{r as Xb}from"./rbush.c53ead3c.js";import{d as Js}from"./canvas-sequencer.89cdaa84.js";import{r as Yb}from"./canvas2svg.bb21c42d.js";import{c as Kb,a as Xd}from"./clone.12982bcb.js";import{d as Qb}from"./librpc-web-mod.114fca1e.js";import{s as Yd}from"./shortid.ae0851a5.js";import{l as Kd,a as Qd,q as Zd}from"./d3-scale.b5c2ec72.js";import{u as ef}from"./react-popper.5e9e888f.js";import{F as tf}from"./file-saver.1b7919eb.js";import{r as Zo}from"./react-error-boundary.5999f6e6.js";import{H as Zb,h as Po}from"./material-ui-popup-state.2f0cd738.js";import{n as e0}from"./normalize-wheel.08b32984.js";import{c as ja}from"./copy-to-clipboard.eb25ebbd.js";import{d as jn}from"./react-d3-axis-mod.e8c27339.js";import{l as t0}from"./load-script2.e50455fe.js";import"./long.81b4bfdc.js";import"./pako.ae457f40.js";import"./object.entries-ponyfill.1bb02ccd.js";import"./cross-fetch.5e5fd403.js";import{c as n0}from"./react-draggable.a41929d4.js";import{c as r0}from"./color.b8402d12.js";import{I as Xs}from"./@flatten-js.f79d6531.js";import{p as a0}from"./pluralize.4d99efd8.js";import{A as o0}from"./react-virtualized-auto-sizer.ca6237cd.js";import{V as i0}from"./react-vtree.cc427872.js";import{r as nf,R as s0}from"./generic-filehandle.a92b52fd.js";import{b as rf}from"./detect-node.cdefd8ba.js";import{r as l0}from"./http-range-fetcher.fcdfd695.js";import{c as c0}from"./deepmerge.d048be44.js";import{i as af}from"./is-object.da397113.js";import{e as u0}from"./escape-html.e5dfadb9.js";import{p as d0}from"./dompurify.a6c1e8f6.js";import{r as f0}from"./react-intersection-observer.8cfb7c97.js";import{J as p0}from"./jexl.58bb62c6.js";function g0(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(e,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const Z=Ds.exports.Fragment,l=Ds.exports.jsx,w=Ds.exports.jsxs,U2=Object.freeze(Object.defineProperty({__proto__:null,Fragment:Z,jsx:l,jsxs:w},Symbol.toStringTag,{value:"Module"}));var Le={},of={};(function(e){var t=v&&v.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(e,"__esModule",{value:!0}),e.createJBrowseTheme=e.createJBrowseBaseTheme=e.createJBrowseDefaultOverrides=e.createJBrowseDefaultProps=e.jbrowseDefaultPalette=void 0;const n=Lh,r=Zr,a=t(c0),o="#0D233F",i="#721E63",s="#135560",c="#FFB11D",u=(0,r.createTheme)();e.jbrowseDefaultPalette={primary:{main:o},secondary:{main:i},tertiary:u.palette.augmentColor({color:{main:s}}),quaternary:u.palette.augmentColor({color:{main:c}}),stopCodon:"#e22",startCodon:"#3e3",bases:{A:u.palette.augmentColor({color:n.green}),C:u.palette.augmentColor({color:n.blue}),G:u.palette.augmentColor({color:n.amber}),T:u.palette.augmentColor({color:n.red})}};function d(){return{components:{MuiButton:{defaultProps:{size:"small"}},MuiAccordion:{defaultProps:{disableGutters:!0,TransitionProps:{timeout:150}}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense"}},MuiAutocomplete:{defaultProps:{size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiToolbar:{defaultProps:{variant:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiMenuList:{defaultProps:{dense:!0}},MuiMenuItem:{defaultProps:{dense:!0}},MuiTextField:{defaultProps:{margin:"dense",variant:"standard"}}}}}e.createJBrowseDefaultProps=d;function f(h={}){const m=(0,a.default)(e.jbrowseDefaultPalette,h);return{components:{MuiIconButton:{styleOverrides:{colorSecondary:{color:m.tertiary.main}}},MuiButton:{styleOverrides:{textSecondary:{color:m.tertiary.main}}},MuiFab:{styleOverrides:{secondary:{backgroundColor:m.quaternary.main}}},MuiLink:{styleOverrides:{root:{color:m.tertiary.main}}},MuiAccordionSummary:{styleOverrides:{root:{backgroundColor:m.tertiary.main},content:{color:m.tertiary.contrastText}}}}}}e.createJBrowseDefaultOverrides=f;function p(h){return{palette:e.jbrowseDefaultPalette,typography:{fontSize:12},spacing:4,...(0,a.default)(d(),f(h))}}e.createJBrowseBaseTheme=p;function g(h){var m,y;return!((m=h==null?void 0:h.palette)===null||m===void 0)&&m.tertiary&&(h=(0,a.default)(h,{palette:{tertiary:u.palette.augmentColor("color"in h.palette.tertiary?h.palette.tertiary:{color:h.palette.tertiary})}})),!((y=h==null?void 0:h.palette)===null||y===void 0)&&y.quaternary&&(h=(0,a.default)(h,{palette:{quaternary:u.palette.augmentColor("color"in h.palette.quaternary?h.palette.quaternary:{color:h.palette.quaternary})}})),(0,r.createTheme)((0,a.default)(p(h==null?void 0:h.palette),h||{}))}e.createJBrowseTheme=g})(of);var sr={},h0=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sr,"__esModule",{value:!0});sr.LogoFull=sr.Logomark=void 0;const et=h0(M.exports);function sf(e){return e==="black"?{midnight:"#808080",forrest:"#666666",grape:"#4d4d4d",mandarin:"#333333",gray:"#1a1a1a"}:e==="white"?{midnight:"#ffffff",forrest:"#e6e6e6",grape:"#cccccc",mandarin:"#b3b3b3",gray:"#999999"}:{midnight:"#0d233f",forrest:"#135560",grape:"#721e63",mandarin:"#ffb11d",gray:"#dadada"}}function m0({variant:e}){return et.default.createElement("svg",{viewBox:"0 0 175 175"},et.default.createElement(lf,{variant:e}))}sr.Logomark=m0;function y0({variant:e}){return et.default.createElement("svg",{viewBox:"0 0 641 175"},et.default.createElement(b0,{variant:e}),et.default.createElement(lf,{variant:e}))}sr.LogoFull=y0;function lf({variant:e}){const t=sf(e);return et.default.createElement(et.default.Fragment,null,et.default.createElement("path",{style:{fill:t.midnight},d:"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z"}),et.default.createElement("path",{style:{fill:t.forrest},d:"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z"}),et.default.createElement("path",{style:{fill:t.grape},d:"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z"}),et.default.createElement("path",{style:{fill:t.mandarin},d:"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z"}),et.default.createElement("path",{style:{fill:t.gray},d:"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z"}))}function b0({variant:e}){const t=sf(e);return et.default.createElement("g",{"aria-label":"JBrowse",transform:"translate(213.084 144.241)",style:{fill:t.midnight}},et.default.createElement("path",{d:"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z"}),et.default.createElement("path",{d:"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z"}),et.default.createElement("path",{d:"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z"}),et.default.createElement("path",{d:"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z"}),et.default.createElement("path",{d:"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z"}),et.default.createElement("path",{d:"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z"}),et.default.createElement("path",{d:"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z"}))}var Ys={},C={},Hr={},ut={};(function(e){var t=v&&v.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(e,"__esModule",{value:!0}),e.FileLocation=e.UriLocation=e.UriLocationRaw=e.BlobLocation=e.LocalPathLocation=e.Region=e.NoAssemblyRegion=e.PropTypes=e.ElementId=void 0;const n=t(Yd.exports),r=Re,a=t(on.exports),o=Dt;e.ElementId=r.types.optional(r.types.identifier,n.default.generate),e.PropTypes={Region:a.default.shape({refName:a.default.string.isRequired,start:a.default.number.isRequired,end:a.default.number.isRequired}),ConfigSchema:o.PropTypes.objectOrObservableObject,Feature:a.default.shape({get:a.default.func.isRequired,id:a.default.func.isRequired})},e.NoAssemblyRegion=r.types.model("NoAssemblyRegion",{refName:r.types.string,start:r.types.number,end:r.types.number,reversed:r.types.optional(r.types.boolean,!1)}).actions(i=>({setRefName(s){i.refName=s}})),e.Region=r.types.compose("Region",e.NoAssemblyRegion,r.types.model({assemblyName:r.types.string})),e.LocalPathLocation=r.types.model("LocalPathLocation",{locationType:r.types.literal("LocalPathLocation"),localPath:r.types.string}),e.BlobLocation=r.types.model("BlobLocation",{locationType:r.types.literal("BlobLocation"),name:r.types.string,blobId:r.types.string}),e.UriLocationRaw=r.types.model("UriLocation",{locationType:r.types.literal("UriLocation"),uri:r.types.string,baseUri:r.types.maybe(r.types.string),internetAccountId:r.types.maybe(r.types.string),internetAccountPreAuthorization:r.types.maybe(r.types.model("InternetAccountPreAuthorization",{internetAccountType:r.types.string,authInfo:r.types.frozen()}))}),e.UriLocation=r.types.snapshotProcessor(e.UriLocationRaw,{postProcessor:i=>{const{baseUri:s,...c}=i;return s?i:c}}),e.FileLocation=r.types.snapshotProcessor(r.types.union(e.LocalPathLocation,e.UriLocation,e.BlobLocation),{preProcessor(i){if(!i)return;const{locationType:s,...c}=i;if(!s){const{uri:u,localPath:d,blob:f}=c;let p="";return u!==void 0?p="UriLocation":d!==void 0?p="LocalPathLocation":f!==void 0&&(p="BlobLocation"),{...c,locationType:p}}return i}})})(ut);var Ks={},za={},ei={},v0=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ei,"__esModule",{value:!0});const w0=v0(p0.exports);function S0(){const e=new w0.default.Jexl;return e.addFunction("get",(t,n)=>t.get(n)),e.addFunction("parent",t=>t.parent()),e.addFunction("id",t=>t.id()),e.addFunction("cast",t=>t),e.addFunction("log",t=>(console.log(t),t)),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(t,n)=>t.split(n)),e.addFunction("charAt",(t,n)=>t.charAt(n)),e.addFunction("charCodeAt",(t,n)=>t.charCodeAt(n)),e.addFunction("codePointAt",(t,n)=>t.codePointAt(n)),e.addFunction("startsWith",(t,n,r)=>t.startsWith(n,r)),e.addFunction("endsWith",(t,n,r)=>t.endsWith(n,r)),e.addFunction("padEnd",(t,n,r)=>t.padEnd(n,r)),e.addFunction("padStart",(t,n,r)=>t.padStart(n,r)),e.addFunction("repeat",(t,n)=>t.repeat(n)),e.addFunction("replace",(t,n,r)=>t.replace(n,r)),e.addFunction("replaceAll",(t,n,r)=>t.replaceAll(n,r)),e.addFunction("slice",(t,n,r)=>t.slice(n,r)),e.addFunction("startsWith",(t,n,r)=>t.startsWith(n,r)),e.addFunction("substring",(t,n,r)=>t.substring(n,r)),e.addFunction("toLowerCase",t=>t.toLowerCase()),e.addFunction("toUpperCase",t=>t.toUpperCase()),e.addFunction("trim",t=>t.trim()),e.addFunction("trimEnd",t=>t.trimEnd()),e.addFunction("trimStart",t=>t.trimStart()),e.addFunction("getTag",(t,n)=>{const r=t.get("tags");return r?r[n]:t.get(n)}),e.addBinaryOp("&",15,(t,n)=>t&n),e}ei.default=S0;var C0=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(za,"__esModule",{value:!0});var cf=za.stringToJexlExpression=void 0;const _0=C0(ei),Di={};function T0(e,t){const n=`nosig|${e}`;if(!Di[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const a=e.split("jexl:")[1],o=t?t.compile(`${a}`):(0,_0.default)().compile(`${a}`);Di[n]=o}return Di[n]}cf=za.stringToJexlExpression=T0;Object.defineProperty(Ks,"__esModule",{value:!0});const Ie=Re,x0=za,P0=ut;function k0(){return!0}const M0={stringArray:Ie.types.array(Ie.types.string),stringArrayMap:Ie.types.map(Ie.types.array(Ie.types.string)),numberMap:Ie.types.map(Ie.types.number),boolean:Ie.types.boolean,color:Ie.types.refinement("Color",Ie.types.string,k0),integer:Ie.types.integer,number:Ie.types.number,string:Ie.types.string,text:Ie.types.string,fileLocation:P0.FileLocation,frozen:Ie.types.frozen()},Nc={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},Li=e=>({views:{get valueJSON(){return e.value}}}),Fc=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),Bc={fileLocation:Fc,number:Li,integer:Li,boolean:Li,frozen:Fc,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,n){e.value[t]=n}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)},addToKey(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.push(n)},removeAtKeyIndex(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.splice(n,1)},setAtKeyIndex(t,n,r){const a=e.value.get(t);if(!a)throw new Error(`${t} not found`);a[n]=r}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)}}})},R0=Ie.types.refinement("JexlString",Ie.types.string,e=>e.startsWith("jexl:"));function A0(e,{description:t="",model:n,type:r,defaultValue:a,contextVariable:o=[]}){if(!r)throw new Error("type name required");if(n||(n=M0[r]),!n)throw new Error(`no builtin config slot type "${r}", and no 'model' param provided`);if(a===void 0)throw new Error("no 'defaultValue' provided");const i=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let s=Ie.types.model(i,{name:Ie.types.literal(e),description:Ie.types.literal(t),type:Ie.types.literal(r),value:Ie.types.optional(Ie.types.union(R0,n),a)}).volatile(()=>({contextVariable:o})).views(d=>({get isCallback(){return String(d.value).startsWith("jexl:")}})).views(d=>({get expr(){if(d.isCallback){const{pluginManager:f}=(0,Ie.getEnv)(d);return!f&&typeof jest>"u"&&console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,x0.stringToJexlExpression)(String(d.value),f==null?void 0:f.jexl)}return{evalSync:()=>d.value}},get valueJSON(){if(d.isCallback)return;function f(p){return p&&p.toJSON?p.toJSON():`"${p}"`}return f(d.value)}})).preProcessSnapshot(d=>typeof d=="object"&&d.name===e?d:{name:e,description:t,type:r,value:d}).postProcessSnapshot(d=>typeof d.value=="object"?JSON.stringify(d.value)!==JSON.stringify(a)?d.value:void 0:d.value!==a?d.value:void 0).actions(d=>({set(f){d.value=f},reset(){d.value=a},convertToCallback(){d.isCallback||(d.value=`jexl:${d.valueJSON||"''"}`)},convertToValue(){if(!!d.isCallback){try{const f=d.expr.evalSync();if(f!==void 0){d.value=f;return}}catch{}if(d.value=a,d.isCallback){if(!(r in Nc))throw new Error(`no fallbackDefault defined for type ${r}`);d.value=Nc[r]}}}}));Bc[r]&&(s=s.extend(Bc[r]));const u=Ie.types.optional(s,{name:e,type:r,description:t,value:a});return Object.defineProperty(u,"isJBrowseConfigurationSlot",{value:!0}),u}Ks.default=A0;var mt={},ot={};Object.defineProperty(ot,"__esModule",{value:!0});ot.resolveLateType=ot.getEnumerationValues=ot.getDefaultValue=df=ot.getPropertyType=vs=ot.getUnionSubTypes=bs=ot.getSubType=void 0;const zn=Re;function ys(e){let t;if((0,zn.isOptionalType)(e))t=e._subtype||e.type;else if((0,zn.isArrayType)(e)||(0,zn.isMapType)(e))t=e._subtype||e._subType||e.subType;else{if(typeof e.getSubType=="function")return e.getSubType();throw new TypeError("unsupported mst type")}if(!t)throw new Error("failed to get subtype");return t}var bs=ot.getSubType=ys;function uf(e){if(!(0,zn.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||ys(e)._types||ys(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}var vs=ot.getUnionSubTypes=uf;function E0(e,t){return e.properties[t]}var df=ot.getPropertyType=E0;function $0(e){if(!(0,zn.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}ot.getDefaultValue=$0;function D0(e){return uf(e).map(n=>n.value)}ot.getEnumerationValues=D0;function L0(e){return!(0,zn.isUnionType)(e)&&!(0,zn.isArrayType)(e)&&(0,zn.isLateType)(e)?e.getSubType():e}ot.resolveLateType=L0;Object.defineProperty(mt,"__esModule",{value:!0});mt.isConfigurationSlotType=mt.isConfigurationModel=mt.isConfigurationSchemaType=mt.isBareConfigurationSchemaType=mt.getTypeNamesFromExplicitlyTypedUnion=mt.getConf=mt.readConfObject=void 0;const Ve=Re,Bn=ot;function Bo(e,t=void 0,n={}){if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,Ve.getSnapshot)(e)));if(typeof t=="string"){let a=e[t];if(!a&&(0,Ve.isStateTreeNode)(e)&&(0,Ve.isMapType)((0,Ve.getType)(e))&&(a=e.get(t)),!a)return;if(a.expr){const o=a.expr.evalSync(n);return(0,Ve.isStateTreeNode)(o)?JSON.parse(JSON.stringify((0,Ve.getSnapshot)(o))):o}return(0,Ve.isStateTreeNode)(a)?JSON.parse(JSON.stringify((0,Ve.getSnapshot)(a))):a}const r=t[0];if(t.length>1){const a=t.slice(1);let o=e[r];return!o&&(0,Ve.isStateTreeNode)(e)&&(0,Ve.isMapType)((0,Ve.getType)(e))&&(o=e.get(r)),o?Bo(o,a,n):void 0}return Bo(e,r,n)}mt.readConfObject=Bo;function N0(e,t=void 0,n={}){if(!e)throw new TypeError("must provide a model object");const{configuration:r}=e;if(gf(r))return Bo(r,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}mt.getConf=N0;function ff(e){if((0,Ve.isType)(e)&&(e=(0,Bn.resolveLateType)(e),(0,Ve.isUnionType)(e))){const t=[];return(0,Bn.getUnionSubTypes)(e).forEach(n=>{n=(0,Bn.resolveLateType)(n);let r=ff(n);if(r.length||(r=[(0,Bn.getDefaultValue)(n).type]),!r[0])throw new Error(`invalid config schema type ${n}`);t.push(...r)}),t}return[]}mt.getTypeNamesFromExplicitlyTypedUnion=ff;function pf(e){return!!((0,Ve.isType)(e)&&((0,Ve.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema"))||(0,Ve.isLateType)(e)))}mt.isBareConfigurationSchemaType=pf;function Fr(e){return(0,Ve.isType)(e)?pf(e)?!0:(0,Ve.isUnionType)(e)?(0,Bn.getUnionSubTypes)(e).every(t=>Fr(t)||t.name==="undefined"):!!((0,Ve.isOptionalType)(e)&&Fr((0,Bn.getSubType)(e))||(0,Ve.isArrayType)(e)&&Fr((0,Bn.getSubType)(e))||(0,Ve.isMapType)(e)&&Fr((0,Bn.getSubType)(e))):!1}mt.isConfigurationSchemaType=Fr;function gf(e){return(0,Ve.isStateTreeNode)(e)&&Fr((0,Ve.getType)(e))}mt.isConfigurationModel=gf;function F0(e){return typeof e=="object"&&e!==null&&"isJBrowseConfigurationSlot"in e}mt.isConfigurationSlotType=F0;var B0=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Hr,"__esModule",{value:!0});var hf=Hr.ConfigurationReference=Hr.ConfigurationSchema=void 0;const Vt=Re,Ic=ut,I0=B0(Ks),Oc=mt;function O0(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null&&Object.keys(e).length===0}function j0(e){return Array.isArray(e)&&e.length===0}function z0(e,t,n={}){if(typeof e!="string")throw new Error("first arg must be string name of the model that this config schema goes with");let r=t,a=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(r={...n.baseConfiguration.jbrowseSchemaDefinition,...r},a={...n.baseConfiguration.jbrowseSchemaOptions||{},...n},delete a.baseConfiguration),{schemaDefinition:r,options:a}}function q0(e,t,n){const r={};let a;if(n.explicitlyTyped&&(r.type=Vt.types.optional(Vt.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);n.explicitIdentifier?typeof n.explicitIdentifier=="string"?(r[n.explicitIdentifier]=Vt.types.identifier,a=n.explicitIdentifier):(r.id=Vt.types.identifier,a="id"):n.implicitIdentifier&&(typeof n.implicitIdentifier=="string"?(r[n.implicitIdentifier]=Ic.ElementId,a=n.implicitIdentifier):(r.id=Ic.ElementId,a="id"));const o={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach(([d,f])=>{if((0,Vt.isType)(f)&&(0,Vt.isLateType)(f)||(0,Oc.isConfigurationSchemaType)(f))r[d]=f;else if(typeof f=="string"||typeof f=="number")o[d]=f;else if(typeof f=="object"){if(!f.type)throw new Error(`no type set for config slot ${e}.${d}`);try{r[d]=(0,I0.default)(d,f)}catch(p){throw new Error(`invalid config slot definition for ${e}.${d}: ${p}`)}}else throw new Error(`invalid configuration schema definition, "${d}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`)});let i=Vt.types.model(`${e}ConfigurationSchema`,r).actions(d=>({setSubschema(f,p){if(!(0,Oc.isConfigurationSchemaType)(r[f]))throw new Error(`${f} is not a subschema, cannot replace`);const g=(0,Vt.isStateTreeNode)(p)?p:r[f].create(p);return d[f]=g,g}}));Object.keys(o).length&&(i=i.volatile(()=>o)),n.actions&&(i=i.actions(n.actions)),n.views&&(i=i.views(n.views)),n.extend&&(i=i.extend(n.extend));const s=a?{[a]:"placeholderId"}:{},c=n.explicitlyTyped?{type:e,...s}:s,u=(0,Vt.getSnapshot)(i.create(c));return i=i.postProcessSnapshot(d=>{const f={};let p=!0;for(const[g,h]of Object.entries(d))p&&(typeof u[g]=="object"&&typeof h=="object"?JSON.stringify(u[g])!==JSON.stringify(h)&&(p=!1):u[g]!==h&&(p=!1)),h!==void 0&&o[g]===void 0&&!O0(h)&&!j0(h)&&(f[g]=h);return p?{}:f}),n.preProcessSnapshot&&(i=i.preProcessSnapshot(n.preProcessSnapshot)),Vt.types.optional(i,c)}function V0(e,t,n){const{schemaDefinition:r,options:a}=z0(e,t,n),o=q0(e,r,a);return o.isJBrowseConfigurationSchema=!0,o.jbrowseSchemaDefinition=r,o.jbrowseSchemaOptions=a,o}Hr.ConfigurationSchema=V0;function H0(e){return Vt.types.union(Vt.types.reference(e),e)}hf=Hr.ConfigurationReference=H0;(function(e){var t=v&&v.__createBinding||(Object.create?function(a,o,i,s){s===void 0&&(s=i);var c=Object.getOwnPropertyDescriptor(o,i);(!c||("get"in c?!o.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return o[i]}}),Object.defineProperty(a,s,c)}:function(a,o,i,s){s===void 0&&(s=i),a[s]=o[i]}),n=v&&v.__exportStar||function(a,o){for(var i in a)i!=="default"&&!Object.prototype.hasOwnProperty.call(o,i)&&t(o,a,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigurationReference=e.ConfigurationSchema=void 0;var r=Hr;Object.defineProperty(e,"ConfigurationSchema",{enumerable:!0,get:function(){return r.ConfigurationSchema}}),Object.defineProperty(e,"ConfigurationReference",{enumerable:!0,get:function(){return r.ConfigurationReference}}),n(mt,e)})(C);var Qs={},Zs={},ti={},W0=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),U0=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),G0=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&W0(t,e,n);return U0(t,e),t};Object.defineProperty(ti,"__esModule",{value:!0});const fo=G0(M.exports),J0=ft,X0=(0,J0.makeStyles)()({horizontalHandle:{cursor:"row-resize",width:"100%"},verticalHandle:{cursor:"col-resize",height:"100%"},flexbox_verticalHandle:{cursor:"col-resize",alignSelf:"stretch"},flexbox_horizontalHandle:{cursor:"row-resize",alignSelf:"stretch"}});function Y0({onDrag:e,vertical:t=!1,flexbox:n=!1,className:r,...a}){const[o,i]=(0,fo.useState)(!1),s=(0,fo.useRef)(0),{classes:c,cx:u}=X0();(0,fo.useEffect)(()=>{function f(g){g.preventDefault();const h=t?g.clientX:g.clientY,m=h-s.current;m&&(e(m),s.current=h)}function p(){i(!1)}return o?(window.addEventListener("mousemove",f,!0),window.addEventListener("mouseup",p,!0),()=>{window.removeEventListener("mousemove",f,!0),window.removeEventListener("mouseup",p,!0)}):()=>{}},[o,e,t]);let d;return n?t?d=c.flexbox_verticalHandle:d=c.flexbox_horizontalHandle:t?d=c.verticalHandle:d=c.horizontalHandle,fo.default.createElement("div",{"data-resizer":"true",onMouseDown:f=>{f.preventDefault(),s.current=t?f.clientX:f.clientY,i(!0)},role:"presentation",className:u(d,r),...a})}ti.default=Y0;var mf=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Zs,"__esModule",{value:!0});const Ni=mf(M.exports),K0=tt,Q0=ft,Z0=Dt,jc=mf(ti),ev=(0,Q0.makeStyles)()(e=>({paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}));function tv({children:e,session:t}){const{drawerPosition:n,drawerWidth:r}=t,{classes:a}=ev();return Ni.default.createElement(K0.Paper,{className:a.paper,elevation:16,square:!0},n==="right"?Ni.default.createElement(jc.default,{onDrag:t.resizeDrawer,className:a.resizeHandle,vertical:!0}):null,e,n==="left"?Ni.default.createElement(jc.default,{onDrag:t.resizeDrawer,className:a.resizeHandle,style:{left:r},vertical:!0}):null)}Zs.default=(0,Z0.observer)(tv);var qa={},nv=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(qa,"__esModule",{value:!0});const zc=nv(M.exports),rv=({error:e})=>{let t="",n=`${e}`;const r="is not assignable",a=n.indexOf(r);if(a!==-1){const o=n.slice(0,a+r.length),i=o.match(/.*at path "(.*)" snapshot `(.*)` is not assignable/m);i&&(n=`Failed to load element at ${i[1]}...Failed element had snapshot`,t=i[2]);const s=o.match(/.*snapshot `(.*)` is not assignable/);s&&(n="Failed to load element...Failed element had snapshot",t=s[1])}return zc.default.createElement("div",{style:{padding:4,margin:4,overflow:"auto",maxHeight:200,background:"#f88",border:"1px solid black"}},n.slice(0,1e4),t?zc.default.createElement("pre",{style:{background:"lightgrey",border:"1px solid black",margin:20}},JSON.stringify(JSON.parse(t),null,2)):null)};qa.default=rv;var av=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),ov=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),iv=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&av(t,e,n);return ov(t,e),t},ta=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Qs,"__esModule",{value:!0});const xe=iv(M.exports),sv=Zo.exports,wt=tt,lv=ft,yf=Dt,bf=Re,cv=ta(Nh),uv=ta(ea),dv=ta(Fh),fv=ta(Bh),pv=ta(Zs),gv=ta(qa),hv=(0,lv.makeStyles)()(e=>({formControl:{margin:0},spacer:{flexGrow:1},drawerSelect:{margin:0,color:e.palette.secondary.contrastText},dropDownIcon:{color:e.palette.secondary.contrastText},header:{background:e.palette.secondary.main}})),mv=(0,yf.observer)(({session:e,setToolbarHeight:t})=>{const{pluginManager:n}=(0,bf.getEnv)(e),{visibleWidget:r,activeWidgets:a,drawerPosition:o}=e,{classes:i}=hv(),[s,c]=xe.default.useState(null);return xe.default.createElement(wt.AppBar,{position:"sticky",className:i.header,ref:u=>t((u==null?void 0:u.getBoundingClientRect().height)||0)},xe.default.createElement(wt.Toolbar,{disableGutters:!0},xe.default.createElement(wt.FormControl,{className:i.formControl},xe.default.createElement(wt.Select,{value:r==null?void 0:r.id,"data-testid":"widget-drawer-selects",className:i.drawerSelect,classes:{icon:i.dropDownIcon},renderValue:u=>{const d=e.activeWidgets.get(u);if(!d)return xe.default.createElement(wt.Typography,{variant:"h6",color:"inherit"},"Unknown widget");const f=n.getWidgetType(d.type),{HeadingComponent:p,heading:g}=f;return p?xe.default.createElement(p,{model:d}):xe.default.createElement(wt.Typography,{variant:"h6",color:"inherit"},g)},onChange:u=>{const d=e.activeWidgets.get(u.target.value);d?e.showWidget(d):e.notify(`Widget not found ${u.target.value}`,"warning")}},Array.from(a.values()).map(u=>{const d=n.getWidgetType(u.type),{HeadingComponent:f,heading:p}=d;return xe.default.createElement(wt.MenuItem,{"data-testid":`widget-drawer-selects-item-${u.type}`,key:u.id,value:u.id},f?xe.default.createElement(f,{model:u}):xe.default.createElement(wt.Typography,{variant:"h6",color:"inherit"},p),xe.default.createElement(wt.IconButton,{"data-testid":`${u.type}-drawer-delete`,color:"inherit","aria-label":"Delete",onClick:()=>e.hideWidget(u)},xe.default.createElement(cv.default,null)))}))),xe.default.createElement("div",{className:i.spacer}),xe.default.createElement("div",null,xe.default.createElement(wt.IconButton,{"data-testid":"drawer-close",color:"inherit",onClick:u=>c(u.currentTarget)},xe.default.createElement(fv.default,null)),xe.default.createElement(wt.Tooltip,{title:"Minimize drawer"},xe.default.createElement(wt.IconButton,{"data-testid":"drawer-minimize",color:"inherit",onClick:()=>{e.notify(`Drawer minimized, click button on ${o} side of screen to re-open`,"info"),e.minimizeWidgetDrawer()}},xe.default.createElement(dv.default,null))),xe.default.createElement(wt.Tooltip,{title:"Close drawer"},xe.default.createElement(wt.IconButton,{"data-testid":"drawer-close",color:"inherit",onClick:()=>e.hideWidget(r)},xe.default.createElement(uv.default,null))))),xe.default.createElement(wt.Menu,{anchorEl:s,open:Boolean(s),onClose:()=>c(null)},["left","right"].map(u=>xe.default.createElement(wt.MenuItem,{key:u,selected:o==="option",onClick:()=>{e.setDrawerPosition(u),c(null)}},u))))}),yv=(0,yf.observer)(({session:e})=>{const{visibleWidget:t}=e,{pluginManager:n}=(0,bf.getEnv)(e),r=t?n.getWidgetType(t.type).ReactComponent:null,[a,o]=(0,xe.useState)(0);return xe.default.createElement(pv.default,{session:e},xe.default.createElement(mv,{session:e,setToolbarHeight:o}),xe.default.createElement(xe.Suspense,{fallback:xe.default.createElement("div",null,"Loading...")},xe.default.createElement(sv.ErrorBoundary,{FallbackComponent:({error:i})=>xe.default.createElement(gv.default,{error:i})},xe.default.createElement(r,{model:t,session:e,toolbarHeight:a}))))});Qs.default=yv;var el={},xn={},Fi={},Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});var tl=Wn.isFeature=void 0;function bv(e){return typeof e=="object"&&e!==null&&typeof e.get=="function"&&typeof e.id=="function"}tl=Wn.isFeature=bv;function qc(e){return"uniqueId"in e&&typeof e.data!="object"}class Io{constructor(t){var n;qc(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);const r=qc(t)?t.uniqueId:t.id;if(r==null)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(r),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=(n=this.data.subfeatures)===null||n===void 0?void 0:n.map((a,o)=>typeof a.get!="function"?new Io({id:a.uniqueId||`${r}-${o}`,data:{strand:this.data.strand,...a},parent:this}):a))}get(t){return t==="subfeatures"?this.subfeatures:t==="parent"?this.parent():this.data[t]}set(t,n){this.data[t]=n}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const t={...this.data,uniqueId:this.id()},n=this.parent();n&&(t.parentId=n.id());const r=this.children();return r&&(t.subfeatures=r.map(a=>a.toJSON())),t}static fromJSON(t){return new Io({...t})}}var Pn=Wn.default=Io,Ut={},vf={};Object.defineProperty(vf,"__esModule",{value:!0});(function(e){var t=v&&v.__createBinding||(Object.create?function(R,E,$,B){B===void 0&&(B=$);var F=Object.getOwnPropertyDescriptor(E,$);(!F||("get"in F?!E.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return E[$]}}),Object.defineProperty(R,B,F)}:function(R,E,$,B){B===void 0&&(B=$),R[B]=E[$]}),n=v&&v.__exportStar||function(R,E){for(var $ in R)$!=="default"&&!Object.prototype.hasOwnProperty.call(E,$)&&t(E,R,$)};Object.defineProperty(e,"__esModule",{value:!0}),e.isRetryException=e.isAuthNeededException=e.RetryError=e.AuthNeededError=e.isUriLocation=e.isAbstractMenuManager=e.isAppRootModel=e.isTrackViewModel=e.isDisplayModel=e.isTrackModel=e.isViewModel=e.isSelectionContainer=e.isSessionWithSessionPlugins=e.isSessionModelWithConnections=e.isSessionModelWithWidgets=e.isSessionWithAddTracks=e.isSessionModelWithConfigEditing=e.isSessionModel=e.isViewContainer=void 0;const r=Re;n(vf,e);function a(R){return(0,r.isStateTreeNode)(R)&&"removeView"in R&&"addView"in R&&"views"in R}e.isViewContainer=a;function o(R){return typeof R=="object"&&R!==null&&"rpcManager"in R&&"configuration"in R}e.isSessionModel=o;function i(R){return o(R)&&"editConfiguration"in R}e.isSessionModelWithConfigEditing=i;function s(R){return o(R)&&"addTrackConf"in R&&!R.disableAddTracks}e.isSessionWithAddTracks=s;function c(R){return o(R)&&"widgets"in R}e.isSessionModelWithWidgets=c;function u(R){return o(R)&&"addConnectionConf"in R}e.isSessionModelWithConnections=u;function d(R){return o(R)&&"sessionPlugins"in R}e.isSessionWithSessionPlugins=d;function f(R){return typeof R=="object"&&R!==null&&"selection"in R&&"setSelection"in R}e.isSelectionContainer=f;function p(R){return typeof R=="object"&&R!==null&&"width"in R&&"setWidth"in R}e.isViewModel=p;function g(R){return typeof R=="object"&&R!==null&&"configuration"in R&&R.configuration.trackId}e.isTrackModel=g;function h(R){return typeof R=="object"&&R!==null&&"configuration"in R&&R.configuration.displayId}e.isDisplayModel=h;function m(R){return typeof R=="object"&&R!==null&&"showTrack"in R&&"hideTrack"in R}e.isTrackViewModel=m;function y(R){return typeof R=="object"&&R!==null&&"isAssemblyEditing"in R&&"findAppropriateInternetAccount"in R}e.isAppRootModel=y;function b(R){return typeof R=="object"&&R!==null&&"appendMenu"in R&&"appendToSubMenu"in R}e.isAbstractMenuManager=b;function S(R){return typeof R=="object"&&R!==null&&"uri"in R}e.isUriLocation=S;class _ extends Error{constructor(E,$){super(E),this.message=E,this.url=$,this.name="AuthNeededError",Object.setPrototypeOf(this,_.prototype)}}e.AuthNeededError=_;class T extends Error{constructor(E,$){super(E),this.message=E,this.internetAccountId=$,this.name="RetryError"}}e.RetryError=T;function x(R){return R instanceof Error&&(R.name==="AuthNeededError"||R.url!==void 0)}e.isAuthNeededException=x;function A(R){return R.name==="RetryError"||R.internetAccountId!==void 0}e.isRetryException=A})(Ut);var At={};Object.defineProperty(At,"__esModule",{value:!0});At.isAbortException=At.observeAbortSignal=At.makeAbortError=At.abortBreakPoint=At.checkAbortSignal=void 0;const Vc=Ls;class vv extends Error{}function wf(e){if(!!e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw Sf()}}At.checkAbortSignal=wf;function wv(e){return new Promise(t=>setTimeout(t,e))}async function Sv(e){await wv(1),wf(e)}At.abortBreakPoint=Sv;function Sf(){if(typeof DOMException<"u")return new DOMException("aborted","AbortError");const e=new vv("aborted");return e.code="ERR_ABORTED",e}At.makeAbortError=Sf;function Cv(e){return e?(0,Vc.fromEvent)(e,"abort"):Vc.Observable.create()}At.observeAbortSignal=Cv;function _v(e){return e instanceof Error&&(e.name==="AbortError"||e.code==="ERR_ABORTED"||!!e.message.match(/\b(aborted|AbortError)\b/i))}At.isAbortException=_v;var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.whenPresent=Wr.when=void 0;const Tv=dr,xv=At;function Cf(e,{timeout:t,signal:n,name:r}={}){return new Promise((a,o)=>{let i=!1;const s=(0,Tv.when)(e);let c,u=()=>{};t&&(c=setTimeout(()=>{i||(i=!0,s.cancel(),o(new Error(`timed out waiting for ${r||"whenPresent"}`)))},t),u=()=>c&&clearTimeout(c)),n&&n.addEventListener("abort",()=>{i||(i=!0,s.cancel(),u(),o((0,xv.makeAbortError)()))}),s.then(()=>{i||(i=!0,u(),a(!0))}).catch(d=>{i||(i=!0,u(),o(d))})})}Wr.when=Cf;async function Pv(e,t={}){return await Cf(()=>{const n=e();return n!=null},t),e()}Wr.whenPresent=Pv;var _n={};Object.defineProperty(_n,"__esModule",{value:!0});_n.isContainedWithin=nl=_n.doesIntersect2=_n.intersection2=void 0;function kv(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}_n.intersection2=kv;function Mv(e,t,n,r){return t>n&&e<r}var nl=_n.doesIntersect2=Mv;function Rv(e,t,n,r){return n<=e&&r>=t}_n.isContainedWithin=Rv;var ht={},Av=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ht,"__esModule",{value:!0});ht.drawImageOntoCanvasContext=ht.ImageBitmapType=ht.createImageBitmap=ht.createCanvas=void 0;const Ev=Av(rf),_f=Js;function $v(e,t){e.serializedCommands?new _f.CanvasSequence(e.serializedCommands).execute(t):t.drawImage(e,0,0)}ht.drawImageOntoCanvasContext=$v;const Hc={realOffscreenCanvas:typeof OffscreenCanvas=="function",node:Ev.default};Hc.realOffscreenCanvas?(ht.createCanvas=(e,t)=>new OffscreenCanvas(e,t),ht.createImageBitmap=window.createImageBitmap||self.createImageBitmap,ht.ImageBitmapType=window.ImageBitmap||self.ImageBitmap):Hc.node?(ht.createCanvas=(...e)=>nodeCreateCanvas(...e),ht.createImageBitmap=async(e,...t)=>{if(t.length)throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");const n=e.toDataURL(),r=new nodeImage;return new Promise((a,o)=>{r.onload=()=>a(r),r.onerror=o,r.src=n})}):(ht.createCanvas=(e,t)=>{const n=new _f.CanvasSequence;return{width:e,height:t,getContext(){return n}}},ht.createImageBitmap=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},ht.ImageBitmapType=String);var ba={},Wc;function Tf(){if(Wc)return ba;Wc=1;var e=v&&v.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ba,"__esModule",{value:!0}),ba.renderToAbstractCanvas=void 0;const t=e(M.exports),n=Js,r=ht,a=Ee();async function o(i,s,c,u){const{exportSVG:d,highResolutionScaling:f=1}=c;if(d)if(d.rasterizeLayers){const g=(0,r.createCanvas)(Math.ceil(i*4),s*4),h=g.getContext("2d");if(!h)throw new Error("2d canvas rendering not supported on this platform");return h.scale(4,4),{...await u(h),reactElement:t.default.createElement("image",{width:i,height:s,xlinkHref:"convertToBlob"in g?await(0,a.blobToDataURL)(await g.convertToBlob({type:"image/png"})):g.toDataURL()})}}else{const p=new n.CanvasSequence;return{...await u(p),canvasRecordedData:p.toJSON()}}else{const p=(0,r.createCanvas)(Math.ceil(i*f),s*f),g=p.getContext("2d");if(!g)throw new Error("2d canvas rendering not supported on this platform");return g.scale(f,f),{...await u(g),imageData:await(0,r.createImageBitmap)(p)}}}return ba.renderToAbstractCanvas=o,ba}var Uc;function Ee(){return Uc||(Uc=1,function(e){var t=v&&v.__createBinding||(Object.create?function(N,O,W,ee){ee===void 0&&(ee=W);var te=Object.getOwnPropertyDescriptor(O,W);(!te||("get"in te?!O.__esModule:te.writable||te.configurable))&&(te={enumerable:!0,get:function(){return O[W]}}),Object.defineProperty(N,ee,te)}:function(N,O,W,ee){ee===void 0&&(ee=W),N[ee]=O[W]}),n=v&&v.__setModuleDefault||(Object.create?function(N,O){Object.defineProperty(N,"default",{enumerable:!0,value:O})}:function(N,O){N.default=O}),r=v&&v.__importStar||function(N){if(N&&N.__esModule)return N;var O={};if(N!=null)for(var W in N)W!=="default"&&Object.prototype.hasOwnProperty.call(N,W)&&t(O,N,W);return n(O,N),O},a=v&&v.__exportStar||function(N,O){for(var W in N)W!=="default"&&!Object.prototype.hasOwnProperty.call(O,W)&&t(O,N,W)},o=v&&v.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(e,"__esModule",{value:!0}),e.getBpDisplayStr=e.supportedIndexingAdapters=e.bytesForRegions=e.objectHash=e.hashCode=e.updateStatus=e.generateCodonTable=e.defaultCodonTable=e.defaultStops=e.defaultStarts=e.measureText=e.rIC=e.blobToDataURL=e.complement=e.reverse=e.revcom=e.isElectron=e.stringify=e.minmax=e.renameRegionsIfNeeded=e.renameRegionIfNeeded=e.makeAbortableReaction=e.findLastIndex=e.iterMap=e.bpSpanPx=e.featureSpanPx=e.cartesianToPolar=e.polarToCartesian=e.degToRad=e.radToDeg=e.bpToPx=e.clamp=e.compareLocStrings=e.compareLocs=e.parseLocString=e.parseLocStringOneBased=e.assembleLocString=e.getContainingDisplay=e.getContainingTrack=e.getContainingView=e.getSession=e.findParentThatIs=e.springAnimate=e.findParentThat=e.useDebouncedCallback=e.useDebounce=e.inProduction=e.inDevelopment=e.isFeature=e.SimpleFeature=void 0,e.measureGridWidth=e.getStr=e.getUriLink=e.useLocalStorage=e.getLayoutId=e.getViewParams=e.getTickDisplayStr=e.toLocale=void 0;const i=M.exports,s=o(af),c=Re,u=dr,d=r(Wn);e.SimpleFeature=d.default,Object.defineProperty(e,"isFeature",{enumerable:!0,get:function(){return d.isFeature}});const f=Ut,p=At,g=Ut;a(Ut,e),a(At,e),a(Wr,e),a(_n,e),a(ht,e),a(Tf(),e),e.inDevelopment=typeof Lc=="object"&&Lc.env&&!1,e.inProduction=!e.inDevelopment;function h(N,O){const[W,ee]=(0,i.useState)(N);return(0,i.useEffect)(()=>{const te=setTimeout(()=>{ee(N)},O);return()=>{clearTimeout(te)}},[N,O]),W}e.useDebounce=h;function m(N,O=400){const W=(0,i.useRef)(),ee=(0,i.useRef)();function te(){ee.current&&clearTimeout(ee.current)}return(0,i.useEffect)(()=>te,[]),function(...Te){W.current=Te,te(),ee.current=setTimeout(()=>{W.current&&N(...W.current)},O)}}e.useDebouncedCallback=m;function y(N,O){if(!(0,c.hasParent)(N))throw new Error("node does not have parent");let W=(0,c.getParent)(N);for(;W&&(0,c.isAlive)(W);){if(O(W))return W;if((0,c.hasParent)(W))W=(0,c.getParent)(W);else break}throw new Error("no matching node found")}e.findParentThat=y;function b(N,O,W,ee=()=>{},te=0,ge=170,Te=26){te||(te=Math.abs(O-N)/1e3);let vt;function Qe(Zt){const Ue=Date.now();let Mt=Zt.lastPosition,$i=Zt.lastTime||Ue,ya=Zt.lastVelocity||0;Ue>$i+64&&($i=Ue);const vh=Math.floor(Ue-$i);for(let Mc=0;Mc<vh;++Mc){const Ch=-ge*(Mt-O),_h=-Te*ya;ya+=(Ch+_h)/1*1/1e3,Mt+=ya*1/1e3}const wh=Math.abs(ya)<=te,Sh=ge!==0?Math.abs(O-Mt)<=te:!0;wh&&Sh?(W(O),ee()):(W(Mt),vt=requestAnimationFrame(()=>Qe({lastPosition:Mt,lastTime:Ue,lastVelocity:ya})))}return[()=>Qe({lastPosition:N}),()=>cancelAnimationFrame(vt)]}e.springAnimate=b;function S(N,O){return y(N,O)}e.findParentThatIs=S;function _(N){try{return S(N,f.isSessionModel)}catch{throw new Error("no session model found!")}}e.getSession=_;function T(N){try{return S(N,f.isViewModel)}catch{throw new Error("no containing view found")}}e.getContainingView=T;function x(N){try{return S(N,f.isTrackModel)}catch{throw new Error("no containing track found")}}e.getContainingTrack=x;function A(N){try{return S(N,f.isDisplayModel)}catch{throw new Error("no containing display found")}}e.getContainingDisplay=A;function R(N){const{assemblyName:O,refName:W,start:ee,end:te,reversed:ge}=N,Te=O?`{${O}}`:"";let Me;ee!==void 0?Me=`:${(ee+1).toLocaleString("en-US")}`:te!==void 0?Me=":1":Me="";let vt;te!==void 0?vt=ee!==void 0&&ee+1===te?"":`..${te.toLocaleString("en-US")}`:vt=ee!==void 0?"..":"";let Qe="";return ge&&(Qe="[rev]"),`${Te}${W}${Me}${vt}${Qe}`}e.assembleLocString=R;function E(N,O){if(!N)throw new Error("no location string provided, could not parse");let W=!1;N.endsWith("[rev]")&&(W=!0,N=N.replace(/\[rev\]$/,"")),N=N.replace(/\s/,"");const ee=N.match(/(\{(.+)\})?(.+)/);if(!ee)throw new Error(`invalid location string: "${N}"`);const[,,te,ge]=ee;if(!te&&ge.startsWith("{}"))throw new Error(`no assembly name was provided in location "${ge}"`);const Te=ge.lastIndexOf(":");if(Te===-1){if(O(ge,te))return{assemblyName:te,refName:ge,reversed:W};throw new Error(`Unknown reference sequence "${ge}"`)}const Me=ge.slice(0,Te),vt=ge.slice(Te+1);if(O(Me,te)&&O(ge,te))throw new Error(`ambiguous location string: "${N}"`);if(O(Me,te))if(vt){const Qe=vt.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)(-?(\d+|\d{1,3}(,\d{3})*))$/),Zt=vt.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)?$/);if(Qe){const[,Ue,,,,Mt]=Qe;if(Ue!==void 0&&Mt!==void 0)return{assemblyName:te,refName:Me,start:+Ue.replace(/,/g,""),end:+Mt.replace(/,/g,""),reversed:W}}else if(Zt){const[,Ue,,,Mt]=Zt;if(Ue!==void 0)return Mt?{assemblyName:te,refName:Me,start:+Ue.replace(/,/g,""),reversed:W}:{assemblyName:te,refName:Me,start:+Ue.replace(/,/g,""),end:+Ue.replace(/,/g,""),reversed:W}}else throw new Error(`could not parse range "${vt}" on location "${N}"`)}else return{assemblyName:te,refName:Me,reversed:W};else if(O(ge,te))return{assemblyName:te,refName:ge,reversed:W};throw new Error(`unknown reference sequence name in location "${N}"`)}e.parseLocStringOneBased=E;function $(N,O){const W=E(N,O);return typeof W.start=="number"&&(W.start-=1),W}e.parseLocString=$;function B(N,O){const W=N.assemblyName||O.assemblyName?(N.assemblyName||"").localeCompare(O.assemblyName||""):0;if(W)return W;const ee=N.refName||O.refName?(N.refName||"").localeCompare(O.refName||""):0;if(ee)return ee;if(N.start!==void 0&&O.start!==void 0){const te=N.start-O.start;if(te)return te}if(N.end!==void 0&&O.end!==void 0){const te=N.end-O.end;if(te)return te}return 0}e.compareLocs=B;function F(N,O,W){const ee=$(N,W),te=$(O,W);return B(ee,te)}e.compareLocStrings=F;function I(N,O,W){return N<O?O:N>W?W:N}e.clamp=I;function U(N){return Math.round(N*10)/10}function z(N,{reversed:O,end:W=0,start:ee=0},te){return U((O?W-N:N-ee)/te)}e.bpToPx=z;const G=180/Math.PI,q=Math.PI/180;function J(N){return N*G%360}e.radToDeg=J;function Q(N){return N*q%(2*Math.PI)}e.degToRad=Q;function H(N,O){return[N*Math.cos(O),N*Math.sin(O)]}e.polarToCartesian=H;function ce(N,O){const W=Math.sqrt(N*N+O*O),ee=Math.atan(O/N);return[W,ee]}e.cartesianToPolar=ce;function le(N,O,W){return re(N.get("start"),N.get("end"),O,W)}e.featureSpanPx=le;function re(N,O,W,ee){const te=z(N,W,ee),ge=z(O,W,ee);return W.reversed?[ge,te]:[te,ge]}e.bpSpanPx=re;function ve(N,O,W){const ee=W?new Array(W):[];let te=0;for(const ge of N)ee[te]=O(ge),te+=1;return ee}e.iterMap=ve;function V(N,O){let W=N.length;for(;W--;)if(O(N[W],W,N))return W;return-1}e.findLastIndex=V;function K(N,O,W,ee,te,ge,Te){let Me;function vt(Qe){(0,p.isAbortException)(Qe)||((0,c.isAlive)(N)?Te(Qe):console.error(Qe))}(0,c.addDisposer)(N,(0,u.reaction)(()=>{try{return O(N)}catch(Qe){vt(Qe);return}},async(Qe,Zt)=>{if(Me&&!Me.signal.aborted&&Me.abort(),!(0,c.isAlive)(N))return;Me=new AbortController;const Ue=Me;te(Ue);try{const Mt=await W(Qe,Ue.signal,N,Zt);(0,p.checkAbortSignal)(Ue.signal),(0,c.isAlive)(N)&&ge(Mt)}catch(Mt){Ue&&!Ue.signal.aborted&&Ue.abort(),vt(Mt)}},ee)),(0,c.addDisposer)(N,()=>{Me&&!Me.signal.aborted&&Me.abort()})}e.makeAbortableReaction=K;function ie(N,O){if((0,c.isStateTreeNode)(O)&&!(0,c.isAlive)(O))return O;if(O&&N&&N[O.refName]){(0,c.isStateTreeNode)(O)?O={...(0,c.getSnapshot)(O)}:O={...O};const W=N[O.refName];if(W)return{...O,refName:W,originalRefName:O.refName}}return O}e.renameRegionIfNeeded=ie;async function oe(N,O){const{regions:W=[],adapterConfig:ee}=O;if(!O.sessionId)throw new Error("sessionId is required");const te=W.map(Te=>Te.assemblyName),ge=Object.fromEntries(await Promise.all(te.map(async Te=>[Te,await N.getRefNameMapForAdapter(ee,Te,O)])));return{...O,regions:W.map((Te,Me)=>ie(ge[te[Me]],Te))}}e.renameRegionsIfNeeded=oe;function he(N,O){return[Math.min(N,O),Math.max(N,O)]}e.minmax=he;function me({refName:N,coord:O,oob:W}){return N?`${N}:${O.toLocaleString("en-US")}${W?" (out of bounds)":""}`:""}e.stringify=me,e.isElectron=/electron/i.test(typeof navigator<"u"?navigator.userAgent:"");function Se(N){return yt((0,e.complement)(N))}e.revcom=Se;function yt(N){return N.split("").reverse().join("")}e.reverse=yt,e.complement=(()=>{const N=/[ACGT]/gi,O={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};return W=>W.replace(N,ee=>O[ee]||"")})();function Be(N){const O=new FileReader;return new Promise((W,ee)=>{O.onload=te=>{te.target?W(te.target.result):ee(new Error("unknown result reading blob from canvas"))},O.readAsDataURL(N)})}e.blobToDataURL=Be,e.rIC=typeof jest>"u"?typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback:N=>setTimeout(()=>N(),1):N=>N();const bt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625];function We(N,O=10){var W;const ee=.5279276315789471,te=String(N);let ge=0;for(let Te=0;Te<te.length;Te++){const Me=te.charCodeAt(Te);ge+=(W=bt[Me])!==null&&W!==void 0?W:ee}return ge*O}e.measureText=We,e.defaultStarts=["ATG"],e.defaultStops=["TAA","TAG","TGA"],e.defaultCodonTable={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function de(N){const O={};return Object.keys(N).forEach(W=>{const ee=N[W],te=[];for(let ge=0;ge<3;ge++){const Te=W.charAt(ge);te[ge]=[],te[ge][0]=Te.toUpperCase(),te[ge][1]=Te.toLowerCase()}for(let ge=0;ge<2;ge++){const Te=te[0][ge];for(let Me=0;Me<2;Me++){const vt=te[1][Me];for(let Qe=0;Qe<2;Qe++){const Zt=te[2][Qe],Ue=Te+vt+Zt;O[Ue]=ee}}}}),O}e.generateCodonTable=de;async function ye(N,O,W){O(N);const ee=await W();return O(""),ee}e.updateStatus=ye;function Ae(N){let O=0;if(N.length===0)return O;for(let W=0;W<N.length;W++){const ee=N.charCodeAt(W);O=(O<<5)-O+ee,O|=0}return O}e.hashCode=Ae;function pt(N){return`${Ae(JSON.stringify(N))}`}e.objectHash=pt;async function Tr(N,O){return(await Promise.all(N.map(ee=>O.blocksForRange(ee.refName,ee.start,ee.end)))).flat().map(ee=>({start:ee.minv.blockPosition,end:ee.maxv.blockPosition+65535})).reduce((ee,te)=>ee+te.end-te.start,0)}e.bytesForRegions=Tr;function mn(N){return["Gff3TabixAdapter","VcfTabixAdapter","Gff3Adapter","VcfAdapter"].includes(N)}e.supportedIndexingAdapters=mn;function yn(N){let O;return Math.floor(N/1e6)>0?O=`${parseFloat((N/1e6).toPrecision(3))}Mbp`:Math.floor(N/1e3)>0?O=`${parseFloat((N/1e3).toPrecision(3))}Kbp`:O=`${Qt(Math.floor(N))}bp`,O}e.getBpDisplayStr=yn;function Qt(N){return N.toLocaleString("en-US")}e.toLocale=Qt;function En(N,O){let W;return Math.floor(O/1e3)>0?W=`${Qt(parseFloat((N/1e6).toFixed(2)))}M`:W=`${Qt(Math.floor(N))}`,W}e.getTickDisplayStr=En;function Xn(N,O){const{dynamicBlocks:W,staticBlocks:ee,offsetPx:te}=T(N),ge=(W==null?void 0:W.contentBlocks[0])||{},Te=(ee==null?void 0:ee.contentBlocks[0])||{},Me=(ee==null?void 0:ee.contentBlocks[1])||{};return{offsetPx:O?0:te-Te.offsetPx,offsetPx1:O?0:te-Me.offsetPx,start:ge.start,end:ge.end}}e.getViewParams=Xn;function xr({sessionId:N,layoutId:O}){return N+"-"+O}e.getLayoutId=xr;function ha(N,O){const[W,ee]=(0,i.useState)(()=>{if(typeof window>"u")return O;try{const ge=window.localStorage.getItem(N);return ge?JSON.parse(ge):O}catch(ge){return console.error(ge),O}});return[W,ge=>{try{const Te=ge instanceof Function?ge(W):ge;ee(Te),typeof window<"u"&&window.localStorage.setItem(N,JSON.stringify(Te))}catch(Te){console.error(Te)}}]}e.useLocalStorage=ha;function ma(N){const{uri:O,baseUri:W=""}=N;let ee;try{ee=new URL(O,W).href}catch{ee=O}return ee}e.getUriLink=ma;function kc(N){return(0,s.default)(N)?(0,g.isUriLocation)(N)?ma(N):JSON.stringify(N):String(N)}e.getStr=kc;function bh(N){return Math.max(...N.map(O=>Math.min(Math.max(We(kc(O),14)+50,80),1e3)))}e.measureGridWidth=bh}(Fi)),Fi}var Dv=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Lv=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Nv=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Dv(t,e,n);return Lv(t,e),t},Va=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xn,"__esModule",{value:!0});xn.MenuItemEndDecoration=void 0;const Pe=Nv(M.exports),wn=tt,Fv=ft,Bv=Va(Ih),Iv=Va(Oh),Ov=Va(jh),jv=Va(zh),zv=Va(qh),qv=Ee(),xf=(0,Fv.makeStyles)()({paper:{position:"fixed",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",top:0,left:0,outline:0},menuItemEndDecoration:{padding:0,margin:0,height:16}});function ws(e){const{classes:t}=xf(),{type:n}=e;let r,a;"checked"in e&&({checked:r,disabled:a}=e);let o;if(n==="subMenu")o=Pe.default.createElement(Bv.default,{color:"action"});else if(n==="checkbox")if(r){const i=a?"inherit":"secondary";o=Pe.default.createElement(Iv.default,{color:i})}else o=Pe.default.createElement(Ov.default,{color:"action"});else if(n==="radio")if(r){const i=a?"inherit":"secondary";o=Pe.default.createElement(jv.default,{color:i})}else o=Pe.default.createElement(zv.default,{color:"action"});return Pe.default.createElement("div",{className:t.menuItemEndDecoration},o)}xn.MenuItemEndDecoration=ws;function Vv(e,t){const n=e.slice(t+1).findIndex(r=>r.type!=="divider"&&r.type!=="subHeader"&&!r.disabled);return n===-1?n:t+1+n}function Hv(e,t){return(0,qv.findLastIndex)(e.slice(0,t),n=>n.type!=="divider"&&n.type!=="subHeader"&&!n.disabled)}const Pf=Pe.default.forwardRef((e,t)=>{const[n,r]=(0,Pe.useState)(),[a,o]=(0,Pe.useState)(),[i,s]=(0,Pe.useState)(!1),[c,u]=(0,Pe.useState)(),[d,f]=(0,Pe.useState)(),p=(0,Pe.useRef)(null),{classes:g}=xf(),{menuItems:h,onMenuItemClick:m,open:y,onClose:b,anchorEl:S,top:_=!1}=e;(0,Pe.useEffect)(()=>{y||(r(void 0),o(void 0))},[y]),(0,Pe.useEffect)(()=>{const E=y&&Boolean(n);let $;return E&&!i?$=setTimeout(()=>{s(!0)},300):!E&&i&&($=setTimeout(()=>{s(!1)},300)),()=>{clearTimeout($)}},[i,y,n]),(0,Pe.useEffect)(()=>{if(S){const E=S.getBoundingClientRect();d?(E.top!==d.top||E.left+E.width!==d.left)&&f({top:E.top,left:E.left+E.width}):f({top:E.top,left:E.left+E.width})}else d||f({})},[d,S]);const T=h.some(E=>"icon"in E&&E.icon),x={};function A(E){return $=>{m($,E)}}const R=Pe.default.createElement(Pe.default.Fragment,null,Pe.default.createElement(wn.MenuList,{autoFocusItem:y&&!i,dense:!0},h.sort((E,$)=>($.priority||0)-(E.priority||0)).map((E,$)=>{if(E.type==="divider")return Pe.default.createElement(wn.Divider,{key:`divider-${$}`,component:"li"});if(E.type==="subHeader")return Pe.default.createElement(wn.ListSubheader,{key:`subHeader-${E.label}-${$}`},E.label);let B=null,F=null;if(E.icon){const U=E.icon;B=Pe.default.createElement(wn.ListItemIcon,null,Pe.default.createElement(U,null))}"subMenu"in E?F=Pe.default.createElement(ws,{type:"subMenu"}):(E.type==="checkbox"||E.type==="radio")&&(F=Pe.default.createElement(ws,{type:E.type,checked:E.checked,disabled:E.disabled}));const I="onClick"in E?A(E.onClick):void 0;return Pe.default.createElement(wn.MenuItem,{key:E.label,style:x,selected:$===c,onClick:I,onMouseMove:U=>{U.currentTarget!==document.activeElement&&(U.currentTarget.focus(),u($)),"subMenu"in E?a!==$&&(r(U.currentTarget),o($)):(r(void 0),o(void 0))},onKeyDown:U=>{if(U.key==="ArrowLeft"||U.key==="Escape")b&&b(U,"escapeKeyDown");else if(U.key==="ArrowUp")u(Hv(h,$));else if(U.key==="ArrowDown"){const z=Vv(h,$);u(z)}else"subMenu"in E&&(U.key==="ArrowRight"||U.key==="Enter")&&(r(U.currentTarget),o($),s(!0))},disabled:Boolean(E.disabled)},B,Pe.default.createElement(wn.ListItemText,{primary:E.label,secondary:E.subLabel,inset:T&&!E.icon}),F)})),h.map((E,$)=>{let B=null;return"subMenu"in E&&(B=Pe.default.createElement(Pf,{key:E.label,anchorEl:n,open:i&&a===$,onClose:()=>{s(!1),r(void 0)},onMenuItemClick:m,menuItems:E.subMenu})),B}));return _?R:Pe.default.createElement(wn.Grow,{in:y,style:{transformOrigin:"0 0 0"},ref:t},Pe.default.createElement(wn.Paper,{elevation:8,ref:p,className:g.paper,style:{...d}},R))});function Wv(e){const{open:t,onClose:n,menuItems:r,onMenuItemClick:a,...o}=e;return Pe.default.createElement(wn.Popover,{transitionDuration:0,open:t,onClose:n,BackdropProps:{invisible:!0},...o},Pe.default.createElement(Pf,{open:t,onClose:n,menuItems:r,onMenuItemClick:a,top:!0}))}var Or=xn.default=Wv,Uv=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Gv=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Jv=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Uv(t,e,n);return Gv(t,e),t},kf=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(el,"__esModule",{value:!0});const Pr=Jv(M.exports),Mf=tt,Xv=ft,Yv=Dt,Kv=kf(Pd),Qv=kf(xn),Zv=(0,Xv.makeStyles)()(e=>({root:{display:"flex"},buttonRoot:{"&:hover":{backgroundColor:(0,Mf.alpha)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}));function ew({menuTitle:e,session:t,menuItems:n}){const[r,a]=(0,Pr.useState)(!1),o=(0,Pr.useRef)(null),{classes:i}=Zv();function s(){a(!r)}function c(d,f){f(t),u()}function u(){a(!1)}return Pr.default.createElement("div",{className:i.root},Pr.default.createElement(Mf.Button,{ref:o,onClick:s,color:"inherit","data-testid":"dropDownMenuButton",classes:{root:i.buttonRoot}},e,Pr.default.createElement(Kv.default,null)),Pr.default.createElement(Qv.default,{anchorEl:o.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:c,open:r,onClose:u,menuItems:n}))}el.default=(0,Yv.observer)(ew);var Ha={},tw=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),nw=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),rw=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&tw(t,e,n);return nw(t,e),t};Object.defineProperty(Ha,"__esModule",{value:!0});const Jt=rw(M.exports),Bi=tt,aw=ft,ow=(0,aw.makeStyles)()(e=>({input:{},inputBase:{},typography:{top:6,left:2,position:"absolute",whiteSpace:"nowrap",visibility:"hidden"},inputRoot:{padding:e.spacing(.5)},inputFocused:{borderStyle:"solid",borderWidth:2}})),iw=Jt.default.forwardRef((e,t)=>{const{value:n,setValue:r,variant:a,...o}=e,[i,s]=(0,Jt.useState)(),[c,u]=(0,Jt.useState)(0),[d,f]=(0,Jt.useState)(null),[p,g]=(0,Jt.useState)(null),[h,m]=(0,Jt.useState)(!1);(0,Jt.useEffect)(()=>{h&&(p&&p.blur(),m(!1))},[h,p]);const{classes:y}=ow(e,{props:e}),b=(0,Bi.useTheme)(),S=d==null?void 0:d.clientWidth;return S&&S!==c&&u(S),Jt.default.createElement("div",{...o,ref:t},Jt.default.createElement("div",{style:{position:"relative"}},Jt.default.createElement(Bi.Typography,{ref:_=>f(_),component:"span",variant:a,className:y.typography},i===void 0?n:i)),Jt.default.createElement(Bi.InputBase,{inputRef:_=>g(_),className:y.inputBase,inputProps:{style:{width:c,...a&&a!=="inherit"?b.typography[a]:{}}},classes:{input:y.input,root:y.inputRoot,focused:y.inputFocused},value:i===void 0?n:i,onChange:_=>s(_.target.value),onKeyDown:_=>{_.key==="Enter"?p&&p.blur():_.key==="Escape"&&(s(void 0),m(!0))},onBlur:()=>{i&&i!==n&&r(i),s(void 0)}}))});Ha.default=iw;var rl={},sw=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),lw=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),cw=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&sw(t,e,n);return lw(t,e),t},uw=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(rl,"__esModule",{value:!0});const en=cw(M.exports),po=tt,dw=uw(ea),fw=Dt;function pw({session:e}){const[t,n]=(0,en.useState)(!1),[r,a]=(0,en.useState)(),{popSnackbarMessage:o,snackbarMessages:i}=e,s=i.length?i[i.length-1]:null;(0,en.useEffect)(()=>{let p;return r?s?r[0]!==s[0]&&(n(!1),p=setTimeout(()=>{a(s),n(!0)},100)):a(void 0):s&&(a(s),n(!0)),()=>{clearTimeout(p)}},[s,r]);const c=(p,g)=>{g!=="clickaway"&&(o(),n(!1))},[u,d,f]=r||[];return en.default.createElement(po.Snackbar,{open:t&&!!u,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"center"}},en.default.createElement(po.Alert,{onClose:c,action:f?en.default.createElement(en.default.Fragment,null,en.default.createElement(po.Button,{color:"inherit",onClick:p=>{f.onClick(),c()}},f.name),en.default.createElement(po.IconButton,{"aria-label":"close",color:"inherit",onClick:c},en.default.createElement(dw.default,null))):null,severity:d||"warning"},u))}rl.default=(0,fw.observer)(pw);var al={},gw=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),hw=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),mw=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&gw(t,e,n);return hw(t,e),t},Wa=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(al,"__esModule",{value:!0});const rt=mw(M.exports),Lr=tt,yw=ft,bw=Zr,Rf=Dt,vw=Re,ww=Wa(qb),Sw=Wa(ea),Cw=Wa(Vh),_w=Wa(Ha),Tw=Wa(xn),xw=(0,yw.makeStyles)()(e=>({viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:(0,bw.alpha)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}})),Pw=(0,Rf.observer)(({model:e,IconButtonProps:t,IconProps:n})=>{const[r,a]=(0,rt.useState)(),{menuItems:o}=e,i=typeof o=="function"?o():o;return i!=null&&i.length?rt.default.createElement(rt.default.Fragment,null,rt.default.createElement(Lr.IconButton,{...t,style:{padding:3},onClick:s=>a(s.currentTarget),"data-testid":"view_menu_icon",size:"small"},rt.default.createElement(Cw.default,{...n,fontSize:"small"})),rt.default.createElement(Tw.default,{anchorEl:r,open:Boolean(r),onMenuItemClick:(s,c)=>{c(),a(void 0)},onClose:()=>a(void 0),menuItems:e.menuItems()})):null}),kw=(0,Rf.observer)(({view:e,onClose:t,style:n,children:r})=>{var a;const{classes:o}=xw(),s=(0,Lr.useTheme)().spacing(1),[c,{width:u}]=(0,ww.default)();(0,rt.useEffect)(()=>{u&&(0,vw.isAlive)(e)&&e.setWidth(u-parseInt(s,10)*2)},[s,e,u]);const d=(0,rt.useRef)(null);return(0,rt.useEffect)(()=>{var f,p;(p=(f=d.current)===null||f===void 0?void 0:f.scrollIntoView)===null||p===void 0||p.call(f,{block:"center"})},[]),rt.default.createElement(Lr.Paper,{ref:c,elevation:12,className:o.viewContainer,style:{...n,padding:`0px ${s} ${s}`}},rt.default.createElement("div",{ref:d,style:{display:"flex"}},rt.default.createElement(Pw,{model:e,IconButtonProps:{classes:{root:o.iconRoot},edge:"start"},IconProps:{className:o.icon}}),rt.default.createElement("div",{className:o.grow}),rt.default.createElement(Lr.Tooltip,{title:"Rename view",arrow:!0},rt.default.createElement(_w.default,{value:e.displayName||((a=e.assemblyNames)===null||a===void 0?void 0:a.join(","))||"Untitled view",setValue:f=>e.setDisplayName(f),variant:"body2",classes:{input:o.input,inputBase:o.inputBase,inputRoot:o.inputRoot,inputFocused:o.inputFocused}})),rt.default.createElement("div",{className:o.grow}),rt.default.createElement(Lr.IconButton,{"data-testid":"close_view",classes:{root:o.iconRoot},edge:"end",size:"small",onClick:t},rt.default.createElement(Sw.default,{className:o.icon,fontSize:"small"}))),rt.default.createElement(Lr.Paper,null,r))});al.default=kw;var Mw=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Rw=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Aw=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Mw(t,e,n);return Rw(t,e),t},gr=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ys,"__esModule",{value:!0});const we=Aw(M.exports),sn=tt,Ew=ft,$w=gr(Hh),Dw=Zo.exports,ni=Dt,Af=Re,Lw=C,Gc=gr(Qs),Nw=gr(el),Fw=gr(qa),Bw=gr(Ha),Iw=sr,Ow=gr(rl),jw=gr(al),ol=(0,Ew.makeStyles)()(e=>({root:{fontFamily:"Roboto",display:"grid",height:"100vh",width:"100%"},fabLeft:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),left:e.spacing(2)},fabRight:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),right:e.spacing(2)},menuBarAndComponents:{gridColumn:"main",display:"grid",gridTemplateRows:"[menubar] min-content [components] auto",height:"100vh"},menuBar:{gridRow:"menubar"},components:{overflowY:"auto",gridRow:"components"},appBar:{flexGrow:1},grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light},selectPaper:{padding:e.spacing(4)}})),zw=(0,ni.observer)(({session:e})=>{const{configuration:t}=e,n=(0,Lw.readConfObject)(t,"logoPath");return n!=null&&n.uri?we.default.createElement("img",{src:n.uri,alt:"Custom logo"}):we.default.createElement(Iw.LogoFull,{variant:"white"})}),qw=({session:e,HeaderButtons:t=we.default.createElement("div",null)})=>{const{classes:n}=ol(),{savedSessionNames:r,name:a,menus:o}=e;function i(s){r!=null&&r.includes(s)?e.notify(`Cannot rename session to "${s}", a saved session with that name already exists`,"warning"):e.renameCurrentSession(s)}return we.default.createElement(sn.Toolbar,null,o.map(s=>we.default.createElement(Nw.default,{key:s.label,menuTitle:s.label,menuItems:s.menuItems,session:e})),we.default.createElement("div",{className:n.grow}),we.default.createElement(sn.Tooltip,{title:"Rename Session",arrow:!0},we.default.createElement(Bw.default,{value:a,setValue:i,variant:"body1",classes:{inputBase:n.inputBase,inputRoot:n.inputRoot,inputFocused:n.inputFocused}})),t,we.default.createElement("div",{className:n.grow}),we.default.createElement("div",{style:{width:150,maxHeight:48}},we.default.createElement(zw,{session:e})))},Vw=(0,ni.observer)(({session:e})=>{var t;const{classes:n}=ol(),{pluginManager:r}=(0,Af.getEnv)(e),a=r.getElementTypeRecord("view").all(),[o,i]=(0,we.useState)((t=a[0])===null||t===void 0?void 0:t.name);return we.default.createElement(sn.Paper,{className:n.selectPaper},we.default.createElement(sn.Typography,null,"Select a view to launch"),we.default.createElement(sn.Select,{value:o,onChange:s=>i(s.target.value)},a.map(({name:s})=>we.default.createElement(sn.MenuItem,{key:s,value:s},s))),we.default.createElement(sn.Button,{onClick:()=>{e.addView(o,{})},variant:"contained",color:"primary"},"Launch view"))}),Hw=(0,ni.observer)(({view:e,session:t})=>{const{pluginManager:n}=(0,Af.getEnv)(t),r=n.getViewType(e.type);if(!r)throw new Error(`unknown view type ${e.type}`);const{ReactComponent:a}=r;return we.default.createElement(jw.default,{view:e,onClose:()=>t.removeView(e)},we.default.createElement(we.Suspense,{fallback:we.default.createElement("div",null,"Loading...")},we.default.createElement(a,{model:e,session:t,getTrackType:n.getTrackType})))}),Ww=(0,ni.observer)(e=>{const{session:t}=e,{classes:n}=ol(),{minimized:r,visibleWidget:a,drawerWidth:o,activeWidgets:i,views:s,drawerPosition:c}=t,u=a&&!r;let d;return c==="right"?d=["[main] 1fr",u?`[drawer] ${o}px`:void 0]:c==="left"&&(d=[u?`[drawer] ${o}px`:void 0,"[main] 1fr"]),we.default.createElement("div",{className:n.root,style:{gridTemplateColumns:d==null?void 0:d.filter(f=>!!f).join(" ")}},u&&c==="left"?we.default.createElement(Gc.default,{session:t}):null,t.DialogComponent?we.default.createElement(we.Suspense,{fallback:we.default.createElement("div",null)},we.default.createElement(t.DialogComponent,{...t.DialogProps})):null,we.default.createElement("div",{className:n.menuBarAndComponents},we.default.createElement("div",{className:n.menuBar},we.default.createElement(sn.AppBar,{className:n.appBar,position:"static"},we.default.createElement(qw,{...e}))),we.default.createElement("div",{className:n.components},s.length?s.map(f=>we.default.createElement(Dw.ErrorBoundary,{key:`view-${f.id}`,FallbackComponent:({error:p})=>we.default.createElement(Fw.default,{error:p})},we.default.createElement(Hw,{view:f,session:t}))):we.default.createElement(Vw,{...e}),we.default.createElement("div",{style:{height:300}}))),i.size>0&&r?we.default.createElement(sn.Tooltip,{title:"Open drawer widget"},we.default.createElement(sn.Fab,{className:c==="right"?n.fabRight:n.fabLeft,color:"primary","data-testid":"drawer-maximize",onClick:()=>t.showWidgetDrawer()},we.default.createElement($w.default,null))):null,u&&c==="right"?we.default.createElement(Gc.default,{session:t}):null,we.default.createElement(Ow.default,{session:t}))});Ys.default=Ww;var il={},Ef=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(il,"__esModule",{value:!0});const tn=Ef(M.exports),Uw=Dt,bn=tt,Gw=ft,Jw=Ef(ea),Xw=(0,Gw.makeStyles)()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function Yw({model:e,handleClose:t}){const{classes:n}=Xw();return tn.default.createElement(bn.Dialog,{maxWidth:"xl",open:!0,onClose:t},tn.default.createElement(bn.DialogTitle,null,"Reference sequence",t?tn.default.createElement(bn.IconButton,{className:n.closeButton,onClick:()=>t(),size:"large"},tn.default.createElement(Jw.default,null)):null),tn.default.createElement(bn.Divider,null),tn.default.createElement(bn.DialogContent,null,tn.default.createElement(bn.Typography,null,"Are you sure you want to return to the import form? This will lose your current view")),tn.default.createElement(bn.DialogActions,null,tn.default.createElement(bn.Button,{onClick:()=>{e.clearView(),t()},variant:"contained",color:"primary",autoFocus:!0},"OK"),tn.default.createElement(bn.Button,{onClick:()=>t(),color:"secondary",variant:"contained"},"Cancel")))}il.default=(0,Uw.observer)(Yw);var sl={},Kw=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Qw=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Zw=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Kw(t,e,n);return Qw(t,e),t};Object.defineProperty(sl,"__esModule",{value:!0});const Ii=Zw(M.exports),eS=Dt,Jc=tt,tS=Ee(),nS=ft,rS=C,aS=(0,nS.makeStyles)()(()=>({importFormEntry:{minWidth:180}})),oS=(0,eS.observer)(({session:e,onChange:t,selected:n,InputProps:r,extra:a=0})=>{const{classes:o}=aS(),{assemblyNames:i,assemblyManager:s}=e,c=new URLSearchParams(window.location.search).get("config"),[u,d]=(0,tS.useLocalStorage)(`lastAssembly-${[window.location.host+window.location.pathname,c,a].join("-")}`,n),f=i.includes(u||"")?u:n;(0,Ii.useEffect)(()=>{f&&f!==n&&t(f)},[f,t,n]);const p=i.length?"":"No configured assemblies";return Ii.default.createElement(Jc.TextField,{select:!0,label:"Assembly",variant:"outlined",helperText:p||"Select assembly to view",value:p?"":f,inputProps:{"data-testid":"assembly-selector"},onChange:g=>d(g.target.value),error:!!p,InputProps:r,disabled:!!p,className:o.importFormEntry},i.map(g=>{const h=s.get(g),m=h?(0,rS.getConf)(h,"displayName"):"";return Ii.default.createElement(Jc.MenuItem,{key:g,value:g},m||g)}))});sl.default=oS;var ll={},cl={},ul={},Y={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.generateUnknownTrackConf=e.generateUnsupportedTrackConf=e.guessTrackType=e.guessAdapter=e.getFileName=e.makeIndexType=e.makeIndex=e.storeBlobLocation=e.setBlobMap=e.getBlobMap=e.getBlob=e.UNSUPPORTED=e.UNKNOWN=e.getParentRenderProps=e.getRpcSessionId=e.getTrackAssemblyNames=void 0;const t=Re,n=Ee(),r=C;function a(T){const x=T.configuration,A=(0,r.readConfObject)(x,"assemblyNames");if(!A){const R=(0,t.getParent)(T.configuration);if("sequence"in R)return[(0,r.readConfObject)(R,"name")]}return A}e.getTrackAssemblyNames=a;function o(T){let x;for(let A=T;!(0,t.isRoot)(A);A=(0,t.getParent)(A))"rpcSessionId"in A&&(x=A.rpcSessionId);if(!x)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return x}e.getRpcSessionId=o;function i(T){for(let x=(0,t.getParent)(T);!(0,t.isRoot)(x);x=(0,t.getParent)(x))if("renderProps"in x)return x.renderProps();return{}}e.getParentRenderProps=i,e.UNKNOWN="UNKNOWN",e.UNSUPPORTED="UNSUPPORTED";let s={};function c(T){return s[T]}e.getBlob=c;function u(){return s}e.getBlobMap=u;function d(T){s=T}e.setBlobMap=d;let f=0;function p(T){if(T&&"blob"in T){const x=`b${+Date.now()}-${f++}`;return s[x]=T.blob,{name:T==null?void 0:T.blob.name,blobId:x,locationType:"BlobLocation"}}return T}e.storeBlobLocation=p;function g(T,x){return"uri"in T?{uri:T.uri+x,locationType:"UriLocation"}:"localPath"in T?{localPath:T.localPath+x,locationType:"LocalPathLocation"}:T}e.makeIndex=g;function h(T,x,A){return T!=null&&T.toUpperCase().endsWith(x)?x:A}e.makeIndexType=h;function m(T){const x="uri"in T?T.uri:void 0,A="localPath"in T?T.localPath:void 0,R="blobId"in T?T:void 0;return(R==null?void 0:R.name)||(x==null?void 0:x.slice(x.lastIndexOf("/")+1))||(A==null?void 0:A.slice(A.lastIndexOf("/")+1))||""}e.getFileName=m;function y(T,x,A,R){if(R){const{pluginManager:E}=(0,t.getEnv)(R),B=E.evaluateExtensionPoint("Core-guessAdapterForLocation",(F,I,U)=>{})(T,x,A);if(B)return B}return{type:e.UNKNOWN}}e.guessAdapter=y;function b(T,x){if(x){const A=(0,n.getSession)(x),E=(0,t.getEnv)(A).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",$=>{})(T);if(E)return E}return"FeatureTrack"}e.guessTrackType=b;function S(T,x,A){const R={type:"FeatureTrack",name:`${T} (Unsupported)`,description:`Support not yet implemented for "${x}"`,category:A,trackId:""};return R.trackId=(0,n.objectHash)(R),R}e.generateUnsupportedTrackConf=S;function _(T,x,A){const R={type:"FeatureTrack",name:`${T} (Unknown)`,description:`Could not determine track type for "${x}"`,category:A,trackId:""};return R.trackId=(0,n.objectHash)(R),R}e.generateUnknownTrackConf=_})(Y);var iS=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ul,"__esModule",{value:!0});const $n=iS(M.exports),Yn=tt,sS=ft,lS=Ee(),Xc=Y;function cS(e){return"localPath"in e}function Yc(e){return"blobId"in e}const uS=(0,sS.makeStyles)()(e=>({filename:{marginLeft:e.spacing(1)}}));function dS(e){const{classes:t}=uS(),{location:n,setLocation:r}=e,a=n&&(Yc(n)&&n.name||cS(n)&&n.localPath),o=n&&Yc(n)&&!(0,Xc.getBlob)(n.blobId);return $n.default.createElement(Yn.Box,{display:"flex",flexDirection:"row",alignItems:"center"},$n.default.createElement(Yn.Box,null,$n.default.createElement(Yn.FormControl,{fullWidth:!0},$n.default.createElement(Yn.Button,{variant:"outlined",component:"label"},"Choose File",$n.default.createElement("input",{type:"file",hidden:!0,onChange:({target:i})=>{const s=i&&i.files&&i.files[0];s&&(lS.isElectron?r({localPath:s.path,locationType:"LocalPathLocation"}):r((0,Xc.storeBlobLocation)({blob:s})))}})))),$n.default.createElement(Yn.Box,null,$n.default.createElement(Yn.Typography,{component:"span",className:t.filename,color:a?"initial":"textSecondary"},a||"No file chosen"),o?$n.default.createElement(Yn.Typography,{color:"error"},"(need to reload)"):null))}ul.default=dS;var dl={},fS=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dl,"__esModule",{value:!0});const Oi=fS(M.exports),pS=tt,gS=Dt,hS=Ut;function mS(e){const{location:t,setLocation:n,label:r}=e;return Oi.default.createElement(Oi.default.Fragment,null,Oi.default.createElement(pS.TextField,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:t&&(0,hS.isUriLocation)(t)?t.uri:"",label:r||"Enter URL",onChange:a=>{n({uri:a.target.value.trim(),locationType:"UriLocation"})}}))}dl.default=(0,gS.observer)(mS);var yS=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),bS=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),vS=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&yS(t,e,n);return bS(t,e),t},fl=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(cl,"__esModule",{value:!0});const Oe=vS(M.exports),wS=Dt,Nt=tt,go=Ut,SS=fl(ul),CS=fl(dl),_S=fl(Pd);function TS(e){const{title:t,children:n,...r}=e;return Oe.default.createElement(Nt.Tooltip,{title:t||""},Oe.default.createElement(Nt.ToggleButton,{...r},n))}function Kc(e,t){return typeof e=="string"&&e.length>t?`${e.substring(0,t)}\u2026`:e}const xS=(0,wS.observer)(e=>{const{location:t,name:n,description:r,rootModel:a,setLocation:o}=e,i=!t||(0,go.isUriLocation)(t)?"url":"file",[s,c]=(0,Oe.useState)(t&&"internetAccountId"in t&&t.internetAccountId?t.internetAccountId:i),u=(0,go.isAppRootModel)(a)?a.internetAccounts.slice():[],d=2,[f,p]=(0,Oe.useState)(u.slice(0,d)),[g,h]=(0,Oe.useState)(u.slice(d)),[m,y]=(0,Oe.useState)(null),b=u.find(T=>T.internetAccountId===s),S=T=>{o({...T,internetAccountId:b?b.internetAccountId:void 0})};t&&b&&(0,go.isUriLocation)(t)&&t.internetAccountId!==b.internetAccountId&&S(t);let _=Oe.default.createElement(CS.default,{...e,setLocation:S,label:b==null?void 0:b.selectorLabel});if(s==="file"&&(_=Oe.default.createElement(SS.default,{...e})),b!=null&&b.SelectorComponent){const{SelectorComponent:T}=b;_=Oe.default.createElement(T,{...e,setLocation:S})}return Oe.default.createElement(Oe.default.Fragment,null,Oe.default.createElement(Nt.Box,{display:"flex"},Oe.default.createElement(Nt.InputLabel,{shrink:!0},n)),Oe.default.createElement(Nt.Box,{display:"flex",flexDirection:"row"},Oe.default.createElement(Nt.Box,null,Oe.default.createElement(Nt.ToggleButtonGroup,{value:s,exclusive:!0,onChange:(T,x)=>{x&&c(x),(0,go.isUriLocation)(t)&&S(t)},"aria-label":"file, url, or account picker"},new URLSearchParams(window.location.search).get("adminKey")?null:Oe.default.createElement(Nt.ToggleButton,{value:"file","aria-label":"local file"},"File"),Oe.default.createElement(Nt.ToggleButton,{value:"url","aria-label":"url"},"URL"),f.map(({internetAccountId:T,toggleContents:x,name:A})=>Oe.default.createElement(TS,{key:T,value:T,"aria-label":A,title:A},typeof x=="string"?Kc(x,5):x||Kc(A,5))),g.length?Oe.default.createElement(Nt.ToggleButton,{onClick:T=>y(T.target),selected:!1},"More",Oe.default.createElement(_S.default,null)):null),Oe.default.createElement(Nt.Menu,{open:Boolean(m),anchorEl:m,onClose:()=>y(null),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},g==null?void 0:g.map((T,x)=>Oe.default.createElement(Nt.MenuItem,{key:T.internetAccountId,value:T.internetAccountId,onClick:()=>{const A=f[f.length-1];p([...f.slice(0,f.length-1),T]),h([A,...g.slice(0,x),...g.slice(x+1)]),c(T.internetAccountId),y(null)}},T.name))))),_,Oe.default.createElement(Nt.FormHelperText,null,r))});cl.default=xS;var PS=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ll,"__esModule",{value:!0});const kS=PS(cl);var va=ll.default=kS.default,pl={},MS=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),RS=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),AS=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&MS(t,e,n);return RS(t,e),t},ES=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(pl,"__esModule",{value:!0});const kr=ES(on.exports),ho=AS(M.exports),$S=ht;function gl(e){const{width:t,height:n,highResolutionScaling:r,style:a,imageData:o,blockKey:i,showSoftClip:s}=e,[c,u]=(0,ho.useState)(!1),d=(0,ho.useRef)(null);(0,ho.useEffect)(()=>{if(!o)return;const h=d.current;if(!h)return;const m=h.getContext("2d");!m||((0,$S.drawImageOntoCanvasContext)(o,m),u(!0))},[o]);const f=s?"_softclipped":"",p=i?"_"+i:"",g=`prerendered_canvas${f}${p}${c?"_done":""}`;return ho.default.createElement("canvas",{"data-testid":g,ref:d,width:t*r,height:n*r,style:{width:t,height:n,...a}})}gl.propTypes={height:kr.default.number.isRequired,width:kr.default.number.isRequired,highResolutionScaling:kr.default.number,style:kr.default.objectOf(kr.default.any),imageData:kr.default.any};gl.defaultProps={imageData:void 0,highResolutionScaling:1,style:{}};pl.default=gl;var ri={},hr=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ri,"__esModule",{value:!0});const Qc=hr(Ns),DS=hr(Fs),LS=hr(Bs),NS=hr(Is),FS=hr(kd),BS=hr(Os),Kn=hr(M.exports);ri.default=({onClose:e,open:t,onFactoryReset:n})=>{function r(a){a==="reset"&&n(),e()}return Kn.default.createElement(DS.default,{open:t,onClose:()=>r()},Kn.default.createElement(LS.default,{id:"alert-dialog-title"},"Reset"),Kn.default.createElement(NS.default,null,Kn.default.createElement(FS.default,{id:"alert-dialog-description"},"Are you sure you want to reset? This will restore the default configuration.")),Kn.default.createElement(BS.default,null,Kn.default.createElement(Qc.default,{onClick:()=>r(),color:"primary"},"Cancel"),Kn.default.createElement(Qc.default,{onClick:()=>r("reset"),color:"primary",variant:"contained"},"OK")))};var hl={},IS=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),OS=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),jS=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&IS(t,e,n);return OS(t,e),t};Object.defineProperty(hl,"__esModule",{value:!0});const ji=jS(M.exports),zS=ft,qS=Dt,VS=C,HS=(0,zS.makeStyles)()({hoverLabel:{border:"1px solid black",position:"absolute",background:"#fffa",pointerEvents:"none",zIndex:1e4}}),WS=({offsetX:e,offsetY:t,configuration:n,feature:r,timeout:a=300})=>{const{classes:o}=HS(),[i,s]=(0,ji.useState)(!1);if((0,ji.useEffect)(()=>{const c=setTimeout(()=>s(!0),a);return()=>clearTimeout(c)}),r&&i){const c=(0,VS.readConfObject)(n,"mouseover",{feature:r});return ji.default.createElement("div",{className:o.hoverLabel,style:{left:e,top:t}},c)}return null};hl.default=(0,qS.observer)(WS);var ml={},US=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),GS=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),JS=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&US(t,e,n);return GS(t,e),t},mr=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ml,"__esModule",{value:!0});const $f=mr(Ns),XS=mr(Fs),YS=mr(Os),KS=mr(Is),QS=mr(Bs),Br=mr(on.exports),Ht=JS(M.exports),ZS=mr(ri),Df=({onFactoryReset:e,resetButtonText:t})=>{const[n,r]=(0,Ht.useState)(!1);return Ht.default.createElement(Ht.default.Fragment,null,Ht.default.createElement($f.default,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:()=>r(!0)},t),Ht.default.createElement(ZS.default,{onClose:()=>r(!1),open:n,onFactoryReset:e}))};Df.propTypes={onFactoryReset:Br.default.func.isRequired,resetButtonText:Br.default.string.isRequired};const yl=({componentStack:e,error:t,onFactoryReset:n,resetButtonText:r})=>Ht.default.createElement(XS.default,{open:!0},Ht.default.createElement(QS.default,{style:{backgroundColor:"#e88"}},"Fatal error"),Ht.default.createElement(KS.default,null,Ht.default.createElement("pre",null,t.toString(),e)),Ht.default.createElement(YS.default,null,Ht.default.createElement($f.default,{color:"secondary",variant:"contained",onClick:()=>window.location.reload()},"Refresh"),Ht.default.createElement(Df,{onFactoryReset:n,resetButtonText:r})));yl.propTypes={componentStack:Br.default.string,error:Br.default.shape({}),onFactoryReset:Br.default.func.isRequired,resetButtonText:Br.default.string};yl.defaultProps={error:{message:"No error message provided"},componentStack:"",resetButtonText:"Factory Reset"};ml.default=yl;var bl={},eC=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),tC=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),nC=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&eC(t,e,n);return tC(t,e),t},Lf=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(bl,"__esModule",{value:!0});const _e=nC(M.exports),In=tt,Zc=xn,Pa=Po,rC=Lf(Zb),aC=Lf(Wh),Ur=_e.default.createContext({parentPopupState:null,rootPopupState:null});function oC({onClick:e,...t}){const{rootPopupState:n}=(0,_e.useContext)(Ur);if(!n)throw new Error("must be used inside a CascadingMenu");const r=(0,_e.useCallback)(a=>{n.close(),e==null||e(a)},[n,e]);return _e.default.createElement(In.MenuItem,{...t,onClick:r})}function iC({title:e,inset:t,popupId:n,...r}){const{parentPopupState:a}=_e.default.useContext(Ur),o=(0,Pa.usePopupState)({popupId:n,variant:"popover",parentPopupState:a});return _e.default.createElement(_e.default.Fragment,null,_e.default.createElement(In.MenuItem,{...(0,Pa.bindHover)(o),...(0,Pa.bindFocus)(o)},_e.default.createElement(In.ListItemText,{primary:e,inset:t}),_e.default.createElement(aC.default,null)),_e.default.createElement(sC,{...r,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},popupState:o}))}function sC({popupState:e,onMenuItemClick:t,menuItems:n,classes:r,...a}){const{rootPopupState:o}=(0,_e.useContext)(Ur),i=(0,_e.useMemo)(()=>({rootPopupState:o||e,parentPopupState:e}),[o,e]);return _e.default.createElement(Ur.Provider,{value:i},_e.default.createElement(rC.default,{...a,...(0,Pa.bindMenu)(e)}))}function lC({popupState:e,onMenuItemClick:t,menuItems:n,...r}){const{rootPopupState:a}=_e.default.useContext(Ur),o=_e.default.useMemo(()=>({rootPopupState:a||e,parentPopupState:e}),[a,e]);return _e.default.createElement(Ur.Provider,{value:o},_e.default.createElement(In.Menu,{...r,...(0,Pa.bindMenu)(e)}))}function cC({item:e}){return"subMenu"in e?_e.default.createElement(Zc.MenuItemEndDecoration,{type:"subMenu"}):e.type==="checkbox"||e.type==="radio"?_e.default.createElement(Zc.MenuItemEndDecoration,{type:e.type,checked:e.checked,disabled:e.disabled}):null}function Nf({onMenuItemClick:e,menuItems:t,...n}){function r(o){return i=>{e(i,o)}}const a=t.some(o=>"icon"in o&&o.icon);return _e.default.createElement(_e.default.Fragment,null,t.map((o,i)=>"subMenu"in o?_e.default.createElement(iC,{key:`subMenu-${o.label}-${i}`,popupId:`subMenu-${o.label}`,title:o.label,inset:a,onMenuItemClick:e,menuItems:o.subMenu},_e.default.createElement(Nf,{...n,onMenuItemClick:e,menuItems:o.subMenu})):o.type==="divider"?_e.default.createElement(In.Divider,{key:`divider-${i}`,component:"li"}):o.type==="subHeader"?_e.default.createElement(In.ListSubheader,{key:`subHeader-${o.label}-${i}`},o.label):_e.default.createElement(oC,{key:`${o.label}-${i}`,onClick:"onClick"in o?r(o.onClick):void 0,disabled:Boolean(o.disabled)},o.icon?_e.default.createElement(In.ListItemIcon,null,_e.default.createElement(o.icon,null)):null," ",_e.default.createElement(In.ListItemText,{primary:o.label,secondary:o.subLabel,inset:a&&!o.icon}),_e.default.createElement("div",{style:{flexGrow:1,minWidth:10}}),_e.default.createElement(cC,{item:o}))))}function uC(e){return _e.default.createElement(lC,{...e},_e.default.createElement(Nf,{...e}))}var dC=bl.default=uC,na={},vl=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(na,"__esModule",{value:!0});na.isHTML=void 0;const fC=vl(M.exports),pC=vl(u0),eu=vl(d0.exports),gC=["a","b","br","code","div","em","h1","h2","h3","h4","h5","h6","i","img","li","p","pre","span","small","strong","table","tbody","td","tfoot","th","thead","tr","u","ul"];let tu=!1;const hC=new RegExp(gC.map(e=>`<${e}\\b[^>]*>`).join("|"),"i");function Ff(e){return hC.test(e)}na.isHTML=Ff;function mC({html:e}){const t=Ff(e)?e:(0,pC.default)(e);return tu||(tu=!0,eu.default.addHook("afterSanitizeAttributes",n=>{n.tagName==="A"&&(n.setAttribute("rel","noopener noreferrer"),n.setAttribute("target","_blank"))})),fC.default.createElement("div",{dangerouslySetInnerHTML:{__html:eu.default.sanitize(t)}})}na.default=mC;(function(e){var t=v&&v.__createBinding||(Object.create?function(_,T,x,A){A===void 0&&(A=x);var R=Object.getOwnPropertyDescriptor(T,x);(!R||("get"in R?!T.__esModule:R.writable||R.configurable))&&(R={enumerable:!0,get:function(){return T[x]}}),Object.defineProperty(_,A,R)}:function(_,T,x,A){A===void 0&&(A=x),_[A]=T[x]}),n=v&&v.__exportStar||function(_,T){for(var x in _)x!=="default"&&!Object.prototype.hasOwnProperty.call(T,x)&&t(T,_,x)},r=v&&v.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(e,"__esModule",{value:!0}),e.SanitizedHTML=e.CascadingMenu=e.Menu=e.FatalErrorDialog=e.Tooltip=e.FactoryResetDialog=e.EditableTypography=e.ResizeHandle=e.PrerenderedCanvas=e.FileSelector=e.AssemblySelector=e.ErrorMessage=e.ReturnToImportFormDialog=e.App=e.Logomark=e.LogoFull=void 0,n(of,e);var a=sr;Object.defineProperty(e,"LogoFull",{enumerable:!0,get:function(){return a.LogoFull}}),Object.defineProperty(e,"Logomark",{enumerable:!0,get:function(){return a.Logomark}});var o=Ys;Object.defineProperty(e,"App",{enumerable:!0,get:function(){return r(o).default}});var i=il;Object.defineProperty(e,"ReturnToImportFormDialog",{enumerable:!0,get:function(){return r(i).default}});var s=qa;Object.defineProperty(e,"ErrorMessage",{enumerable:!0,get:function(){return r(s).default}});var c=sl;Object.defineProperty(e,"AssemblySelector",{enumerable:!0,get:function(){return r(c).default}});var u=ll;Object.defineProperty(e,"FileSelector",{enumerable:!0,get:function(){return r(u).default}});var d=pl;Object.defineProperty(e,"PrerenderedCanvas",{enumerable:!0,get:function(){return r(d).default}});var f=ti;Object.defineProperty(e,"ResizeHandle",{enumerable:!0,get:function(){return r(f).default}});var p=Ha;Object.defineProperty(e,"EditableTypography",{enumerable:!0,get:function(){return r(p).default}});var g=ri;Object.defineProperty(e,"FactoryResetDialog",{enumerable:!0,get:function(){return r(g).default}});var h=hl;Object.defineProperty(e,"Tooltip",{enumerable:!0,get:function(){return r(h).default}});var m=ml;Object.defineProperty(e,"FatalErrorDialog",{enumerable:!0,get:function(){return r(m).default}});var y=xn;Object.defineProperty(e,"Menu",{enumerable:!0,get:function(){return r(y).default}});var b=bl;Object.defineProperty(e,"CascadingMenu",{enumerable:!0,get:function(){return r(b).default}});var S=na;Object.defineProperty(e,"SanitizedHTML",{enumerable:!0,get:function(){return r(S).default}}),n(xn,e)})(Le);const yC=ae()({paper:{overflow:"auto"}}),bC=j(({session:e})=>{const{visibleWidget:t}=e;if(!t)return l(Rc,{position:"relative",children:l(Ac,{})});const{ReactComponent:n,HeadingComponent:r,heading:a}=He(e).pluginManager.getWidgetType(t.type);return w(Z,{children:[l(Rc,{position:"static",children:l(Ac,{children:r?l(r,{model:t}):l(X,{variant:"h6",children:a})})}),t&&n?l(M.exports.Suspense,{fallback:l("div",{children:"Loading..."}),children:l(Md,{children:l(n,{model:t,session:e,overrideDimensions:{height:window.innerHeight*5/8,width:800}})})}):null]})}),vC=j(({session:e})=>{const{classes:t}=yC(),{visibleWidget:n,hideAllWidgets:r}=e;return l(De,{open:Boolean(n),onClose:r,maxWidth:"xl",children:l(Je,{className:t.paper,children:l(bC,{session:e})})})}),wC="modulepreload",SC=function(e){return"/"+e},nu={},se=function(t,n,r){return!n||n.length===0?t():Promise.all(n.map(a=>{if(a=SC(a),a in nu)return;nu[a]=!0;const o=a.endsWith(".css"),i=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${i}`))return;const s=document.createElement("link");if(s.rel=o?"stylesheet":wC,o||(s.as="script",s.crossOrigin=""),s.href=a,document.head.appendChild(s),o)return new Promise((c,u)=>{s.addEventListener("load",c),s.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())};var P=Ee();const CC=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>nN),void 0)),_C=ae()(e=>({viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},displayName:{marginTop:2,color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:zt(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),TC=j(({model:e,IconButtonProps:t,IconProps:n})=>{var r;const[a,o]=M.exports.useState();return!((r=e.menuItems())===null||r===void 0)&&r.length?w(Z,{children:[l(pe,{...t,"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:i=>o(i.currentTarget),"data-testid":"view_menu_icon",children:l(Rd,{...n})}),l(Le.Menu,{anchorEl:a,open:Boolean(a),onMenuItemClick:(i,s)=>{s(),o(void 0)},onClose:()=>o(void 0),menuItems:e.menuItems()})]}):null}),xC=j(({view:e,children:t})=>{const{classes:n}=_C(),r=Fa(),a=P.getSession(e),[o,i]=M.exports.useState(!1),[s,{width:c}]=Vb(),u=r.spacing(1);return M.exports.useEffect(()=>{c&&Ye(e)&&e.setWidth(c-parseInt(u,10)*2)},[u,e,c]),w(Je,{elevation:12,ref:s,className:n.viewContainer,style:{padding:`0px ${u} ${u}`},children:[a.DialogComponent?$t.createElement(M.exports.Suspense,{fallback:l("div",{})},$t.createElement(a.DialogComponent,{...a.DialogProps})):null,w("div",{style:{display:"flex"},children:[l(TC,{model:e,IconButtonProps:{classes:{root:n.iconRoot},edge:"start"},IconProps:{className:n.icon}}),l("div",{className:n.grow}),e.displayName?l(X,{variant:"body2",className:n.displayName,children:e.displayName}):null,l("div",{className:n.grow}),l(pe,{onClick:()=>i(!0),children:l("div",{style:{width:22,height:22},children:l(Le.Logomark,{variant:"white"})})})]}),l(Je,{children:t}),o?l(M.exports.Suspense,{fallback:l("div",{}),children:l(CC,{open:!0,onClose:()=>i(!1)})}):null]})}),PC=ae()(()=>({avoidParentStyle:{all:"initial"}})),kC=jb({key:"mui",prepend:!0}),G2=j(({viewState:e})=>{const{classes:t}=PC(),{session:n}=e,{view:r}=n,{pluginManager:a}=He(n),o=a.getViewType(r.type);if(!o)throw new Error(`unknown view type ${r.type}`);const{ReactComponent:i}=o,s=Le.createJBrowseTheme(C.readConfObject(e.config.configuration,"theme"));return l(zb,{value:kC,children:l(Uh,{theme:s,children:l("div",{className:t.avoidParentStyle,children:w(Md,{children:[l(xC,{view:r,children:l(M.exports.Suspense,{fallback:l("div",{children:"Loading..."}),children:l(i,{model:r,session:n})})},`view-${r.id}`),l(vC,{session:n})]})})})})});var wl={},Sl={},Cl={},ai={};Object.defineProperty(ai,"__esModule",{value:!0});class MC extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[n,r]of t)this.onEviction(n,r.value)}_deleteIfExpired(t,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,n.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,n){if(this._deleteIfExpired(t,n)===!1)return n.value}_getItemValue(t,n){return n.expiry?this._getOrDeleteIfExpired(t,n):n.value}_peek(t,n){const r=n.get(t);return this._getItemValue(t,r)}_set(t,n){this.cache.set(t,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,n){this.oldCache.delete(t),this._set(t,n)}*_entriesAscending(){for(const t of this.oldCache){const[n,r]=t;this.cache.has(n)||this._deleteIfExpired(n,r)===!1&&(yield t)}for(const t of this.cache){const[n,r]=t;this._deleteIfExpired(n,r)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const n=this.cache.get(t);return this._getItemValue(t,n)}if(this.oldCache.has(t)){const n=this.oldCache.get(t);if(this._deleteIfExpired(t,n)===!1)return this._moveToRecent(t,n),n.value}}set(t,n,{maxAge:r=this.maxAge}={}){const a=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;this.cache.has(t)?this.cache.set(t,{value:n,expiry:a}):this._set(t,{value:n,expiry:a})}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const n=this.cache.delete(t);return n&&this._size--,this.oldCache.delete(t)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],r=n.length-t;r<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(r>0&&this._emitEvictions(n.slice(0,r)),this.oldCache=new Map(n.slice(r)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[n,r]=t;this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}for(const t of this.oldCache){const[n,r]=t;this.cache.has(n)||this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}}*entriesDescending(){let t=[...this.cache];for(let n=t.length-1;n>=0;--n){const r=t[n],[a,o]=r;this._deleteIfExpired(a,o)===!1&&(yield[a,o.value])}t=[...this.oldCache];for(let n=t.length-1;n>=0;--n){const r=t[n],[a,o]=r;this.cache.has(a)||this._deleteIfExpired(a,o)===!1&&(yield[a,o.value])}}*entriesAscending(){for(const[t,n]of this._entriesAscending())yield[t,n.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const n of this.oldCache.keys())this.cache.has(n)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,n=this){for(const[r,a]of this.entriesAscending())t.call(n,a,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}var RC=ai.default=MC,_l=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Cl,"__esModule",{value:!0});const AC=_l(Hb),zi=Re,EC=_l(Wb),mo=C,Bf=Ee(),$C=_l(ai),DC=new RegExp("[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*"),LC=["rgb(153, 102, 0)","rgb(102, 102, 0)","rgb(153, 153, 30)","rgb(204, 0, 0)","rgb(255, 0, 0)","rgb(255, 0, 204)","rgb(165, 132, 132)","rgb(204, 122, 0)","rgb(178, 142, 0)","rgb(153, 153, 0)","rgb(122, 153, 0)","rgb(0, 165, 0)","rgb(53, 128, 0)","rgb(0, 0, 204)","rgb(96, 145, 242)","rgb(107, 142, 178)","rgb(0, 165, 165)","rgb(122, 153, 153)","rgb(153, 0, 204)","rgb(204, 51, 255)","rgb(173, 130, 216)","rgb(102, 102, 102)","rgb(145, 145, 145)","rgb(142, 142, 142)","rgb(142, 142, 107)","rgb(96, 163, 48)"];async function NC(e,t,n,r){const{sessionId:a}=n;await(0,Bf.when)(()=>Boolean(e.regions&&e.refNameAliases),{signal:r,name:"when assembly ready"});const o=await e.rpcManager.call(a,"CoreGetRefNames",{adapterConfig:t,signal:r,...n},{timeout:1e6}),{refNameAliases:i}=e;if(!i)throw new Error(`error loading assembly ${e.name}'s refNameAliases`);const s=Object.fromEntries(o.map(u=>(Ss(u),[e.getCanonicalRefName(u),u]))),c=Object.fromEntries(Object.entries(s).map(([u,d])=>[d,u]));return{forwardMap:s,reverseMap:c}}function Ss(e){if(!e.match(DC))throw new Error(`Encountered invalid refName: "${e}"`)}function FC(e){return(0,AC.default)(e)}function BC(e,t){const n=new EC.default({cache:new $C.default({maxSize:1e3}),async fill(r,a,o){const{adapterConf:i,self:s,options:c}=r;return NC(s,i,{...c,statusCallback:o},a)}});return zi.types.model({configuration:zi.types.safeReference(e)}).volatile(()=>({error:void 0,regions:void 0,refNameAliases:void 0,lowerCaseRefNameAliases:void 0,cytobands:void 0})).views(r=>({get initialized(){return!!r.refNameAliases},get name(){return(0,mo.getConf)(r,"name")},get aliases(){return(0,mo.getConf)(r,"aliases")},get displayName(){return(0,mo.getConf)(r,"displayName")},hasName(a){return this.allAliases.includes(a)},get allAliases(){return[this.name,...this.aliases]},get refNames(){var a;return(a=r.regions)===null||a===void 0?void 0:a.map(o=>o.refName)},get allRefNames(){return r.refNameAliases?Object.keys(r.refNameAliases):void 0},get lowerCaseRefNames(){return r.lowerCaseRefNameAliases?Object.keys(r.lowerCaseRefNameAliases||{}):void 0},get allRefNamesWithLowerCase(){return this.allRefNames&&this.lowerCaseRefNames?[...new Set([...this.allRefNames,...this.lowerCaseRefNames])]:void 0},get rpcManager(){return(0,zi.getParent)(r,2).rpcManager},get refNameColors(){const a=(0,mo.getConf)(r,"refNameColors");return a.length===0?LC:a}})).views(r=>({getCanonicalRefName(a){if(!r.refNameAliases||!r.lowerCaseRefNameAliases)throw new Error("aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called");return r.refNameAliases[a]||r.lowerCaseRefNameAliases[a]},getRefNameColor(a){var o;const i=(o=r.refNames)===null||o===void 0?void 0:o.findIndex(s=>s===a);if(!(i===void 0||i===-1))return r.refNameColors[i%r.refNameColors.length]},isValidRefName(a){if(!r.refNameAliases)throw new Error("isValidRefName cannot be called yet, the assembly has not finished loading");return!!this.getCanonicalRefName(a)}})).actions(r=>({setLoading(){},setLoaded({adapterRegionsWithAssembly:a,refNameAliases:o,lowerCaseRefNameAliases:i,cytobands:s}){this.setRegions(a),this.setRefNameAliases(o,i),this.setCytobands(s)},setError(a){console.error(a),r.error=a},setRegions(a){r.regions=a},setRefNameAliases(a,o){r.refNameAliases=a,r.lowerCaseRefNameAliases=o},setCytobands(a){r.cytobands=a},afterAttach(){(0,Bf.makeAbortableReaction)(r,IC(t),OC,{name:`${r.name} assembly loading`,fireImmediately:!0},this.setLoading,this.setLoaded,this.setError)}})).views(r=>({getAdapterMapEntry(a,o){const{signal:i,statusCallback:s,...c}=o;if(!o.sessionId)throw new Error("sessionId is required");const u=FC(a);return n.get(u,{adapterConf:a,self:r,options:c},void 0,s)},async getRefNameMapForAdapter(a,o){if(!o||!o.sessionId)throw new Error("sessionId is required");return(await this.getAdapterMapEntry(a,o)).forwardMap},async getReverseRefNameMapForAdapter(a,o){return(await this.getAdapterMapEntry(a,o)).reverseMap}}))}Cl.default=BC;function IC(e){return t=>{if(t.configuration){const{sequence:n,refNameAliases:r,cytobands:a}=t.configuration,o=n.adapter,i=r==null?void 0:r.adapter,s=a==null?void 0:a.adapter;return{sequenceAdapterConfig:o,assemblyName:t.name,refNameAliasesAdapterConfig:i,cytobandAdapterConfig:s,pluginManager:e}}}}async function OC(e,t){if(!e)return;const{sequenceAdapterConfig:n,assemblyName:r,refNameAliasesAdapterConfig:a,cytobandAdapterConfig:o,pluginManager:i}=e,c=(await qC(n,i,t)).map(g=>(Ss(g.refName),{...g,assemblyName:r})),u={},d=await jC(a,i,t),f=await zC(o,i);d.forEach(({refName:g,aliases:h})=>{h.forEach(m=>{Ss(m),u[m]=g})}),c.forEach(g=>{u[g.refName]=g.refName});const p=Object.fromEntries(Object.entries(u).map(([g,h])=>[g.toLowerCase(),h]));return{adapterRegionsWithAssembly:c,refNameAliases:u,lowerCaseRefNameAliases:p,cytobands:f}}async function jC(e,t,n){var r;const a=t.getAdapterType(e.type),o=await((r=a.getAdapterClass)===null||r===void 0?void 0:r.call(a));return new o(e,void 0,t).getRefNameAliases({signal:n})}async function zC(e,t){const r=await t.getAdapterType(e.type).getAdapterClass();return new r(e,void 0,t).getData()}async function qC(e,t,n){const a=await t.getAdapterType(e.type).getAdapterClass();return new a(e,void 0,t).getRegions({signal:n})}var VC=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Sl,"__esModule",{value:!0});const HC=dr,Qn=Re,ru=Ee(),WC=C,UC=VC(Cl);function GC(e,t){const n=(0,UC.default)(e,t);return Qn.types.model({assemblies:Qn.types.array(n)}).views(r=>({get(a){return r.assemblies.find(o=>o.hasName(a))},get assemblyNamesList(){return this.assemblyList.map(a=>a.name)},get assemblyList(){const{jbrowse:{assemblies:a},session:{sessionAssemblies:o=[],temporaryAssemblies:i=[]}={}}=(0,Qn.getParent)(r);return[...a,...o,...i]},get rpcManager(){return(0,Qn.getParent)(r).rpcManager},get pluginManager(){return(0,Qn.getParent)(r).pluginManager},get allPossibleRefNames(){let a=[];for(const o of r.assemblies){if(!o.allRefNames)return;a=a.concat(o.allRefNames)}return a}})).views(r=>({async waitForAssembly(a){if(!a)throw new Error("no assembly name supplied to waitForAssembly");let o=r.get(a);if(!o)try{await(0,ru.when)(()=>Boolean(r.get(a)),{timeout:1e3}),o=r.get(a)}catch{}if(!!o){if(await(0,ru.when)(()=>Boolean((o==null?void 0:o.regions)&&o.refNameAliases)||!!(o!=null&&o.error)),o.error)throw o.error;return o}},async getRefNameMapForAdapter(a,o,i){if(o){const s=await this.waitForAssembly(o);return s==null?void 0:s.getRefNameMapForAdapter(a,i)}return{}},async getReverseRefNameMapForAdapter(a,o,i){if(o){const s=await this.waitForAssembly(o);return s==null?void 0:s.getReverseRefNameMapForAdapter(a,i)}return{}},isValidRefName(a,o){if(o){const i=r.get(o);if(i)return i.isValidRefName(a);throw new Error(`isValidRefName for ${o} failed, assembly does not exist`)}if(!r.allPossibleRefNames)throw new Error("isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument");return r.allPossibleRefNames.includes(a)}})).actions(r=>({removeAssembly(a){r.assemblies.remove(a)},afterAttach(){(0,Qn.addDisposer)(r,(0,HC.reaction)(()=>r.assemblyList,a=>{r.assemblies.forEach(o=>{o.configuration||this.removeAssembly(o)}),a.forEach(o=>{r.assemblies.findIndex(s=>s.name===(0,WC.readConfObject)(o,"name"))===-1&&this.addAssembly(o)})},{fireImmediately:!0,name:"assemblyManagerAfterAttach"}))},addAssembly(a){r.assemblies.push({configuration:a})},replaceAssembly(a,o){r.assemblies[a]=(0,Qn.cast)({configuration:o})}}))}Sl.default=GC;var Tl={};Object.defineProperty(Tl,"__esModule",{value:!0});const qi=C;Tl.default=e=>(0,qi.ConfigurationSchema)("BaseAssembly",{aliases:{type:"stringArray",defaultValue:[],description:"Other possible names for the assembly"},sequence:e.getTrackType("ReferenceSequenceTrack").configSchema,refNameColors:{type:"stringArray",defaultValue:[],description:"Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence."},refNameAliases:(0,qi.ConfigurationSchema)("RefNameAliases",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:t=>t.adapter?t:{adapter:{type:"RefNameAliasAdapter"}}}),cytobands:(0,qi.ConfigurationSchema)("Cytoband",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:t=>t.adapter?t:{adapter:{type:"CytobandAdapter"}}}),displayName:{type:"string",defaultValue:"",description:'A human readable display name for the assembly e.g. "Homo sapiens (hg38)" while the assembly name may just be "hg38"'}},{explicitIdentifier:"name"});(function(e){var t=v&&v.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.assemblyConfigSchemaFactory=e.default=void 0;var n=Sl;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t(n).default}});var r=Tl;Object.defineProperty(e,"assemblyConfigSchemaFactory",{enumerable:!0,get:function(){return t(r).default}})})(wl);const JC=Jd(wl);var If={},yr={},qt={};Object.defineProperty(qt,"__esModule",{value:!0});class XC{constructor(t){this.name="",this.name=t.name}}qt.default=XC;var Of=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yr,"__esModule",{value:!0});const YC=Of(M.exports),KC=ot,QC=Of(qt);class ZC extends QC.default{constructor(t){if(super(t),this.supportsSVG=!1,this.ReactComponent=t.ReactComponent,this.configSchema=t.configSchema,this.pluginManager=t.pluginManager,!this.ReactComponent)throw new Error(`no ReactComponent defined for renderer ${this.name}`);if(!(0,KC.getDefaultValue)(this.configSchema).type)throw new Error(`${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`);if(!this.pluginManager)throw new Error(`no plugin manager defined for renderer ${this.name}`)}async render(t){return{reactElement:YC.default.createElement(this.ReactComponent,t,null)}}freeResources(){return 0}}yr.default=ZC;var ra={},e_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ra,"__esModule",{value:!0});const t_=e_(qt);class n_ extends t_.default{constructor(t){if(super(t),"AdapterClass"in t)this.AdapterClass=t.AdapterClass,this.getAdapterClass=async()=>t.AdapterClass;else if("getAdapterClass"in t)this.getAdapterClass=t.getAdapterClass;else throw new Error(`no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`);this.configSchema=t.configSchema,this.adapterCapabilities=t.adapterCapabilities||[],this.adapterMetadata=t.adapterMetadata}}var je=ra.default=n_,Ua={},r_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ua,"__esModule",{value:!0});const a_=r_(qt),o_=ot;class i_ extends a_.default{constructor(t){if(super(t),this.displayTypes=[],this.stateModel=t.stateModel,this.configSchema=t.configSchema,!this.stateModel)throw new Error(`no stateModel defined for track ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for track ${this.name}`);if(!(0,o_.getDefaultValue)(this.configSchema).type){const n=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${n} is not explicitlyTyped`)}}addDisplayType(t){this.displayTypes.push(t)}}var lr=Ua.default=i_,Ga={},s_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ga,"__esModule",{value:!0});const l_=s_(qt),c_=ot;class u_ extends l_.default{constructor(t){if(super(t),this.stateModel=t.stateModel,this.configSchema=t.configSchema,this.ReactComponent=t.ReactComponent,this.trackType=t.trackType,this.viewType=t.viewType,!this.stateModel)throw new Error(`no stateModel defined for display ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for display ${this.name}`);if(!this.ReactComponent)throw new Error(`no ReactComponent provided for display ${this.name}`);if(!this.trackType)throw new Error(`no trackType provided for display ${this.name}`);if(!this.viewType)throw new Error(`no viewType provided for display ${this.name}`);if(!(0,c_.getDefaultValue)(this.configSchema).type){const n=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${n} is not explicitlyTyped`)}}}var kn=Ga.default=u_,Ja={},d_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ja,"__esModule",{value:!0});const f_=d_(qt);class p_ extends f_.default{constructor(t){if(super(t),this.displayTypes=[],this.ReactComponent=t.ReactComponent,this.stateModel=t.stateModel,this.extendedName=t.extendedName,!this.ReactComponent)throw new Error(`no ReactComponent defined for view ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for view ${this.name}`)}addDisplayType(t){this.displayTypes.push(t)}}var g_=Ja.default=p_,aa={},h_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(aa,"__esModule",{value:!0});const m_=h_(qt);class y_ extends m_.default{constructor(t){if(super(t),this.heading=t.heading,this.HeadingComponent=t.HeadingComponent,this.configSchema=t.configSchema,this.stateModel=t.stateModel,this.ReactComponent=t.ReactComponent,!this.ReactComponent)throw new Error(`no ReactComponent defined for widget ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for widget ${this.name}`)}}var tr=aa.default=y_,oi={},b_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(oi,"__esModule",{value:!0});const v_=b_(qt);class w_ extends v_.default{constructor(t){if(super(t),this.stateModel=t.stateModel,this.configSchema=t.configSchema,this.displayName=t.displayName,this.description=t.description,this.url=t.url,this.configEditorComponent=t.configEditorComponent,!this.stateModel)throw new Error(`no stateModel defined for connection ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema defined for connection ${this.name}`)}}var jf=oi.default=w_,Xa={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.remoteAbortRpcHandler=Bt.remoteAbort=Bt.deserializeAbortSignal=Bt.isRemoteAbortSignal=Bt.serializeAbortSignal=void 0;let Vi=0;const Hi=new WeakMap;function S_(e,t){let n=Hi.get(e);return n||(Vi+=1,Hi.set(e,Vi),n=Vi,e.addEventListener("abort",()=>{const r=Hi.get(e);r!==void 0&&t("signalAbort",r)})),{abortSignalId:n}}Bt.serializeAbortSignal=S_;function C_(e){return typeof e=="object"&&e!==null&&"abortSignalId"in e&&typeof e.abortSignalId=="number"}Bt.isRemoteAbortSignal=C_;const Cs=new Map;function __({abortSignalId:e}){let t=Cs.get(e);return t||(t=new AbortController,Cs.set(e,t)),t.signal}Bt.deserializeAbortSignal=__;function zf(e){const{signalId:t}=e,n=Cs.get(t);n&&n.abort()}Bt.remoteAbort=zf;function T_(){return{signalAbort:zf}}Bt.remoteAbortRpcHandler=T_;var x_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xa,"__esModule",{value:!0});const P_=x_(qt),au=Y,ou=Re,yo=Ut,iu=Bt;class k_ extends P_.default{constructor(t){super({name:""}),this.pluginManager=t,this.name="UNKNOWN"}async serializeArguments(t,n){const r=(0,au.getBlobMap)();return await this.augmentLocationObjects(t),{...t,blobMap:r}}async serializeNewAuthArguments(t){const n=this.pluginManager.rootModel;if(!(0,yo.isAppRootModel)(n)||t.internetAccountPreAuthorization)return t;const r=n==null?void 0:n.findAppropriateInternetAccount(t);return r&&(t.internetAccountPreAuthorization=await r.getPreAuthorizationInformation(t)),t}async deserializeArguments(t,n){t.blobMap&&(0,au.setBlobMap)(t.blobMap);const{signal:r}=t;return r&&(0,iu.isRemoteAbortSignal)(r)?{...t,signal:(0,iu.deserializeAbortSignal)(r)}:{...t,signal:void 0}}async serializeReturn(t,n,r){return t}async deserializeReturn(t,n,r){let a;const{rootModel:o}=this.pluginManager;try{a=await t}catch(i){if((0,yo.isAuthNeededException)(i)){const s=o==null?void 0:o.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(i.url).origin}`,{},i.url);throw new yo.RetryError("Retrying with created internet account",s.internetAccountId)}throw i}return a}async augmentLocationObjects(t){if((0,ou.isStateTreeNode)(t)&&!(0,ou.isAlive)(t))return t;if((0,yo.isUriLocation)(t)&&await this.serializeNewAuthArguments(t),Array.isArray(t))for(const n of t)await this.augmentLocationObjects(n);if(typeof t=="object"&&t!==null)for(const n of Object.values(t))if(Array.isArray(n))for(const r of n)await this.augmentLocationObjects(r);else typeof n=="object"&&n!==null&&await this.augmentLocationObjects(n)}}var Ya=Xa.default=k_,ii={},M_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ii,"__esModule",{value:!0});const R_=M_(qt),A_=ot;class E_ extends R_.default{constructor(t){if(super(t),this.stateModel=t.stateModel,this.configSchema=t.configSchema,!this.stateModel)throw new Error(`no stateModel defined for internet account type ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for internet account type ${this.name}`);if(!(0,A_.getDefaultValue)(this.configSchema).type){const n=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${n} is not explicitlyTyped`)}}}ii.default=E_;var si={},$_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(si,"__esModule",{value:!0});const D_=$_(qt);class L_ extends D_.default{constructor(t){if(super(t),this.description=t.description,this.configSchema=t.configSchema,this.AdapterClass=t.AdapterClass,!this.AdapterClass)throw new Error(`no AdapterClass defined for adapter type ${this.name}`)}}var qf=si.default=L_,li={},N_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(li,"__esModule",{value:!0});const F_=N_(qt);class B_ extends F_.default{constructor(t){if(super(t),this.ReactComponent=t.ReactComponent,this.stateModel=t.stateModel,!this.ReactComponent)throw new Error(`no ReactComponent defined for view ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for view ${this.name}`)}}li.default=B_;var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});class I_{constructor(){this.configurationSchema=void 0}install(t){}configure(t){}}var Gt=Ka.default=I_,ci={},xl={},Xe={},Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});var Ke=Qa.ObservableCreate=void 0;const O_=Ls,j_=Qr,z_=Ee();function q_(e,t){return O_.Observable.create(n=>{try{const r=e(n);r&&r.catch&&r.catch(a=>n.error(a))}catch(r){n.error(r)}}).pipe((0,j_.takeUntil)((0,z_.observeAbortSignal)(t)))}Ke=Qa.ObservableCreate=q_;var Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.blankStats=Wt.scoresToStats=Wt.calcPerBaseStats=Wf=Wt.rectifyStats=Wt.calcStdFromSums=void 0;const V_=Qr;function Vf(e,t,n,r=!1){if(n===0)return 0;let a;return r?a=t/n-e*e/(n*n):(a=t-e*e/n,n>1&&(a/=n-1)),a<0?0:Math.sqrt(a)}Wt.calcStdFromSums=Vf;function Hf(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:Vf(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}var Wf=Wt.rectifyStats=Hf;function H_(e,t){const{start:n,end:r}=e,a=[],o=t.sort((u,d)=>u.get("start")-d.get("start"));let i=n,s=0,c=0;for(;i<r;){for(;s<o.length&&i>=o[s].get("end");)s+=1;const u=o[s];u&&i>=u.get("start")&&i<u.get("end")?a[c]=u.get("score"):a[c]=0,c+=1,i+=1}return a}Wt.calcPerBaseStats=H_;async function W_(e,t){const{start:n,end:r}=e,{scoreMin:a,scoreMax:o,scoreSum:i,scoreSumSquares:s,featureCount:c}=await t.pipe((0,V_.reduce)((u,d)=>{const f=d.get("score");return u.scoreMax=Math.max(u.scoreMax,d.get("summary")?d.get("maxScore"):f),u.scoreMin=Math.min(u.scoreMin,d.get("summary")?d.get("minScore"):f),u.scoreSum+=f,u.scoreSumSquares+=f*f,u.featureCount+=1,u},{scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0})).toPromise();return Hf({scoreMax:o,scoreMin:a,scoreSum:i,scoreSumSquares:s,featureCount:c,basesCovered:r-n+1})}Wt.scoresToStats=W_;function U_(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}Wt.blankStats=U_;var ui={};Object.defineProperty(ui,"__esModule",{value:!0});const G_=Ee();function Uf(e,t=""){const n=Object.keys(e);for(let r=0;r<n.length;r++){const a=n[r];if(t.length>5e3)break;typeof e[a]=="object"&&e[a]?t+=Uf(e[a],t):t+=`${a}-${e[a]};`}return(0,G_.hashCode)(t)}ui.default=Uf;var J_=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.isTextSearchAdapter=Xe.isRefNameAliasAdapter=Xe.isFeatureAdapter=Xe.isRegionsAdapter=Xe.isSequenceAdapter=kl=Xe.BaseSequenceAdapter=st=Xe.BaseFeatureDataAdapter=oa=Xe.BaseAdapter=void 0;const X_=Ls,Y_=Qr,su=Re,K_=Qa,Q_=Ee(),Gf=C,Wi=Wt,Z_=J_(ui),e1=(0,Gf.ConfigurationSchema)("empty",{});class Pl{constructor(t=e1.create(),n,r){if(this.config=t,this.getSubAdapter=n,this.pluginManager=r,typeof jest>"u"){const a=(0,su.isStateTreeNode)(t)?(0,su.getSnapshot)(t):t;this.id=`${(0,Z_.default)(a)}`}else this.id="test"}getConf(t){return(0,Gf.readConfObject)(this.config,t)}}var oa=Xe.BaseAdapter=Pl;Pl.capabilities=[];class Jf extends Pl{async getHeader(t){return null}async getMetadata(t){return null}getFeaturesInRegion(t,n={}){return(0,K_.ObservableCreate)(async r=>{const a=await this.hasDataForRefName(t.refName,n);(0,Q_.checkAbortSignal)(n.signal),a?this.getFeatures(t,n).subscribe(r):r.complete()})}getFeaturesInMultipleRegions(t,n={}){return(0,X_.merge)(...t.map(r=>this.getFeaturesInRegion(r,n)))}async hasDataForRefName(t,n={}){return(await this.getRefNames(n)).includes(t)}async getRegionStats(t,n){const r=this.getFeatures(t,n);return(0,Wi.scoresToStats)(t,r)}async getMultiRegionStats(t=[],n){if(!t.length)return(0,Wi.blankStats)();const r=await Promise.all(t.map(d=>this.getRegionStats(d,n))),a=r.map(d=>d.scoreMax).reduce((d,f)=>Math.max(d,f)),o=r.map(d=>d.scoreMin).reduce((d,f)=>Math.min(d,f)),i=r.reduce((d,f)=>d+f.scoreSum,0),s=r.reduce((d,f)=>d+f.scoreSumSquares,0),c=r.reduce((d,f)=>d+f.featureCount,0),u=r.reduce((d,f)=>d+f.basesCovered,0);return(0,Wi.rectifyStats)({scoreMin:o,scoreMax:a,featureCount:c,basesCovered:u,scoreSumSquares:s,scoreSum:i})}async estimateRegionsStats(t,n){if(!t.length)throw new Error("No regions to estimate stats for");const r=t[0];let a=+Date.now();const o=async(s,c)=>{const{start:u,end:d}=r,f=u*.75+d*.25,p={...r,start:Math.max(0,Math.round(f-s/2)),end:Math.min(Math.round(f+s/2),d)},g=await this.getFeatures(p,n).pipe((0,Y_.toArray)()).toPromise();return i(s,{featureDensity:g.length/s},g.length,c)},i=async(s,c,u,d)=>{const f=r.end-r.start;if(u>=70||s*2>f)return c;if(d<=5e3){const p=+Date.now();return d+=p-a,a=p,o(s*2,d)}else return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:1/0}};return o(1e3,0)}}var st=Xe.BaseFeatureDataAdapter=Jf;class t1 extends Jf{async estimateRegionsStats(){return{featureDensity:0}}}var kl=Xe.BaseSequenceAdapter=t1;function n1(e){return"getRegions"in e&&"getFeatures"in e}Xe.isSequenceAdapter=n1;function r1(e){return"getRegions"in e}Xe.isRegionsAdapter=r1;function a1(e){return"getFeatures"in e}Xe.isFeatureAdapter=a1;function o1(e){return"getRefNameAliases"in e}Xe.isRefNameAliasAdapter=o1;function i1(e){return"searchIndex"in e}Xe.isTextSearchAdapter=i1;var Ml={},Rl={},It={};Object.defineProperty(It,"__esModule",{value:!0});var di=It.InterRegionPaddingBlock=pi=It.ElidedBlock=ia=It.ContentBlock=It.BaseBlock=It.BlockSet=void 0;class s1{constructor(t=[]){this.blocks=t}push(t){if(t instanceof _s&&this.blocks.length){const n=this.blocks[this.blocks.length-1];if(n instanceof _s){n.push(t);return}}this.blocks.push(t)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map(t=>t.toRegion())}map(t,n){return this.blocks.map(t,n)}forEach(t,n){return this.blocks.forEach(t,n)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length?this.blocks.map(t=>t.widthPx).reduce((t,n)=>t+n):0}get totalWidthPxWithoutBorders(){return this.blocks.length?this.blocks.filter(t=>t.variant!=="boundary").map(t=>t.widthPx).reduce((t,n)=>t+n):0}get offsetPx(){return this.blocks.length?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter(t=>t instanceof Xf)}get totalBp(){return this.contentBlocks.map(t=>t.end-t.start).reduce((t,n)=>t+n,0)}}It.BlockSet=s1;class fi{constructor(t){this.widthPx=0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key,this.offsetPx=t.offsetPx}renameReference(t){return this.refName&&t!==this.refName?new this.constructor({...this,refName:t}):this}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}It.BaseBlock=fi;class Xf extends fi{}var ia=It.ContentBlock=Xf;class _s extends fi{constructor(t){super(t),this.elidedBlockCount=0,this.widthPx=t.widthPx}push(t){this.elidedBlockCount+=1,t&&(this.refName="",this.start=0,this.end=0,this.widthPx+=t.widthPx)}}var pi=It.ElidedBlock=_s;class l1 extends fi{}di=It.InterRegionPaddingBlock=l1;Object.defineProperty(Rl,"__esModule",{value:!0});const lu=Re,c1=_n,u1=Ee(),Mr=It;function d1(e,t=!0,n=!0){const{offsetPx:r,displayedRegions:a,bpPerPx:o,width:i,minimumBlockWidth:s,interRegionPaddingWidth:c}=e;if(!i)throw new Error("view has no width, cannot calculate displayed blocks");const u=new Mr.BlockSet;let d=0;const f=r,p=f+i;return a.forEach((g,h)=>{const{assemblyName:m,refName:y,start:b,end:S,reversed:_}=g,T=d+(S-b)/o,x=(S-b)/o,A=(0,lu.isStateTreeNode)(g)?(0,lu.getSnapshot)(g):g;if(d<p&&T>f){const[R,E]=(0,c1.intersection2)(f,p,d,T);let $,B,F,I,U;_?($=Math.max(b,S-(E-d)*o),B=S-(R-d)*o,F=B===S,I=$===b,U=d+(S-B)/o):($=(R-d)*o+b,B=Math.min(S,(E-d)*o+b),F=$===b,I=B===S,U=d+($-b)/o);const z=(B-$)/o,G={assemblyName:m,refName:y,start:$,end:B,reversed:_,offsetPx:U,parentRegion:A,regionNumber:h,widthPx:z,isLeftEndOfDisplayedRegion:F,isRightEndOfDisplayedRegion:I,key:""};G.key=`${(0,u1.assembleLocString)(G)}-${h}${_?"-reversed":""}`,t&&u.length===0&&F&&u.push(new Mr.InterRegionPaddingBlock({key:`${G.key}-beforeFirstRegion`,widthPx:-r,offsetPx:G.offsetPx+r,variant:"boundary"})),n&&x<s?u.push(new Mr.ElidedBlock(G)):u.push(new Mr.ContentBlock(G)),t&&(x>=s&&G.isRightEndOfDisplayedRegion&&h<a.length-1&&(u.push(new Mr.InterRegionPaddingBlock({key:`${G.key}-rightpad`,widthPx:c,offsetPx:G.offsetPx+G.widthPx})),d+=c),h===a.length-1&&G.isRightEndOfDisplayedRegion&&(U=G.offsetPx+G.widthPx,u.push(new Mr.InterRegionPaddingBlock({key:`${G.key}-afterLastRegion`,widthPx:i-U+r,offsetPx:U,variant:"boundary"}))))}d+=(S-b)/o}),u}var f1=Rl.default=d1,Al={};Object.defineProperty(Al,"__esModule",{value:!0});const cu=Re,p1=Ee(),Rr=It;function g1(e,t=!0,n=!0,r=0,a=800){const{offsetPx:o,displayedRegions:i,bpPerPx:s,minimumBlockWidth:c,interRegionPaddingWidth:u,width:d}=e,f=o*s,p=(o+d)*s,h=Math.ceil(a*s);let m=0;const y=new Rr.BlockSet;return i.forEach((b,S)=>{const{assemblyName:_,refName:T,start:x,end:A,reversed:R}=b,E=Math.ceil((A-x)/h),$=(0,cu.isStateTreeNode)(b)?(0,cu.getSnapshot)(b):b;let B=Math.floor((p-m)/h)+r;B>=E&&(B=E-1);let F=Math.floor((f-m)/h)-r;F<0&&(F=0);const I=(A-x)/s;for(let U=F;U<=B;U+=1){let z,G,q,J;R?(z=Math.max(x,A-(U+1)*h),G=A-U*h,q=G===A,J=z===x):(z=x+U*h,G=Math.min(A,x+(U+1)*h),q=z===x,J=G===A);const Q=(G-z)/s,H={assemblyName:_,refName:T,start:z,end:G,reversed:R,offsetPx:(m+U*h)/s,parentRegion:$,regionNumber:S,widthPx:Q,isLeftEndOfDisplayedRegion:q,isRightEndOfDisplayedRegion:J,key:""};H.key=`${(0,p1.assembleLocString)(H)}-${S}${R?"-reversed":""}`,t&&S===0&&U===0&&y.push(new Rr.InterRegionPaddingBlock({key:`${H.key}-beforeFirstRegion`,widthPx:a,offsetPx:H.offsetPx-a,variant:"boundary"})),n&&I<c?y.push(new Rr.ElidedBlock(H)):y.push(new Rr.ContentBlock(H)),t&&(I>=c&&H.isRightEndOfDisplayedRegion&&S<i.length-1&&(m+=u*s,y.push(new Rr.InterRegionPaddingBlock({key:`${H.key}-rightpad`,widthPx:u,offsetPx:H.offsetPx+H.widthPx}))),S===i.length-1&&H.isRightEndOfDisplayedRegion&&(m+=u*s,y.push(new Rr.InterRegionPaddingBlock({key:`${H.key}-afterLastRegion`,widthPx:a,offsetPx:H.offsetPx+H.widthPx,variant:"boundary"}))))}m+=A-x}),y}var h1=Al.default=g1,qn={};Object.defineProperty(qn,"__esModule",{value:!0});var Yf=qn.bpToPx=Qf=qn.pxToBp=Kf=qn.moveTo=void 0;const Ui=Re;function m1(e,t,n){let r=0;const{displayedRegions:a}=e;if(t.index===n.index)r+=n.offset-t.offset;else{const o=a[t.index];if(r+=o.end-o.start-t.offset,n.index-t.index>=2)for(let i=t.index+1;i<n.index;i++){const s=a[i];r+=s.end-s.start}r+=n.offset}return r}function y1(e,t,n){if(!t||!n)return;const{width:r,interRegionPaddingWidth:a}=e,o=m1(e,t,n),i=n.index-t.index,s=o/(r-a*i),c=e.zoomTo(s);let u=0;s<c&&(u=(c-s)*e.width/2);let d=-u;for(let f=0;f<e.displayedRegions.length;f+=1){const p=e.displayedRegions[f];if(t.index===f){d+=t.offset;break}else d+=p.end-p.start}e.scrollTo(Math.round(d/e.bpPerPx))}var Kf=qn.moveTo=y1;function b1(e,t){var n;let r=0;const{bpPerPx:a,offsetPx:o,displayedRegions:i,interRegionPaddingWidth:s,staticBlocks:c}=e,u=c.contentBlocks,d=(o+t)*a;if(d<0){const g=i[0];return{...(0,Ui.getSnapshot)(g),oob:!0,coord:g.reversed?Math.floor(g.end-d)+1:Math.floor(g.start+d)+1,offset:d,index:0}}const f=s*a;let p=0;for(let g=0;g<i.length;g++){const h=i[g],m=h.end-h.start,y=d-r;if(m+r>d&&r<=d)return{...(0,Ui.getSnapshot)(h),oob:!1,offset:y,coord:h.reversed?Math.floor(h.end-y)+1:Math.floor(h.start+y)+1,index:g};((n=u[p])===null||n===void 0?void 0:n.regionNumber)===g?(r+=m+f,p++):r+=m}if(d>=r){const g=i[i.length-1],h=g.end-g.start,m=d-r+h;return{...(0,Ui.getSnapshot)(g),oob:!0,offset:m,coord:g.reversed?Math.floor(g.end-m)+1:Math.floor(g.start+m)+1,index:i.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}var Qf=qn.pxToBp=b1;function v1({refName:e,coord:t,regionNumber:n,self:r}){var a;let o=0;const{interRegionPaddingWidth:i,bpPerPx:s,displayedRegions:c,staticBlocks:u}=r,d=u.contentBlocks,f=i*s;let p=0,g=0;for(;g<c.length;g++){const m=c[g],y=m.end-m.start;if(e===m.refName&&t>=m.start&&t<=m.end&&(!n||n===g)){o+=m.reversed?m.end-t:t-m.start;break}((a=d[p])===null||a===void 0?void 0:a.regionNumber)===g?(o+=y+f,p++):o+=y}if(c[g])return{index:g,offsetPx:Math.round(o/s)}}Yf=qn.bpToPx=v1;var Zf=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ml,"__esModule",{value:!0});const Zn=Re,Gi=Ee(),uu=ut,w1=Zf(Rl),S1=Zf(Al),Ji=qn,C1=Zn.types.model("Base1DView",{id:uu.ElementId,displayedRegions:Zn.types.array(uu.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:Zn.types.optional(Zn.types.number,0),minimumBlockWidth:Zn.types.optional(Zn.types.number,0)}).volatile(()=>({features:void 0,volatileWidth:0})).actions(e=>({setDisplayedRegions(t){e.displayedRegions=(0,Zn.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}})).views(e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map(t=>t.assemblyName))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return-this.width+30},get totalBp(){return e.displayedRegions.map(t=>t.end-t.start).reduce((t,n)=>t+n,0)}})).views(e=>({get dynamicBlocks(){return(0,w1.default)(e)},get staticBlocks(){return(0,S1.default)(e)},get currBp(){return this.dynamicBlocks.map(t=>t.end-t.start).reduce((t,n)=>t+n,0)}})).views(e=>({pxToBp(t){return(0,Ji.pxToBp)(e,t)},bpToPx({refName:t,coord:n,regionNumber:r}){var a;return(a=(0,Ji.bpToPx)({refName:t,coord:n,regionNumber:r,self:e}))===null||a===void 0?void 0:a.offsetPx}})).actions(e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(e.bpPerPx*2)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,n=e.width/2){const r=t;if(r===e.bpPerPx)return e.bpPerPx;const a=e.bpPerPx;return e.bpPerPx=r,e.offsetPx=(0,Gi.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset),e.bpPerPx},scrollTo(t){const n=(0,Gi.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt(t,n,r){if(!n)return;const a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const n=e.offsetPx,r=(0,Gi.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}})).actions(e=>({moveTo(t,n){(0,Ji.moveTo)(e,t,n)}}));var El=Ml.default=C1,$l={},Ct={},sa={},gi={};Object.defineProperty(gi,"__esModule",{value:!0});const Ar=1e4,ep=2e4;function _1(e,t,n,r){return t>=n&&r>=e}class T1{constructor(){this.padding=1,this.widthLimit=1e6}setAllFilled(t){this.allFilled=t}getItemAt(t){if(this.allFilled)return this.allFilled;if(!this.rowState||this.rowState.min===void 0||t<this.rowState.min||t>=this.rowState.max)return;const n=t-this.rowState.offset;return this.rowState.bits[n]}isRangeClear(t,n){if(this.allFilled)return!1;if(!this.rowState)return!0;const{min:r,max:a}=this.rowState;if(n<=r||t>=a)return!0;const o=Math.min(a,n);let i=Math.max(r,t);for(;i<n&&i<o;i+=1)if(this.getItemAt(i))return!1;return!0}initialize(t,n){const r=n-t;return{offset:t-r,min:t,max:n,bits:new Array(3*r)}}addRect(t,n){const r=t.l,a=t.r+this.padding;this.rowState||(this.rowState=this.initialize(r,a));let o=r-this.rowState.offset,i=a-this.rowState.offset;const s=this.rowState.bits.length;if(i>=this.rowState.bits.length){const u=i+1;this.rowState.bits.length+u>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,a)):u>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(u)))}if(r<this.rowState.offset){const u=Math.min(s-o,this.rowState.offset);this.rowState.bits.length+u>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,a)):(this.rowState.bits=new Array(u).concat(this.rowState.bits),this.rowState.offset-=u)}i=a-this.rowState.offset,o=r-this.rowState.offset;const c=i-o;c>ep&&console.warn(`Layout X pitch set too low, feature spans ${c} bits in a single row.`,t,n);for(let u=o;u<i;u+=1)this.rowState.bits[u]=n;r<this.rowState.min&&(this.rowState.min=r),a>this.rowState.max&&(this.rowState.max=a)}discardRange(t,n){if(this.allFilled||!this.rowState||n<=this.rowState.min||t>=this.rowState.max)return;if(t<=this.rowState.min&&n>=this.rowState.max){this.rowState=void 0;return}if(n>this.rowState.min&&t<=this.rowState.min&&(this.rowState.min=n),t<this.rowState.max&&n>=this.rowState.max&&(this.rowState.max=t),this.rowState.offset<this.rowState.min-Ar&&this.rowState.bits.length>this.rowState.max+Ar-this.rowState.offset){const o=this.rowState.min-this.rowState.offset,i=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(o,this.rowState.bits.length-i),this.rowState.offset+=o}else if(this.rowState.offset<this.rowState.min-Ar){const i=this.rowState.min-Math.floor(Ar/2)-this.rowState.offset;this.rowState.bits.splice(0,i),this.rowState.offset+=i}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+Ar){const o=this.rowState.max-this.rowState.offset+1+Math.floor(Ar/2);this.rowState.bits.length=o}const r=Math.max(this.rowState.min,t)-this.rowState.offset,a=Math.min(n,this.rowState.max)-this.rowState.offset;for(let o=r;o>=0&&o<a;o+=1)this.rowState.bits[o]=void 0}}class x1{constructor({pitchX:t=10,pitchY:n=10,maxHeight:r=1e4,hardRowLimit:a=1e4,displayMode:o="normal"}={}){this.pitchX=t,this.pitchY=n,this.hardRowLimit=a,this.maxHeightReached=!1,this.displayMode=o,this.displayMode==="compact"&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(r/this.pitchY),this.pTotalHeight=0}addRect(t,n,r,a,o){const i=this.rectangles.get(t);if(i)return i.top===null?null:(this.addRectToBitmap(i),i.top*this.pitchY);const s=Math.floor(n/this.pitchX),c=Math.floor(r/this.pitchX),u=Math.ceil(a/this.pitchY),d={id:t,l:s,r:c,top:null,h:u,originalHeight:a,data:o},f=this.maxHeight-u;let p=0;if(this.displayMode!=="collapse"){for(;p<=f&&this.collides(d,p);p+=1);if(p>f)return d.top=null,this.rectangles.set(t,d),this.maxHeightReached=!0,null}return d.top=p,this.addRectToBitmap(d),this.rectangles.set(t,d),this.pTotalHeight=Math.max(this.pTotalHeight||0,p+u),p*this.pitchY}collides(t,n){const{bitmap:r}=this,a=n+t.h;for(let o=n;o<a;o+=1){const i=r[o];if(i&&!i.isRangeClear(t.l,t.r))return!0}return!1}autovivifyRow(t,n){let r=t[n];if(!r){if(n>this.hardRowLimit)throw new Error(`layout hard limit (${this.hardRowLimit*this.pitchY}px) exceeded, aborting layout`);r=new T1,t[n]=r}return r}addRectToBitmap(t){if(t.top===null)return;const n=t.id,r=t.top+t.h;if(t.r-t.l>ep)for(let a=t.top;a<r;a+=1)this.autovivifyRow(this.bitmap,a).setAllFilled(n);else for(let a=t.top;a<r;a+=1)this.autovivifyRow(this.bitmap,a).addRect(t,n)}discardRange(t,n){const r=Math.floor(t/this.pitchX),a=Math.floor(n/this.pitchX),{bitmap:o}=this;for(let i=0;i<o.length;i+=1){const s=o[i];s&&s.discardRange(r,a)}}hasSeen(t){return this.rectangles.has(t)}getByCoord(t,n){const r=Math.floor(n/this.pitchY),a=this.bitmap[r];if(!a)return;const o=Math.floor(t/this.pitchX);return a.getItemAt(o)}getByID(t){const n=this.rectangles.get(t);if(n){const r=n.top*this.pitchY;return[n.l*this.pitchX,r,n.r*this.pitchX,r+n.originalHeight]}}getDataByID(t){var n;return(n=this.rectangles.get(t))===null||n===void 0?void 0:n.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map(Array.from(this.rectangles.entries()).map(([t,n])=>{const{l:r,r:a,originalHeight:o,top:i}=n,s=(i||0)*this.pitchY,c=s+o;return[t,[r*this.pitchX,s,a*this.pitchX,c]]}))}serializeRegion(t){const n={};let r=!1;for(const[a,o]of this.rectangles.entries()){const{l:i,r:s,originalHeight:c,top:u}=o;if(o.top===null)r=!0;else{const d=(u||0)*this.pitchY,f=d+c,p=i*this.pitchX,g=s*this.pitchX,h=t.start,m=t.end;_1(h,m,p-this.pitchX,g+this.pitchX)&&(n[a]=[p,d,g,f])}}return{rectangles:n,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:r}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}gi.default=x1;var Za={};Object.defineProperty(Za,"__esModule",{value:!0});class P1{constructor(t,n={}){this.SubLayoutClass=t,this.subLayouts=new Map,this.subLayoutConstructorArgs={},this.subLayouts=new Map,this.subLayoutConstructorArgs=n}getDataByID(t){for(const n of this.subLayouts.values()){const r=n.getDataByID(t);if(r)return r}}getSublayout(t){let n=this.subLayouts.get(t);return n===void 0&&(n=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(t,n)),n}addRect(t,n,r,a,o,i={}){return this.getSublayout(t).addRect(n,r,a,o,i)}discardRange(t,n,r){const a=this.subLayouts.get(t);return a&&a.discardRange(n,r)}toJSON(){const t={};for(const[n,r]of this.subLayouts.entries())t[n]=r.toJSON();return t}}Za.default=P1;var eo={},k1=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eo,"__esModule",{value:!0});const M1=k1(Xb.exports);class R1{constructor({rectangles:t,totalHeight:n,maxHeightReached:r}){this.rectangles=new Map(Object.entries(t)),this.totalHeight=n,this.maxHeightReached=r,this.rbush=new M1.default;for(const[a,o]of Object.entries(t))this.rbush.insert({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],name:a})}addRect(t){const n=this.rectangles.get(t);if(!n)throw new Error(`id ${t} not found in precomputed feature layout`);return n[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(t,n){throw new Error("Method not implemented.")}getByCoord(t,n){const r={minX:t,minY:n,maxX:t+1,maxY:n+1};return this.rbush.collides(r)?this.rbush.search(r)[0].name:void 0}getByID(t){return this.rectangles.get(t)}addRectToBitmap(t,n){throw new Error("Method not implemented.")}discardRange(t,n){throw new Error("Method not implemented.")}serializeRegion(t){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}eo.default=R1;var la={},dn={},A1=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dn,"__esModule",{value:!0});dn.clearAdapterCache=dn.freeAdapterResources=br=dn.getAdapter=void 0;const E1=A1(ui);function $1(e){return`${(0,E1.default)(e)}`}let rr={};async function tp(e,t,n){const r=$1(n);if(!rr[r]){const o=(n||{}).type;if(!o)throw new Error("could not determine adapter type from adapter config snapshot");const i=e.getAdapterType(o);if(!i)throw new Error(`unknown data adapter type ${o}`);const s=i.configSchema.create(n,{pluginManager:e}),c=tp.bind(null,e,t),{AdapterClass:u,getAdapterClass:d}=i,f=u||await d();if(!f)throw new Error("Failed to get adapter");const p=new f(s,c,e);rr[r]={dataAdapter:p,sessionIds:new Set([t])}}const a=rr[r];return a.sessionIds.add(t),a}var br=dn.getAdapter=tp;function D1(e){let t=0;const n=Object.keys(e);if(n.length===1&&n[0]==="sessionId"){const{sessionId:r}=e;Object.entries(rr).forEach(([a,o])=>{o.sessionIds.delete(r),o.sessionIds.size===0&&(t+=1,delete rr[a])})}else Object.values(rr).forEach(r=>{r.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach(o=>{o.refName!==void 0&&r.dataAdapter.freeResources(o)}):console.warn(r.dataAdapter,"does not implement freeResources")});return t}dn.freeAdapterResources=D1;function L1(){rr={}}dn.clearAdapterCache=L1;var vr={},Dl={};Object.defineProperty(Dl,"__esModule",{value:!0});const N1=za;class Ll{constructor({filters:t=[]}){this.filterChain=t.map(n=>{if(typeof n=="string")return{expr:(0,N1.stringToJexlExpression)(n),string:n};throw new Error(`invalid inputFilter string "${n}"`)})}passes(...t){for(let n=0;n<this.filterChain.length;n+=1)if(!this.filterChain[n].expr.evalSync({feature:t[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map(t=>t.string)}}static fromJSON(t){return new Ll(t)}}var Nl=Dl.default=Ll,hi={},F1=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),B1=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),I1=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&F1(t,e,n);return B1(t,e),t};Object.defineProperty(hi,"__esModule",{value:!0});const wa=I1(M.exports),O1=Zr,Xi=xa.exports,j1=Le,z1=Ee();function q1(e){const t=(0,wa.useRef)(null),{theme:n,html:r,RenderingComponent:a,...o}=e,i=(0,j1.createJBrowseTheme)(n);return(0,wa.useEffect)(()=>{const s=t.current;function c(){s&&(s&&(0,Xi.unmountComponentAtNode)(s),s.innerHTML=r,(0,z1.rIC)(()=>{(0,Xi.hydrate)(wa.default.createElement(O1.ThemeProvider,{theme:i},wa.default.createElement(a,{...o})),s)},{timeout:300}))}return c(),()=>{s&&(0,Xi.unmountComponentAtNode)(s)}},[r,i,o,a]),wa.default.createElement("div",{ref:t,"data-html-size":r.length,className:"ssr-container"})}hi.default=q1;var V1=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),H1=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),W1=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&V1(t,e,n);return H1(t,e),t},mi=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(vr,"__esModule",{value:!0});const du=mi(M.exports),U1=Zr,G1=Js,J1=Gb,fu=Re,Yi=Ee(),X1=mi(yr),Y1=mi(Dl),K1=Le,Q1=mi(hi);function Z1(e){return"canvasRecordedData"in e}class eT extends X1.default{serializeArgsInClient(t){return{...t,config:(0,fu.isStateTreeNode)(t.config)?(0,fu.getSnapshot)(t.config):t.config,filters:t.filters&&t.filters.toJSON().filters}}deserializeResultsInClient(t,n){const{html:r,...a}=t;return n.exportSVG?{...t,html:this.supportsSVG?t.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...a,reactElement:du.default.createElement(Q1.default,{...n,...t,RenderingComponent:this.ReactComponent})}}deserializeArgsInWorker(t){const n={...t};return n.config=this.configSchema.create(t.config||{},{pluginManager:this.pluginManager}),n.filters=new Y1.default({filters:t.filters}),n}serializeResultsInWorker(t,n){const r=(0,J1.renderToString)(du.default.createElement(U1.ThemeProvider,{theme:(0,K1.createJBrowseTheme)(n.theme)},t.reactElement));return delete t.reactElement,{...t,html:r}}async renderInClient(t,n){const r=await t.call(n.sessionId,"CoreRender",n);if(Z1(r)){const{width:a,height:o,canvasRecordedData:i}=r,s=await Promise.resolve().then(()=>W1(Yb())),c=new s.default(a,o);new G1.CanvasSequence(i).execute(c);const d=c.getSvg();r.html=d.innerHTML,delete r.reactElement}return r}async renderInWorker(t){const{signal:n,statusCallback:r=()=>{}}=t,a=this.deserializeArgsInWorker(t),o=await(0,Yi.updateStatus)("Rendering plot",r,()=>this.render(a));return(0,Yi.checkAbortSignal)(n),(0,Yi.updateStatus)("Serializing results",r,()=>this.serializeResultsInWorker(o,a))}async freeResourcesInClient(t,n){const r=this.serializeArgsInClient(n),a=this.freeResources(),o=await t.call(n.sessionId,"CoreFreeResources",r);return a+o}}vr.default=eT;var np=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(la,"__esModule",{value:!0});const tT=Qr,pu=Ee(),nT=np(Wn),rT=dn,aT=np(vr),oT=Xe;class iT extends aT.default{serializeArgsInClient(t){const{displayModel:n,regions:r}=t,a={...t,displayModel:n&&{id:n.id,selectedFeatureId:n.selectedFeatureId},regions:JSON.parse(JSON.stringify(r))};return super.serializeArgsInClient(a)}deserializeResultsInClient(t,n){const r=new Map;return t.features.forEach(o=>{const i=nT.default.fromJSON(o);r.set(String(i.id()),i)}),{...super.deserializeResultsInClient({...t,features:r},n),blockKey:n.blockKey,features:r}}serializeResultsInWorker(t,n){const r=super.serializeResultsInWorker(t,n),{features:a}=t;return{...r,features:(0,pu.iterMap)(a.values(),o=>o.toJSON(),a.size)}}getExpandedRegion(t,n){return t}async getFeatures(t){const{signal:n,regions:r,sessionId:a,adapterConfig:o}=t,{dataAdapter:i}=await(0,rT.getAdapter)(this.pluginManager,a,o);if(!(0,oT.isFeatureAdapter)(i))throw new Error("Adapter does not support retrieving features");const s=new Map;if(!r||r.length===0)return s;const c=r.map(p=>{const g={...p};return g.start&&(g.start=Math.floor(g.start)),g.end&&(g.end=Math.ceil(g.end)),g}),u=c[0],f=await(c.length===1?i.getFeatures(this.getExpandedRegion(u,t),t):i.getFeaturesInMultipleRegions(c,t)).pipe((0,tT.toArray)()).toPromise();return(0,pu.checkAbortSignal)(n),new Map(f.filter(p=>this.featurePassesFilters(t,p)).map(p=>[p.id(),p]))}featurePassesFilters(t,n){return t.filters?t.filters.passes(n,t):!0}async render(t){const n=t.features||await this.getFeatures(t);return{...await super.render({...t,features:n}),features:n}}}var rp=la.default=iT,to=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sa,"__esModule",{value:!0});var ap=sa.LayoutSession=void 0;const gu=to(Cn),sT=to(gi),lT=to(Za),cT=to(eo),uT=to(la),hu=Ee(),Nr=C;class op{constructor(t){this.config=t.config,this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}update(t){Object.assign(this,t)}makeLayout(){return new lT.default(sT.default,{maxHeight:(0,Nr.readConfObject)(this.config,"maxHeight"),displayMode:(0,Nr.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,Nr.readConfObject)(this.config,"noSpacing")?1:3})}cachedLayoutIsValid(t){return t&&t.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&(0,gu.default)((0,Nr.readConfObject)(this.config),t.config)&&(0,gu.default)(this.filters,t.filters)}get layout(){return(!this.cachedLayout||!this.cachedLayoutIsValid(this.cachedLayout))&&(this.cachedLayout={layout:this.makeLayout(),config:(0,Nr.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}ap=sa.LayoutSession=op;class dT extends uT.default{constructor(){super(...arguments),this.sessions={}}getWorkerSession(t){const n=(0,hu.getLayoutId)(t);this.sessions[n]||(this.sessions[n]=this.createSession(t));const r=this.sessions[n];return r.update(t),r}getExpandedRegion(t,n){if(!t)return t;const{bpPerPx:r,config:a}=n,o=a===void 0?0:(0,Nr.readConfObject)(a,"maxFeatureGlyphExpansion");if(!o)return t;const i=Math.round(o*r);return{...t,start:Math.floor(Math.max(t.start-i,0)),end:Math.ceil(t.end+i)}}createSession(t){return new op(t)}async freeResourcesInClient(t,n){const{regions:r}=n,a=(0,hu.getLayoutId)(n);let o=0;const i=this.sessions[a];return!r&&i&&(delete this.sessions[a],o=1),i&&r&&i.layout.discardRange(r[0].refName,r[0].start,r[0].end),o+await super.freeResourcesInClient(t,n)}deserializeLayoutInClient(t){return new cT.default(t)}deserializeResultsInClient(t,n){const r=this.deserializeLayoutInClient(t.layout);return super.deserializeResultsInClient({...t,layout:r},n)}createLayoutInWorker(t){const{regions:n}=t;return this.getWorkerSession(t).layout.getSublayout(n[0].refName)}serializeResultsInWorker(t,n){const r=super.serializeResultsInWorker(t,n),[a]=n.regions;return r.layout=t.layout.serializeRegion(this.getExpandedRegion(a,n)),r.layout.rectangles&&(r.features=r.features.filter(o=>Boolean(r.layout.rectangles[o.uniqueId]))),r.maxHeightReached=r.layout.maxHeightReached,r}async render(t){const n=t.layout||this.createLayoutInWorker(t);return{...await super.render({...t,layout:n}),layout:n}}}var ip=sa.default=dT,yi={},fT=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yi,"__esModule",{value:!0});const pT=fT(la);class gT extends pT.default{}var sp=yi.default=gT,Fl={},hT=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Fl,"__esModule",{value:!0});const mu=Qr,mT=hT(vr),yT=dn;class bT extends mT.default{async renameRegionsIfNeeded(t){return t}serializeArgsInClient(t){const n={...t,displayModel:{}};return super.serializeArgsInClient(n)}deserializeResultsInClient(t,n){return{...super.deserializeResultsInClient(t,n),blockKey:n.blockKey}}async renderInClient(t,n){return t.call(n.sessionId,"ComparativeRender",n)}featurePassesFilters(t,n){return t.filters?t.filters.passes(n,t):!0}async getFeatures(t){const n=this.pluginManager,{sessionId:r,adapterConfig:a}=t,{dataAdapter:o}=await(0,yT.getAdapter)(n,r,a);let i=[];if(i=t.regions,!i||i.length===0)return console.warn("no regions supplied to comparative renderer"),[];const s=i.map(c=>{const u={...c};return u.start&&(u.start=Math.floor(u.start)),u.end&&(u.end=Math.floor(u.end)),u});return o.getFeaturesInMultipleRegions(s,t).pipe((0,mu.filter)(c=>this.featurePassesFilters(t,c)),(0,mu.toArray)()).toPromise()}}Fl.default=bT;var wr=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.ServerSideRendererType=Ct.ServerSideRenderedContent=Ct.RendererType=Ct.FeatureRendererType=Ct.ComparativeServerSideRendererType=Ct.CircularChordRendererType=Ct.BoxRendererType=void 0;const vT=wr(sa);Ct.BoxRendererType=vT.default;const wT=wr(yi);Ct.CircularChordRendererType=wT.default;const ST=wr(Fl);Ct.ComparativeServerSideRendererType=ST.default;const CT=wr(la);Ct.FeatureRendererType=CT.default;const _T=wr(yr);Ct.RendererType=_T.default;const TT=wr(hi);Ct.ServerSideRenderedContent=TT.default;const xT=wr(vr);Ct.ServerSideRendererType=xT.default;var ze={},Bl={};Object.defineProperty(Bl,"__esModule",{value:!0});const PT=C;Bl.default=(0,PT.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var Il={};Object.defineProperty(Il,"__esModule",{value:!0});const bo=Re;Il.default=e=>bo.types.model("Connection",{name:bo.types.identifier,tracks:bo.types.array(e.pluggableConfigSchemaType("track"))}).actions(t=>({afterAttach(){t.tracks.length||t.connect(t.configuration)},addTrackConf(n){const r=t.tracks.push(n);return t.tracks[r-1]},addTrackConfs(n){const r=t.tracks.push(...n);return t.tracks.slice(r-1-n.length,r-1)},setTrackConfs(n){return t.tracks=(0,bo.cast)(n),t.tracks},clear(){}}));var Ol={};Object.defineProperty(Ol,"__esModule",{value:!0});const Ki=Re,kT=ut,MT=Ki.types.model("BaseView",{id:kT.ElementId,displayName:Ki.types.maybe(Ki.types.string)}).volatile(()=>({width:800})).views(()=>({menuItems(){return[]}})).actions(e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t}}));Ol.default=MT;var bi={};Object.defineProperty(bi,"__esModule",{value:!0});bi.BaseDisplay=void 0;const vn=Re,yu=C,RT=Y,AT=ut;bi.BaseDisplay=vn.types.model("BaseDisplay",{id:AT.ElementId,type:vn.types.string,rpcDriverName:vn.types.maybe(vn.types.string)}).volatile(()=>({rendererTypeName:"",error:void 0})).views(e=>({get RenderingComponent(){const{pluginManager:t}=(0,vn.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,yu.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,vn.getParent)(e);for(;!(t.configuration&&(0,yu.getConf)(t,"trackId"));){if((0,vn.isRoot)(t))throw new Error(`No parent track found for ${e.type} ${e.id}`);t=(0,vn.getParent)(t)}return t},renderProps(){return{...(0,RT.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e}},get rendererType(){const{pluginManager:t}=(0,vn.getEnv)(e),n=t.getRendererType(e.rendererTypeName);if(!n)throw new Error(`renderer "${e.rendererTypeName}" not found`);if(!n.ReactComponent)throw new Error(`renderer ${e.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`);return n},get DisplayMessageComponent(){},trackMenuItems(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered(){}})).actions(e=>({setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}}));var vi={},Ce={},Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.RemoteFileWithRangeCache=Gr.clearCache=void 0;const ET=l0,$T=Cd,DT=nf,Ts={};function LT(e,t,n,r={}){const a=Ts[e];if(!a)throw new Error(`fetch not registered for ${e}`);return a(e,t,n,r)}const lp=new ET.HttpRangeFetcher({fetch:LT,size:500*1024**2,chunkSize:128*124,maxFetchSize:100*1024**2,minimumTTL:24*60*60*1e3});function NT(){lp.reset()}Gr.clearCache=NT;class FT extends DT.RemoteFile{async fetch(t,n){Ts[String(t)]||(Ts[String(t)]=this.fetchBinaryRange.bind(this));const r=n&&n.headers;let a;if(r&&(r instanceof Headers?a=r.get("range"):Array.isArray(r)?[,a]=r.find(([o])=>o==="range")||[void 0,void 0]:a=r.range),a){const o=/bytes=(\d+)-(\d+)/.exec(a);if(o){const[,i,s]=o,c=parseInt(i,10),u=parseInt(s,10),d=await lp.getRange(t,c,u-c+1,{signal:n&&n.signal}),{headers:f}=d;return new Response(d.buffer,{status:206,headers:f})}}return super.fetch(t,n)}async fetchBinaryRange(t,n,r,a={}){const o=new Date,i={...a.headers,range:`bytes=${n}-${r}`},s=await super.fetch(t,{...a,headers:i}),c=new Date;if(s.status!==206){const f=`HTTP ${s.status} (${s.statusText}) when fetching ${t} bytes ${n}-${r}`,p=" (should be 206 for range requests)";throw new Error(`${f}${s.status===200?p:""}`)}const u={};for(const[f,p]of s.headers.entries())u[f]=p;const d=await s.arrayBuffer();return{headers:u,requestDate:o,responseDate:c,buffer:$T.Buffer.from(d)}}}Gr.RemoteFileWithRangeCache=FT;(function(e){var t=v&&v.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(e,"__esModule",{value:!0}),e.getFetcher=e.openLocation=e.RemoteFileWithRangeCache=void 0;const n=nf,r=t(rf),a=Gr;Object.defineProperty(e,"RemoteFileWithRangeCache",{enumerable:!0,get:function(){return a.RemoteFileWithRangeCache}});const o=Ut,i=Y,s=Ee();function c(h){return"localPath"in h}function u(h){return"blobId"in h}function d(h,m){if(!h)throw new Error("must provide a location to openLocation");if(c(h)){if(!h.localPath)throw new Error("No local path provided");if(r.default||s.isElectron)return new n.LocalFile(h.localPath);throw new Error("can't use local files in the browser")}if(u(h)){const y=(0,i.getBlob)(h.blobId);if(!y)throw new Error(`file ("${h.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new n.BlobFile(y)}if((0,o.isUriLocation)(h)){if(!h.uri)throw new Error("No URI provided");const y=h.baseUri?{...h,uri:new URL(h.uri,h.baseUri).href}:h;if(m){const b=p(h,m);if(b)return b.openLocation(y)}return new a.RemoteFileWithRangeCache(y.uri,{fetch:g})}throw new Error("invalid fileLocation")}e.openLocation=d;function f(h,m){if(!(0,o.isUriLocation)(h))throw new Error(`Not a valid UriLocation: ${JSON.stringify(h)}`);if(m){const y=p(h,m);if(y)return y.getFetcher(h)}return g}e.getFetcher=f;function p(h,m){const{rootModel:y}=m;if(y&&(0,o.isAppRootModel)(y))return y.findAppropriateInternetAccount(h);if(h.internetAccountPreAuthorization){if(!h.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return m.getInternetAccountType(h.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:h.internetAccountPreAuthorization.internetAccountType,configuration:h.internetAccountPreAuthorization.authInfo.configuration})}}async function g(h,m){const y=await fetch(h,m);if(y.status===401){const b=y.headers.get("WWW-Authenticate");if(b&&b.includes("Basic"))throw new o.AuthNeededError("Accessing HTTPBasic resource without authentication",h.toString())}return y}})(Ce);Object.defineProperty(vi,"__esModule",{value:!0});vi.InternetAccount=void 0;const bu=Re,er=C,BT=Ce,IT=ut,OT=typeof sessionStorage>"u";vi.InternetAccount=bu.types.model("InternetAccount",{id:IT.ElementId,type:bu.types.string}).views(e=>({get name(){return(0,er.getConf)(e,"name")},get description(){return(0,er.getConf)(e,"description")},get internetAccountId(){return(0,er.getConf)(e,"internetAccountId")},get authHeader(){return(0,er.getConf)(e,"authHeader")},get tokenType(){return(0,er.getConf)(e,"tokenType")},get domains(){return(0,er.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}})).views(e=>({handlesLocation(t){return e.domains.some(n=>t==null?void 0:t.uri.includes(n))},get tokenKey(){return`${e.internetAccountId}-token`}})).actions(e=>({getTokenFromUser(t,n){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken(){return sessionStorage.getItem(e.tokenKey)},async validateToken(t,n){return t}})).actions(e=>{let t;return{async getToken(n){var r,a;if(t)return t;let o=(a=(r=n==null?void 0:n.internetAccountPreAuthorization)===null||r===void 0?void 0:r.authInfo)===null||a===void 0?void 0:a.token;if(o)return t=Promise.resolve(o),t;if(OT)throw new Error("Did not get internet account pre-authorization info in worker");return o=e.retrieveToken(),o?(t=Promise.resolve(o),t):(t=new Promise((i,s)=>{function c(d){e.storeToken(d),i(d)}function u(d){e.removeToken(),s(d)}e.getTokenFromUser(c,u)}),t)}}}).actions(e=>({addAuthHeaderToInit(t={},n){const r=e.tokenType?`${e.tokenType} ${n}`:n,a=new Headers(t.headers||{});return a.append(e.authHeader,r),{...t,headers:a}},async getPreAuthorizationInformation(t){const n=await e.getToken(t);let r;try{r=await e.validateToken(n,t)}catch(a){throw e.removeToken(),a}return{internetAccountType:e.type,authInfo:{token:r,configuration:(0,er.getConf)(e)}}}})).actions(e=>({getFetcher(t){return async(n,r)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit(r,a);return fetch(n,o)}}})).actions(e=>({openLocation(t){return new BT.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})}}));var wi={};Object.defineProperty(wi,"__esModule",{value:!0});wi.BaseInternetAccountConfig=void 0;const jT=C;wi.BaseInternetAccountConfig=(0,jT.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0});var Si={};Object.defineProperty(Si,"__esModule",{value:!0});Si.createBaseTrackModel=void 0;const zT=dr,nn=Re,vo=C,wo=Ee(),vu=Ut,qT=ut;function VT(e,t,n){return nn.types.model(t,{id:qT.ElementId,type:nn.types.literal(t),configuration:(0,vo.ConfigurationReference)(n),displays:nn.types.array(e.pluggableMstType("display","stateModel"))}).views(r=>({get rpcSessionId(){return r.configuration.trackId},get name(){return(0,vo.getConf)(r,"name")},get textSearchAdapter(){return(0,vo.getConf)(r,"textSearchAdapter")},get adapterType(){const a=(0,vo.getConf)(r,"adapter"),{pluginManager:o}=(0,nn.getEnv)(r);if(!a)throw new Error(`no adapter configuration provided for ${r.type}`);const i=o.getAdapterType(a.type);if(!i)throw new Error(`unknown adapter type ${a.type}`);return i},get viewMenuActions(){const a=[];return r.displays.forEach(o=>{a.push(...o.viewMenuActions)}),a},get canConfigure(){const a=(0,wo.getSession)(r);return(0,vu.isSessionModelWithConfigEditing)(a)&&(a.adminMode||a.sessionTracks.find(o=>o.trackId===r.configuration.trackId))}})).actions(r=>({activateConfigurationUI(){const a=(0,wo.getSession)(r),o=(0,wo.getContainingView)(r);if((0,vu.isSessionModelWithConfigEditing)(a)){const i=a.editTrackConfiguration(r.configuration);i&&i!==r.configuration&&(o.hideTrack(r.configuration),o.showTrack(i))}},showDisplay(a,o={}){const i=e.pluggableConfigSchemaType("display"),s=(0,nn.resolveIdentifier)(i,(0,nn.getRoot)(r),a),c=e.getDisplayType(s.type);if(!c)throw new Error(`unknown display type ${s.type}`);const u=c.stateModel.create({...o,type:s.type,configuration:s});r.displays.push(u)},hideDisplay(a){const o=e.pluggableConfigSchemaType("display"),i=(0,nn.resolveIdentifier)(o,(0,nn.getRoot)(r),a),s=r.displays.filter(c=>c.configuration===i);return(0,zT.transaction)(()=>s.forEach(c=>r.displays.remove(c))),s.length},replaceDisplay(a,o,i={}){const s=r.displays.findIndex(f=>f.configuration.displayId===a);if(s===-1)throw new Error(`could not find display id ${a} to replace`);const c=e.pluggableConfigSchemaType("display"),u=(0,nn.resolveIdentifier)(c,(0,nn.getRoot)(r),o);if(!e.getDisplayType(u.type))throw new Error(`unknown display type ${u.type}`);r.displays.splice(s,1,{...i,type:u.type,configuration:u})}})).views(r=>({trackMenuItems(){const a=[];r.displays.forEach(f=>{a.push(...f.trackMenuItems())});const o=[],i=(0,wo.getContainingView)(r),c=e.getViewType(i.type).displayTypes.map(f=>f.name),u=r.configuration.displays.filter(f=>c.includes(f.type)),d=r.displays[0].configuration.displayId;return u.length>1&&(o.push({type:"divider"},{type:"subHeader",label:"Display types"}),u.forEach(f=>{o.push({type:"radio",label:f.type,checked:f.displayId===d,onClick:()=>r.replaceDisplay(d,f.displayId)})})),[...a,...o]}}))}Si.createBaseTrackModel=VT;var Ci={};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.createBaseTrackConfig=void 0;const HT=Re,Qi=C;function WT(e){return(0,Qi.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,Qi.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:HT.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,Qi.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth to iterate on subfeatures"}})},{preProcessSnapshot:t=>{const n=JSON.parse(JSON.stringify(t)),r=new Set,{displays:a=[]}=n;return n.trackId!=="placeholderId"&&(a.forEach(i=>i&&r.add(i.type)),e.getTrackType(n.type).displayTypes.forEach(i=>{r.has(i.name)||a.push({displayId:`${n.trackId}-${i.name}`,type:i.name})})),{...n,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:t=>({addDisplayConf(n){const{type:r}=n;if(!r)throw new Error(`unknown display type ${r}`);const a=t.displays.find(i=>i&&i.displayId===n.displayId);if(a)return a;const o=t.displays.push(n);return t.displays[o-1]}})})}Ci.createBaseTrackConfig=WT;(function(e){var t=v&&v.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(e,"__esModule",{value:!0}),e.createBaseTrackConfig=e.createBaseTrackModel=e.BaseInternetAccountConfig=e.InternetAccount=e.BaseDisplay=e.BaseViewModel=e.BaseConnectionModelFactory=e.baseConnectionConfig=void 0;var n=Bl;Object.defineProperty(e,"baseConnectionConfig",{enumerable:!0,get:function(){return t(n).default}});var r=Il;Object.defineProperty(e,"BaseConnectionModelFactory",{enumerable:!0,get:function(){return t(r).default}});var a=Ol;Object.defineProperty(e,"BaseViewModel",{enumerable:!0,get:function(){return t(a).default}});var o=bi;Object.defineProperty(e,"BaseDisplay",{enumerable:!0,get:function(){return o.BaseDisplay}});var i=vi;Object.defineProperty(e,"InternetAccount",{enumerable:!0,get:function(){return i.InternetAccount}});var s=wi;Object.defineProperty(e,"BaseInternetAccountConfig",{enumerable:!0,get:function(){return s.BaseInternetAccountConfig}});var c=Si;Object.defineProperty(e,"createBaseTrackModel",{enumerable:!0,get:function(){return c.createBaseTrackModel}});var u=Ci;Object.defineProperty(e,"createBaseTrackConfig",{enumerable:!0,get:function(){return u.createBaseTrackConfig}})})(ze);(function(e){var t=v&&v.__createBinding||(Object.create?function(m,y,b,S){S===void 0&&(S=b);var _=Object.getOwnPropertyDescriptor(y,b);(!_||("get"in _?!y.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return y[b]}}),Object.defineProperty(m,S,_)}:function(m,y,b,S){S===void 0&&(S=b),m[S]=y[b]}),n=v&&v.__exportStar||function(m,y){for(var b in m)b!=="default"&&!Object.prototype.hasOwnProperty.call(y,b)&&t(y,m,b)},r=v&&v.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(e,"__esModule",{value:!0}),e.AddTrackWorkflowType=e.TextSearchAdapterType=e.InternetAccountType=e.RpcMethodType=e.ViewType=e.DisplayType=e.TrackType=e.WidgetType=e.RendererType=e.ConnectionType=e.AdapterType=void 0;const a=r(ra);e.AdapterType=a.default;const o=r(oi);e.ConnectionType=o.default;const i=r(yr);e.RendererType=i.default;const s=r(aa);e.WidgetType=s.default;const c=r(Ua);e.TrackType=c.default;const u=r(Ga);e.DisplayType=u.default;const d=r(Ja);e.ViewType=d.default;const f=r(Xa);e.RpcMethodType=f.default;const p=r(ii);e.InternetAccountType=p.default;const g=r(si);e.TextSearchAdapterType=g.default;const h=r(li);e.AddTrackWorkflowType=h.default,n(Ct,e),n(ze,e)})($l);var jl={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.isNamedColor=Jr.namedColorToHex=void 0;const cp={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function UT(e){return cp[e]}Jr.namedColorToHex=UT;function GT(e){return!!cp[e]}Jr.isNamedColor=GT;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.makeContrasting=e.emphasize=e.contrastingTextColor=e.isNamedColor=e.namedColorToHex=void 0;const t=Zr,n=Jr;Object.defineProperty(e,"namedColorToHex",{enumerable:!0,get:function(){return n.namedColorToHex}}),Object.defineProperty(e,"isNamedColor",{enumerable:!0,get:function(){return n.isNamedColor}});function r(s){return a(s)>.5?"black":"white"}e.contrastingTextColor=r;function a(s){const c=(0,n.namedColorToHex)(s);return(0,t.getLuminance)(c||s)}function o(s,c=.15){const u=(0,n.namedColorToHex)(s);return(0,t.emphasize)(u||s,c)}e.emphasize=o;function i(s,c="white",u=3){let d=(0,n.namedColorToHex)(s)||s;const f=(0,n.namedColorToHex)(c)||c,p=a(f);let g=(0,t.getContrastRatio)(d,f);const h=d;let m=.05;for(;g<u;)d=p>.5?(0,t.darken)(h,m):(0,t.lighten)(h,m),m+=.05,g=(0,t.getContrastRatio)(d,f);return d}e.makeContrasting=i})(jl);var zl={},up={};Object.defineProperty(up,"__esModule",{value:!0});var ql={},dp=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ql,"__esModule",{value:!0});const JT=dp(Za),XT=dp(eo);class YT{constructor(){throw new Error("invalid layout name")}}class KT extends JT.default{constructor(t){super(YT),Object.entries(t).forEach(([n,r])=>{this.subLayouts.set(n,new XT.default(r))})}}ql.default=KT;var Vl={};Object.defineProperty(Vl,"__esModule",{value:!0});const QT=Ee();class ka{constructor(t,n,r,a,o,i){if(this.name=t,this.left=n,this.top=r,this.width=a,this.height=o,this.data=i,QT.inDevelopment&&(typeof t!="string"||typeof n!="number"||Number.isNaN(n)||typeof r!="number"||Number.isNaN(r)||typeof a!="number"||Number.isNaN(a)||typeof o!="number"||Number.isNaN(o)))throw new TypeError("invalid SceneGraph arguments");this.children=new Map,this.absoluteCache={dirty:!0}}addChild(t,n,r,a,o,i){let s;if(t instanceof ka?s=t:s=new ka(t,n,r,a,o,i),!(s instanceof ka))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(s.name))throw new Error(`child named "${s.name}" already exists`);s.parent=this;const{left:c,right:u,top:d,bottom:f}=s.absolute;return c!==void 0&&u!==void 0&&d!==void 0&&f!==void 0&&(this.expand(c,u,d,f),this.children.set(s.name,s)),s}getSubRecord(t){return this.children.get(t)}expand(t,n,r,a){const{left:o,right:i,top:s,bottom:c}=this.absolute;if(o!==void 0&&t<o){const u=o-t;this.width+=u,this.left-=u}if(i!==void 0&&n>i&&(this.width+=n-i),s!==void 0&&r<s){const u=s-r;this.height+=u,this.top-=u}c!==void 0&&a>c&&(this.height+=a-c),this.parent&&this.parent.expand(t,n,r,a),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(t){this.parent&&(t(this.parent),this.parent.walkParents(t))}walkChildren(t){for(const n of this.children.values())t(n),n.walkChildren(t)}get absolute(){if(this.absoluteCache.dirty){let t=0,n=0;this.walkParents(r=>{t+=r.left,n+=r.top}),this.absoluteCache={dirty:!1,left:this.left+t,right:this.right+t,top:this.top+n,bottom:this.bottom+n,width:this.width,height:this.height}}return this.absoluteCache}move(t,n){this.left+=t,this.top+=n,this.absoluteCache.dirty=!0,this.walkChildren(s=>{s.absoluteCache.dirty=!0});const{left:r,right:a,top:o,bottom:i}=this.absolute;r!==void 0&&a!==void 0&&o!==void 0&&i!==void 0&&this.expand(r,a,o,i)}}Vl.default=ka;(function(e){var t=v&&v.__createBinding||(Object.create?function(u,d,f,p){p===void 0&&(p=f);var g=Object.getOwnPropertyDescriptor(d,f);(!g||("get"in g?!d.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return d[f]}}),Object.defineProperty(u,p,g)}:function(u,d,f,p){p===void 0&&(p=f),u[p]=d[f]}),n=v&&v.__exportStar||function(u,d){for(var f in u)f!=="default"&&!Object.prototype.hasOwnProperty.call(d,f)&&t(d,u,f)},r=v&&v.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(e,"__esModule",{value:!0}),e.SceneGraph=e.PrecomputedMultiLayout=e.PrecomputedLayout=e.MultiLayout=e.GranularRectLayout=void 0,n(up,e);var a=gi;Object.defineProperty(e,"GranularRectLayout",{enumerable:!0,get:function(){return r(a).default}});var o=Za;Object.defineProperty(e,"MultiLayout",{enumerable:!0,get:function(){return r(o).default}});var i=eo;Object.defineProperty(e,"PrecomputedLayout",{enumerable:!0,get:function(){return r(i).default}});var s=ql;Object.defineProperty(e,"PrecomputedMultiLayout",{enumerable:!0,get:function(){return r(s).default}});var c=Vl;Object.defineProperty(e,"SceneGraph",{enumerable:!0,get:function(){return r(c).default}})})(zl);var Hl={};Object.defineProperty(Hl,"__esModule",{value:!0});Hl.default=["mobx","mobx-state-tree","react","react-dom","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","prop-types","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];var So={},_t={},fp={},Wl={},ZT=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),ex=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),tx=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&ZT(t,e,n);return ex(t,e),t},nx=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wl,"__esModule",{value:!0});const Lt=tx(M.exports),rn=tt,rx=ft,ax=nx(ea),ox=(0,rx.makeStyles)()(e=>({formElt:{margin:e.spacing(3),width:400},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"}}));function ix({handleClose:e,intronBp:t,upDownBp:n}){const{classes:r}=ox(),[a,o]=(0,Lt.useState)(`${t}`),[i,s]=(0,Lt.useState)(`${n}`),c=!Number.isNaN(+a),u=!Number.isNaN(+i);return Lt.default.createElement(rn.Dialog,{maxWidth:"xl",open:!0,onClose:()=>e()},Lt.default.createElement(rn.DialogTitle,null,"Feature sequence settings",e?Lt.default.createElement(rn.IconButton,{className:r.closeButton,onClick:()=>e()},Lt.default.createElement(ax.default,null)):null),Lt.default.createElement(rn.Divider,null),Lt.default.createElement(rn.DialogContent,{className:r.dialogContent},Lt.default.createElement(rn.TextField,{label:"Number of intronic bases around splice site to display",className:r.formElt,value:a,helperText:c?"":"Not a number",error:!c,onChange:d=>o(d.target.value)}),Lt.default.createElement(rn.TextField,{label:"Number of bases up/down stream of feature to display",className:r.formElt,value:i,helperText:u?"":"Not a number",error:!u,onChange:d=>s(d.target.value)})),Lt.default.createElement(rn.DialogActions,null,Lt.default.createElement(rn.Button,{onClick:()=>e({upDownBp:+i,intronBp:+a}),disabled:!c||!u,color:"primary",variant:"contained"},"Submit"),Lt.default.createElement(rn.Button,{onClick:()=>e(),color:"secondary",autoFocus:!0,variant:"contained"},"Cancel")))}Wl.default=ix;var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.ellipses=Ot.calculateUTRs=Ot.revlist=Ot.dedupe=Ot.stitch=void 0;function sx(e,t){return e.map(n=>t.slice(n.start,n.end)).join("")}Ot.stitch=sx;function wu(e){return`${e.start}-${e.end}`}function lx(e){return e.filter((t,n,r)=>!n||wu(t)!==wu(r[n-1]))}Ot.dedupe=lx;function cx(e,t){return e.map(n=>({...n,start:t-n.end,end:t-n.start})).sort((n,r)=>n.start-r.start)}Ot.revlist=cx;function ux(e,t){const n=e[0],r=e[e.length-1],a=t.findIndex(d=>d.end>=n.start&&d.start<=n.start),o=t.findIndex(d=>d.end>=r.end&&d.start<=r.end),i=t[o],s=t[a],c=[...t.slice(0,a),{start:s.start,end:n.start}].map(d=>({...d,type:"five_prime_UTR"})),u=[{start:r.end,end:i.end},...t.slice(o+1)].map(d=>({...d,type:"three_prime_UTR"}));return[...c,...u]}Ot.calculateUTRs=ux;function dx(e){return e.length>20?`${e.slice(0,20)}...`:e}Ot.ellipses=dx;(function(e){var t=v&&v.__createBinding||(Object.create?function($,B,F,I){I===void 0&&(I=F);var U=Object.getOwnPropertyDescriptor(B,F);(!U||("get"in U?!B.__esModule:U.writable||U.configurable))&&(U={enumerable:!0,get:function(){return B[F]}}),Object.defineProperty($,I,U)}:function($,B,F,I){I===void 0&&(I=F),$[I]=B[F]}),n=v&&v.__setModuleDefault||(Object.create?function($,B){Object.defineProperty($,"default",{enumerable:!0,value:B})}:function($,B){$.default=B}),r=v&&v.__importStar||function($){if($&&$.__esModule)return $;var B={};if($!=null)for(var F in $)F!=="default"&&Object.prototype.hasOwnProperty.call($,F)&&t(B,$,F);return n(B,$),B},a=v&&v.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(e,"__esModule",{value:!0}),e.SequencePanel=void 0;const o=r(M.exports),i=tt,s=ft,c=f0,u=a(ja),d=a(Wl),f=Ee(),p=C,g=Ot,h=a(Gh),m=(0,s.makeStyles)()($=>({button:{margin:$.spacing(1)},formControl:{margin:0},container:{margin:$.spacing(1)}})),y="rgb(220,160,220)",b=void 0,S="rgb(220,220,180)",_="rgba(250,200,200)",T="rgb(200,240,240)";function x({cds:$,sequence:B}){return o.default.createElement("span",{style:{background:S}},(0,g.stitch)($,B))}function A({cds:$,sequence:B,codonTable:F}){const I=(0,g.stitch)($,B);let U="";for(let z=0;z<I.length;z+=3)U+=F[I.slice(z,z+3)]||"&";return o.default.createElement("span",{style:{background:y}},U)}function R({utr:$,cds:B,exons:F,sequence:I,upstream:U,downstream:z,includeIntrons:G,collapseIntron:q,intronBp:J}){const Q=B.length?[...B,...$].sort((H,ce)=>H.start-ce.start):F;return o.default.createElement(o.default.Fragment,null,U?o.default.createElement("span",{style:{background:_}},U):null,Q.filter(H=>H.start!==H.end).map((H,ce)=>{var le;const re=I.slice(H.end,(le=Q[ce+1])===null||le===void 0?void 0:le.start);return o.default.createElement(o.default.Fragment,{key:JSON.stringify(H)},o.default.createElement("span",{style:{background:H.type==="CDS"?S:T}},I.slice(H.start,H.end)),G&&ce<Q.length-1?o.default.createElement("span",{style:{background:b}},q&&re.length>J*2?`${re.slice(0,J)}...${re.slice(-J)}`:re):null)}),z?o.default.createElement("span",{style:{background:_}},z):null)}e.SequencePanel=o.default.forwardRef(($,B)=>{const{feature:F,mode:I,intronBp:U=10}=$;let{sequence:{seq:z,upstream:G="",downstream:q=""}}=$;const{subfeatures:J}=F;if(!J)return null;const Q=J.sort((ve,V)=>ve.start-V.start).map(ve=>({...ve,start:ve.start-F.start,end:ve.end-F.start}));let H=(0,g.dedupe)(Q.filter(ve=>ve.type==="CDS")),ce=(0,g.dedupe)(Q.filter(ve=>ve.type.match(/utr/i))),le=(0,g.dedupe)(Q.filter(ve=>ve.type==="exon"));!ce.length&&H.length&&le.length&&(ce=(0,g.calculateUTRs)(H,le)),F.strand===-1&&([z,G,q]=[(0,f.revcom)(z),(0,f.revcom)(q),(0,f.revcom)(G)],H=(0,g.revlist)(H,z.length),le=(0,g.revlist)(le,z.length),ce=(0,g.revlist)(ce,z.length));const re=(0,f.generateCodonTable)(f.defaultCodonTable);return o.default.createElement("div",{ref:B,"data-testid":"sequence_panel"},o.default.createElement("div",{style:{fontFamily:"monospace",wordWrap:"break-word",fontSize:12,maxWidth:600}},`>${F.name||F.id||"unknown"}-${I}
`,I==="cds"?o.default.createElement(x,{cds:H,sequence:z}):I==="cdna"?o.default.createElement(R,{exons:le,cds:H,utr:ce,sequence:z,intronBp:U}):I==="protein"?o.default.createElement(A,{cds:H,codonTable:re,sequence:z}):I==="gene"?o.default.createElement(R,{exons:le,cds:H,utr:ce,sequence:z,includeIntrons:!0,intronBp:U}):I==="gene_collapsed_intron"?o.default.createElement(R,{exons:le,cds:H,sequence:z,utr:ce,includeIntrons:!0,collapseIntron:!0,intronBp:U}):I==="gene_updownstream"?o.default.createElement(R,{exons:le,cds:H,sequence:z,utr:ce,upstream:G,downstream:q,includeIntrons:!0,intronBp:U}):I==="gene_updownstream_collapsed_intron"?o.default.createElement(R,{exons:le,cds:H,sequence:z,utr:ce,upstream:G,downstream:q,includeIntrons:!0,collapseIntron:!0,intronBp:U}):o.default.createElement("div",null,"Unknown type")))});function E({model:$,feature:B}){var F;const{classes:I}=m(),U=B,z=(F=U.subfeatures)===null||F===void 0?void 0:F.find(de=>de.type==="CDS"),G=(0,o.useRef)(null),[q,J]=(0,o.useState)(!1),{ref:Q,inView:H}=(0,c.useInView)(),[ce,le]=(0,o.useState)(),[re,ve]=(0,o.useState)(),[V,K]=(0,o.useState)(z?"cds":"cdna"),[ie,oe]=(0,o.useState)(!1),[he,me]=(0,o.useState)(!1),[Se,yt]=(0,f.useLocalStorage)("intronBp",10),[Be,bt]=(0,f.useLocalStorage)("upDownBp",500);(0,o.useEffect)(()=>{var de;let ye=!1;if(!$||!H)return()=>{};const{assemblyManager:Ae,rpcManager:pt}=(0,f.getSession)($),[Tr]=((de=$.view)===null||de===void 0?void 0:de.assemblyNames)||[];async function mn(yn,Qt,En){const Xn=await Ae.waitForAssembly(Tr);if(!Xn)throw new Error("assembly not found");const xr="getSequence",ha=await pt.call(xr,"CoreGetFeatures",{adapterConfig:(0,p.getConf)(Xn,["sequence","adapter"]),sessionId:xr,regions:[{start:yn,end:Qt,refName:Xn.getCanonicalRefName(En)}]}),[ma]=ha;if(!ma)throw new Error(`sequence not found for feature with refName:${En}`);return ma.get("seq")}return(async()=>{try{const{start:yn,end:Qt,refName:En}=B,Xn=await mn(yn,Qt,En),xr=await mn(Math.max(0,yn-Be),yn,En),ha=await mn(Qt,Qt+Be,En);ye||le({seq:Xn,upstream:xr,downstream:ha})}catch(yn){ve(yn)}})(),()=>{ye=!0}},[B,H,$,Be]);const We=!ce;return $?o.default.createElement("div",{ref:Q,className:I.container},o.default.createElement(i.FormControl,{className:I.formControl},o.default.createElement(i.Select,{style:{margin:0},value:V,onChange:de=>K(de.target.value)},z?o.default.createElement(i.MenuItem,{value:"cds"},"CDS"):null,z?o.default.createElement(i.MenuItem,{value:"protein"},"Protein"):null,o.default.createElement(i.MenuItem,{value:"gene"},"Gene w/ introns"),o.default.createElement(i.MenuItem,{value:"gene_collapsed_intron"},"Gene w/ ",Se,"bp of intron"),o.default.createElement(i.MenuItem,{value:"gene_updownstream"},"Gene w/ ",Be,"bp up+down stream"),o.default.createElement(i.MenuItem,{value:"gene_updownstream_collapsed_intron"},"Gene w/ ",Be,"bp up+down stream w/ ",Se,"bp intron"),o.default.createElement(i.MenuItem,{value:"cdna"},"cDNA"))),o.default.createElement(i.FormControl,{className:I.formControl},o.default.createElement(i.Button,{className:I.button,type:"button",variant:"contained",onClick:()=>{const de=G.current;de&&((0,u.default)(de.textContent||"",{format:"text/plain"}),oe(!0),setTimeout(()=>oe(!1),1e3))}},ie?"Copied to clipboard!":"Copy as plaintext")),o.default.createElement(i.FormControl,{className:I.formControl},o.default.createElement(i.Tooltip,{title:"Note that 'Copy as HTML' can retain the colors but cannot be pasted into some programs like notepad that only expect plain text"},o.default.createElement(i.Button,{className:I.button,type:"button",variant:"contained",onClick:()=>{const de=G.current;de&&((0,u.default)(de.innerHTML,{format:"text/html"}),me(!0),setTimeout(()=>me(!1),1e3))}},he?"Copied to clipboard!":"Copy as HTML"))),o.default.createElement(i.FormControl,{className:I.formControl},o.default.createElement(i.IconButton,{onClick:()=>J(!0),style:{margin:0,padding:0}},o.default.createElement(h.default,null))),o.default.createElement("br",null),o.default.createElement(o.default.Fragment,null,re?o.default.createElement(i.Typography,{color:"error"},`${re}`):We?o.default.createElement(i.Typography,null,"Loading gene sequence..."):ce?o.default.createElement(e.SequencePanel,{ref:G,feature:U,mode:V,sequence:ce,intronBp:Se}):o.default.createElement(i.Typography,null,"No sequence found")),q?o.default.createElement(d.default,{handleClose:de=>{if(de){const{upDownBp:ye,intronBp:Ae}=de;yt(Ae),bt(ye)}J(!1)},upDownBp:Be,intronBp:Se}):null):null}e.default=E})(fp);(function(e){var t=v&&v.__createBinding||(Object.create?function(V,K,ie,oe){oe===void 0&&(oe=ie);var he=Object.getOwnPropertyDescriptor(K,ie);(!he||("get"in he?!K.__esModule:he.writable||he.configurable))&&(he={enumerable:!0,get:function(){return K[ie]}}),Object.defineProperty(V,oe,he)}:function(V,K,ie,oe){oe===void 0&&(oe=ie),V[oe]=K[ie]}),n=v&&v.__setModuleDefault||(Object.create?function(V,K){Object.defineProperty(V,"default",{enumerable:!0,value:K})}:function(V,K){V.default=K}),r=v&&v.__importStar||function(V){if(V&&V.__esModule)return V;var K={};if(V!=null)for(var ie in V)ie!=="default"&&Object.prototype.hasOwnProperty.call(V,ie)&&t(K,V,ie);return n(K,V),K},a=v&&v.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(e,"__esModule",{value:!0}),e.FeatureDetails=e.BaseAttributes=e.Attributes=e.UriLink=e.BaseCoreDetails=e.SimpleValue=e.BasicValue=e.FieldName=e.BaseCard=e.useStyles=void 0;const o=r(M.exports),i=Zo.exports,s=tt,c=ft,u=a(Jh),d=fe,f=Dt,p=a(af),g=C,h=Ee(),m=a(na),y=a(fp),b=Ot,S=170,_=["__jbrowsefmt","length","position","subfeatures","uniqueId","exonFrames","parentId","thickStart","thickEnd"],T=["name","start","end","strand","refName","description","type"];e.useStyles=(0,c.makeStyles)()(V=>({expansionPanelDetails:{display:"block",padding:V.spacing(1)},expandIcon:{color:"#FFFFFF"},field:{display:"flex",flexWrap:"wrap"},fieldDescription:{"&:hover":{background:"yellow"}},fieldName:{wordBreak:"break-all",minWidth:90,borderBottom:"1px solid #0003",fontSize:12,background:V.palette.grey[200],marginRight:V.spacing(1),padding:V.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,fontSize:12,padding:V.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:V.spacing(.5),background:V.palette.grey[100],border:`1px solid ${V.palette.grey[300]}`,boxSizing:"border-box",overflow:"auto"}}));function x({children:V,title:K,defaultExpanded:ie=!0}){const{classes:oe}=(0,e.useStyles)(),[he,me]=(0,o.useState)(ie);return o.default.createElement(s.Accordion,{expanded:he,onChange:()=>me(Se=>!Se),TransitionProps:{unmountOnExit:!0}},o.default.createElement(s.AccordionSummary,{expandIcon:o.default.createElement(u.default,{className:oe.expandIcon})},o.default.createElement(s.Typography,{variant:"button"}," ",K)),o.default.createElement(s.AccordionDetails,{className:oe.expansionPanelDetails},V))}e.BaseCard=x;const A=({description:V,name:K,width:ie,prefix:oe=[]})=>{const{classes:he,cx:me}=(0,e.useStyles)(),Se=[...oe,K].join(".");return V?o.default.createElement(s.Tooltip,{title:V,placement:"left"},o.default.createElement("div",{className:me(he.fieldDescription,he.fieldName)},Se)):o.default.createElement("div",{className:he.fieldName,style:{width:ie}},Se)};e.FieldName=A;const R=({value:V})=>{const{classes:K}=(0,e.useStyles)(),ie=`${V}`.match(/^https?:\/\//);return o.default.createElement("div",{className:K.fieldValue},o.default.isValidElement(V)?V:ie?o.default.createElement(m.default,{html:`<a href="${V}">${V}</a>`}):o.default.createElement(m.default,{html:(0,p.default)(V)?JSON.stringify(V):String(V)}))};e.BasicValue=R;const E=({name:V,value:K,description:ie,prefix:oe,width:he})=>{const{classes:me}=(0,e.useStyles)();return K!=null?o.default.createElement("div",{className:me.field},o.default.createElement(e.FieldName,{prefix:oe,description:ie,name:V,width:he}),o.default.createElement(e.BasicValue,{value:K})):null};e.SimpleValue=E;const $=({name:V,value:K,description:ie,prefix:oe=[]})=>{const{classes:he}=(0,e.useStyles)();return K.length===1?(0,p.default)(K[0])?o.default.createElement(Q,{attributes:K[0],prefix:[...oe,V]}):o.default.createElement("div",{className:he.field},o.default.createElement(e.FieldName,{prefix:oe,description:ie,name:V}),o.default.createElement(e.BasicValue,{value:K[0]})):K.every(me=>(0,p.default)(me))?o.default.createElement(o.default.Fragment,null,K.map((me,Se)=>o.default.createElement(Q,{key:JSON.stringify(me)+"-"+Se,attributes:me,prefix:[...oe,V+"-"+Se]}))):o.default.createElement("div",{className:he.field},o.default.createElement(e.FieldName,{prefix:oe,description:ie,name:V}),K.map((me,Se)=>o.default.createElement("div",{key:JSON.stringify(me)+"-"+Se,className:he.fieldSubvalue},o.default.createElement(e.BasicValue,{value:me}))))},B=V=>V.toLocaleString("en-US");function F(V){const{feature:K}=V,ie=K,oe={...ie,...ie.__jbrowsefmt},{start:he,strand:me,end:Se,refName:yt}=oe,Be={"-1":"-",0:"",1:"+"},bt=Be[me]?`(${Be[me]})`:"",We={...oe,length:B(Se-he),position:`${yt}:${B(he+1)}..${B(Se)} ${bt}`},de={position:"Position",description:"Description",name:"Name",length:"Length",type:"Type",assemblyName:"Assembly name"};return o.default.createElement(o.default.Fragment,null,Object.entries(de).map(([ye,Ae])=>[Ae,We[ye]]).filter(([,ye])=>ye!=null).map(([ye,Ae])=>o.default.createElement(e.SimpleValue,{key:ye,name:ye,value:Ae})))}const I=V=>o.default.createElement(x,{...V,title:"Primary data"},o.default.createElement(F,{...V}));e.BaseCoreDetails=I;function U({value:V}){const K=(0,h.getUriLink)(V);return o.default.createElement(m.default,{html:`<a href="${K}">${K}</a>`})}e.UriLink=U;const z=({value:V,prefix:K,name:ie})=>{const oe=Object.keys(V[0]).sort(),he=new Set(oe);if(V.forEach(me=>Object.keys(me).forEach(Se=>he.add(Se))),he.size<oe.length+5){const me=Object.entries(V).map(([de,ye])=>{const{id:Ae,...pt}=ye;return{id:de,identifier:Ae,...pt}});let Se;he.has("id")?(he.delete("id"),Se=["identifier",...he]):Se=[...he];const yt=Se.map(de=>({field:de,renderCell:ye=>{const{value:Ae}=ye;return(0,h.isUriLocation)(Ae)?o.default.createElement(U,{value:Ae}):(0,h.getStr)(Ae)},width:(0,h.measureGridWidth)(me.map(ye=>ye[de]))})),Be=25,bt=me.length<100,We=80;return o.default.createElement(o.default.Fragment,null,o.default.createElement(e.FieldName,{prefix:K,name:ie}),o.default.createElement("div",{style:{height:Math.min(me.length,100)*Be+We+(bt?0:50),width:"100%"}},o.default.createElement(d.DataGrid,{disableSelectionOnClick:!0,rowHeight:Be,rows:me,rowsPerPageOptions:[],hideFooterSelectedRowCount:!0,columns:yt,hideFooter:bt})))}return null};function G(V,K={}){return V.forEach(ie=>{K&&(K=K[ie])}),typeof K=="string"?K:typeof(K==null?void 0:K.Description)=="string"?K.Description:void 0}function q(V,K){const ie=[];return V.forEach((oe,he)=>{const me=[...K,oe[0]].join(".");ie.push((0,h.measureText)(me,12))}),Math.ceil(Math.max(...ie))+10}function J({value:V,prefix:K,name:ie}){const{classes:oe}=(0,e.useStyles)(),{uri:he,baseUri:me=""}=V;let Se;try{Se=new URL(he,me).href}catch{Se=he}return o.default.createElement("div",{className:oe.field},o.default.createElement(e.FieldName,{prefix:K,name:ie}),o.default.createElement(e.BasicValue,{value:Se}))}function Q(V){const{attributes:K,omit:ie=[],descriptions:oe,formatter:he=de=>de,prefix:me=[]}=V,Se=[...ie,..._],{__jbrowsefmt:yt,...Be}=K,bt={...Be,...yt},We=q(Object.entries(bt).filter(([de,ye])=>ye!==void 0&&!Se.includes(de)),me);return o.default.createElement(o.default.Fragment,null,Object.entries(bt).filter(([de,ye])=>ye!==void 0&&!Se.includes(de)).map(([de,ye])=>{const Ae=G([...me,de],oe);return Array.isArray(ye)?ye.length>1&&ye.every(pt=>(0,p.default)(pt))?o.default.createElement(z,{key:de,name:de,prefix:me,value:ye}):o.default.createElement($,{key:de,name:de,value:ye,description:Ae,prefix:me}):(0,p.default)(ye)?(0,h.isUriLocation)(ye)?o.default.createElement(J,{key:de,name:de,prefix:me,value:ye}):o.default.createElement(Q,{...V,omit:Se,key:de,attributes:ye,descriptions:oe,prefix:[...me,de]}):o.default.createElement(e.SimpleValue,{key:de,name:de,value:he(ye,de),description:Ae,prefix:me,width:Math.min(We,S)})}))}e.Attributes=Q;const H=V=>{const{feature:K}=V;return o.default.createElement(x,{...V,title:"Attributes"},o.default.createElement(Q,{...V,attributes:K}))};e.BaseAttributes=H;function ce(V){return Object.keys(V).length===0}function le(V,K,ie){return[(0,b.ellipses)(`${V}`||`${K}`),`${ie}`].filter(oe=>!!oe).join(" - ")}const re=V=>{const{omit:K=[],model:ie,feature:oe,depth:he=0}=V,{name:me="",id:Se="",type:yt="",subfeatures:Be}=oe,bt=(0,h.getSession)(ie),We=["mRNA","transcript","gene"],de=(0,g.getConf)(bt,["featureDetails","sequenceTypes"])||We;return o.default.createElement(x,{title:le(me,Se,yt)},o.default.createElement(s.Typography,null,"Core details"),o.default.createElement(F,{...V}),o.default.createElement(s.Divider,null),o.default.createElement(s.Typography,null,"Attributes"),o.default.createElement(Q,{attributes:oe,...V,omit:[...K,...T]}),de.includes(oe.type)?o.default.createElement(i.ErrorBoundary,{FallbackComponent:({error:ye})=>o.default.createElement(s.Typography,{color:"error"},`${ye}`)},o.default.createElement(y.default,{...V})):null,Be!=null&&Be.length?o.default.createElement(x,{title:"Subfeatures",defaultExpanded:!de.includes(oe.type)},Be.map(ye=>o.default.createElement(e.FeatureDetails,{key:JSON.stringify(ye),feature:ye,model:ie,depth:he+1}))):null)};e.FeatureDetails=re;const ve=(0,f.observer)(V=>{const{model:K}=V,{featureData:ie}=K;if(!ie)return null;const oe=JSON.parse(JSON.stringify(ie,(he,me)=>typeof me>"u"?null:me));return ce(oe)?null:o.default.createElement(e.FeatureDetails,{model:K,feature:oe})});e.default=ve})(_t);var Su;function fx(){if(Su)return So;Su=1,Object.defineProperty(So,"__esModule",{value:!0});const e=_t;return So.default=e.Attributes,So}var Co={},Cu;function px(){if(Cu)return Co;Cu=1,Object.defineProperty(Co,"__esModule",{value:!0});const e=_t;return Co.default=e.FeatureDetails,Co}var _o={},_u;function gx(){if(_u)return _o;_u=1,Object.defineProperty(_o,"__esModule",{value:!0});const e=_t;return _o.default=e.BaseCard,_o}var hx=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),mx=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),D=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&hx(t,e,n);return mx(t,e),t},gn=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xl,"__esModule",{value:!0});const L=D(M.exports),yx=D(xa.exports),bx=D(dr),vx=D(Re),wx=D(Dt),Tu=ft,Sx=gn(on.exports),Zi=D(Zr),xu=D(Xh),Cx=tt,es=fe,_x=D(Xe),Tx=gn(Ml),xx=D($l),Px=gn(Ja),kx=gn(ra),Mx=gn(Ga),Rx=gn(Ua),Ax=gn(aa),Ex=D(ze),$x=D(vr),Dx=gn(yi),Lx=D(sa),Nx=D(la),Fx=D(yr),Bx=D(C),Ix=gn(Ka),Ox=D(Le),jx=D(Ee()),zx=D(jl),qx=D(zl),Vx=D(Y),Hx=D(Ce),Wx=D(ot),Ux=D(Qa),Gx=D(ut),pp=gn(Hl),Sn={Accordion:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Yh))),AccordionActions:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Kh))),AccordionDetails:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Qh))),Alert:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Zh))),AlertTitle:(0,L.lazy)(()=>Promise.resolve().then(()=>D(em))),Autocomplete:(0,L.lazy)(()=>Promise.resolve().then(()=>D(tm))),Avatar:(0,L.lazy)(()=>Promise.resolve().then(()=>D(nm))),AvatarGroup:(0,L.lazy)(()=>Promise.resolve().then(()=>D(rm))),Backdrop:(0,L.lazy)(()=>Promise.resolve().then(()=>D(am))),Badge:(0,L.lazy)(()=>Promise.resolve().then(()=>D(om))),Box:(0,L.lazy)(()=>Promise.resolve().then(()=>D(im))),Breadcrumbs:(0,L.lazy)(()=>Promise.resolve().then(()=>D(sm))),Button:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ns))),ButtonGroup:(0,L.lazy)(()=>Promise.resolve().then(()=>D(lm))),Card:(0,L.lazy)(()=>Promise.resolve().then(()=>D(cm))),CardActions:(0,L.lazy)(()=>Promise.resolve().then(()=>D(um))),CardActionArea:(0,L.lazy)(()=>Promise.resolve().then(()=>D(dm))),CardContent:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fm))),CardHeader:(0,L.lazy)(()=>Promise.resolve().then(()=>D(pm))),CardMedia:(0,L.lazy)(()=>Promise.resolve().then(()=>D(gm))),CircularProgress:(0,L.lazy)(()=>Promise.resolve().then(()=>D(hm))),Collapse:(0,L.lazy)(()=>Promise.resolve().then(()=>D(mm))),ClickAwayListener:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ym))),Chip:(0,L.lazy)(()=>Promise.resolve().then(()=>D(bm))),Checkbox:(0,L.lazy)(()=>Promise.resolve().then(()=>D(vm))),Container:(0,L.lazy)(()=>Promise.resolve().then(()=>D(wm))),Dialog:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Fs))),DialogActions:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Os))),DialogTitle:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Bs))),DialogContent:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Is))),DialogContentText:(0,L.lazy)(()=>Promise.resolve().then(()=>D(kd))),Divider:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Sm))),Drawer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Cm))),Fab:(0,L.lazy)(()=>Promise.resolve().then(()=>D(_m))),Fade:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Tm))),FilledInput:(0,L.lazy)(()=>Promise.resolve().then(()=>D(xm))),FormLabel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Pm))),FormControl:(0,L.lazy)(()=>Promise.resolve().then(()=>D(km))),FormControlLabel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Mm))),FormHelperText:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Rm))),FormGroup:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Am))),Grid:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Em))),Grow:(0,L.lazy)(()=>Promise.resolve().then(()=>D($m))),Icon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Dm))),IconButton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Lm))),Input:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Nm))),InputBase:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Fm))),InputLabel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Bm))),InputAdornment:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Im))),Link:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Om))),LinearProgress:(0,L.lazy)(()=>Promise.resolve().then(()=>D(jm))),List:(0,L.lazy)(()=>Promise.resolve().then(()=>D(zm))),ListItem:(0,L.lazy)(()=>Promise.resolve().then(()=>D(qm))),ListItemAvatar:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Vm))),ListItemSecondaryAction:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Hm))),ListItemIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Wm))),ListSubheader:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Um))),ListItemText:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Gm))),Menu:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Jm))),MenuItem:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Xm))),MenuList:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ym))),Modal:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Km))),NativeSelect:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Qm))),OutlinedInput:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Zm))),Pagination:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ey))),PaginationItem:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ty))),Paper:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ny))),Popover:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ry))),Popper:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ay))),Portal:(0,L.lazy)(()=>Promise.resolve().then(()=>D(oy))),Radio:(0,L.lazy)(()=>Promise.resolve().then(()=>D(iy))),RadioGroup:(0,L.lazy)(()=>Promise.resolve().then(()=>D(sy))),Rating:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ly))),ScopedCssBaseline:(0,L.lazy)(()=>Promise.resolve().then(()=>D(cy))),Select:(0,L.lazy)(()=>Promise.resolve().then(()=>D(uy))),Skeleton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(dy))),Slider:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fy))),Snackbar:(0,L.lazy)(()=>Promise.resolve().then(()=>D(py))),SnackbarContent:(0,L.lazy)(()=>Promise.resolve().then(()=>D(gy))),SpeedDial:(0,L.lazy)(()=>Promise.resolve().then(()=>D(hy))),SpeedDialAction:(0,L.lazy)(()=>Promise.resolve().then(()=>D(my))),SpeedDialIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(yy))),Stack:(0,L.lazy)(()=>Promise.resolve().then(()=>D(by))),Step:(0,L.lazy)(()=>Promise.resolve().then(()=>D(vy))),StepButton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(wy))),StepConnector:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Sy))),StepLabel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Cy))),StepIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(_y))),Stepper:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ty))),SvgIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ad))),Switch:(0,L.lazy)(()=>Promise.resolve().then(()=>D(xy))),Tab:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Py))),Table:(0,L.lazy)(()=>Promise.resolve().then(()=>D(ky))),TableBody:(0,L.lazy)(()=>Promise.resolve().then(()=>D(My))),TableCell:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ry))),TableContainer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ay))),TableFooter:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ey))),TableHead:(0,L.lazy)(()=>Promise.resolve().then(()=>D($y))),TablePagination:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Dy))),TableRow:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ly))),TableSortLabel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Ny))),Tabs:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Fy))),TextField:(0,L.lazy)(()=>Promise.resolve().then(()=>D(By))),TextareaAutosize:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Iy))),ToggleButton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Oy))),ToggleButtonGroup:(0,L.lazy)(()=>Promise.resolve().then(()=>D(jy))),Toolbar:(0,L.lazy)(()=>Promise.resolve().then(()=>D(zy))),Tooltip:(0,L.lazy)(()=>Promise.resolve().then(()=>D(qy))),Typography:(0,L.lazy)(()=>Promise.resolve().then(()=>D(Vy)))},Oo=Object.fromEntries(Object.entries(Sn).map(([e,t])=>[e,n=>L.default.createElement(L.Suspense,{fallback:L.default.createElement("div",null)},L.default.createElement(t,{...n}))])),Jx=Object.fromEntries(Object.entries(Oo).map(([e,t])=>["@material-ui/core/"+e,t])),Xx=Object.fromEntries(Object.entries(Oo).map(([e,t])=>["@mui/material/"+e,t])),Yx=(0,L.lazy)(()=>Promise.resolve().then(()=>D(fx()))),Kx=(0,L.lazy)(()=>Promise.resolve().then(()=>D(px()))),Qx=(0,L.lazy)(()=>Promise.resolve().then(()=>D(gx()))),Zx={DataGrid:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.DataGrid}))),GridActionsCellItem:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridActionsCellItem}))),GridAddIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridAddIcon}))),GridArrowDownwardIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridArrowDownwardIcon}))),GridArrowUpwardIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridArrowUpwardIcon}))),GridAutoSizer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridAutoSizer}))),GridCellCheckboxForwardRef:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridCellCheckboxForwardRef}))),GridCellCheckboxRenderer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridCellCheckboxRenderer}))),GridCheckCircleIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridCheckCircleIcon}))),GridCheckIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridCheckIcon}))),GridCloseIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridCloseIcon}))),GridColumnHeaderSeparator:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridColumnHeaderSeparator}))),GridColumnHeaderSortIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridColumnHeaderSortIcon}))),GridColumnIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridColumnIcon}))),GridColumnMenu:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridColumnMenu}))),GridColumnMenuContainer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridColumnMenuContainer}))),GridDragIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridDragIcon}))),GridExpandMoreIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridExpandMoreIcon}))),GridFilterAltIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFilterAltIcon}))),GridFilterForm:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFilterForm}))),GridFilterListIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFilterListIcon}))),GridFilterPanel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFilterPanel}))),GridFooter:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFooter}))),GridFooterContainer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridFooterContainer}))),GridHeader:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridHeader}))),GridHeaderCheckbox:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridHeaderCheckbox}))),GridKeyboardArrowRight:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridKeyboardArrowRight}))),GridLoadIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridLoadIcon}))),GridLoadingOverlay:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridLoadingOverlay}))),GridMenuIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridMenuIcon}))),GridMoreVertIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridMoreVertIcon}))),GridNoRowsOverlay:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridNoRowsOverlay}))),GridOverlay:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridOverlay}))),GridPagination:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridPagination}))),GridPanel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridPanel}))),GridPanelWrapper:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridPanelWrapper}))),GridPreferencesPanel:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridPreferencesPanel}))),GridRemoveIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridRemoveIcon}))),GridRoot:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridRoot}))),GridRowCount:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridRowCount}))),GridSaveAltIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridSaveAltIcon}))),GridScrollArea:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridScrollArea}))),GridSearchIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridSearchIcon}))),GridSelectedRowCount:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridSelectedRowCount}))),GridSeparatorIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridSeparatorIcon}))),GridTableRowsIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridTableRowsIcon}))),GridToolbar:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbar}))),GridToolbarColumnsButton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarColumnsButton}))),GridToolbarContainer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarContainer}))),GridToolbarDensitySelector:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarDensitySelector}))),GridToolbarExport:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarExport}))),GridToolbarExportContainer:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarExportContainer}))),GridToolbarFilterButton:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridToolbarFilterButton}))),GridTripleDotsVerticalIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridTripleDotsVerticalIcon}))),GridViewHeadlineIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridViewHeadlineIcon}))),GridViewStreamIcon:(0,L.lazy)(()=>Promise.resolve().then(()=>D(fe)).then(e=>({default:e.GridViewStreamIcon})))},eP=Object.fromEntries(Object.entries(Zx).map(([e,t])=>[e,n=>L.default.createElement(L.Suspense,{fallback:L.default.createElement("div",null)},L.default.createElement(t,{...n}))])),tP=e=>L.default.createElement(L.Suspense,{fallback:L.default.createElement("div",null)},L.default.createElement(Yx,{...e})),nP=e=>L.default.createElement(L.Suspense,{fallback:L.default.createElement("div",null)},L.default.createElement(Kx,{...e})),rP=e=>L.default.createElement(L.Suspense,{fallback:L.default.createElement("div",null)},L.default.createElement(Qx,{...e})),gp={mobx:bx,"mobx-state-tree":vx,react:L.default,"react-dom":yx,"mobx-react":wx,"@mui/x-data-grid":{useGridApiContext:es.useGridApiContext,useGridApiRef:es.useGridApiRef,useGridRootProps:es.useGridRootProps,...eP},"@mui/material/utils":xu,"@material-ui/core/utils":xu,"tss-react/mui":{makeStyles:Tu.makeStyles},"@material-ui/core":{...Oo,useTheme:Cx.useTheme,alpha:Zi.alpha,makeStyles:e=>{const t=(0,Tu.makeStyles)()(e);return()=>t().classes}},"@mui/material":Oo,"prop-types":Sx.default,"@mui/material/styles":Zi,"@material-ui/core/styles":Zi,...Jx,...Xx,"@material-ui/lab/ToggleButton":Sn.ToggleButton,"@material-ui/lab/ToggleButtonGroup":Sn.ToggleButtonGroup,"@material-ui/lab/Autocomplete":Sn.Autocomplete,"@material-ui/lab/Alert":Sn.Alert,"@material-ui/lab":{Alert:Sn.Alert,Autocomplete:Sn.Autocomplete,ToggleButton:Sn.ToggleButton,ToggleButtonGroup:Sn.ToggleButtonGroup},"@jbrowse/core/Plugin":Ix.default,"@jbrowse/core/pluggableElementTypes":xx,"@jbrowse/core/pluggableElementTypes/ViewType":Px.default,"@jbrowse/core/pluggableElementTypes/AdapterType":kx.default,"@jbrowse/core/pluggableElementTypes/DisplayType":Mx.default,"@jbrowse/core/pluggableElementTypes/TrackType":Rx.default,"@jbrowse/core/pluggableElementTypes/WidgetType":Ax.default,"@jbrowse/core/pluggableElementTypes/models":Ex,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":$x,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":Dx.default,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":Lx,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":Nx,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":Fx,"@jbrowse/core/configuration":Bx,"@jbrowse/core/util/types/mst":Gx,"@jbrowse/core/ui":Ox,"@jbrowse/core/util":jx,"@jbrowse/core/util/color":zx,"@jbrowse/core/util/layouts":qx,"@jbrowse/core/util/tracks":Vx,"@jbrowse/core/util/Base1DViewModel":Tx.default,"@jbrowse/core/util/io":Hx,"@jbrowse/core/util/mst-reflection":Wx,"@jbrowse/core/util/rxjs":Ux,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":{Attributes:tP,FeatureDetails:nP,BaseCard:rP},"@jbrowse/core/data_adapters/BaseAdapter":_x},hp=Array.from(Object.keys(gp)),Pu=hp.filter(e=>!pp.default.includes(e));if(Pu.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${Pu.join(", ")}`);const ku=pp.default.filter(e=>!hp.includes(e));if(ku.length)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${ku.join(", ")}`);xl.default=gp;var aP=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ci,"__esModule",{value:!0});const oP=aP(xl);ci.default=oP.default;var Ul={},cr={},iP=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(cr,"__esModule",{value:!0});var Gl=cr.stateModelFactory=cr.configSchema=void 0;const Dn=Re,sP=dr,ko=C,lP=iP(Kb.exports),cP=ut,uP=(0,ko.ConfigurationSchema)("BaseFeatureWidget",{});cr.configSchema=uP;function mp(e,t,n,r=0,a={}){var o;return t<=r||(a.subfeatures=(o=e.subfeatures)===null||o===void 0?void 0:o.map(i=>(mp(i,t,n,r+1,a),n(i)))),a}function yp(e){return Dn.types.model("BaseFeatureWidget",{id:cP.ElementId,type:Dn.types.literal("BaseFeatureWidget"),featureData:Dn.types.frozen(),formattedFields:Dn.types.frozen(),unformattedFeatureData:Dn.types.frozen(),view:Dn.types.safeReference(e.pluggableMstType("view","stateModel")),track:Dn.types.safeReference(e.pluggableMstType("track","stateModel"))}).volatile(()=>({})).actions(t=>({setFeatureData(n){t.unformattedFeatureData=n},clearFeatureData(){t.featureData=void 0},setFormattedData(n){t.featureData=n}})).actions(t=>({afterCreate(){(0,Dn.addDisposer)(t,(0,sP.autorun)(()=>{const{unformattedFeatureData:n,track:r}=t;if(n){const a=(0,lP.default)(n);if(r){a.__jbrowsefmt=(0,ko.getConf)(r,["formatDetails","feature"],{feature:a});const o=(0,ko.getConf)(r,["formatDetails","depth"]);mp(a,o,i=>{i.__jbrowsefmt=(0,ko.getConf)(r,["formatDetails","subfeatures"],{feature:i})})}t.setFormattedData(a)}}))}})).preProcessSnapshot(t=>{const{featureData:n,finalizedFeatureData:r,...a}=t;return{unformattedFeatureData:n,featureData:r,...a}}).postProcessSnapshot(t=>{const{unformattedFeatureData:n,featureData:r,...a}=t;return{finalizedFeatureData:JSON.parse(JSON.stringify(r,(o,i)=>typeof i>"u"?null:i)),...a}})}cr.default=yp;Gl=cr.stateModelFactory=yp;var ct={},Jl=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ct,"__esModule",{value:!0});ct.CoreGetFeatureDetails=ct.CoreRender=ct.CoreEstimateRegionStats=ct.CoreFreeResources=ct.CoreGetFeatures=ct.CoreGetMetadata=ct.CoreGetFileInfo=ct.CoreGetRefNames=void 0;const dP=Qr,ca=dn,Un=Jl(Xa),fP=Jl(vr),no=Xe,ar=Ee(),pP=Jl(Wn);class gP extends Un.default{constructor(){super(...arguments),this.name="CoreGetRefNames"}async execute(t,n){const r=await this.deserializeArguments(t,n),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,ca.getAdapter)(this.pluginManager,a,o);return(0,no.isFeatureAdapter)(i)?i.getRefNames(r):[]}}ct.CoreGetRefNames=gP;class hP extends Un.default{constructor(){super(...arguments),this.name="CoreGetInfo"}async execute(t,n){const r=await this.deserializeArguments(t,n),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,ca.getAdapter)(this.pluginManager,a,o);return(0,no.isFeatureAdapter)(i)?i.getHeader(r):null}}ct.CoreGetFileInfo=hP;class mP extends Un.default{constructor(){super(...arguments),this.name="CoreGetMetadata"}async execute(t,n){const r=await this.deserializeArguments(t,n),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,ca.getAdapter)(this.pluginManager,a,o);return(0,no.isFeatureAdapter)(i)?i.getMetadata(r):null}}ct.CoreGetMetadata=mP;class yP extends Un.default{constructor(){super(...arguments),this.name="CoreGetFeatures"}async deserializeReturn(t,n,r){return(await super.deserializeReturn(t,n,r)).map(o=>new pP.default(o))}async serializeArguments(t,n){var r,a;const o=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager,i=o?await(0,ar.renameRegionsIfNeeded)(o,t):t;return await super.serializeArguments(i,n)}async execute(t,n){const r=await this.deserializeArguments(t,n),{signal:a,sessionId:o,adapterConfig:i,regions:s,opts:c}=r,{dataAdapter:u}=await(0,ca.getAdapter)(this.pluginManager,o,i);if(!(0,no.isFeatureAdapter)(u))throw new Error("Adapter does not support retrieving features");return(await u.getFeaturesInMultipleRegions(s,{...c,signal:a}).pipe((0,dP.toArray)()).toPromise()).map(p=>p.toJSON())}}ct.CoreGetFeatures=yP;class bP extends Un.default{constructor(){super(...arguments),this.name="CoreFreeResources"}async execute(t){let n=0;return n+=(0,ca.freeAdapterResources)(t),this.pluginManager.getRendererTypes().forEach(r=>{const a=r.freeResources();a&&(n+=a)}),n}async serializeArguments(t,n){return t}}ct.CoreFreeResources=bP;class vP extends Un.default{constructor(){super(...arguments),this.name="CoreEstimateRegionStats"}async serializeArguments(t,n){var r,a;const o=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager;if(!o)return t;const i=await(0,ar.renameRegionsIfNeeded)(o,{...t,filters:t.filters&&t.filters.toJSON().filters});return super.serializeArguments(i,n)}async execute(t,n){const r=await this.deserializeArguments(t,n),{adapterConfig:a,sessionId:o,regions:i}=r,{dataAdapter:s}=await(0,ca.getAdapter)(this.pluginManager,o,a);if(!(0,no.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.estimateRegionsStats(i,r)}}ct.CoreEstimateRegionStats=vP;class wP extends Un.default{constructor(){super(...arguments),this.name="CoreRender"}async serializeArguments(t,n){var r,a;const o=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager,i=o?await(0,ar.renameRegionsIfNeeded)(o,t):t,s=await super.serializeArguments(i,n);if(n==="MainThreadRpcDriver")return s;const{rendererType:c}=t;return Ma(c,this.pluginManager.getRendererType(c)).serializeArgsInClient(s)}async execute(t,n){let r=t;n!=="MainThreadRpcDriver"&&(r=await this.deserializeArguments(t,n));const{sessionId:a,rendererType:o,signal:i}=r;if(!a)throw new Error("must pass a unique session id");(0,ar.checkAbortSignal)(i);const s=Ma(o,this.pluginManager.getRendererType(o)),c=n==="MainThreadRpcDriver"?await s.render(r):await s.renderInWorker(r);return(0,ar.checkAbortSignal)(i),c}async deserializeReturn(t,n,r){const a=await super.deserializeReturn(t,n,r);if(r==="MainThreadRpcDriver")return a;const{rendererType:o}=n;return Ma(o,this.pluginManager.getRendererType(o)).deserializeResultsInClient(a,n)}}ct.CoreRender=wP;class SP extends Un.default{constructor(){super(...arguments),this.name="CoreGetFeatureDetails"}async serializeArguments(t,n){var r,a;const o=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager,i=o?await(0,ar.renameRegionsIfNeeded)(o,t):t,s=await super.serializeArguments(i,n);if(n==="MainThreadRpcDriver")return s;const{rendererType:c}=t;return Ma(c,this.pluginManager.getRendererType(c)).serializeArgsInClient(s)}async execute(t,n){let r=t;n!=="MainThreadRpcDriver"&&(r=await this.deserializeArguments(t,n));const{rendererType:a,featureId:o}=r,s=Ma(a,this.pluginManager.getRendererType(a)).sessions[(0,ar.getLayoutId)(t)],{layout:c}=s.cachedLayout;return{feature:c.getDataByID(o).toJSON()}}}ct.CoreGetFeatureDetails=SP;function Ma(e,t){if(!t)throw new Error(`renderer "${e}" not found`);if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);if(!(t instanceof fP.default))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var Xr={},CP=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.DataAdapter=Xr.configSchema=void 0;const _P=CP(Wn),bp=C,TP=Ce,xP=Xe,PP=(0,bp.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0});Xr.configSchema=PP;class kP extends xP.BaseAdapter{async getData(){const t=(0,bp.readConfObject)(this.config,"cytobandLocation");return t.uri===""||t.uri==="/path/to/cytoband.txt.gz"?[]:(await(0,TP.openLocation)(t).readFile("utf8")).split(`
`).filter(r=>!!r.trim()).map(r=>{const[a,o,i,s,c]=r.split("	");return new _P.default({uniqueId:r,refName:a,start:+o,end:+i,name:s,type:c})})}freeResources(){}}Xr.DataAdapter=kP;var MP=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),RP=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),vp=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&MP(t,e,n);return RP(t,e),t},Xl=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ul,"__esModule",{value:!0});const AP=M.exports,Mu=cr,EP=Xl(Ka),$P=vp(ct),DP=Xl(ra),LP=Xl(aa),Ru=Xr;class NP extends EP.default{constructor(){super(...arguments),this.name="CorePlugin"}install(t){Object.values($P).forEach(n=>{t.addRpcMethod(()=>new n(t))}),t.addAdapterType(()=>new DP.default({name:"CytobandAdapter",configSchema:Ru.configSchema,AdapterClass:Ru.DataAdapter})),t.addWidgetType(()=>new LP.default({name:"BaseFeatureWidget",heading:"Feature details",configSchema:Mu.configSchema,stateModel:(0,Mu.stateModelFactory)(t),ReactComponent:(0,AP.lazy)(()=>Promise.resolve().then(()=>vp(_t)))}))}}Ul.default=NP;var kt=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(If,"__esModule",{value:!0});const Er=Re,FP=kt(yr),BP=kt(ra),IP=kt(Ua),OP=kt(Ga),jP=kt(Ja),zP=kt(aa),qP=kt(oi),VP=kt(Xa),HP=kt(ii),WP=kt(si),UP=kt(li),Au=C,GP=kt(Ka),JP=kt(ci),XP=kt(Ul),YP=kt(ei);class KP{constructor(...t){this.phaseCallbacks=new Map,this.phaseOrder=[],this.phaseOrder=t}add(t,n){if(!this.phaseOrder.includes(t))throw new Error(`unknown phase ${t}`);let r=this.phaseCallbacks.get(t);r||(r=[],this.phaseCallbacks.set(t,r)),r.push(n)}run(){this.phaseOrder.forEach(t=>{var n;(n=this.phaseCallbacks.get(t))===null||n===void 0||n.forEach(r=>r())})}}class Xt{constructor(t,n){this.typeName=t,this.baseClass=n,this.registeredTypes={}}add(t,n){this.registeredTypes[t]=n}has(t){return t in this.registeredTypes}get(t){if(!this.has(t))throw new Error(`${this.typeName} '${t}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[t]}all(){return Object.values(this.registeredTypes)}}class QP{constructor(t=[]){this.plugins=[],this.jexl=(0,YP.default)(),this.pluginMetadata={},this.runtimePluginDefinitions=[],this.elementCreationSchedule=new KP("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow"),this.rendererTypes=new Xt("RendererType",FP.default),this.adapterTypes=new Xt("AdapterType",BP.default),this.textSearchAdapterTypes=new Xt("TextSearchAdapterType",WP.default),this.trackTypes=new Xt("TrackType",IP.default),this.displayTypes=new Xt("DisplayType",OP.default),this.connectionTypes=new Xt("ConnectionType",qP.default),this.viewTypes=new Xt("ViewType",jP.default),this.widgetTypes=new Xt("WidgetType",zP.default),this.rpcMethods=new Xt("RpcMethodType",VP.default),this.addTrackWidgets=new Xt("AddTrackWorkflow",UP.default),this.internetAccountTypes=new Xt("InternetAccountType",HP.default),this.configured=!1,this.extensionPoints=new Map,this.jbrequireCache=new Map,this.lib=JP.default,this.load=n=>(this.jbrequireCache.has(n)||this.jbrequireCache.set(n,n(this)),this.jbrequireCache.get(n)),this.jbrequire=n=>{if(typeof n=="string"){const r=this.lib[n];if(!r)throw new TypeError(`No jbrequire re-export defined for package '${n}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return r}if(typeof n=="function")return this.load(n);if(n.default)return this.jbrequire(n.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")},this.addPlugin({plugin:new XP.default,metadata:{isCore:!0}}),t.forEach(n=>{this.addPlugin(n)})}pluginConfigurationSchemas(){const t={};return this.plugins.forEach(n=>{n.configurationSchema&&(t[n.name]=n.configurationSchema)}),t}addPlugin(t){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[n,r={}]=t instanceof GP.default?[t,{}]:[t.plugin,t.metadata];if(this.plugins.includes(n))throw new Error("plugin already installed");return this.pluginMetadata[n.name]=r,"definition"in t&&this.runtimePluginDefinitions.push(t.definition),n.install(this),this.plugins.push(n),this}getPlugin(t){return this.plugins.find(n=>n.name===t)}hasPlugin(t){return this.getPlugin(t)!==void 0}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),delete this.elementCreationSchedule),this}setRootModel(t){this.rootModel=t}configure(){if(this.configured)throw new Error("already configured");return this.plugins.forEach(t=>t.configure(this)),this.configured=!0,this}getElementTypeRecord(t){switch(t){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error(`invalid element type '${t}'`)}}addElementType(t,n){var r;if(typeof n!="function")throw new Error("must provide a callback function that returns the new type object");const a=this.getElementTypeRecord(t);return(r=this.elementCreationSchedule)===null||r===void 0||r.add(t,()=>{const o=n(this);if(!o.name)throw new Error(`cannot add a ${t} with no name`);if(a.has(o.name))throw new Error(`${t} ${o.name} already registered, cannot register it again`);a.add(o.name,this.evaluateExtensionPoint("Core-extendPluggableElement",o))}),this}getElementType(t,n){return this.getElementTypeRecord(t).get(n)}getElementTypesInGroup(t){return this.getElementTypeRecord(t).all()}pluggableMstType(t,n,r=Er.types.maybe(Er.types.null)){const a=this.getElementTypeRecord(t).all().map(o=>o[n]).filter(o=>(0,Er.isType)(o)&&(0,Er.isModelType)(o));return a.length===0?(console.warn(`No pluggable types found matching ('${t}','${n}')`),r):Er.types.union(...a)}pluggableConfigSchemaType(t,n="configSchema"){const r=this.getElementTypeRecord(t).all().map(a=>a[n]).filter(a=>(0,Au.isBareConfigurationSchemaType)(a));return r.length===0&&r.push((0,Au.ConfigurationSchema)("Null",{})),Er.types.union(...r)}getRendererType(t){return this.rendererTypes.get(t)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(t){return this.adapterTypes.get(t)}getTextSearchAdapterType(t){return this.textSearchAdapterTypes.get(t)}getTrackType(t){return this.trackTypes.get(t)}getDisplayType(t){return this.displayTypes.get(t)}getViewType(t){return this.viewTypes.get(t)}getAddTrackWorkflow(t){return this.addTrackWidgets.get(t)}getWidgetType(t){return this.widgetTypes.get(t)}getConnectionType(t){return this.connectionTypes.get(t)}getRpcMethodType(t){return this.rpcMethods.get(t)}getInternetAccountType(t){return this.internetAccountTypes.get(t)}addRendererType(t){return this.addElementType("renderer",t)}addAdapterType(t){return this.addElementType("adapter",t)}addTextSearchAdapterType(t){return this.addElementType("text search adapter",t)}addTrackType(t){const n=()=>{const r=t(this);return this.getElementTypesInGroup("display").forEach(o=>{o.trackType===r.name&&!r.displayTypes.includes(o)&&r.addDisplayType(o)}),r};return this.addElementType("track",n)}addDisplayType(t){return this.addElementType("display",t)}addViewType(t){const n=()=>{const r=t(this);return this.getElementTypesInGroup("display").forEach(o=>{(o.viewType===r.name||o.viewType===r.extendedName)&&!r.displayTypes.includes(o)&&r.addDisplayType(o)}),r};return this.addElementType("view",n)}addWidgetType(t){return this.addElementType("widget",t)}addConnectionType(t){return this.addElementType("connection",t)}addRpcMethod(t){return this.addElementType("rpc method",t)}addInternetAccountType(t){return this.addElementType("internet account",t)}addAddTrackWorkflowType(t){return this.addElementType("add track workflow",t)}addToExtensionPoint(t,n){let r=this.extensionPoints.get(t);r||(r=[],this.extensionPoints.set(t,r)),r.push(n)}evaluateExtensionPoint(t,n,r){const a=this.extensionPoints.get(t);let o=n;if(a)for(const i of a)try{o=i(o,r)}catch(s){console.error(s)}return o}async evaluateAsyncExtensionPoint(t,n,r){const a=this.extensionPoints.get(t);let o=n;if(a)for(const i of a)try{o=await i(o,r)}catch(s){console.error(s)}return o}}var ZP=If.default=QP,wp={},Yl={};Object.defineProperty(Yl,"__esModule",{value:!0});const ts=Re,_i=C,Sp=(0,_i.ConfigurationSchema)("BaseRpcDriver",{workerCount:{type:"number",description:"The number of workers to use. If 0 (the default) JBrowse will decide how many workers to use.",defaultValue:0}},{explicitlyTyped:!0}),ek=(0,_i.ConfigurationSchema)("MainThreadRpcDriver",{},{explicitlyTyped:!0,baseConfiguration:Sp}),tk=(0,_i.ConfigurationSchema)("WebWorkerRpcDriver",{},{explicitlyTyped:!0,baseConfiguration:Sp});Yl.default=(0,_i.ConfigurationSchema)("RpcOptions",{defaultDriver:{type:"string",description:"the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend",defaultValue:"MainThreadRpcDriver"},drivers:ts.types.optional(ts.types.map(ts.types.union(ek,tk)),{MainThreadRpcDriver:{type:"MainThreadRpcDriver"}})},{actions:e=>({addDriverConfig(t,n){e.drivers.set(t,n)}})});var Kl={},ua={};Object.defineProperty(ua,"__esModule",{value:!0});ua.watchWorker=void 0;const Eu=Re,nk=Ee(),rk=Bt,ak=C;function $u(e){return!(typeof e=="function"||e instanceof Error)}async function Cp(e,t,n){return new Promise((r,a)=>{function o(){setTimeout(async()=>{try{await e.call("ping",[],{timeout:t*2,rpcDriverClassName:n}),o()}catch(i){a(i)}},t)}o()})}ua.watchWorker=Cp;function ok(){const e=typeof window<"u",t=e&&"hardwareConcurrency"in window.navigator;return e&&t?window.navigator.hardwareConcurrency:1}class ik{constructor(t){this.driver=t}async getWorker(){return this.workerP||(this.workerP=this.driver.makeWorker().then(t=>(Cp(t,this.driver.maxPingTime,this.driver.name).catch(n=>{t&&(console.error("worker did not respond, killing and generating new one"),console.error(n),t.destroy(),t.status="killed",t.error=n,this.workerP=void 0)}),t)).catch(t=>{throw this.workerP=void 0,t})),this.workerP}}class sk{constructor(t){this.lastWorkerAssignment=-1,this.workerAssignments=new Map,this.maxPingTime=3e4,this.workerCheckFrequency=5e3,this.config=t.config}filterArgs(t,n){if(Array.isArray(t))return t.filter($u).map(r=>this.filterArgs(r,n));if(typeof t=="object"&&t!==null){if(t instanceof AbortSignal)return(0,rk.serializeAbortSignal)(t,this.remoteAbort.bind(this,n));if((0,Eu.isStateTreeNode)(t)&&!(0,Eu.isAlive)(t))throw new Error("dead state tree node passed to RPC call");return t instanceof File?t:Object.fromEntries(Object.entries(t).filter(r=>$u(r[1])).map(([r,a])=>[r,this.filterArgs(a,n)]))}return t}async remoteAbort(t,n,r){(await this.getWorker(t)).call(n,{signalId:r},{timeout:1e6,rpcDriverClassName:this.name})}createWorkerPool(){const t=ok(),n=(0,ak.readConfObject)(this.config,"workerCount")||(0,nk.clamp)(1,Math.max(1,t-1),5);return[...new Array(n)].map(()=>new ik(this))}getWorkerPool(){if(!this.workerPool){const t=this.createWorkerPool();return this.workerPool=t,t}return this.workerPool}async getWorker(t){const n=this.getWorkerPool();let r=this.workerAssignments.get(t);if(r===void 0){const o=(this.lastWorkerAssignment+1)%n.length;this.workerAssignments.set(t,o),this.lastWorkerAssignment=o,r=o}const a=n[r].getWorker();if(!a)throw new Error("no web workers registered for RPC");return a}async call(t,n,r,a,o={}){if(!n)throw new TypeError("sessionId is required");let i=!1;const s=await this.getWorker(n),c=t.getRpcMethodType(r),u=await c.serializeArguments(a,this.name),d=this.filterArgs(u,n),f=s.call(r,d,{timeout:5*60*1e3,statusCallback:a.statusCallback,rpcDriverClassName:this.name,...o}).finally(()=>{i=!0});let p;const g=new Promise((m,y)=>{p=setInterval(()=>{s.status==="killed"?y(new Error(`operation timed out, worker process stopped responding, ${s.error}`)):i&&m(!0)},this.workerCheckFrequency)}).finally(()=>{clearInterval(p)}),h=Promise.race([f,g]);return c.deserializeReturn(h,a,this.name)}}ua.default=sk;var Ql=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Kl,"__esModule",{value:!0});const lk=Ql(Qb),ck=Ql(Yd.exports),uk=Ql(ua);class dk extends lk.default.Client{destroy(){this.workers[0].terminate()}async call(t,n,r){const{statusCallback:a,rpcDriverClassName:o}=r,i=`message-${ck.default.generate()}`,s=u=>{a&&a(u)};this.on(i,s);const c=await super.call(t,{...n,channel:i,rpcDriverClassName:o},r);return this.off(i,s),c}}class fk extends uk.default{constructor(t,n){super(t),this.workerBootConfiguration=n,this.name="WebWorkerRpcDriver",this.makeWorkerInstance=t.makeWorkerInstance}async makeWorker(){const t=this.makeWorkerInstance(),n=new dk({workers:[t]});return new Promise((a,o)=>{n.workers[0].onmessage=i=>{i.data==="ready"?a(n):i.data==="readyForConfig"?n.workers[0].postMessage(this.workerBootConfiguration):o()}})}}Kl.default=fk;var Zl={},pk=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Zl,"__esModule",{value:!0});const gk=pk(ua);class hk{destroy(){}async call(t,n,r={}){}}class mk extends gk.default{constructor(t){super(t),this.name="MainThreadRpcDriver",this.makeWorker=async()=>new hk}async call(t,n,r,a){if(!n)throw new TypeError("sessionId is required");const o=t.getRpcMethodType(r),i=await o.serializeArguments(a,this.name),s=await o.execute(i,this.name);return o.deserializeReturn(s,a,this.name)}}Zl.default=mk;var ec=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wp,"__esModule",{value:!0});const yk=C,bk=ec(Yl),_p=ec(Kl),Tp=ec(Zl);_p.default,Tp.default;class xp{constructor(t,n,r){if(this.pluginManager=t,this.mainConfiguration=n,this.backendConfigurations=r,!n)throw new Error("RpcManager requires at least a main configuration");this.driverObjects=new Map}getDriver(t){const n=this.driverObjects.get(t);if(n)return n;let r;const a=this.mainConfiguration.drivers.get("WebWorkerRpcDriver");if(t==="MainThreadRpcDriver"){const o=this.backendConfigurations.MainThreadRpcDriver;if(!o)throw new Error(`requested RPC driver "${t}" is missing config`);r=new Tp.default({...o,config:a})}else if(t==="WebWorkerRpcDriver"){const o=this.backendConfigurations.WebWorkerRpcDriver;if(!o)throw new Error(`requested RPC driver "${t}" is missing config`);r=new _p.default({...o,config:a},{plugins:this.pluginManager.runtimePluginDefinitions})}else throw new Error(`requested RPC driver "${t}" is not installed`);return this.driverObjects.set(t,r),r}async getDriverForCall(t,n,r){const a=r.rpcDriverName||(0,yk.readConfObject)(this.mainConfiguration,"defaultDriver");return this.getDriver(a)}async call(t,n,r,a={}){if(!t)throw new Error("sessionId is required");return(await this.getDriverForCall(t,n,r)).call(this.pluginManager,t,n,r,a)}}var Pp=wp.default=xp;xp.configSchema=bk.default;var kp={},vk=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kp,"__esModule",{value:!0});const wk=vk(ai),ns=C;class Sk{constructor(t){this.pluginManager=t,this.adapterCache=new wk.default({maxSize:15})}loadTextSearchAdapters(t){const n=this.pluginManager;return this.relevantAdapters(t).map(r=>{const a=(0,ns.readConfObject)(r,"textSearchAdapterId"),o=this.adapterCache.get(a);if(o)return o;{const{AdapterClass:i}=n.getTextSearchAdapterType(r.type),s=new i(r,void 0,n);return this.adapterCache.set(a,s),s}})}relevantAdapters(t){var n;const r=this.pluginManager,{aggregateTextSearchAdapters:a,tracks:o}=(n=r.rootModel)===null||n===void 0?void 0:n.jbrowse,{assemblyName:i}=t;return[...this.getAdaptersWithAssembly(i,a),...this.getTrackAdaptersWithAssembly(i,o)]}getAdaptersWithAssembly(t,n){return n.filter(r=>{var a;return(a=(0,ns.readConfObject)(r,"assemblyNames"))===null||a===void 0?void 0:a.includes(t)})}getTrackAdaptersWithAssembly(t,n){return n.filter(r=>{var a;return(a=(0,ns.readConfObject)(r,["textSearching","textSearchAdapter","assemblyNames"]))===null||a===void 0?void 0:a.includes(t)}).map(r=>r.textSearching.textSearchAdapter)}async search(t,n,r){const a=this.loadTextSearchAdapters(n),o=await Promise.all(a.map(i=>i.searchIndex(t)));return this.sortResults(o.flat(),r)}sortResults(t,n){return n(t.sort((r,a)=>-a.getLabel().localeCompare(r.getLabel()))).sort((r,a)=>r.getScore()-a.getScore())}}var Ck=kp.default=Sk;const _k=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi),Mp=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/);function On(e=""){return e.split(/([MIDNSHPX=])/).slice(0,-1)}function Tk(e,t,n,r){let a=0,o=0;const i=[],s=n&&t;for(let c=0;c<e.length;c+=2){const u=+e[c],d=e[c+1];if(d==="M"||d==="="||d==="E"){if(s)for(let f=0;f<u;f++)t[o+f].toUpperCase()!==n[a+f].toUpperCase()&&i.push({start:a+f,type:"mismatch",base:t[o+f],altbase:n[a+f],length:1});o+=u}if(d==="I")i.push({start:a,type:"insertion",base:`${u}`,length:0}),o+=u;else if(d==="D")i.push({start:a,type:"deletion",base:"*",length:u});else if(d==="N")i.push({start:a,type:"skip",base:"N",length:u});else if(d==="X"){const f=t.slice(o,o+u),p=(r==null?void 0:r.slice(o,o+u))||[];for(let g=0;g<u;g++)i.push({start:a+g,type:"mismatch",base:f[g],qual:p[g],length:1});o+=u}else d==="H"?i.push({start:a,type:"hardclip",base:`H${u}`,cliplen:u,length:1}):d==="S"&&(i.push({start:a,type:"softclip",base:`S${u}`,cliplen:u,length:1}),o+=u);d!=="I"&&d!=="S"&&d!=="H"&&(a+=u)}return i}function xk(e,t,n,r,a){const o=[];let i={start:0,base:"",length:0,type:"mismatch"};const s=n.filter(m=>m.type==="skip");let c=0,u=0,d=0,f=0;function p(){o.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}function g(m){let y=u,b=d;for(let S=c;S<t.length&&b<=m;S+=2,c=S){const _=+t[S],T=t[S+1];T==="S"||T==="I"?y+=_:T==="D"||T==="P"||T==="N"?b+=_:T!=="H"&&(y+=_,b+=_)}return u=y,d=b,y-(b-m)}const h=e.match(_k)||[];for(let m=0;m<h.length;m++){const y=h[m],b=+y;if(!Number.isNaN(b))i.start+=b;else if(y.startsWith("^"))i.start+=y.length-1;else for(let S=0;S<y.length;S+=1){for(i.length=1;f<s.length;){const x=s[f];if(i.start>=x.start)i.start+=x.length,f++;else break}const _=g(i.start);i.base=r[_]||"X";const T=a==null?void 0:a[_];T&&(i.qual=T),i.altbase=y,p()}}return o}function Pk(e,t,n,r,a){let o=[];const i=On(e);return e&&(o=o.concat(Tk(i,n,r,a))),t&&(o=o.concat(xk(t,i,o,n,a))),o}function*jo(e,t){let n=0,r=0,a=0;for(let o=0;o<e.length&&a<t.length;o+=2){const i=+e[o],s=e[o+1];if(s==="S"||s==="I"){for(let c=0;c<i&&a<t.length;c++)t[a]===n+c&&a++;n+=i}else if(s==="D"||s==="N")r+=i;else if(s==="M"||s==="X"||s==="="){for(let c=0;c<i&&a<t.length;c++)t[a]===n+c&&(yield r+c,a++);n+=i,r+=i}}}function zo(e,t,n){const r=n===-1?P.revcom(t):t,a=e.split(";").filter(i=>!!i),o=[];for(let i=0;i<a.length;i++){const s=a[i],[c,...u]=s.split(","),d=c.match(Mp);if(!d)throw new Error("bad format for MM tag");const[,f,p,g]=d,h=g.split(/(\d+|.)/).filter(m=>!!m);p==="-"&&(console.warn("unsupported negative strand modifications"),o.push({type:"unsupported",positions:[]}));for(let m=0;m<h.length;m++){const y=h[m];let b=0;const S=[];for(let _=0;_<u.length;_++){let T=+u[_];do(f==="N"||f===r[b])&&T--,b++;while(T>=0&&b<r.length);const x=b-1;S.push(n===-1?r.length-1-x:x)}n===-1&&S.sort((_,T)=>_-T),o.push({type:y,positions:S})}}return o}function kk(e){return e.split(";").filter(n=>!!n).map(n=>{const[r]=n.split(","),a=r.match(Mp);if(!a)throw new Error("bad format for MM tag");const[,,,o]=a;return o.split(/(\d+|.)/).filter(i=>!!i)}).flat()}const Mk=e=>k.late(()=>C.ConfigurationSchema("CramAdapter",{fetchSizeLimit:{type:"number",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})),Rk=e=>{e.addAdapterType(()=>new je({name:"CramAdapter",configSchema:e.load(Mk),getAdapterClass:()=>se(()=>Promise.resolve().then(()=>aN),void 0).then(t=>t.default)}))},Ak=k.late(()=>C.ConfigurationSchema("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:C.ConfigurationSchema("BamIndex",{indexType:{model:k.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",defaultValue:5e6},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})),Ek=e=>{e.addAdapterType(()=>new je({name:"BamAdapter",configSchema:Ak,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>oN),void 0).then(t=>t.default)}))},$k=k.late(()=>C.ConfigurationSchema("HtsgetBamAdapter",{htsgetBase:{type:"string",defaultValue:""},htsgetTrackId:{type:"string",defaultValue:""},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})),Dk=e=>{e.addAdapterType(()=>new je({name:"HtsgetBamAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},configSchema:$k,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>sN),void 0).then(t=>t.default)}))},Lk=e=>k.late(()=>C.ConfigurationSchema("SNPCoverageAdapter",{subadapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0}));function qo(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function nr(e,t,n){return qo(e,t)||qo(e,n)}const Nk={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}};async function Rp(e,t){var n;const{end:r,originalRefName:a,refName:o}=e;return(n=(await t.getFeatures({...e,refName:a||o,end:r+1}).pipe(Rn()).toPromise())[0])===null||n===void 0?void 0:n.get("seq")}function Ap(e){return e==="methylation"}function Fk(e){return Ep(e.type)?1:e.length}function Ep(e){return e==="softclip"||e==="hardclip"||e==="insertion"}function Ln(e,t,n,r){let a=e[n][r];a===void 0&&(a=e[n][r]={total:0,"-1":0,0:0,1:0}),a.total++,a[t]++}class $p extends st{async configure(){var t,n;const r=this.getConf("subadapter"),a=this.getConf(["subadapter","sequenceAdapter"]),o=await((t=this.getSubAdapter)===null||t===void 0?void 0:t.call(this,r)),i=a?await((n=this.getSubAdapter)===null||n===void 0?void 0:n.call(this,a)):void 0;if(!o)throw new Error("Failed to get subadapter");return{subadapter:o.dataAdapter,sequenceAdapter:i==null?void 0:i.dataAdapter}}async fetchSequence(t){const{sequenceAdapter:n}=await this.configure();if(!!n)return Rp(t,n)}getFeatures(t,n={}){return Ke(async r=>{const{subadapter:a}=await this.configure(),o=await a.getFeatures(t,n).pipe(Rn()).toPromise(),{bins:i,skipmap:s}=await this.generateCoverageBins(o,t,n);i.forEach((c,u)=>{const d=t.start+u;r.next(new Pn({id:`${this.id}-${d}`,data:{score:c.total,snpinfo:c,start:d,end:d+1,refName:t.refName}}))}),Object.entries(s).forEach(([c,u])=>{r.next(new Pn({id:c,data:{type:"skip",start:u.start,end:u.end,strand:u.strand,score:u.score,xs:u.xs}}))}),r.complete()},n.signal)}async estimateRegionsStats(t,n){const{subadapter:r}=await this.configure();return r.estimateRegionsStats(t,n)}async getRefNames(t={}){const{subadapter:n}=await this.configure();return n.getRefNames(t)}freeResources(){}async generateCoverageBins(t,n,r){var a;const{colorBy:o}=r,i=Math.ceil(n.end-n.start),s={},c=t.length&&Ap((a=r.colorBy)===null||a===void 0?void 0:a.type)?await this.fetchSequence(n):void 0,u=[];for(let d=0;d<t.length;d++){const f=t[d],p=f.get("start"),g=f.get("end"),h=f.get("strand");for(let b=p;b<g+1;b++){const S=b-n.start;S>=0&&S<i&&(u[S]===void 0&&(u[S]={total:0,all:0,ref:0,"-1":0,0:0,1:0,lowqual:{},cov:{},delskips:{},noncov:{}}),b!==g&&(u[S].total++,u[S].all++,u[S].ref++,u[S][h]++))}if((o==null?void 0:o.type)==="modifications"){const b=f.get("seq"),S=nr(f,"MM","Mm")||"",_=On(f.get("CIGAR")),T=f.get("end");zo(S,b,h).forEach(({type:x,positions:A})=>{const R=`mod_${x}`;for(const E of jo(_,A)){const $=E+p-n.start;if($>=0&&$<u.length&&E+p<T){const B=u[$];B?Ln(B,h,"cov",R):console.warn("Undefined position in modifications snpcoverage encountered")}}})}else if((o==null?void 0:o.type)==="methylation"){if(!c)throw new Error("no region sequence detected, need sequenceAdapter configuration");const b=f.get("seq"),S=nr(f,"MM","Mm")||"",_=new Array(n.end-n.start).fill(0),T=On(f.get("CIGAR"));zo(S,b,h).forEach(({type:x,positions:A})=>{if(x==="m")for(const R of jo(T,A)){const E=R+p-n.start;E>=0&&E<_.length&&(_[E]=1)}});for(let x=p;x<g;x++){const A=x-n.start;if(A>=0&&A<u.length-1){const R=c[A].toLowerCase(),E=c[A+1].toLowerCase(),$=u[A],B=u[A+1];R==="c"&&E==="g"&&(_[A]||_[A+1]?(Ln($,h,"cov","meth"),Ln(B,h,"cov","meth"),u[A].ref--,u[A][h]--,u[A+1].ref--,u[A+1][h]--):(Ln($,h,"cov","unmeth"),Ln(B,h,"cov","unmeth"),u[A].ref--,u[A][h]--,u[A+1].ref--,u[A+1][h]--))}}}const m=f.get("mismatches")||[],y=(o==null?void 0:o.type)!=="modifications"&&(o==null?void 0:o.type)!=="methylation";for(let b=0;b<m.length;b++){const S=m[b],_=p+S.start,T=Fk(S),x=_+T;for(let A=_;A<_+T;A++){const R=A-n.start;if(R>=0&&R<u.length){const E=u[R],{base:$,type:B}=S,F=Ep(B);F?Ln(E,h,"noncov",B):(E.ref--,E[h]--),B==="deletion"||B==="skip"?(Ln(E,h,"delskips",B),E.total--):!F&&y&&(Ln(E,h,"cov",$),E.refbase=S.altbase)}}if(S.type==="skip"){const A=`${_}_${x}_${h}`;s[A]===void 0&&(s[A]={feature:f,start:_,end:x,strand:h,xs:qo(f,"XS")||qo(f,"TS"),score:0}),s[A].score++}}}return{bins:u,skipmap:s}}}const{capabilities:Dp}=$p,Bk=Object.freeze(Object.defineProperty({__proto__:null,default:$p,capabilities:Dp},Symbol.toStringTag,{value:"Module"})),Ik=e=>{e.addAdapterType(()=>new je({name:"SNPCoverageAdapter",adapterMetadata:{category:null,displayName:null,hiddenFromGUI:!0,description:null},getAdapterClass:()=>se(()=>Promise.resolve().then(()=>Bk),void 0).then(t=>t.default),configSchema:Lk(e),adapterCapabilities:Dp}))},Ok=C.ConfigurationSchema("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:`draw count "upsidedown histogram" of the interbase events that don't contribute to the coverage count so are not drawn in the normal histogram`,defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0});class hn extends rp{constructor(){super(...arguments),this.supportsSVG=!0}async render(t){const n=await this.getFeatures(t),{height:r,regions:a,bpPerPx:o}=t,[i]=a,s=(i.end-i.start)/o,{reducedFeatures:c,...u}=await P.renderToAbstractCanvas(s,r,t,f=>this.draw(f,{...t,features:n})),d=await super.render({...t,...u,features:n,height:r,width:s});return{...d,...u,features:c?new Map(c.map(f=>[f.id(),f])):d.features,height:r,width:s,containsNoTransferables:!0}}}function jk(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,onMouseLeave:i=()=>{},onMouseMove:s=()=>{},onFeatureClick:c=()=>{}}=e,[u]=t,d=M.exports.useRef(null);function f(p){let g=0;d.current&&(g=d.current.getBoundingClientRect().left);const h=p-g,m=u.reversed?a-h:h,y=u.start+r*m;let b;for(const S of n.values())if(y<=S.get("end")+r&&y>=S.get("start")){b=S;break}return b}return l("div",{ref:d,"data-testid":"wiggle-rendering-test",onMouseMove:p=>{var g;return s(p,(g=f(p.clientX))===null||g===void 0?void 0:g.id())},onClick:p=>{var g;return c(p,(g=f(p.clientX))===null||g===void 0?void 0:g.id())},onMouseLeave:p=>i(p),style:{overflow:"visible",position:"relative",height:o},children:l(Le.PrerenderedCanvas,{...e})})}const ro=j(jk),zk=C.ConfigurationSchema("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"}},{explicitlyTyped:!0}),qk=e=>{e.addAdapterType(()=>new je({name:"BigWigAdapter",configSchema:zk,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>se(()=>Promise.resolve().then(()=>lN),void 0).then(t=>t.default)}))},Vk=e=>{e.addTrackType(()=>{const t=C.ConfigurationSchema("QuantitativeTrack",{},{baseConfiguration:ze.createBaseTrackConfig(e)});return new lr({name:"QuantitativeTrack",configSchema:t,stateModel:ze.createBaseTrackModel(e,"QuantitativeTrack",t)})})},Hk=e=>{e.addTrackType(()=>{const t=C.ConfigurationSchema("MultiQuantitativeTrack",{},{baseConfiguration:ze.createBaseTrackConfig(e)});return new lr({name:"MultiQuantitativeTrack",configSchema:t,stateModel:ze.createBaseTrackModel(e,"MultiQuantitativeTrack",t)})})},Wk=C.ConfigurationSchema("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[]},bigWigs:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0}),Uk=e=>{e.addAdapterType(()=>new je({name:"MultiWiggleAdapter",configSchema:Wk,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>se(()=>Promise.resolve().then(()=>uN),void 0).then(t=>t.default)}))},Gn=C.ConfigurationSchema("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:k.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),Gk=C.ConfigurationSchema("DensityRenderer",{},{baseConfiguration:Gn,explicitlyTyped:!0}),pn=5;function Mn({domain:e=[],range:t=[],scaleType:n,pivotValue:r,inverted:a}){let o;const[i,s]=e;if(i===void 0||s===void 0)throw new Error("invalid domain");if(n==="linear")o=Kd();else if(n==="log")o=Qd(),o.base(2);else if(n==="quantize")o=Zd();else throw new Error("undefined scaleType");o.domain(r!==void 0?[i,r,s]:[i,s]),o.nice();const[c,u]=t;if(c===void 0||u===void 0)throw new Error("invalid range");return o.range(a?t.slice().reverse():t),o}function Vo(e){return e==="log"?1:0}function tc({scaleType:e,domain:t,bounds:n}){const[r,a]=n;let[o,i]=t;if(e==="linear"&&(i<0&&(i=0),o>0&&(o=0)),e==="log"&&(o===0||o>1)&&(o=1),o===void 0||i===void 0)throw new Error("invalid domain supplied to stats function");r!==void 0&&r!==Number.MIN_VALUE&&(o=r),a!==void 0&&a!==Number.MAX_VALUE&&(i=a);const c=(u=>{if(u==="linear")return Kd();if(u==="log"){const d=Qd();return d.base(2),d}if(u==="quantize")return Zd();throw new Error(`undefined scaleType ${u}`)})(e);return c.domain([o,i]),c.nice(),c.domain()}function da(e,t){return e.reduce((n,r)=>{var a;return(n[a=t(r)]||(n[a]=[])).push(r),n},{})}async function Ti(e,t){const{rpcManager:n}=P.getSession(e),r=C.getConf(e,"numStdDev")||3,{adapterConfig:a,autoscaleType:o}=e,i=Y.getRpcSessionId(e),s={sessionId:i,adapterConfig:a,statusCallback:c=>{Ye(e)&&e.setMessage(c)},...t};if(o==="global"||o==="globalsd"){const c=await n.call(i,"WiggleGetGlobalStats",s),{scoreMin:u,scoreMean:d,scoreStdDev:f}=c;return o==="globalsd"?{...c,scoreMin:u>=0?0:d-r*f,scoreMax:d+r*f}:c}if(o==="local"||o==="localsd"){const{dynamicBlocks:c,bpPerPx:u}=P.getContainingView(e),d=await n.call(i,"WiggleGetMultiRegionStats",{...s,regions:c.contentBlocks.map(h=>{const{start:m,end:y}=h;return{...JSON.parse(JSON.stringify(h)),start:Math.floor(m),end:Math.ceil(y)}}),bpPerPx:u}),{scoreMin:f,scoreMean:p,scoreStdDev:g}=d;return o==="localsd"?{...d,scoreMin:f>=0?0:p-r*g,scoreMax:p+r*g}:d}if(o==="zscale")return n.call(i,"WiggleGetGlobalStats",s);throw new Error(`invalid autoscaleType '${o}'`)}function nc(e){fn(e,Yt(async()=>{try{const t=new AbortController,n=P.getContainingView(e);if(e.setLoading(t),!n.initialized||!e.estimatedStatsReady||e.regionTooLarge)return;const r=JSON.stringify(n.dynamicBlocks),a=await Ti(e,{signal:t.signal,...e.renderProps()});Ye(e)&&e.updateStats(a,r)}catch(t){!P.isAbortException(t)&&Ye(e)&&(console.error(t),e.setError(t))}},{delay:1e3}))}function ln(e=0){return+(+e).toPrecision(6)}function Lp(e){return Math.round(e*1e5)/1e5}const Jk=Object.freeze(Object.defineProperty({__proto__:null,YSCALEBAR_LABEL_OFFSET:pn,getScale:Mn,getOrigin:Vo,getNiceDomain:tc,groupBy:da,getStats:Ti,statsAutorun:nc,toP:ln,round:Lp},Symbol.toStringTag,{value:"Module"}));function an(e,t,n,r,a,o){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),o&&(a.fillStyle=o),a.fillRect(e,t,n,r)}const Nn=.4,Yr=2;function rc(e,t){const{features:n,bpPerPx:r,regions:a,scaleOpts:o,height:i,config:s,ticks:c,displayCrossHatches:u,offset:d=0,colorCallback:f,Color:p}=t,[g]=a,h=(g.end-g.start)/r,m=i-d*2,y=C.readConfObject(s,"filled"),b=C.readConfObject(s,"clipColor"),S=C.readConfObject(s,"summaryScoreMode"),_=C.readConfObject(s,"bicolorPivotValue"),T=C.readConfObject(s,"minSize"),x=Mn({...o,range:[0,m]}),A=Vo(o.scaleType),[R,E]=x.domain(),$=q=>P.clamp(m-(x(q)||0),0,m)+d,B=q=>$(A)-$(q),F=q=>y?B(q):Math.max(T,1);let I=!1,U=0;const z=[],G=R<_&&E>_;if(S==="whiskers"){let q,J;for(const Q of n.values()){const[H,ce]=P.featureSpanPx(Q,g,r);if(Q.get("summary")){const le=ce-H+Nn,re=Q.get("maxScore"),ve=f(Q,re),V=G?ve:ve===q?J:J=p(ve).lighten(.4).toString();an(H,$(re),le,F(re),e,V),q=ve}}J=void 0,q=void 0;for(const Q of n.values()){const[H,ce]=P.featureSpanPx(Q,g,r),le=Q.get("score"),re=Q.get("maxScore"),ve=Q.get("minScore"),V=Q.get("summary"),K=f(Q,le),ie=G&&V?K===q?J:J=p(f(Q,re)).mix(p(f(Q,ve))).toString():K,oe=Math.max(ce-H+Nn,T);Math.floor(H)!==Math.floor(U)&&(z.push(Q),U=H),I=I||le<R||le>E,an(H,$(le),oe,F(le),e,ie),q=K}J=void 0,q=void 0;for(const Q of n.values()){const[H,ce]=P.featureSpanPx(Q,g,r);if(Q.get("summary")){const le=Q.get("minScore"),re=f(Q,le),ve=Math.max(ce-H+Nn,T),V=G?re:re===q?J:J=p(re).darken(.4).toString();an(H,$(le),ve,F(le),e,V),q=re}}}else for(const q of n.values()){const[J,Q]=P.featureSpanPx(q,g,r);Math.floor(J)!==Math.floor(U)&&(z.push(q),U=J);const H=q.get("score"),ce=f(q,H);I=I||H<R||H>E;const le=Math.max(Q-J+Nn,T);if(S==="max"){const re=q.get("summary")?q.get("maxScore"):H;an(J,$(re),le,F(re),e,ce)}else if(S==="min"){const re=q.get("summary")?q.get("minScore"):H;an(J,$(re),le,F(re),e,ce)}else an(J,$(H),le,F(H),e,ce)}if(e.save(),I){e.fillStyle=b;for(const q of n.values()){const[J,Q]=P.featureSpanPx(q,g,r),H=Q-J+Nn,ce=q.get("score");ce>E?an(J,d,H,Yr,e):ce<R&&o.scaleType!=="log"&&an(J,i,H,Yr,e)}}return e.restore(),u&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",c.values.forEach(q=>{e.beginPath(),e.moveTo(0,Math.round($(q))),e.lineTo(h,Math.round($(q))),e.stroke()})),{reducedFeatures:z}}function ac(e,t){const{features:n,regions:r,bpPerPx:a,scaleOpts:o,height:i,ticks:{values:s},displayCrossHatches:c,colorCallback:u,config:d,offset:f=0}=t,[p]=r,g=(p.end-p.start)/a,h=i-f*2,m=C.readConfObject(d,"clipColor"),y=Mn({...o,range:[0,h]}),[b,S]=y.domain(),_=R=>P.clamp(h-(y(R)||0),0,h)+f;let T,x=0;const A=[];for(const R of n.values()){const[E,$]=P.featureSpanPx(R,p,a);Math.floor(E)!==Math.floor(x)&&(A.push(R),x=E);const B=R.get("score"),F=B<b,I=B>S,U=$-E+Nn,z=u(R,B);e.beginPath(),e.strokeStyle=z;const G=typeof T<"u"?T:B;p.reversed?(e.moveTo($,_(G)),e.lineTo($,_(B)),e.lineTo(E,_(B))):(e.moveTo(E,_(G)),e.lineTo(E,_(B)),e.lineTo($,_(B))),e.stroke(),T=B,I?(e.fillStyle=m,e.fillRect(E,f,U,Yr)):F&&o.scaleType!=="log"&&(e.fillStyle=m,e.fillRect(E,h-Yr,U,h))}return c&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",s.forEach(R=>{e.beginPath(),e.moveTo(0,Math.round(_(R))),e.lineTo(g,Math.round(_(R))),e.stroke()})),{reducedFeatures:A}}function Np(e,t){const{features:n,regions:r,bpPerPx:a,scaleOpts:o,height:i,config:s}=t,[c]=r,u=C.readConfObject(s,"bicolorPivot"),d=C.readConfObject(s,"bicolorPivotValue"),f=C.readConfObject(s,"negColor"),p=C.readConfObject(s,"posColor"),g=C.readConfObject(s,"color"),h=C.readConfObject(s,"clipColor"),m=u!=="none"&&o.scaleType!=="log",y=Mn({...o,pivotValue:m?d:void 0,range:m?[f,"white",p]:["white",p]}),b=Mn({...o,range:[0,i]});let S;g==="#f0f"?S=(E,$)=>y($):S=(E,$)=>C.readConfObject(s,"color",{feature:E,score:$});const[_,T]=b.domain();let x=0,A=!1;const R=[];for(const E of n.values()){const[$,B]=P.featureSpanPx(E,c,a);Math.floor($)!==Math.floor(x)&&(R.push(E),x=$);const F=E.get("score");A=A||F>T||F<_;const I=B-$+Nn;e.fillStyle=S(E,F),e.fillRect($,0,I,i)}if(e.save(),A){e.fillStyle=h;for(const E of n.values()){const[$,B]=P.featureSpanPx(E,c,a),F=B-$+Nn,I=E.get("score");(I>T||I<_&&o.scaleType!=="log")&&an($,0,F,Yr,e)}}return e.restore(),{reducedFeatures:R}}class Xk extends hn{async draw(t,n){return Np(t,n)}}const Yk=e=>{e.addRendererType(()=>new Xk({name:"DensityRenderer",ReactComponent:ro,configSchema:Gk,pluginManager:e}))};class Fp extends hn{async draw(t,n){const{features:r,config:a}=n,o=C.readConfObject(a,"bicolorPivotValue"),i=C.readConfObject(a,"negColor"),s=C.readConfObject(a,"posColor"),c=await se(()=>import("./color.b8402d12.js").then(u=>u.i),["assets/color.b8402d12.js","assets/color-string.6cf0e789.js","assets/color-name.e7a4e1d3.js","assets/simple-swizzle.bbda63e1.js","assets/is-arrayish.e606b633.js","assets/color-convert.69e17089.js"]).then(u=>u.default);return rc(t,{...n,colorCallback:C.readConfObject(a,"color")==="#f0f"?(u,d)=>d<o?i:s:(u,d)=>C.readConfObject(a,"color",{feature:u}),offset:pn,features:[...r.values()],Color:c})}}const Bp=C.ConfigurationSchema("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:k.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:Gn,explicitlyTyped:!0}),Kk=e=>{e.addRendererType(()=>new Fp({name:"XYPlotRenderer",ReactComponent:ro,configSchema:Bp,pluginManager:e}))},Qk=C.ConfigurationSchema("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:Gn,explicitlyTyped:!0});class Zk extends hn{async draw(t,n){return ac(t,{...n,offset:pn,colorCallback:()=>"grey"})}}const eM=e=>{e.addRendererType(()=>new Zk({name:"LinePlotRenderer",ReactComponent:ro,configSchema:Qk,pluginManager:e}))},Sr=C.ConfigurationSchema("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"}},{explicitIdentifier:"displayId"}),tM=ae()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function xs({message:e,severity:t,buttonText:n,icon:r,action:a}){const{classes:o}=tM();return l(fr,{title:e,children:l(Ed,{severity:t,action:a?l(ne,{"data-testid":"reload_button",onClick:a,startIcon:r,children:n}):null,classes:{message:o.ellipses},children:e})})}function nM({model:e}){const{regionTooLargeReason:t}=e;return l(xs,{severity:"warning",action:()=>{e.estimatedRegionStats?(e.updateStatsLimit(e.estimatedRegionStats),e.reload()):console.error("No global stats?")},buttonText:"Force load",message:`${t?t+". ":""}
      Zoom in to see features or force load (may be slow).`})}var Ip={};Object.defineProperty(Ip,"__esModule",{value:!0});class rM{constructor(t){this.submaps=t}has(t){for(const n of this.submaps.values())if(n.has(t))return!0;return!1}get(t){for(const n of this.submaps.values())if(n.has(t))return n.get(t)}*values(){for(const t of this.keys())yield this.get(t)}*keys(){const t=new Set;for(const n of this.submaps.values())for(const r of n.keys())t.add(r);for(const n of t)yield n}find(t){for(const n of this.submaps.values())for(const r of n.values())if(t(r))return r}*[Symbol.iterator](){for(const t of this.keys())yield[t,this.get(t)]}*entries(){for(const t of this.keys())yield[t,this.get(t)]}}var aM=Ip.default=rM;function oM(e){return Math.round(e*1e5)/1e5}const iM=ae()(e=>({tooltip:{pointerEvents:"none",backgroundColor:zt(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:`${oM(14/10)}em`,maxWidth:300,wordWrap:"break-word"}})),sM=$t.forwardRef(({message:e},t)=>l("div",{ref:t,children:$t.isValidElement(e)?e:e?l(Le.SanitizedHTML,{html:String(e)}):null})),lM=j(({model:e,clientMouseCoord:t})=>{const{classes:n}=iM(),{featureUnderMouse:r}=e,[a,o]=M.exports.useState(0),[i,s]=M.exports.useState(null),c=M.exports.useMemo(()=>({getBoundingClientRect:()=>{const p=t[0]+a/2+20,g=t[1];return{top:g,left:p,bottom:g,right:p,width:0,height:0,x:p,y:g,toJSON(){}}}}),[t,a]),{styles:u,attributes:d}=ef(c,i),f=r?C.getConf(e,"mouseover",{feature:r}):void 0;return r&&f?l($d,{children:l("div",{ref:s,className:n.tooltip,style:{...u.popper,zIndex:1e5},...d.popper,children:l(sM,{ref:p=>o((p==null?void 0:p.getBoundingClientRect().width)||0),message:f})})}):null}),oc=ae()(e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}})),ic=j(({block:e,children:t})=>{const{classes:n}=oc(),{widthPx:r}=e;return l("div",{style:{width:r},className:n.contentBlock,children:t})});function sc({width:e}){const{classes:t}=oc();return l("div",{className:t.elidedBlock,style:{width:e}})}function lc({boundary:e,width:t,style:n={}}){const{classes:r}=oc();return l("div",{style:{...n,width:t},className:e?r.boundaryPaddingBlock:r.interRegionPaddingBlock})}const Op=ae()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),cM=j(({model:e})=>{const{classes:t}=Op(),{blockDefinitions:n,blockState:r}=e;return l(Z,{children:n.map(a=>{if(a instanceof ia){const o=r.get(a.key);return w(ic,{block:a,children:[o&&o.ReactComponent?$t.createElement(o.ReactComponent,{model:o}):null,o&&o.maxHeightReached?l("div",{className:t.heightOverflowed,style:{top:o.layout.getTotalHeight()-16,pointerEvents:"none",height:16},children:"Max height reached"}):null]},`${e.id}-${a.key}`)}if(a instanceof pi)return l(sc,{width:a.widthPx},`${e.id}-${a.key}`);if(a instanceof di)return l(lc,{width:a.widthPx,style:{background:"none"},boundary:a.variant==="boundary"},a.key);throw new Error(`invalid block type ${typeof a}`)})})});function uM({model:e}){const{classes:t}=Op(),{blockDefinitions:n}=e,r=P.getContainingView(e);return l("div",{"data-testid":"Blockset",className:t.linearBlocks,style:{left:n.offsetPx-r.offsetPx},children:l(cM,{model:e})})}const dM=j(uM),fM=ae()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),Vn=j(e=>{const{classes:t}=fM(),n=Fa(),r=M.exports.useRef(null),[a,o]=M.exports.useState(),[i,s]=M.exports.useState([0,0]),[c,u]=M.exports.useState([0,0]),[d,f]=M.exports.useState(),{model:p,children:g}=e,{TooltipComponent:h,DisplayMessageComponent:m,contextMenuItems:y,height:b,setContextMenuFeature:S}=p;return w("div",{ref:r,"data-testid":`display-${C.getConf(p,"displayId")}`,className:t.display,onContextMenu:_=>{_.preventDefault(),d?f(void 0):r.current&&f([_.clientX,_.clientY])},onMouseMove:_=>{if(!r.current)return;const T=r.current.getBoundingClientRect(),{left:x,top:A}=T;s([_.clientX-x,_.clientY-A]),u([_.clientX,_.clientY]),o(T)},children:[m?l(m,{model:p}):l(dM,{...e}),g,l(h,{model:p,height:b,offsetMouseCoord:i,clientMouseCoord:c,clientRect:a,mouseCoord:i}),l(Le.Menu,{open:Boolean(d)&&Boolean(y().length),onMenuItemClick:(_,T)=>{T(),f(void 0)},onClose:()=>{f(void 0),S(void 0)},TransitionProps:{onExit:()=>{f(void 0),S(void 0)}},anchorReference:"anchorPosition",anchorPosition:d?{top:d[1],left:d[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:y()})]})}),pM=ae()(e=>({loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}})),gM=j(({model:e})=>{const[t,n]=M.exports.useState(!1),{classes:r}=pM();M.exports.useEffect(()=>{let s=!1;const c=setTimeout(()=>{s||n(!0)},300);return()=>{clearTimeout(c),s=!0}},[]);const{status:a}=e,{message:o}=Ge(e,2),i=o||a;return l(Z,{children:t?l("div",{className:r.loading,children:l(X,{className:r.dots,variant:"body2",children:i?`${i}`:"Loading"})}):null})}),Du=j(({model:e})=>e.error?l(xs,{message:`${e.error}`,severity:"error",buttonText:"reload",icon:l(Hy,{}),action:e.reload}):e.message?$t.isValidElement(e.message)?e.message:l(xs,{message:`${e.message}`,severity:"info"}):e.filled?e.reactElement:l(gM,{model:e})),rs=k.model("BlockState",{key:k.string,region:ut.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile(()=>({renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:Du,renderProps:void 0})).actions(e=>{let t;return{doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const n=P.getContainingDisplay(e);P.makeAbortableReaction(e,Ps,hM,{name:`${n.id}/${P.assembleLocString(e.region)} rendering`,delay:n.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus(n){e.status=n},setLoading(n){t!==void 0&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered(n){if(!n)return;const{reactElement:r,features:a,layout:o,maxHeightReached:i,renderProps:s}=n;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=o,e.error=void 0,e.maxHeightReached=i,e.renderProps=s,t=void 0},setError(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0,Ut.isRetryException(n)&&this.reload()},reload(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=Du,e.renderProps=void 0,Ge(e,2).reload()},beforeDestroy(){t&&!t.signal.aborted&&t.abort();const n=P.getContainingDisplay(e),{rpcManager:r}=P.getSession(e),{rendererType:a}=n,{renderArgs:o}=Ps(Hn(e));o&&a.freeResourcesInClient(r,JSON.parse(JSON.stringify(o))).catch(i=>{console.warn("Error while destroying block",i)})}}});function Ps(e,t){try{const n=t||P.getContainingDisplay(e),{assemblyManager:r,rpcManager:a}=P.getSession(n),{adapterConfig:o,rendererType:i,error:s,parentTrack:c}=n,u=Y.getTrackAssemblyNames(c),d=e.region.assemblyName;if(!u.includes(d)&&!u.find(y=>{var b;return(b=r.get(y))===null||b===void 0?void 0:b.hasName(d)}))throw new Error(`region assembly (${d}) does not match track assemblies (${u})`);const f=n.renderProps(),{config:p}=f;C.readConfObject(p);const g=Y.getRpcSessionId(n),h=P.getContainingView(n).id,m=n.regionCannotBeRendered(e.region);return{rendererType:i,rpcManager:a,renderProps:f,cannotBeRenderedReason:m,displayError:s,renderArgs:{statusCallback:y=>{Ye(e)&&e.setStatus(y)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:o,rendererType:i.name,sessionId:g,layoutId:h,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(n){return{displayError:n}}}async function hM(e,t,n){const{rendererType:r,renderProps:a,rpcManager:o,renderArgs:i,cannotBeRenderedReason:s,displayError:c}=e;if(!Ye(n))return;if(c){n.setError(c);return}if(s){n.setMessage(s);return}if(a.notReady)return;const{reactElement:u,features:d,layout:f,maxHeightReached:p}=await r.renderInClient(o,{...i,...a,viewParams:P.getViewParams(n),signal:t});return{reactElement:u,features:d,layout:f,maxHeightReached:p}}function mM(e,t){return`clip-${typeof jest>"u"?e:"jest"}-${t}`}function yM(e){let t;return Math.floor(e/1e6)>0?t=`${parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?t=`${parseFloat((e/1e3).toPrecision(3))} Kb`:t=`${Math.floor(e)} bytes`,t}const as=20,bM=100,Cr=k.compose("BaseLinearDisplay",ze.BaseDisplay,k.model({height:k.optional(k.refinement("displayHeight",k.number,e=>e>=as),bM),blockState:k.map(rs),userBpPerPxLimit:k.maybe(k.number),userByteSizeLimit:k.maybe(k.number)})).volatile(()=>({currBpPerPx:0,message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,scrollTop:0,estimatedRegionStatsP:void 0,estimatedRegionStats:void 0})).views(e=>({get blockType(){return"staticBlocks"},get blockDefinitions(){const{blockType:t}=this,n=P.getContainingView(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]}})).views(e=>({get renderDelay(){return 50},get TooltipComponent(){return lM},get selectedFeatureId(){if(Ye(e)){const{selection:t}=P.getSession(e);if(tl(t))return t.id()}},get DisplayMessageComponent(){}})).views(e=>({get features(){const t=[];for(const n of e.blockState.values())n&&n.features&&t.push(n.features);return new aM(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping(t,n,r){var a,o;return(o=(a=e.blockState.get(t))===null||a===void 0?void 0:a.layout)===null||o===void 0?void 0:o.getByCoord(n,r)},getFeatureByID(t,n){var r,a;return(a=(r=e.blockState.get(t))===null||r===void 0?void 0:r.layout)===null||a===void 0?void 0:a.getByID(n)},searchFeatureByID(t){let n;return e.blockState.forEach(r=>{var a;const o=(a=r==null?void 0:r.layout)===null||a===void 0?void 0:a.getByID(t);o&&(n=o)}),n},get currentBytesRequested(){var t;return((t=e.estimatedRegionStats)===null||t===void 0?void 0:t.bytes)||0},get currentFeatureScreenDensity(){var t;const n=P.getContainingView(e);return(((t=e.estimatedRegionStats)===null||t===void 0?void 0:t.featureDensity)||0)*n.bpPerPx},get maxFeatureScreenDensity(){return C.getConf(e,"maxFeatureScreenDensity")},get estimatedStatsReady(){return!!e.estimatedRegionStats},get maxAllowableBytes(){var t;return e.userByteSizeLimit||((t=e.estimatedRegionStats)===null||t===void 0?void 0:t.fetchSizeLimit)||C.getConf(e,"fetchSizeLimit")}})).actions(e=>({setMessage(t){e.message=t},afterAttach(){const t=Yt(()=>{const n={};P.getContainingView(e).initialized&&(e.blockDefinitions.contentBlocks.forEach(a=>{n[a.key]=!0,e.blockState.has(a.key)||this.addBlock(a.key,a)}),e.blockState.forEach((a,o)=>{n[o]||this.deleteBlock(o)}))});fn(e,t)},estimateRegionsStats(t,n){if(e.estimatedRegionStatsP)return e.estimatedRegionStatsP;const{rpcManager:r}=P.getSession(e),{adapterConfig:a}=e;if(!a)return Promise.resolve({});const o=Y.getRpcSessionId(e),i={sessionId:o,regions:t,adapterConfig:a,statusCallback:s=>{Ye(e)&&this.setMessage(s)},...n};return e.estimatedRegionStatsP=r.call(o,"CoreEstimateRegionStats",i).catch(s=>{throw this.setRegionStatsP(void 0),s}),e.estimatedRegionStatsP},setRegionStatsP(t){e.estimatedRegionStatsP=t},setRegionStats(t){e.estimatedRegionStats=t},clearRegionStats(){e.estimatedRegionStatsP=void 0,e.estimatedRegionStats=void 0},setHeight(t){return t>as?e.height=t:e.height=as,e.height},resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},setScrollTop(t){e.scrollTop=t},updateStatsLimit(t){const n=P.getContainingView(e);t.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},addBlock(t,n){e.blockState.set(t,rs.create({key:t,region:n.toRegion()}))},setCurrBpPerPx(t){e.currBpPerPx=t},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const n=P.getSession(e);if(P.isSessionModelWithWidgets(n)){const r=n.addWidget("BaseFeatureWidget","baseFeature",{view:P.getContainingView(e),track:P.getContainingTrack(e),featureData:t.toJSON()});n.showWidget(r)}P.isSelectionContainer(n)&&n.setSelection(t)},clearFeatureSelection(){P.getSession(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},reload(){[...e.blockState.values()].map(t=>t.doReload())},setContextMenuFeature(t){e.contextMenuFeature=t}})).views(e=>({get regionTooLarge(){const t=P.getContainingView(e);if(!e.estimatedStatsReady||t.dynamicBlocks.totalBp<2e4)return!1;const n=e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity;return e.currentBytesRequested>e.maxAllowableBytes||n},get regionTooLargeReason(){const t=e.currentBytesRequested,n=e.maxAllowableBytes;return t&&t>n?`Requested too much data (${yM(t)})`:""}})).actions(e=>{const{reload:t}=e;return{async reload(){e.setError();const n=new AbortController,r=P.getContainingView(e);if(!(!r.initialized||!r.staticBlocks.contentBlocks.length))try{e.estimatedRegionStatsP=e.estimateRegionsStats(r.staticBlocks.contentBlocks,{signal:n.signal});const a=await e.estimatedRegionStatsP;if(Ye(e))e.setRegionStats(a),t();else return}catch(a){console.error(a),e.setError(a)}},afterAttach(){fn(e,Yt(async()=>{var n;try{const r=new AbortController,a=P.getContainingView(e);if(!a.initialized||!a.staticBlocks.contentBlocks.length)return;if(((n=e.estimatedRegionStats)===null||n===void 0?void 0:n.featureDensity)!==void 0){e.setCurrBpPerPx(a.bpPerPx);return}if(a.bpPerPx===e.currBpPerPx)return;e.clearRegionStats(),e.setCurrBpPerPx(a.bpPerPx);const o=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal});e.setRegionStatsP(o);const i=await o;Ye(e)&&e.setRegionStats(i)}catch(r){!P.isAbortException(r)&&Ye(e)&&(console.error(r),e.setError(r))}},{delay:500}))}}}).views(e=>({regionCannotBeRenderedText(t){return e.regionTooLarge?"Force load to see features":""},regionCannotBeRendered(t){const{regionTooLarge:n}=e;return n?l(nM,{model:e}):null},trackMenuItems(){return[]},contextMenuItems(){return e.contextMenuFeature?[{label:"Open feature details",icon:js,onClick:()=>{e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]},renderProps(){const t=P.getContainingView(e);return{...Y.getParentRenderProps(e),notReady:e.currBpPerPx!==t.bpPerPx||!e.estimatedRegionStats,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(n,r){const a=r||e.featureIdUnderMouse;if(!a)e.clearFeatureSelection();else{const o=e.features.get(a);o&&e.selectFeature(o)}},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(n,r){const a=r||e.featureIdUnderMouse;a?e.setContextMenuFeature(e.features.get(a)):e.clearFeatureSelection()},onMouseMove(n,r){e.setFeatureIdUnderMouse(r)},onMouseLeave(n){e.setFeatureIdUnderMouse(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}}}})).actions(e=>({async renderSvg(t){const{height:n,id:r}=e,{overrideHeight:a}=t,o=P.getContainingView(e),{offsetPx:i,roundedDynamicBlocks:s,width:c}=o,u=await Promise.all(s.map(d=>{const f=rs.create({key:d.key,region:d}),p=e.regionCannotBeRenderedText(d)||e.regionCannotBeRendered(d);if(p)return{reactElement:w(Z,{children:[l("rect",{x:0,y:0,width:c,height:20,fill:"#aaa"}),l("text",{x:0,y:15,children:p})]})};const{rpcManager:g,renderArgs:h,renderProps:m,rendererType:y}=Ps(f,e);return y.renderInClient(g,{...h,...m,viewParams:P.getViewParams(e,!0),exportSVG:t})}));return l(Z,{children:u.map((d,f)=>{const{offsetPx:p}=s[f],g=p-i,h=mM(r,f);return w(Z,{children:[l("defs",{children:l("clipPath",{id:h,children:l("rect",{x:0,y:0,width:c,height:a||n})})}),l("g",{transform:`translate(${g} 0)`,children:l("g",{clipPath:`url(#${h})`,children:$t.isValidElement(d.reactElement)?d.reactElement:l("g",{dangerouslySetInnerHTML:{__html:d.html}})})})]})})})}})).postProcessSnapshot(e=>{const t=e,{blockState:n,...r}=t;return r});function vM(e){return C.ConfigurationSchema("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:Sr,explicitlyTyped:!0})}function wM(e){return k.compose("LinearBareDisplay",Cr,k.model({type:k.literal("LinearBareDisplay"),configuration:hf(e)})).views(t=>{const{renderProps:n}=t;return{renderProps(){return{...n(),...Y.getParentRenderProps(t),rpcDriverName:t.rpcDriverName,config:t.configuration.renderer}},get rendererTypeName(){return t.configuration.renderer.type}}})}var at={},jp=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(at,"__esModule",{value:!0});var zp=at.Cable=at.DNA=at.Save=at.SaveAs=xi=at.TrackSelector=at.ContentPaste=at.ContentCut=at.Indexing=cc=at.ContentCopy=void 0;const An=jp(Ad),dt=jp(M.exports);function SM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}))}var cc=at.ContentCopy=SM;function CM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z"}))}at.Indexing=CM;function _M(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z"}))}at.ContentCut=_M;function TM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z"}))}at.ContentPaste=TM;function xM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"}))}var xi=at.TrackSelector=xM;function PM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{fill:"currentColor",d:"M10,19L10.14,18.86C8.9,18.5 8,17.36 8,16A3,3 0 0,1 11,13C12.36,13 13.5,13.9 13.86,15.14L20,9V7L16,3H4C2.89,3 2,3.9 2,5V19A2,2 0 0,0 4,21H10V19M4,5H14V9H4V5M20.04,12.13C19.9,12.13 19.76,12.19 19.65,12.3L18.65,13.3L20.7,15.35L21.7,14.35C21.92,14.14 21.92,13.79 21.7,13.58L20.42,12.3C20.31,12.19 20.18,12.13 20.04,12.13M18.07,13.88L12,19.94V22H14.06L20.12,15.93L18.07,13.88Z"}))}at.SaveAs=PM;function kM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"}))}at.Save=kM;function MM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{fill:"currentColor",d:"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z"}))}at.DNA=MM;function RM(e){return dt.default.createElement(An.default,{...e},dt.default.createElement("path",{d:"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z"}))}zp=at.Cable=RM;function qp(e,t,n){e=Math.abs(e);const r=t*e,a=parseInt(Number(r).toExponential().split(/e/i)[1],10);let o=10**a;for(;o<r&&(o*=2,!(o>=r));)o*=2.5;o=Math.max(o,5);const i=o/e;let s=0;return!(o%10)&&i/10>=n?s=o/10:!(o%5)&&i/5>=n?s=o/5:!(o%2)&&i/2>=n&&(s=o/2),{majorPitch:o,minorPitch:s}}function uc(e,t,n,r=!0,a=!0){const o=qp(n,60,15);let i=e,s=t;if(i===null||s===null)return[];n<0&&([i,s]=[s,i]),i-=Math.abs(20*n)-1,s+=Math.abs(20*n)+1;const c=o.minorPitch||o.majorPitch;let u=0;const d=[];for(let f=Math.ceil(i/c)*c;f<s;f+=c)a&&f%(o.majorPitch*2)?(d.push({type:"minor",base:f-1,index:u}),u+=1):r&&!(f%(o.majorPitch*2))&&(d.push({type:"major",base:f-1,index:u}),u+=1);return d}const AM=ae()(()=>({majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}));function dc({start:e,end:t,bpPerPx:n,reversed:r,major:a,minor:o}){const{classes:i}=AM(),s=uc(e,t,n,a,o);return w(Z,{children:[s.map(c=>{const u=(r?t-c.base:c.base-e)/n;return l("line",{x1:u,x2:u,y1:0,y2:c.type==="major"?6:4,strokeWidth:1,stroke:c.type==="major"?"#555":"#999",className:c.type==="major"?i.majorTick:i.minorTick,"data-bp":c.base},c.base)}),s.filter(c=>c.type==="major").map(c=>{const u=(r?t-c.base:c.base-e)/n;return l("text",{x:u-3,y:7+11,style:{fontSize:"11px"},className:i.majorTickLabel,children:P.getTickDisplayStr(c.base+1,n)},`label-${c.base}`)})]})}dc.propTypes={start:on.exports.number.isRequired,end:on.exports.number.isRequired,bpPerPx:on.exports.number.isRequired,reversed:on.exports.bool,major:on.exports.bool,minor:on.exports.bool};dc.defaultProps={reversed:!1,major:!0,minor:!0};const EM=j(dc),Vp=ae()(e=>{const{tertiary:t,primary:n}=e.palette,r=t?zt(t.main,.7):zt(n.main,.7);return{rubberBand:{height:"100%",background:r,position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:t?t.contrastText:n.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}}),$M=j(({model:e,open:t,guideX:n,overview:r})=>{var a;const{classes:o}=Vp(),{cytobandOffset:i}=e,{assemblyManager:s}=P.getSession(e),c=r.pxToBp(n-i),u=s.get(c.assemblyName),d=(a=u==null?void 0:u.cytobands)===null||a===void 0?void 0:a.find(f=>c.coord>f.get("start")&&c.coord<f.get("end")&&c.refName===u.getCanonicalRefName(f.get("refName")));return l(fr,{open:t,placement:"top",title:[P.stringify(c),d==null?void 0:d.get("name")].join(" "),arrow:!0,children:l("div",{className:o.guide,style:{left:n}})})});function DM({model:e,overview:t,ControlComponent:n=l("div",{})}){const{cytobandOffset:r}=e,[a,o]=M.exports.useState(),[i,s]=M.exports.useState(),[c,u]=M.exports.useState(),d=M.exports.useRef(null),f=M.exports.useRef(null),{classes:p}=Vp(),g=a!==void 0;M.exports.useEffect(()=>{function x(E){const $=d.current;if($&&g){const B=E.clientX-$.getBoundingClientRect().left;s(B)}}function A(){if(a!==void 0&&i!==void 0&&Math.abs(i-a)>3){const E=Math.min(a,i),$=Math.max(a,i);e.moveTo(t.pxToBp(E-r),t.pxToBp($-r))}if(a!==void 0&&i===void 0){const E=t.pxToBp(a-r);E.refName?e.centerAt(Math.round(E.coord),E.refName,E.index):(P.getSession(e).notify("unknown position clicked"),console.error("unknown position clicked",E))}o(void 0),s(void 0),a!==void 0&&u(void 0)}function R(E){E.key==="Escape"&&(o(void 0),s(void 0))}return g?(window.addEventListener("mousemove",x,!0),window.addEventListener("mouseup",A,!0),window.addEventListener("keydown",R,!0),()=>{window.removeEventListener("mousemove",x,!0),window.removeEventListener("mouseup",A,!0),window.removeEventListener("keydown",R,!0)}):()=>{}},[g,i,a,e,t,r]);function h(x){x.preventDefault(),x.stopPropagation(),d.current&&o(x.clientX-d.current.getBoundingClientRect().left)}function m(x){d.current&&u(x.clientX-d.current.getBoundingClientRect().left)}function y(){u(void 0)}if(a===void 0)return w("div",{style:{position:"relative"},children:[c!==void 0?l($M,{model:e,open:!g,overview:t,guideX:c}):null,l("div",{className:p.rubberBandControl,role:"presentation",ref:d,onMouseDown:h,onMouseOut:y,onMouseMove:m,children:n})]});let b=a||0,S=0;a!==void 0&&i!==void 0&&(b=i<a?i:a,S=i-a);let _,T;return a&&(_=t.pxToBp(a-r),T=t.pxToBp(a+S-r),i&&i<a&&([_,T]=[T,_])),w("div",{style:{position:"relative"},children:[f.current?w(Z,{children:[l($o,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:l(X,{children:_?P.stringify(_):""})}),l($o,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:l(X,{children:T?P.stringify(T):""})})]}):null,l("div",{ref:f,className:p.rubberBand,style:{left:b,width:Math.abs(S),height:xt}}),l("div",{"data-testid":"rubberBand_controls",className:p.rubberBandControl,role:"presentation",ref:d,onMouseDown:h,onMouseOut:y,onMouseMove:m,children:n})]})}const LM=j(DM),NM=2,fc=ae()(e=>({scaleBar:{height:xt},scaleBarBorder:{border:"1px solid"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:xt},scaleBarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scaleBarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scaleBarLabel:{height:xt,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{position:"absolute",height:xt,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:ur,position:"relative"},overviewSvg:{width:"100%",position:"absolute"}})),Hp=j(({model:e,overview:t,useOffset:n=!0})=>{const r=Fa(),a=Number(n),{interRegionPaddingWidth:o,offsetPx:i,dynamicBlocks:s,cytobandOffset:c}=e,{contentBlocks:u,totalWidthPxWithoutBorders:d}=s,{tertiary:f,primary:p}=r.palette,g=f?f.light:p.light;if(!u.length)return null;const h=u[0],m=u[u.length-1],y=(t.bpToPx({...h,coord:h.reversed?h.end:h.start})||0)+c*a,b=(t.bpToPx({...m,coord:m.reversed?m.start:m.end})||0)+c*a,S=Math.max(0,-i),_=S+d+u.length*o/2;return l("polygon",{points:[[S,ur],[_,ur],[b,0],[y,0]].toString(),fill:zt(g,.3),stroke:zt(g,.8)})});function FM(e,t,n,r,a){return"M"+e+","+t+"h"+(n-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-n)+"z"}function BM(e,t,n,r,a){return"M"+(e+a)+","+t+"h"+(n-a)+"v"+r+"h"+(a-n)+"a"+a+","+a+" 0 0 1 "+-a+","+-a+"v"+(2*a-r)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z"}const Sa={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"};function Wp(e,t){var n;return((n=e==null?void 0:e.cytobands)===null||n===void 0?void 0:n.map(r=>({refName:e.getCanonicalRefName(r.get("refName")),start:r.get("start"),end:r.get("end"),type:r.get("type")})).filter(r=>r.refName===t))||[]}const Up=j(({overview:e,block:t,assembly:n})=>{const{offsetPx:r,reversed:a}=t,o=Wp(n,t.refName),i=o.map(f=>{const{refName:p,start:g,end:h,type:m}=f;return[e.bpToPx({refName:p,coord:g}),e.bpToPx({refName:p,coord:h}),m]}),s=o||[],c=a?s.length-1:0,u=a?0:s.length-1;let d=!0;return l("g",{transform:`translate(-${r})`,children:i.map(([f,p,g],h)=>{const m=`${f}-${p}-${g}`;return g==="acen"&&d?(d=!1,l("polygon",{points:[[f,0],[p,xt/2],[f,xt]].toString(),fill:Sa[g]},m)):g==="acen"&&!d?l("polygon",{points:[[f,xt/2],[p,0],[p,xt]].toString(),fill:Sa[g]},m):c===h?l("path",{d:BM(Math.min(f,p),0,Math.abs(p-f),xt,8),fill:Sa[g]},m):u===h?l("path",{d:FM(Math.min(f,p),0,Math.abs(p-f)-2,xt,8),fill:Sa[g]},m):l("rect",{x:Math.min(f,p),y:0,width:Math.abs(p-f),height:xt,fill:Sa[g]},m)})})}),IM=j(({scale:e,model:t,block:n,overview:r})=>{const{classes:a,cx:o}=fc(),{cytobandOffset:i,bpPerPx:s,showCytobands:c}=t,{start:u,end:d,reversed:f,refName:p,assemblyName:g}=n,{majorPitch:h}=qp(e,120,15),{assemblyManager:m}=P.getSession(t),y=m.get(g),b=y==null?void 0:y.getRefNameColor(p),S=[];for(let T=0;T<Math.floor((d-u)/h);T++){const x=(T+1)*h;S.push(f?d-x:u+x)}const _=c&&Wp(y,n.refName).length;return w("div",{children:[l(X,{style:{left:n.offsetPx+3,color:_?"black":b},className:a.scaleBarRefName,children:p}),w("div",{className:o(a.scaleBarContig,_?void 0:f?a.scaleBarContigReverse:a.scaleBarContigForward,_?void 0:a.scaleBarBorder),style:{left:n.offsetPx+i,width:n.widthPx,borderColor:b},children:[_?null:S.map((T,x)=>l(X,{className:a.scaleBarLabel,variant:"body2",style:{left:(x+1)*h/e,pointerEvents:"none",color:b},children:P.getTickDisplayStr(T,s)},`${JSON.stringify(n)}-${T}-${x}`)),_?l("svg",{style:{width:"100%"},children:l(Up,{overview:r,assembly:y,block:n})}):null]})]})}),OM=j(({model:e,scale:t,overview:n})=>{const{classes:r}=fc(),a=Fa(),{dynamicBlocks:o,showCytobands:i,cytobandOffset:s}=e,c=o.contentBlocks,u=n.dynamicBlocks,{tertiary:d,primary:f}=a.palette,p=d?d.light:f.light;if(!c.length)return null;const g=c[0],h=n.bpToPx({...g,coord:g.reversed?g.end:g.start})||0,m=c[c.length-1],y=n.bpToPx({...m,coord:m.reversed?m.start:m.end})||0,b=i?"#f00":p,S=i?.1:.3;return w("div",{className:r.scaleBar,children:[l("div",{className:r.scaleBarVisibleRegion,style:{width:y-h,left:h+s,background:zt(b,S),borderColor:b}}),u.map((_,T)=>_ instanceof ia?l(IM,{scale:t,block:_,model:e,overview:n},`${JSON.stringify(_)}-${T}`):l("div",{className:r.scaleBarContig,style:{width:_.widthPx,left:_.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},`${JSON.stringify(_)}-${T}`))]})});function jM({model:e,children:t}){const{classes:n}=fc(),{totalBp:r,width:a,cytobandOffset:o,displayedRegions:i}=e,s=El.create({displayedRegions:JSON.parse(JSON.stringify(i)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),c=a-o;s.setVolatileWidth(c),s.showAllRegions();const u=r/(c-(i.length-1)*NM);return w("div",{children:[l(LM,{model:e,overview:s,ControlComponent:l(OM,{model:e,overview:s,scale:u})}),w("div",{className:n.overview,children:[l("svg",{height:ur,className:n.overviewSvg,children:l(Hp,{model:e,overview:s})}),t]})]})}const zM=j(jM);function qM({model:e,fontSize:t}){const{offsetPx:n,dynamicBlocks:{totalWidthPxWithoutBorders:r,totalBp:a}}=e,o=P.getBpDisplayStr(a),i=Math.max(-n,0),s=i+r;return w(Z,{children:[l("line",{x1:i,x2:s,y1:10,y2:10,stroke:"black"}),l("line",{x1:i,x2:i,y1:5,y2:15,stroke:"black"}),l("line",{x1:s,x2:s,y1:5,y2:15,stroke:"black"}),l("text",{x:i+(s-i)/2,y:t*2,textAnchor:"middle",fontSize:t,children:o})]})}function VM({model:e,fontSize:t,width:n}){const{dynamicBlocks:{contentBlocks:r},offsetPx:a,bpPerPx:o}=e,i=r.length<5;return w(Z,{children:[l("defs",{children:l("clipPath",{id:"clip-ruler",children:l("rect",{x:0,y:0,width:n,height:20})})}),r.map(s=>{const{key:c,start:u,end:d,reversed:f,offsetPx:p,refName:g}=s,h=p-a;return w("g",{transform:`translate(${h} 0)`,children:[l("text",{x:h/o,y:t,fontSize:t,children:g}),i?l("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)",children:l(EM,{start:u,end:d,bpPerPx:o,reversed:f})}):l("line",{strokeWidth:1,stroke:"black",x1:u/o,x2:d/o,y1:20,y2:20})]},`${c}`)})]})}const Fn=15,ks=50,Ho=Fn+5,Gp=20,HM=Ho+20,Jp=100,WM=e=>e.reduce((t,n)=>{const r=n.displays[0];return t+r.height+Gp+Ho},0),UM=({model:e})=>{const{width:t,assemblyNames:n,showCytobands:r,displayedRegions:a}=e,{assemblyManager:o}=P.getSession(e),i=n.length>1?"":n[0],s=o.get(i),c=El.create({displayedRegions:JSON.parse(JSON.stringify(a)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),u=e.dynamicBlocks.contentBlocks;c.setVolatileWidth(t),c.showAllRegions();const d=c.dynamicBlocks.contentBlocks[0],f=u[0],p=c.bpToPx({...f,coord:f.reversed?f.end:f.start})||0,g=u[u.length-1],h=c.bpToPx({...g,coord:g.reversed?g.start:g.end})||0,m=r?Jp:0;return w("g",{id:"header",children:[l("text",{x:0,y:Fn,fontSize:Fn,children:i}),r?w("g",{transform:`translate(0 ${ks})`,children:[l(Up,{overview:c,assembly:s,block:d}),l("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(h-p,.5),height:xt-1,x:p,y:.5}),l("g",{transform:`translate(0,${xt})`,children:l(Hp,{overview:c,model:e,useOffset:!1})})]}):null,l("g",{transform:`translate(0 ${Fn+m})`,children:l(qM,{model:e,fontSize:Fn})}),l("g",{transform:`translate(0 ${ks+m})`,children:l(VM,{model:e,fontSize:Fn,width:t})})]})},GM=({model:e,height:t})=>{const{dynamicBlocks:n,offsetPx:r,interRegionPaddingWidth:a}=e;return l(Z,{children:n.contentBlocks.slice(1).map(o=>l("rect",{x:o.offsetPx-r-a,width:a,y:0,height:t,stroke:"none",fill:"grey"},o.key))})};function JM({displayResults:e,model:t,offset:n}){return l(Z,{children:e.map(({track:r,result:a})=>{const o=n,i=C.getConf(r,"name")||`Reference sequence (${C.readConfObject(Ge(r.configuration),"displayName")||C.readConfObject(Ge(r.configuration),"name")})`,s=r.displays[0];return n+=s.height+Gp+Ho,w("g",{transform:`translate(0 ${o})`,children:[l("text",{fontSize:Fn,x:Math.max(-t.offsetPx,0),children:i}),w("g",{transform:`translate(0 ${Ho})`,children:[a,l(GM,{model:t,height:s.height})]})]},r.configuration.trackId)})})}async function XM(e,t){await jr(()=>e.initialized);const{width:n,tracks:r,showCytobands:a}=e,o=50,i=HM+ks+(a?Jp:0)+20,s=WM(r)+i,c=await Promise.all(r.map(async u=>{const d=u.displays[0];await jr(()=>d.ready!==void 0?d.ready:!0);const f=await d.renderSvg(t);return{track:u,result:f}}));return Jb(w("svg",{width:n,height:s,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,n+o*2,s].toString(),children:[l("rect",{width:n+o*2,height:s,fill:"white"}),w("g",{stroke:"none",transform:`translate(${o} ${Fn})`,children:[l(UM,{model:e}),l(JM,{model:e,displayResults:c,offset:i})]})]}))}var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});var Xp=Pi.RefSequenceResult=void 0;class Yp{constructor(t){this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(t){return this.score=t,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}var or=Pi.default=Yp;class YM extends Yp{constructor(t){var n;super(t),this.refName=(n=t.refName)!==null&&n!==void 0?n:""}getLocation(){return this.refName}}Xp=Pi.RefSequenceResult=YM;const KM=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>pN),void 0));function QM(e,t){return e.filter(n=>{const{result:r}=n;return r.getLabel().toLowerCase().includes(t)||r.matchedObject})}function ZM({model:e,onSelect:t,assemblyName:n,style:r,fetchResults:a,onChange:o,value:i,showHelp:s=!0,minWidth:c=200,TextFieldProps:u={}}){const d=P.getSession(e),{assemblyManager:f}=d,[p,g]=M.exports.useState(!1),[h,m]=M.exports.useState(!0),[y,b]=M.exports.useState(!1),[S,_]=M.exports.useState(""),[T,x]=M.exports.useState(""),[A,R]=M.exports.useState(),E=P.useDebounce(S,300),$=n?f.get(n):void 0,{coarseVisibleLocStrings:B,hasDisplayedRegions:F}=e,I=($==null?void 0:$.regions)||[],U=M.exports.useMemo(()=>I.map(q=>({result:new Xp({refName:q.refName,label:q.refName,matchedAttribute:"refName"})})),[I]);M.exports.useEffect(()=>{let q=!0;return(async()=>{try{if(E===""||!n)return;m(!1);const J=await a(E);if(q){const Q={};for(let ce=0;ce<J.length;ce++){const le=J[ce],re=le.getDisplayString();Q[re]||(Q[re]=[]),Q[re].push(le)}const H=Object.entries(Q).map(([ce,le])=>le.length===1?{result:le[0]}:{result:new or({displayString:ce,results:le,label:ce})});R(H),m(!0)}}catch(J){console.error(J),q&&d.notify(`${J}`,"error")}})(),()=>{q=!1}},[n,a,E,d,e]);const z=B||i||"",G=Math.min(Math.max(P.measureText(z,16)+45,c),550);return w(Z,{children:[l(Wy,{id:`refNameAutocomplete-${e.id}`,"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!n,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...r,width:G},value:z,loading:!h,inputValue:T,onInputChange:(q,J)=>{x(J),o==null||o(J)},loadingText:"loading results",open:p,onOpen:()=>g(!0),onClose:()=>{g(!1),m(!0),F&&(_(""),R(void 0))},onChange:(q,J)=>{!J||!n||(typeof J=="string"?t==null||t(new or({label:J})):t==null||t(J.result),x(z))},options:A!=null&&A.length?A:U,getOptionDisabled:q=>(q==null?void 0:q.group)==="limitOption",filterOptions:(q,J)=>{const Q=QM(q,J.inputValue.toLocaleLowerCase());return[...Q.slice(0,100),...Q.length>100?[{group:"limitOption",result:new or({label:"keep typing for more results"})}]:[]]},renderInput:q=>{const{helperText:J,InputProps:Q={}}=u;return l(be,{onBlur:()=>x(z),...q,...u,helperText:J,InputProps:{...q.InputProps,...Q,endAdornment:w(Z,{children:[I.length===0?l(Ba,{color:"inherit",size:20}):w(Tn,{position:"end",style:{marginRight:7},children:[l(Uy,{fontSize:"small"}),s?l(pe,{onClick:()=>b(!0),size:"small",children:l(Dd,{fontSize:"small"})}):null]}),q.InputProps.endAdornment]})},placeholder:"Search for location",onChange:H=>_(H.target.value)})},getOptionLabel:q=>(typeof q=="string"?q:q.result.getDisplayString())||""}),y?l(M.exports.Suspense,{fallback:l("div",{}),children:l(KM,{handleClose:()=>b(!1)})}):null]})}const Kp=j(ZM);function eR(e=[],t){return e.filter((n,r,a)=>r===a.findIndex(o=>t(o)===t(n)))}async function Wo({queryString:e,searchType:t,searchScope:n,rankSearchResults:r,textSearchManager:a,assembly:o}){var i;a||console.warn("No text search manager");const s=await(a==null?void 0:a.search({queryString:e,searchType:t},n,r)),c=(i=o==null?void 0:o.allRefNames)===null||i===void 0?void 0:i.filter(u=>u.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(u=>new or({label:u}));return eR([...c||[],...s||[]],u=>u.getId())}function Qp(e,t){const n=e.lastIndexOf(t);if(n===-1)return[e,""];{const r=e.slice(0,n),a=e.slice(n+1);return[r,a]}}const tR=ae()(()=>({headerRefName:{minWidth:100}}));function nR({model:e,showHelp:t}){const{classes:n}=tR(),r=Fa(),a=P.getSession(e),{textSearchManager:o,assemblyManager:i}=a,{assemblyNames:s,rankSearchResults:c}=e,u=s[0],d=i.get(u),f=e.searchScope(u);function p(h){const m=h.getLocation(),y=h.getTrackId();m&&(e.navToLocString(m,u),y&&e.showTrack(y))}async function g(h){try{if(h.hasLocation())p(h);else{const m=h.getLabel(),[y,b]=Qp(m,":"),S=(d==null?void 0:d.allRefNamesWithLowerCase)||[];if(S.includes(m)||S.includes(y)&&!Number.isNaN(parseInt(b,10)))e.navToLocString(m,u);else{const _=await Wo({queryString:m,searchType:"exact",searchScope:f,rankSearchResults:c,textSearchManager:o,assembly:d});_.length>1?e.setSearchResults(_,m.toLowerCase()):_.length===1?p(_[0]):e.navToLocString(m,u)}}}catch(m){console.error(m),a.notify(`${m}`,"warning")}}return l(Kp,{showHelp:t,onSelect:g,assemblyName:u,fetchResults:h=>Wo({queryString:h,searchScope:f,rankSearchResults:c,textSearchManager:o,assembly:d}),model:e,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:cg,minWidth:"175px"},InputProps:{style:{padding:0,height:gc,background:zt(r.palette.background.paper,.8)}}}})}const Zp=j(nR),rR=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function aR(){return w("div",{children:[l(Ba,{size:20,style:{marginRight:20}}),l(X,{display:"inline",children:"Creating SVG"})]})}function oR({model:e,handleClose:t}){const n=typeof OffscreenCanvas<"u",[r,a]=M.exports.useState(n),[o,i]=M.exports.useState(!1),[s,c]=M.exports.useState("jbrowse.svg"),[u,d]=M.exports.useState(),{classes:f}=rR();return w(De,{open:!0,onClose:t,children:[w(Ne,{children:["Export SVG",l(pe,{className:f.closeButton,onClick:t,children:l($e,{})})]}),w(Fe,{children:[u?l(Le.ErrorMessage,{error:u}):o?l(aR,{}):null,l(be,{helperText:"filename",value:s,onChange:p=>c(p.target.value)}),n?l(Pt,{control:l(jt,{checked:r,onChange:()=>a(p=>!p)}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):l(X,{children:"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"})]}),w(qe,{children:[l(ne,{variant:"contained",color:"secondary",onClick:()=>t(),children:"Cancel"}),l(ne,{variant:"contained",color:"primary",type:"submit",onClick:async()=>{i(!0),d(void 0);try{await e.exportSvg({rasterizeLayers:r,filename:s}),t()}catch(p){console.error(p),d(p),i(!1)}},children:"Submit"})]})]})}const iR=j(e=>{const{model:t}=e,{bpPerPx:n,maxBpPerPx:r,minBpPerPx:a,scaleFactor:o,hideHeader:i}=t,[s,c]=M.exports.useState();return i?l("div",{style:{position:"absolute",right:"0px",zIndex:"1001"},children:w(Je,{style:{background:"#aaa7"},children:[l(pe,{color:"secondary",onClick:u=>c(u.currentTarget),children:l(Ld,{fontSize:"small"})}),l(pe,{"data-testid":"zoom_out",onClick:()=>t.zoom(n*2),disabled:n>=r-1e-4||o!==1,color:"secondary",children:l(Nd,{fontSize:"small"})}),l(pe,{"data-testid":"zoom_in",onClick:()=>t.zoom(t.bpPerPx/2),disabled:n<=a+1e-4||o!==1,color:"secondary",children:l(zs,{fontSize:"small"})}),l(Or,{anchorEl:s,open:Boolean(s),onMenuItemClick:(u,d)=>{d(),c(void 0)},onClose:()=>c(void 0),menuItems:t.menuItems()})]})}):null}),sR=ae()({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});function lR({model:e}){const{classes:t}=sR(),{maxBpPerPx:n,minBpPerPx:r,bpPerPx:a,scaleFactor:o}=e,[i,s]=M.exports.useState(-Math.log2(a)*100);return M.exports.useEffect(()=>{s(-Math.log2(a)*100)},[s,a]),w("div",{className:t.container,children:[l(pe,{"data-testid":"zoom_out",onClick:()=>e.zoom(a*2),disabled:a>=n-1e-4||o!==1,color:"secondary",size:"large",children:l(Nd,{})}),l(Gy,{size:"small",className:t.slider,value:i,min:-Math.log2(n)*100,max:-Math.log2(r)*100,onChange:(c,u)=>s(u),onChangeCommitted:()=>e.zoomTo(2**(-i/100)),disabled:o!==1}),l(pe,{"data-testid":"zoom_in",onClick:()=>e.zoom(e.bpPerPx/2),disabled:a<=r+1e-4||o!==1,color:"secondary",size:"large",children:l(zs,{})})]})}const eg=j(lR),ki=ae()(e=>({headerBar:{height:ur,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:zt(e.palette.background.paper,.8),height:gc,margin:cg},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}})),cR=j(({model:e})=>{const{classes:t}=ki();return l(ne,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select",color:"secondary",children:l(xi,{className:t.buttonSpacer})})});function uR({model:e}){const{classes:t}=ki();return w(Z,{children:[l(ne,{variant:"outlined",className:t.panButton,onClick:()=>e.slide(-.9),children:l(Jy,{})}),l(ne,{variant:"outlined",className:t.panButton,onClick:()=>e.slide(.9),children:l(Xy,{})})]})}const dR=j(({model:e})=>{const{classes:t}=ki(),{coarseTotalBp:n}=e;return l(X,{variant:"body2",color:"textSecondary",className:t.bp,children:P.getBpDisplayStr(n)})}),Lu=({model:e})=>{const{classes:t}=ki();return w("div",{className:t.headerBar,children:[l(cR,{model:e}),l("div",{className:t.spacer}),w(Yo,{row:!0,className:t.headerForm,children:[l(uR,{model:e}),l(Zp,{model:e})]}),l(dR,{model:e}),l(eg,{model:e}),l("div",{className:t.spacer})]})},fR=j(({model:e})=>e.hideHeader?null:e.hideHeaderOverview?l(Lu,{model:e}):l(zM,{model:e,children:l(Lu,{model:e})})),pR=ae()(e=>({root:{background:zt(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}));function gR(e,t){const n=C.getConf(e,"name");if(!n&&C.getConf(e,"type")==="ReferenceSequenceTrack"){const r=t.assemblies.find(a=>a.sequence===e.configuration);return r?`Reference Sequence (${C.readConfObject(r,"displayName")||C.readConfObject(r,"name")})`:"Reference Sequence"}return n}const hR=$t.forwardRef(({track:e,className:t},n)=>{var r;const{classes:a,cx:o}=pR(),i=P.getContainingView(e),s=P.getSession(e),c=e.configuration,u=C.getConf(e,"trackId"),d=gR(e,s),f=Po.usePopupState({popupId:"trackLabelMenu",variant:"popover"}),p=h=>{const m=h.currentTarget;if(m.parentNode){const y=m.parentNode;h.dataTransfer.setDragImage(y,20,20),i.setDraggingTrackId(e.id)}},g=[...((r=s.getTrackActionMenuItems)===null||r===void 0?void 0:r.call(s,c))||[],...e.trackMenuItems()].sort((h,m)=>(m.priority||0)-(h.priority||0));return w(Je,{ref:n,className:o(t,a.root),children:[l("span",{draggable:!0,className:a.dragHandle,onDragStart:p,onDragEnd:()=>i.setDraggingTrackId(void 0),"data-testid":`dragHandle-${i.id}-${u}`,children:l(Yy,{className:a.dragHandleIcon,fontSize:"small"})}),l(pe,{onClick:()=>i.hideTrack(u),className:a.iconButton,title:"close this track",color:"secondary",children:l($e,{fontSize:"small"})}),l(X,{variant:"body1",component:"span",className:a.trackName,children:d}),l(pe,{...Po.bindTrigger(f),className:a.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!g.length,children:l(Ky,{fontSize:"small"})}),l(dC,{...Po.bindPopover(f),onMenuItemClick:(h,m)=>m(),menuItems:g,popupState:f})]})}),mR=j(hR),tg=ae()({root:{marginTop:2},resizeHandle:{height:3,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3},trackLabel:{zIndex:3},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}),yR=j(({model:e,view:t})=>{const{classes:n,cx:r}=tg(),a=e.displays[0],{trackLabel:o,trackLabelOverlap:i,trackLabelOffset:s}=n,c=t.trackLabels!=="overlapping"||a.prefersOffset?s:i;return t.trackLabels!=="hidden"?l(mR,{track:e,className:r(o,c)}):null});function bR({model:e,track:t}){const{classes:n}=tg(),r=t.displays[0],{horizontalScroll:a,draggingTrackId:o,moveTrack:i}=e,{height:s,RenderingComponent:c,DisplayBlurb:u}=r,d=C.getConf(t,"trackId"),f=M.exports.useRef(null),p=o!==void 0&&o!==r.id,g=P.useDebouncedCallback(()=>{Ye(r)&&p&&i(o,t.id)},100);return M.exports.useEffect(()=>(f.current&&(e.trackRefs[d]=f.current),()=>{delete e.trackRefs[d]}),[e.trackRefs,d]),w(Je,{className:n.root,variant:"outlined",children:[l(yR,{model:t,view:e}),w("div",{className:n.trackRenderingContainer,style:{height:s},onScroll:h=>r.setScrollTop(h.currentTarget.scrollTop),onDragEnter:g,"data-testid":`trackRenderingContainer-${e.id}-${d}`,children:[l("div",{ref:f,className:n.renderingComponentContainer,style:{transform:`scaleX(${e.scaleFactor})`},children:l(c,{model:r,onHorizontalScroll:a})}),u?l("div",{style:{position:"absolute",left:0,top:r.height-20},children:l(u,{model:r})}):null]}),l("div",{className:n.overlay,style:{height:r.height,background:p?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:g}),l(Le.ResizeHandle,{onDrag:r.resizeHeight,className:n.resizeHandle})]})}const vR=j(bR),ng=ae()(e=>{const{primary:t,tertiary:n}=e.palette,r=n?zt(n.main,.7):zt(t.main,.7);return{rubberBand:{height:"100%",background:r,position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:n?n.contrastText:t.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}}),wR=j(({model:e,coordX:t})=>{const{classes:n}=ng();return l(fr,{open:!0,placement:"top",title:P.stringify(e.pxToBp(t)),arrow:!0,children:l("div",{className:n.guide,style:{left:t,background:"red"}})})});function SR({model:e,ControlComponent:t=l("div",{})}){const[n,r]=M.exports.useState(),[a,o]=M.exports.useState(),[i,s]=M.exports.useState(),[c,u]=M.exports.useState(),d=M.exports.useRef(null),f=M.exports.useRef(null),{classes:p}=ng(),g=n!==void 0&&i===void 0,{setOffsets:h,pxToBp:m}=e;M.exports.useEffect(()=>{function I(G){if(n===void 0)return;let q=n,J=G;J<q&&([q,J]=[J,q]);const Q=m(q),H=m(J);return{leftOffset:Q,rightOffset:H}}function U(G){if(d.current&&g){const q=G.clientX-d.current.getBoundingClientRect().left;o(q)}}function z(G){if(n!==void 0&&d.current){const{clientX:q,clientY:J}=G,Q=d.current,H=q-Q.getBoundingClientRect().left;s({offsetX:H,clientX:q,clientY:J});const ce=I(H);if(ce){const{leftOffset:le,rightOffset:re}=ce;h(le,re)}u(void 0)}}return g?(window.addEventListener("mousemove",U),window.addEventListener("mouseup",z),()=>{window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",z)}):()=>{}},[n,g,i,h,m]),M.exports.useEffect(()=>{!g&&a!==void 0&&n!==void 0&&Math.abs(a-n)<=3&&_()},[g,a,n,e.bpPerPx]);function y(I){I.preventDefault(),I.stopPropagation();const U=I.clientX-I.target.getBoundingClientRect().left;r(U),o(U)}function b(I){const U=I.target;u(I.clientX-U.getBoundingClientRect().left)}function S(){u(void 0),e.setOffsets(void 0,void 0)}function _(){s(void 0),r(void 0),o(void 0)}const T=Boolean(i);function x(I,U){U(),_()}if(n===void 0)return w(Z,{children:[c!==void 0?l(wR,{model:e,coordX:c}):null,l("div",{"data-testid":"rubberBand_controls",className:p.rubberBandControl,role:"presentation",ref:d,onMouseDown:y,onMouseOut:S,onMouseMove:b,children:t})]});const A=i?i.offsetX:a||0,R=A<n?A:n,E=Math.abs(A-n),$=e.pxToBp(R),B=e.pxToBp(R+E),F=Math.ceil(E*e.bpPerPx);return w(Z,{children:[f.current?w(Z,{children:[l($o,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:l(X,{children:P.stringify($)})}),l($o,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:l(X,{children:P.stringify(B)})})]}):null,l("div",{ref:f,className:p.rubberBand,style:{left:R,width:E},children:w(X,{variant:"h6",className:p.rubberBandText,children:[F.toLocaleString("en-US")," bp"]})}),l("div",{"data-testid":"rubberBand_controls",className:p.rubberBandControl,role:"presentation",ref:d,onMouseDown:y,onMouseOut:S,onMouseMove:b,children:t}),i?l(Le.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:i.clientX,top:i.clientY},onMenuItemClick:x,open:T,onClose:_,menuItems:e.rubberBandMenuItems()}):null]})}const CR=j(SR),pc=ae()(e=>({scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}})),_R=j(({model:e})=>{const{classes:t}=pc();let n=0;return e.staticBlocks.forEach((r,a)=>{r.offsetPx-e.offsetPx<0&&(n=a)}),l(Z,{children:e.staticBlocks.map((r,a)=>r instanceof ia&&(r.isLeftEndOfDisplayedRegion||a===n)?l(X,{style:{left:a===n?Math.max(0,-e.offsetPx):r.offsetPx-e.offsetPx-1,paddingLeft:a===n?0:1},className:t.refLabel,"data-testid":`refLabel-${r.refName}`,children:r.refName},`refLabel-${r.key}-${a}`):null)})}),TR=j(({model:e})=>{const{classes:t}=pc(),{bpPerPx:n,staticBlocks:r}=e;return l(Z,{children:r.map((a,o)=>{const{reversed:i,start:s,end:c,key:u,widthPx:d}=a;if(a instanceof ia){const f=uc(s,c,n,!0,!1);return l(ic,{block:a,children:f.map(p=>{if(p.type==="major"){const g=(i?c-p.base:p.base-s)/n,h=p.base+1;return l("div",{className:t.tick,style:{left:g},children:h?l(X,{className:t.majorTickLabel,children:P.getTickDisplayStr(h,n)}):null},p.base)}return null})},`${u}-${o}`)}return a instanceof pi?l(sc,{width:d},u):a instanceof di?l(lc,{width:d,style:{background:"none"},boundary:a.variant==="boundary"},u):null})})}),xR=$t.forwardRef(({model:e,style:t,className:n,...r},a)=>{const{classes:o,cx:i}=pc(),s=e.staticBlocks.offsetPx-e.offsetPx;return w(Je,{"data-resizer":"true",className:i(o.scaleBarContainer,n),variant:"outlined",ref:a,style:t,...r,children:[l("div",{className:o.scaleBarZoomContainer,style:{transform:e.scaleFactor!==1?`scaleX(${e.scaleFactor})`:void 0},children:l("div",{className:o.scaleBar,style:{left:s-1,width:e.staticBlocks.totalWidthPx,...t},children:l(TR,{model:e})})}),l(_R,{model:e})]})}),PR=j(xR),rg=ae()(e=>({verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.secondary},minorTick:{background:e.palette.divider}})),kR=j(({model:e})=>{const{classes:t,cx:n}=rg();return l(Z,{children:e.staticBlocks.map((r,a)=>{if(r instanceof ia){const o=uc(r.start,r.end,e.bpPerPx);return l(ic,{block:r,children:o.map(i=>{const s=(r.reversed?r.end-i.base:i.base-r.start)/e.bpPerPx;return l("div",{className:n(t.tick,i.type==="major"||i.type==="labeledMajor"?t.majorTick:t.minorTick),style:{left:s}},i.base)})},`${r.key}-${a}`)}return r instanceof pi?l(sc,{width:r.widthPx},r.key):r instanceof di?l(lc,{width:r.widthPx,boundary:r.variant==="boundary"},r.key):null})})});function MR({model:e}){const{classes:t}=rg(),n=e.staticBlocks.offsetPx-e.offsetPx;return l("div",{className:t.verticalGuidesZoomContainer,style:{transform:e.scaleFactor!==1?`scaleX(${e.scaleFactor})`:void 0},children:l("div",{className:t.verticalGuidesContainer,style:{left:n,width:e.staticBlocks.totalWidthPx},children:l(kR,{model:e})})})}const RR=j(MR),AR=ae()(()=>({centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}));function ER({model:e}){const{bpPerPx:t,centerLineInfo:n,trackHeights:r,tracks:a,width:o}=e,i=M.exports.useRef(null),{classes:s}=AR(),c=o/2;return a.length?l("div",{"data-testid":"centerline_container",className:s.centerLineContainer,role:"presentation",ref:i,style:{left:`${c}px`,width:Math.max(1/t,1)},children:n&&w("div",{"data-testid":"centerline_text",className:s.centerLineText,role:"presentation",style:{left:Math.max(1/t,1)+5,top:r},children:[n.refName,":"," ",Math.max(Math.round(n.offset)+1,0)]})}):null}const $R=j(ER),DR=ae()({tracksContainer:{position:"relative",overflow:"hidden"},spacer:{position:"relative",height:3}});function LR({children:e,model:t}){const{classes:n}=DR(),r=M.exports.useRef(0),a=M.exports.useRef(!1),o=M.exports.useRef(),i=M.exports.useRef(null),s=M.exports.useRef(0),[c,u]=M.exports.useState(!1);M.exports.useEffect(()=>{let g=()=>{};function h(y){y.preventDefault();const S=y.clientX-s.current;S&&(a.current||(a.current=!0,window.requestAnimationFrame(()=>{t.horizontalScroll(-S),a.current=!1,s.current=y.clientX})))}function m(){s.current=0,c&&u(!1)}return c&&(window.addEventListener("mousemove",h,!0),window.addEventListener("mouseup",m,!0),g=()=>{window.removeEventListener("mousemove",h,!0),window.removeEventListener("mouseup",m,!0)}),g},[t,c,s]);function d(g){const h=g.target;h.draggable||h.dataset.resizer||g.button===0&&(s.current=g.clientX,u(!0))}function f(g){g.preventDefault(),u(!1)}function p(g){g.preventDefault()}return M.exports.useEffect(()=>{const g=i.current;function h(m){const y=e0(m);m.ctrlKey===!0?(m.preventDefault(),r.current+=y.pixelY/500,t.setScaleFactor(r.current<0?1-r.current:1/(1+r.current)),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t.setScaleFactor(1),t.zoomTo(r.current>0?t.bpPerPx*(1+r.current):t.bpPerPx/(1-r.current)),r.current=0},300)):(Math.abs(y.pixelX)>Math.abs(2*y.pixelY)&&m.preventDefault(),r.current+=y.pixelX,a.current||(a.current=!0,window.requestAnimationFrame(()=>{t.horizontalScroll(r.current),r.current=0,a.current=!1})))}return g?(g.addEventListener("wheel",h),()=>{g.removeEventListener("wheel",h)}):()=>{}},[t]),w("div",{ref:i,"data-testid":"trackContainer",className:n.tracksContainer,onMouseDown:d,onMouseUp:f,onMouseLeave:p,children:[t.showGridlines?l(RR,{model:t}):null,t.showCenterLine?l($R,{model:t}):null,l(CR,{model:t,ControlComponent:l(PR,{model:t,style:{height:lg,boxSizing:"border-box"}})}),e]})}const NR=j(LR),FR=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>WR),void 0)),BR=ae()(e=>({importFormContainer:{padding:e.spacing(2)},button:{margin:e.spacing(2)},container:{padding:e.spacing(4)}})),IR=j(({model:e})=>{var t;const{classes:n}=BR(),r=P.getSession(e),{assemblyNames:a,assemblyManager:o,textSearchManager:i}=r,{rankSearchResults:s,isSearchDialogDisplayed:c,error:u}=e,[d,f]=M.exports.useState(a[0]),[p,g]=M.exports.useState(u),[h,m]=M.exports.useState(),y=e.searchScope(d),b=o.get(d),S=a.length?b==null?void 0:b.error:"No configured assemblies",_=(b==null?void 0:b.regions)||[],T=S||p,[x,A]=M.exports.useState(""),R=x||((t=_[0])===null||t===void 0?void 0:t.refName);function E(F){const I=F.getLocation(),U=F.getTrackId();I&&(e.navToLocString(I,d),U&&e.showTrack(U))}async function $(F){try{if((h==null?void 0:h.getDisplayString())===F&&h.hasLocation())E(h);else{const[I,U]=Qp(F,":"),z=(b==null?void 0:b.allRefNamesWithLowerCase)||[];if(z.includes(F)||z.includes(I)&&!Number.isNaN(parseInt(U,10)))e.navToLocString(F,d);else{const G=await Wo({queryString:F,searchType:"exact",searchScope:y,rankSearchResults:s,textSearchManager:i,assembly:b});G.length>1?e.setSearchResults(G,F.toLowerCase()):G.length===1?E(G[0]):e.navToLocString(F,d)}}}catch(I){console.error(I),r.notify(`${I}`,"warning")}}const B=gc+5;return w("div",{className:n.container,children:[T?l(Le.ErrorMessage,{error:T}):null,l(Fd,{className:n.importFormContainer,children:l("form",{onSubmit:F=>{F.preventDefault(),e.setError(void 0),R&&$(R)},children:w(Ft,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[l(Ft,{item:!0,children:l(Le.AssemblySelector,{onChange:F=>{g(""),f(F),A("")},session:r,selected:d,InputProps:{style:{height:B}}})}),l(Ft,{item:!0,children:d?T?l($e,{style:{color:"red"}}):R?l(Kp,{fetchResults:F=>Wo({queryString:F,assembly:b,textSearchManager:i,rankSearchResults:s,searchScope:y}),model:e,assemblyName:S?void 0:d,value:R,minWidth:270,onChange:F=>A(F),onSelect:F=>m(F),TextFieldProps:{variant:"outlined",helperText:"Enter sequence name, feature name, or location",style:{minWidth:"175px"},InputProps:{style:{height:B}}}}):l(Ba,{role:"progressbar",size:20,disableShrink:!0}):null}),w(Ft,{item:!0,children:[l(ne,{type:"submit",disabled:!R,className:n.button,variant:"contained",color:"primary",children:"Open"}),l(ne,{disabled:!R,className:n.button,onClick:()=>{e.setError(void 0),e.showAllRegionsInAssembly(d)},variant:"contained",color:"secondary",children:"Show all regions in assembly"})]})]})})}),c?l(FR,{model:e,optAssemblyName:d,handleClose:()=>e.setSearchResults(void 0,void 0)}):null]})});var $a={};Object.defineProperty($a,"__esModule",{value:!0});var ag=$a.formatSeqFasta=$a.formatFastaLines=void 0;function og(e){return e.replace(/(.{1,80})/g,`$1
`).trimEnd()}$a.formatFastaLines=og;function OR(e){return e.map(t=>`>${t.header}
${og(t.seq)}`).join(`
`)}ag=$a.formatSeqFasta=OR;const jR=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}));async function zR(e,t,n){const r=P.getSession(e),{leftOffset:a,rightOffset:o}=e;if(!a||!o)throw new Error("no offsets on model to use for range");if(a.assemblyName!==o.assemblyName)throw new Error("not able to fetch sequences from multiple assemblies");const{rpcManager:i,assemblyManager:s}=r,c=a.assemblyName||o.assemblyName||"",u=s.get(c);if(!u)throw new Error(`assembly ${c} not found`);const d=C.getConf(u,["sequence","adapter"]),f="getSequence";return i.call(f,"CoreGetFeatures",{adapterConfig:d,regions:t,sessionId:f,signal:n})}function qR({model:e,handleClose:t}){const{classes:n}=jR(),r=P.getSession(e),[a,o]=M.exports.useState(),[i,s]=M.exports.useState(),c=Boolean(i===void 0),{leftOffset:u,rightOffset:d}=e,f=M.exports.useMemo(()=>e.getSelectedRegions(u,d),[e,u,d]);M.exports.useEffect(()=>{let g=!0;const h=new AbortController;return(async()=>{try{if(f.length>0){const m=await zR(e,f,h.signal);g&&s(ag(m.filter(y=>!!y).map(y=>{const b=y.get("seq"),S=y.get("refName"),_=y.get("start")+1,T=y.get("end"),x=`${S}:${_}-${T}`;if((b==null?void 0:b.length)!==T-_+1)throw new Error(`${x} returned ${b.length.toLocaleString()} bases, but should have returned ${(T-_).toLocaleString()}`);return{header:x,seq:b}})))}else throw new Error("Selected region is out of bounds")}catch(m){console.error(m),g&&o(m)}})(),()=>{h.abort(),g=!1}},[e,r,f,s]);const p=i?i.length>1e6:!1;return w(De,{maxWidth:"xl",open:!0,onClose:t,children:[w(Ne,{children:["Reference sequence",t?l(pe,{className:n.closeButton,onClick:()=>{t(),e.setOffsets(void 0,void 0)},size:"large",children:l($e,{})}):null]}),l(un,{}),w(Fe,{children:[a?l(X,{color:"error",children:`${a}`}):null,c&&!a?w(Fd,{children:["Retrieving reference sequence...",l(Ba,{style:{marginLeft:10},size:20,disableShrink:!0})]}):null,l(be,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,disabled:p,className:n.dialogContent,fullWidth:!0,value:p?"Reference sequence too large to display, use the download FASTA button":i,InputProps:{readOnly:!0,classes:{input:n.textAreaFont}}})]}),w(qe,{children:[l(ne,{onClick:()=>{ja(i||""),r.notify("Copied to clipboard","success")},disabled:c||!!a||p,color:"primary",startIcon:l(cc,{}),children:"Copy to clipboard"}),l(ne,{onClick:()=>{const g=new Blob([i||""],{type:"text/x-fasta;charset=utf-8"});tf.exports.saveAs(g,"jbrowse_ref_seq.fa")},disabled:c||!!a,color:"primary",startIcon:l(Qy,{}),children:"Download FASTA"}),l(ne,{onClick:t,variant:"contained",children:"Close"})]})]})}const VR=j(qR),HR=ae()(e=>({dialogContent:{width:"80em"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function ig({model:e,optAssemblyName:t,handleClose:n}){var r,a;const{classes:o}=HR(),i=P.getSession(e),{pluginManager:s}=He(i),{assemblyManager:c}=i;let u=t;if(e.displayedRegions.length>0&&(u=(r=e.displayedRegions[0])===null||r===void 0?void 0:r.assemblyName),!u)throw new Error("Assembly name not found");const d=c.get(u);if(!d)throw new Error(`assembly ${u} not found`);if(!d.regions)throw new Error(`assembly ${u} regions not loaded`);const f=d.regions;function p(h){try{const m=f.find(y=>h===y.refName);m?(e.setDisplayedRegions([m]),e.showAllRegions()):e.navToLocString(h,u)}catch(m){console.warn(m),i.notify(`${m}`,"warning")}}function g(h){var m;if(h){const y=s.pluggableConfigSchemaType("track"),b=gs(y,Aa(e),h);if(b)return(m=b.name)===null||m===void 0?void 0:m.value}return""}return w(De,{open:!0,maxWidth:"xl",onClose:n,children:[w(Ne,{children:["Search results",n?l(pe,{"data-testid":"close-resultsDialog",className:o.closeButton,onClick:()=>{n()},size:"large",children:l($e,{})}):null]}),l(un,{}),l(Fe,{children:!((a=e.searchResults)===null||a===void 0)&&a.length?w(Z,{children:[w(X,{children:["Showing results for ",l("b",{children:e.searchQuery})]}),l(Bd,{component:Je,children:w(Id,{children:[l(Od,{children:w(Do,{children:[l(St,{children:"Name"}),l(St,{align:"right",children:"Location"}),l(St,{align:"right",children:"Track"}),l(St,{align:"right"})]})}),l(jd,{children:e.searchResults.map(h=>w(Do,{children:[l(St,{component:"th",scope:"row",children:h.getLabel()}),l(St,{align:"right",children:h.getLocation()}),l(St,{align:"right",children:g(h.getTrackId())||"N/A"}),l(St,{align:"right",children:l(ne,{onClick:()=>{const m=h.getLocation();if(m){p(m);const y=h.getTrackId();y&&e.showTrack(y)}n()},color:"primary",variant:"contained",children:"Go"})})]},`${h.getId()}`))})]})})]}):w(X,{children:["No results found for ",l("b",{children:e.searchQuery})]})}),l(un,{}),l(qe,{children:l(ne,{onClick:()=>n(),color:"primary",children:"Cancel"})})]})}const WR=Object.freeze(Object.defineProperty({__proto__:null,default:ig},Symbol.toStringTag,{value:"Module"})),UR=ae()(e=>({note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}})),sg=j(({model:e})=>{const{tracks:t,error:n,initialized:r,hasDisplayedRegions:a}=e,{classes:o}=UR();if(!r&&!n)return l(X,{className:o.dots,variant:"h5",children:"Loading"});if(!a||n)return l(IR,{model:e});const i=e.MiniControlsComponent(),s=e.HeaderComponent();return w("div",{style:{position:"relative"},children:[e.seqDialogDisplayed?l(VR,{model:e,handleClose:()=>e.setGetSequenceDialogOpen(!1)}):null,e.isSearchDialogDisplayed?l(ig,{model:e,handleClose:()=>e.setSearchResults(void 0,void 0)}):null,l(s,{model:e}),l(i,{model:e}),l(NR,{model:e,children:t.length?t.map(c=>l(Zo.exports.ErrorBoundary,{FallbackComponent:({error:u})=>l(Le.ErrorMessage,{error:u}),children:l(vR,{model:e,track:c})},c.id)):l(Je,{variant:"outlined",className:o.note,children:e.hideNoTracksActive?l("div",{style:{height:"48px"}}):w(Z,{children:[l(X,{children:"No tracks active."}),l(ne,{variant:"contained",color:"primary",onClick:e.activateTrackSelector,style:{zIndex:1e3},startIcon:l(xi,{}),children:"Open track selector"})]})})})]})}),GR=Object.freeze(Object.defineProperty({__proto__:null,default:sg},Symbol.toStringTag,{value:"Module"})),JR=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>yN),void 0));function Nu(e){if(!e.length)return"";const t=e.every(r=>r.assemblyName===e[0].assemblyName);return e.map(r=>P.assembleLocString({...r,start:Math.round(r.start),end:Math.round(r.end),assemblyName:t?void 0:r.assemblyName})).join(" ")}const ur=48,xt=20,lg=17,Fu=3,XR=2,cg=7,gc=32;function os(e){return typeof localStorage<"u"?localStorage.getItem(e):void 0}function YR(e){return k.compose(ze.BaseViewModel,k.model("LinearGenomeView",{id:ut.ElementId,type:k.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:k.array(ut.Region),tracks:k.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:k.optional(k.enumeration(["hierarchical"]),"hierarchical"),trackLabels:k.optional(k.string,()=>os("lgv-trackLabels")||"overlapping"),showCenterLine:k.optional(k.boolean,()=>{const t=os("lgv-showCenterLine");return t!=null?!!+t:!1}),showCytobandsSetting:k.optional(k.boolean,()=>{const t=os("lgv-showCytobands");return t!=null?!!+t:!0}),showGridlines:!0})).volatile(()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,searchResults:void 0,searchQuery:void 0,seqDialogDisplayed:!1})).views(t=>({get width(){if(t.volatileWidth===void 0)throw new Error("width undefined, make sure to check for model.initialized");return t.volatileWidth},get interRegionPaddingWidth(){return XR},get assemblyNames(){return[...new Set(t.displayedRegions.map(n=>n.assemblyName))]}})).views(t=>({MiniControlsComponent(){return iR},HeaderComponent(){return fR},get assemblyErrors(){const{assemblyManager:n}=P.getSession(t),{assemblyNames:r}=t;return r.map(a=>{var o;return(o=n.get(a))===null||o===void 0?void 0:o.error}).filter(a=>!!a).join(", ")},get assembliesInitialized(){const{assemblyManager:n}=P.getSession(t),{assemblyNames:r}=t;return r.every(a=>{var o;return(o=n.get(a))===null||o===void 0?void 0:o.initialized})},get initialized(){return t.volatileWidth!==void 0&&this.assembliesInitialized},get hasDisplayedRegions(){return t.displayedRegions.length>0},get isSearchDialogDisplayed(){return t.searchResults!==void 0},get scaleBarHeight(){return lg+Fu},get headerHeight(){return t.hideHeader?0:t.hideHeaderOverview?ur:ur+xt},get trackHeights(){return t.tracks.map(n=>n.displays[0].height).reduce((n,r)=>n+r,0)},get trackHeightsWithResizeHandles(){return this.trackHeights+t.tracks.length*Fu},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return t.displayedRegions.reduce((n,r)=>n+r.end-r.start,0)},get maxBpPerPx(){return this.totalBp/(t.width*.9)},get minBpPerPx(){return 1/50},get error(){return t.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return-t.width+30},get displayedRegionsTotalPx(){return this.totalBp/t.bpPerPx},renderProps(){return{...Y.getParentRenderProps(t),bpPerPx:t.bpPerPx,highResolutionScaling:C.getConf(P.getSession(t),"highResolutionScaling")}},searchScope(n){return{assemblyName:n,includeAggregateIndexes:!0,tracks:t.tracks}},getTrack(n){return t.tracks.find(r=>r.configuration.trackId===n)},rankSearchResults(n){const r=t.tracks.map(a=>a.configuration.trackId);return n.forEach(a=>{r.includes(a.trackId)&&a.updateScore(a.getScore()+1)}),n},rewriteOnClicks(n,r){r.forEach(a=>{if("subMenu"in a&&this.rewriteOnClicks(n,a.subMenu),"onClick"in a){const o=a.onClick;a.onClick=(...i)=>{t.tracks.forEach(s=>{s.type===n&&o.apply(s,[s,...i])})}}})},get trackTypeActions(){const n=new Map;return t.tracks.forEach(r=>{if(!n.get(r.type)){const o=Xd(r.viewMenuActions);this.rewriteOnClicks(r.type,o),n.set(r.type,o)}}),n}})).actions(t=>({setShowCytobands(n){t.showCytobandsSetting=n,localStorage.setItem("lgv-showCytobands",`${+n}`)},setWidth(n){t.volatileWidth=n},setError(n){t.volatileError=n},toggleHeader(){t.hideHeader=!t.hideHeader},toggleHeaderOverview(){t.hideHeaderOverview=!t.hideHeaderOverview},toggleNoTracksActive(){t.hideNoTracksActive=!t.hideNoTracksActive},toggleShowGridlines(){t.showGridlines=!t.showGridlines},scrollTo(n){const r=P.clamp(n,t.minOffset,t.maxOffset);return t.offsetPx=r,r},zoomTo(n){const r=P.clamp(n,t.minBpPerPx,t.maxBpPerPx);if(r===t.bpPerPx)return r;const a=t.bpPerPx;if(t.bpPerPx=r,Math.abs(a-r)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),a;const o=t.width;return this.scrollTo(Math.round((t.offsetPx+o/2)*a/r-o/2)),r},setOffsets(n,r){t.leftOffset=n,t.rightOffset=r},setSearchResults(n,r){t.searchResults=n,t.searchQuery=r},setGetSequenceDialogOpen(n){t.seqDialogDisplayed=n},setNewView(n,r){this.zoomTo(n),this.scrollTo(r)},horizontallyFlip(){t.displayedRegions=Hn(t.displayedRegions.slice().reverse().map(n=>({...n,reversed:!n.reversed}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(n,r={},a={}){const o=e.pluggableConfigSchemaType("track"),i=gs(o,Aa(t),n);if(!i)throw new Error(`Could not resolve identifier "${n}"`);const s=e.getTrackType(i==null?void 0:i.type);if(!s)throw new Error(`Unknown track type ${i.type}`);const u=e.getViewType(t.type).displayTypes.map(p=>p.name),d=i.displays.find(p=>u.includes(p.type));if(!d)throw new Error(`Could not find a compatible display for view type ${t.type}`);const f=t.tracks.filter(p=>p.configuration===i);if(f.length===0){const p=s.stateModel.create({...r,type:i.type,configuration:i,displays:[{type:d.type,configuration:d,...a}]});return t.tracks.push(p),p}return f[0]},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=gs(r,Aa(t),n),o=t.tracks.filter(i=>i.configuration===a);return Mh(()=>o.forEach(i=>t.tracks.remove(i))),o.length}})).actions(t=>({moveTrack(n,r){const a=t.tracks.findIndex(s=>s.id===n);if(a===-1)throw new Error(`Track ID ${n} not found`);const o=t.tracks.findIndex(s=>s.id===r);if(o===-1)throw new Error(`Track ID ${r} not found`);const i=gt(t.tracks[a]);t.tracks.splice(a,1),t.tracks.splice(o,0,i)},closeView(){const n=P.getContainingView(t);n?P.isViewContainer(n)&&n.removeView(t):P.getSession(t).removeView(t)},toggleTrack(n){t.hideTrack(n)||t.showTrack(n)},setTrackLabels(n){t.trackLabels=n,localStorage.setItem("lgv-trackLabels",n)},toggleCenterLine(){t.showCenterLine=!t.showCenterLine,localStorage.setItem("lgv-showCenterLine",`${+t.showCenterLine}`)},setDisplayedRegions(n){t.displayedRegions=Hn(n),t.zoomTo(t.bpPerPx)},activateTrackSelector(){if(t.trackSelectorType==="hierarchical"){const n=P.getSession(t);if(P.isSessionModelWithWidgets(n)){const r=n.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return n.showWidget(r),r}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},getSelectedRegions(n,r){const a=gt(t),o=El.create({...a,interRegionPaddingWidth:t.interRegionPaddingWidth});return o.setVolatileWidth(t.width),o.moveTo(n,r),o.dynamicBlocks.contentBlocks.map(i=>({...i,start:Math.floor(i.start),end:Math.ceil(i.end)}))},afterDisplayedRegionsSet(n){t.afterDisplayedRegionsSetCallbacks.push(n)},horizontalScroll(n){const r=t.offsetPx;return t.scrollTo(t.offsetPx+n)-r},center(){const r=t.totalBp/2/t.bpPerPx;t.scrollTo(Math.round(r-t.width/2))},showAllRegions(){t.zoomTo(t.maxBpPerPx),this.center()},showAllRegionsInAssembly(n){const r=P.getSession(t),{assemblyManager:a}=r;if(!n){const i=[...new Set(t.displayedRegions.map(s=>s.assemblyName))];if(i.length>1){r.notify("Can't perform this with multiple assemblies currently");return}[n]=i}const o=a.get(n);if(o){const{regions:i}=o;i&&(this.setDisplayedRegions(i),t.zoomTo(t.maxBpPerPx),this.center())}},setDraggingTrackId(n){t.draggingTrackId=n},setScaleFactor(n){t.scaleFactor=n},clearView(){this.setDisplayedRegions([]),t.tracks.clear(),t.scrollTo(0),t.zoomTo(10)},async exportSvg(n={}){const r=await XM(t,n),a=new Blob([r],{type:"image/svg+xml"});tf.exports.saveAs(a,n.filename||"image.svg")}})).actions(t=>{let n=()=>{};function r(a){const[o,i]=P.springAnimate(t.offsetPx,t.offsetPx+t.width*a,t.scrollTo);n(),n=i,o()}return{slide:r}}).actions(t=>{let n=()=>{};function r(a){if(t.zoomTo(t.bpPerPx),a<t.bpPerPx&&t.bpPerPx===t.minBpPerPx||a>t.bpPerPx&&t.bpPerPx===t.maxBpPerPx)return;const o=t.bpPerPx/a,[i,s]=P.springAnimate(1,o,t.setScaleFactor,()=>{t.zoomTo(a),t.setScaleFactor(1)});n(),n=s,i()}return{zoom:r}}).views(t=>({get canShowCytobands(){return t.displayedRegions.length===1&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&t.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:n}=P.getSession(t),{assemblyNames:r}=t;return r.some(a=>{var o,i;return(i=(o=n.get(a))===null||o===void 0?void 0:o.cytobands)===null||i===void 0?void 0:i.length})},get cytobandOffset(){return this.showCytobands?P.measureText(t.displayedRegions[0].refName,12)+15:0}})).views(t=>({menuItems(){const{canShowCytobands:n,showCytobands:r}=t,a=P.getSession(t),o=[{label:"Return to import form",onClick:()=>{P.getSession(t).queueDialog(i=>[Le.ReturnToImportFormDialog,{model:t,handleClose:i}])},icon:Zy},...P.isSessionWithAddTracks(a)?[{label:"Sequence search",onClick:()=>{P.getSession(t).queueDialog(i=>[JR,{model:t,handleClose:i}])}}]:[],{label:"Export SVG",icon:eb,onClick:()=>{P.getSession(t).queueDialog(i=>[oR,{model:t,handleClose:i}])}},{label:"Open track selector",onClick:t.activateTrackSelector,icon:xi},{label:"Horizontally flip",icon:tb,onClick:t.horizontallyFlip},{type:"divider"},{label:"Show all regions in assembly",icon:Rt,onClick:t.showAllRegionsInAssembly},{label:"Show center line",icon:Rt,type:"checkbox",checked:t.showCenterLine,onClick:t.toggleCenterLine},{label:"Show header",icon:Rt,type:"checkbox",checked:!t.hideHeader,onClick:t.toggleHeader},{label:"Show header overview",icon:Rt,type:"checkbox",checked:!t.hideHeaderOverview,onClick:t.toggleHeaderOverview,disabled:t.hideHeader},{label:"Show no tracks active button",icon:Rt,type:"checkbox",checked:!t.hideNoTracksActive,onClick:t.toggleNoTracksActive},{label:"Show guidelines",icon:Rt,type:"checkbox",checked:t.showGridlines,onClick:t.toggleShowGridlines},...n?[{label:"Show ideogram",icon:Rt,type:"checkbox",checked:t.showCytobands,onClick:()=>t.setShowCytobands(!r)}]:[],{label:"Track labels",icon:nb,subMenu:[{label:"Overlapping",icon:Rt,type:"radio",checked:t.trackLabels==="overlapping",onClick:()=>t.setTrackLabels("overlapping")},{label:"Offset",icon:Rt,type:"radio",checked:t.trackLabels==="offset",onClick:()=>t.setTrackLabels("offset")},{label:"Hidden",icon:Rt,type:"radio",checked:t.trackLabels==="hidden",onClick:()=>t.setTrackLabels("hidden")}]}];for(const[i,s]of t.trackTypeActions.entries())s.length&&(o.push({type:"divider"},{type:"subHeader",label:i}),s.forEach(c=>o.push(c)));return o}})).views(t=>{let n,r="";return{get staticBlocks(){const a=h1(t),o=JSON.stringify(a);return r!==o&&(n=a,r=o),n},get dynamicBlocks(){return f1(t)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map(a=>({...a,start:Math.floor(a.start),end:Math.ceil(a.end)}))},get visibleLocStrings(){return Nu(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return Nu(t.coarseDynamicBlocks)}}}).actions(t=>({setCoarseDynamicBlocks(n){t.coarseDynamicBlocks=n.contentBlocks,t.coarseTotalBp=n.totalBp},afterAttach(){fn(t,Yt(()=>{t.initialized&&this.setCoarseDynamicBlocks(t.dynamicBlocks)},{delay:150}))}})).actions(t=>({moveTo(n,r){Kf(t,n,r)},navToLocString(n,r){const{assemblyNames:a}=t,{assemblyManager:o}=P.getSession(t),{isValidRefName:i}=o,s=r||a[0];let c;const u=n.split(/(\s+)/).map(f=>f.trim()).filter(f=>!!f);try{c=u.map(f=>P.parseLocString(f,p=>i(p,s)))}catch(f){const[p,g,h]=u;if(`${f}`.match(/Unknown reference sequence/)&&Number.isInteger(+g)&&Number.isInteger(+h))c=[P.parseLocString(p+":"+g+".."+h,m=>i(m,s))];else throw f}const d=c==null?void 0:c.map(f=>{const p=f.assemblyName||s,g=o.get(p),{refName:h}=f;if(!g)throw new Error(`assembly ${p} not found`);const{regions:m}=g;if(!m)throw new Error(`regions not loaded yet for ${p}`);const y=g.getCanonicalRefName(f.refName);if(!y)throw new Error(`Could not find refName ${h} in ${g.name}`);const b=m.find(S=>S.refName===y);if(!b)throw new Error(`Could not find refName ${h} in ${p}`);return{...f,assemblyName:p,parentRegion:b}});if(d.length===1){const f=d[0];t.setDisplayedRegions([{reversed:f.reversed,...f.parentRegion}]);const{start:p,end:g,parentRegion:h}=f;this.navTo({...f,start:P.clamp(p!=null?p:0,0,h.end),end:P.clamp(g!=null?g:h.end,0,h.end)})}else t.setDisplayedRegions(d.map(f=>f.start===void 0?f.parentRegion:f)),t.showAllRegions()},navTo(n){this.navToMultiple([n])},navToMultiple(n){const r=n[0];let{refName:a}=r;const{start:o,end:i,assemblyName:s=t.assemblyNames[0]}=r;if(o!==void 0&&i!==void 0&&o>i)throw new Error(`start "${o+1}" is greater than end "${i}"`);const c=P.getSession(t),{assemblyManager:u}=c,d=u.get(s);if(d){const b=d.getCanonicalRefName(a);b&&(a=b)}let f=o,p=i,g=!1;const h=b=>{if(a===b.refName){if(g=!0,f===void 0&&(f=b.start),p===void 0&&(p=b.end),f>=b.start&&f<=b.end&&p<=b.end&&p>=b.start)return!0;f=o,p=i}return!1},m=P.findLastIndex(t.displayedRegions,h);let y;for(;y!==m;)try{const b=y;if(y=t.displayedRegions.slice(b===void 0?0:b+1).findIndex(h),b!==void 0&&(y+=b+1),!g)throw new Error(`could not find a region with refName "${a}"`);if(f===void 0)throw new Error(`could not find a region with refName "${a}" that contained an end position ${p}`);if(p===void 0)throw new Error(`could not find a region with refName "${a}" that contained a start position ${f+1}`);if(y===-1)throw new Error(`could not find a region that completely contained "${P.assembleLocString(r)}"`);if(n.length===1){const R=t.displayedRegions[y];this.moveTo({index:y,offset:R.reversed?R.end-p:f-R.start},{index:y,offset:R.reversed?R.end-f:p-R.start});return}let S=0,_=0,T=0;for(S;S<n.length;S++){const R=n[S],E=t.displayedRegions[y+S];if(_=R.start||E.start,T=R.end||E.end,R.refName!==E.refName)throw new Error(`Entered location ${P.assembleLocString(R)} does not match with displayed regions`)}S-=1;const x=t.displayedRegions[y],A=t.displayedRegions[y+S];this.moveTo({index:y,offset:x.reversed?x.end-p:f-x.start},{index:y+S,offset:A.reversed?A.end-_:T-A.start});return}catch(b){if(y===m)throw b}}})).views(t=>({rubberBandMenuItems(){return[{label:"Zoom to region",icon:zs,onClick:()=>{const{leftOffset:n,rightOffset:r}=t;t.moveTo(n,r)}},{label:"Get sequence",icon:js,onClick:()=>t.setGetSequenceDialogOpen(!0)}]},bpToPx({refName:n,coord:r,regionNumber:a}){return Yf({refName:n,coord:r,regionNumber:a,self:t})},centerAt(n,r,a){const o=this.bpToPx({refName:r,coord:n,regionNumber:a});o&&t.scrollTo(Math.round(o.offsetPx-t.width/2))},pxToBp(n){return Qf(t,n)},get centerLineInfo(){return t.displayedRegions.length?this.pxToBp(t.width/2):void 0}}))}const KR=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>SN),void 0)),ug=e=>k.compose("LinearBasicDisplay",Cr,k.model({type:k.literal("LinearBasicDisplay"),trackShowLabels:k.maybe(k.boolean),trackShowDescriptions:k.maybe(k.boolean),trackDisplayMode:k.maybe(k.string),trackMaxHeight:k.maybe(k.number),configuration:C.ConfigurationReference(e)})).views(t=>({get rendererTypeName(){return C.getConf(t,["renderer","type"])},get showLabels(){var n;return(n=t.trackShowLabels)!==null&&n!==void 0?n:C.getConf(t,["renderer","showLabels"])},get showDescriptions(){var n;return(n=t.trackShowDescriptions)!==null&&n!==void 0?n:C.getConf(t,["renderer","showDescriptions"])},get maxHeight(){var n;return(n=t.trackMaxHeight)!==null&&n!==void 0?n:C.getConf(t,["renderer","maxHeight"])},get displayMode(){var n;return(n=t.trackDisplayMode)!==null&&n!==void 0?n:C.getConf(t,["renderer","displayMode"])}})).views(t=>({get rendererConfig(){const r=C.getConf(t,["renderer"])||{};return t.rendererType.configSchema.create({...r,showLabels:t.showLabels,showDescriptions:t.showDescriptions,displayMode:t.displayMode,maxHeight:t.maxHeight},He(t))}})).actions(t=>({toggleShowLabels(){t.trackShowLabels=!t.showLabels},toggleShowDescriptions(){t.trackShowDescriptions=!t.showDescriptions},setDisplayMode(n){t.trackDisplayMode=n},setMaxHeight(n){t.trackMaxHeight=n}})).views(t=>{const{trackMenuItems:n,renderProps:r}=t;return{renderProps(){const a=t.rendererConfig;return{...r(),config:a}},trackMenuItems(){return[...n(),{label:"Show labels",icon:Rt,type:"checkbox",checked:t.showLabels,onClick:()=>{t.toggleShowLabels()}},{label:"Show descriptions",icon:Rt,type:"checkbox",checked:t.showDescriptions,onClick:()=>t.toggleShowDescriptions()},{label:"Display mode",icon:Rt,subMenu:["compact","reducedRepresentation","normal","collapse"].map(a=>({label:a,onClick:()=>{t.setDisplayMode(a)}}))},{label:"Set max height",onClick:()=>{P.getSession(t).queueDialog(a=>[KR,{model:t,handleClose:a}])}}]}}});function hc(e){return C.ConfigurationSchema("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:Sr,explicitlyTyped:!0})}class QR extends Gt{constructor(){super(...arguments),this.name="LinearGenomeViewPlugin",this.exports={BaseLinearDisplayComponent:Vn,BaseLinearDisplay:Cr,baseLinearDisplayConfigSchema:Sr,SearchBox:Zp,ZoomControls:eg,LinearGenomeView:sg}}install(t){t.addTrackType(()=>{const n=C.ConfigurationSchema("FeatureTrack",{},{baseConfiguration:ze.createBaseTrackConfig(t),explicitIdentifier:"trackId"});return new lr({name:"FeatureTrack",configSchema:n,stateModel:ze.createBaseTrackModel(t,"FeatureTrack",n)})}),t.addTrackType(()=>{const n=C.ConfigurationSchema("BasicTrack",{},{baseConfiguration:ze.createBaseTrackConfig(t),explicitIdentifier:"trackId"});return new lr({name:"BasicTrack",configSchema:n,stateModel:ze.createBaseTrackModel(t,"BasicTrack",n)})}),t.addDisplayType(()=>{const n=vM(t);return new kn({name:"LinearBareDisplay",configSchema:n,stateModel:wM(n),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:Vn})}),t.addDisplayType(()=>{const n=hc(t);return new kn({name:"LinearBasicDisplay",configSchema:n,stateModel:ug(n),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:Vn})}),t.addViewType(()=>new g_({name:"LinearGenomeView",stateModel:YR(t),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>GR),void 0))})),t.addToExtensionPoint("LaunchView-LinearGenomeView",async({session:n,assembly:r,loc:a,tracks:o=[]})=>{try{const{assemblyManager:i}=n,s=n.addView("LinearGenomeView",{});if(await jr(()=>!!s.volatileWidth),!r)throw new Error("No assembly provided when launching linear genome view");if(!await i.waitForAssembly(r))throw new Error(`Assembly "${r}" not found when launching linear genome view`);s.navToLocString(a,r);const u=[];if(o.forEach(d=>{try{s.showTrack(d)}catch(f){if(`${f}`.match("Could not resolve identifier"))u.push(d);else throw f}}),u.length)throw new Error(`Could not resolve identifiers: ${u.join(",")}`)}catch(i){throw n.notify(`${i}`,"error"),i}})}configure(t){P.isAbstractMenuManager(t.rootModel)&&t.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:rb,onClick:n=>{n.addView("LinearGenomeView",{})}})}}function ZR(e){const t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return C.ConfigurationSchema("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:k.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:k.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:k.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:C.ConfigurationSchema("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:Sr,explicitlyTyped:!0})}const eA=ae()(e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:zt(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:`${Lp(14/10)}em`,maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:pn,cursor:"default",position:"absolute",pointerEvents:"none"}}));function tA({model:e,height:t,clientMouseCoord:n,offsetMouseCoord:r,clientRect:a,TooltipContents:o,useClientY:i}){const{featureUnderMouse:s}=e,[c,u]=M.exports.useState(0),[d,f]=M.exports.useState(null),{classes:p}=eA(),g=M.exports.useMemo(()=>({getBoundingClientRect:()=>{const y=n[0]+c/2+20,b=i?n[1]:(a==null?void 0:a.top)||0;return{top:b,left:y,bottom:b,right:y,width:0,height:0,x:y,y:b,toJSON(){}}}}),[a==null?void 0:a.top,n,c,i]),{styles:h,attributes:m}=ef(g,d);return s?w(Z,{children:[l($d,{children:l("div",{ref:f,className:p.tooltip,style:{...h.popper,zIndex:1e5},...m.popper,children:l(o,{ref:y=>u((y==null?void 0:y.getBoundingClientRect().width)||0),model:e,feature:s})})}),l("div",{className:p.hoverVertical,style:{left:r[0],height:t-pn*2}})]}):null}const dg=j(tA),is=e=>e.toLocaleString("en-US"),nA=$t.forwardRef(({feature:e},t)=>{const n=e.get("start"),r=e.get("end"),o=[e.get("refName"),n===r?is(n):`${is(n)}..${is(r)}`].filter(i=>!!i).join(":");return e.get("summary")!==void 0?w("div",{ref:t,children:[o,l("br",{}),"Max: ",ln(e.get("maxScore")),l("br",{}),"Avg: ",ln(e.get("score")),l("br",{}),"Min: ",ln(e.get("minScore"))]}):w("div",{ref:t,children:[o,l("br",{}),`${ln(e.get("score"))}`]})}),fg=j(e=>l(dg,{TooltipContents:nA,...e})),pg=j(({model:e,orientation:t})=>{const{ticks:n}=e;return n?l(jn.Axis,{...n,shadow:2,format:r=>r,style:{orient:t==="left"?jn.LEFT:jn.RIGHT}}):null}),mc=j(e=>{const{model:t}=e,{stats:n,height:r,needsScalebar:a}=t,{trackLabels:o}=P.getContainingView(t),i=P.getContainingTrack(t),s=o==="overlapping"?P.measureText(C.getConf(i,"name"),12.8)+100:50;return w("div",{children:[l(Vn,{...e}),n&&a?l("svg",{style:{position:"absolute",top:0,left:s,pointerEvents:"none",height:r,width:50},children:l(pg,{model:t})}):null]})}),rA=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>TN),void 0)),aA=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>hF),void 0)),oA=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),yc=(e,t)=>k.compose("LinearWiggleDisplay",Cr,k.model({type:k.literal("LinearWiggleDisplay"),configuration:C.ConfigurationReference(t),selectedRendering:k.optional(k.string,""),resolution:k.optional(k.number,1),fill:k.maybe(k.boolean),minSize:k.maybe(k.number),color:k.maybe(k.string),posColor:k.maybe(k.string),negColor:k.maybe(k.string),summaryScoreMode:k.maybe(k.string),rendererTypeNameState:k.maybe(k.string),scale:k.maybe(k.string),autoscale:k.maybe(k.string),displayCrossHatches:k.maybe(k.boolean),constraints:k.optional(k.model({max:k.maybe(k.number),min:k.maybe(k.number)}),{})})).volatile(()=>({statsReady:!1,message:void 0,stats:{scoreMin:0,scoreMax:50},statsFetchInProgress:void 0})).actions(n=>({updateStats(r){const{scoreMin:a,scoreMax:o}=r,i=1e-6;(Math.abs(n.stats.scoreMax-o)>i||Math.abs(n.stats.scoreMin-a)>i)&&(n.stats={scoreMin:a,scoreMax:o},n.statsReady=!0)},setColor(r){n.color=r},setPosColor(r){n.posColor=r},setNegColor(r){n.negColor=r},setLoading(r){const{statsFetchInProgress:a}=n;a!==void 0&&!a.signal.aborted&&a.abort(),n.statsFetchInProgress=r},selectFeature(r){const a=P.getSession(n);P.isSelectionContainer(a)&&a.setSelection(r)},setResolution(r){n.resolution=r},setFill(r){r===0?(n.fill=!0,n.minSize=0):r===1?(n.fill=!1,n.minSize=1):r===2&&(n.fill=!1,n.minSize=2)},toggleLogScale(){n.scale!=="log"?n.scale="log":n.scale="linear"},setScaleType(r){n.scale=r},setSummaryScoreMode(r){n.summaryScoreMode=r},setAutoscale(r){n.autoscale=r},setMaxScore(r){n.constraints.max=r},setRendererType(r){n.rendererTypeNameState=r},setMinScore(r){n.constraints.min=r},toggleCrossHatches(){n.displayCrossHatches=!n.displayCrossHatches},setCrossHatches(r){n.displayCrossHatches=r}})).views(n=>({get TooltipComponent(){return fg},get adapterTypeName(){return n.adapterConfig.type},get rendererTypeNameSimple(){return n.rendererTypeNameState||C.getConf(n,"defaultRendering")},get rendererTypeName(){const r=this.rendererTypeNameSimple,a=oA.get(r);if(!a)throw new Error(`unknown renderer ${r}`);return a},get filters(){},get scaleType(){return n.scale||C.getConf(n,"scaleType")},get maxScore(){var r;return(r=n.constraints.max)!==null&&r!==void 0?r:C.getConf(n,"maxScore")},get minScore(){var r;return(r=n.constraints.min)!==null&&r!==void 0?r:C.getConf(n,"minScore")}})).views(n=>({get rendererConfig(){const r=C.getConf(n,["renderers",n.rendererTypeName])||{},{color:a,displayCrossHatches:o,fill:i,minSize:s,negColor:c,posColor:u,summaryScoreMode:d,scaleType:f}=n;return n.rendererType.configSchema.create({...r,...f?{scaleType:f}:{},...i!==void 0?{filled:i}:{},...o!==void 0?{displayCrossHatches:o}:{},...d!==void 0?{summaryScoreMode:d}:{},...a!==void 0?{color:a}:{},...c!==void 0?{negColor:c}:{},...u!==void 0?{posColor:u}:{},...s!==void 0?{minSize:s}:{}},He(n))}})).views(n=>{let r=[0,0];return{get filled(){const{fill:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"filled")},get summaryScoreModeSetting(){const{summaryScoreMode:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"summaryScoreMode")},get domain(){const{stats:a,scaleType:o,minScore:i,maxScore:s}=n,c=tc({domain:[a.scoreMin,a.scoreMax],bounds:[i,s],scaleType:o});return o==="log"&&c[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(r)!==JSON.stringify(c)&&(r=c),r)},get needsScalebar(){return n.rendererTypeName==="XYPlotRenderer"||n.rendererTypeName==="LinePlotRenderer"},get scaleOpts(){return{domain:this.domain,stats:n.stats,autoscaleType:this.autoscaleType,scaleType:n.scaleType,inverted:C.getConf(n,"inverted")}},get canHaveFill(){return n.rendererTypeName==="XYPlotRenderer"},get autoscaleType(){var a;return(a=n.autoscale)!==null&&a!==void 0?a:C.getConf(n,"autoscale")},get displayCrossHatchesSetting(){const{displayCrossHatches:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"displayCrossHatches")}}}).views(n=>({get ticks(){const{scaleType:r,domain:a,height:o}=n,i=C.getConf(n,"minimalTicks"),s=C.getConf(n,"inverted"),c=[o-pn,pn],u=Mn({scaleType:r,domain:a,range:c,inverted:s}),d=jn.axisPropsFromTickScale(u,4);return o<100||i?{...d,values:a}:d},get adapterCapabilities(){return e.getAdapterType(n.adapterTypeName).adapterCapabilities}})).views(n=>{const{renderProps:r}=n;return{renderProps(){const a=r(),{filters:o,ticks:i,height:s,resolution:c,scaleOpts:u}=n;return{...a,notReady:a.notReady||!n.statsReady,rpcDriverName:n.rpcDriverName,displayModel:n,config:n.rendererConfig,displayCrossHatches:n.displayCrossHatchesSetting,scaleOpts:u,resolution:c,height:s,ticks:i,filters:o}},get hasResolution(){return n.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return n.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return n.filled?0:!n.filled&&n.minSize===1?1:2}}}).views(n=>{const{trackMenuItems:r}=n,a=C.getConf(n,"defaultRendering");return{trackMenuItems(){return[...r(),...n.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>n.setResolution(n.resolution*5)},{label:"Coarser resolution",onClick:()=>n.setResolution(n.resolution/5)}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map(o=>({label:o,type:"radio",checked:n.summaryScoreModeSetting===o,onClick:()=>n.setSummaryScoreMode(o)}))}]:[],...n.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((o,i)=>({label:o,type:"radio",checked:n.fillSetting===i,onClick:()=>n.setFill(i)}))}]:[],{label:n.scaleType==="log"?"Set linear scale":"Set log scale",onClick:()=>n.toggleLogScale()},...n.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:n.displayCrossHatchesSetting,onClick:()=>n.toggleCrossHatches()}]:[],...a?[{label:"Renderer type",subMenu:["xyplot","density","line"].map(o=>({label:o,type:"radio",checked:n.rendererTypeNameSimple===o,onClick:()=>n.setRendererType(o)}))}]:[],{label:"Autoscale type",subMenu:[["local","Local"],...n.hasGlobalStats?[["global","Global"],["globalsd","Global \xB1 3\u03C3"]]:[],["localsd","Local \xB1 3\u03C3"]].map(([o,i])=>({label:i,type:"radio",checked:n.autoscaleType===o,onClick:()=>n.setAutoscale(o)}))},{label:"Set min/max score",onClick:()=>{P.getSession(n).queueDialog(o=>[rA,{model:n,handleClose:o}])}},{label:"Set color",onClick:()=>{P.getSession(n).queueDialog(o=>[aA,{model:n,handleClose:o}])}}]}}}).actions(n=>{const{reload:r,renderSvg:a}=n;return{async reload(){n.setError();const o=new AbortController;n.setLoading(o);try{const i=await Ti(n,{signal:o.signal,...n.renderProps()});Ye(n)&&(n.updateStats(i),r())}catch(i){n.setError(i)}},afterAttach(){nc(n)},async renderSvg(o){await jr(()=>n.statsReady&&!!n.regionCannotBeRenderedText);const{needsScalebar:i,stats:s}=n,{offsetPx:c}=P.getContainingView(n);return w(Z,{children:[l("g",{id:"snpcov",children:await a(o)}),i&&s?l("g",{transform:`translate(${Math.max(-c,0)})`,children:l(pg,{model:n,orientation:"left"})}):null]})}}}),iA=e=>{e.addDisplayType(()=>{const t=ZR(e),n=yc(e,t);return new kn({name:"LinearWiggleDisplay",configSchema:t,stateModel:n,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:mc})})};function sA(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,n=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return C.ConfigurationSchema("MultiLinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:k.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:k.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:k.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:C.ConfigurationSchema("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:n,MultiRowXYPlotRenderer:r,MultiLineRenderer:a,MultiRowLineRenderer:o})},{baseConfiguration:Sr,explicitlyTyped:!0})}var Ze={};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.ggplot2Colors3=Ze.ggplot2Colors4=Ze.ggplot2Colors5=Ze.ggplot2Colors6=Ze.category10=Ze.dark2=Ze.tableau10=Ze.set2=gg=Ze.set1=void 0;const lA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Ze.category10=lA;const cA=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"];Ze.dark2=cA;const uA=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"];var gg=Ze.set1=uA;const dA=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"];Ze.set2=dA;const fA=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"];Ze.tableau10=fA;const pA=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"];Ze.ggplot2Colors6=pA;const gA=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"];Ze.ggplot2Colors5=gA;const hA=["#F8766D","#7CAE00","#00BFC4","#C77CFF"];Ze.ggplot2Colors4=hA;const mA=["#F8766D","#00BA38","#619CFF"];Ze.ggplot2Colors3=mA;const ss=e=>e.toLocaleString("en-US"),yA=$t.forwardRef(({model:e,feature:t},n)=>{const r=t.get("start"),a=t.get("end"),o=t.get("refName"),i=r===a?ss(r):`${ss(r)}..${ss(a)}`,s=t.get("sources"),c=t.get("source"),u=t.get("summary"),d=Object.fromEntries(e.sources.map(f=>[f.name,f]));return w("div",{ref:n,children:[[o,i].filter(f=>!!f).join(":"),l("br",{}),s?w("table",{children:[l("thead",{children:w("tr",{children:[l("th",{children:"color"}),l("th",{children:"source"}),l("th",{children:"score"})]})}),l("tbody",{children:Object.entries(s).map(([f,p])=>{var g;return w("tr",{children:[l("td",{style:{background:(g=d[f])===null||g===void 0?void 0:g.color},children:" "}),l("td",{children:f}),l("td",{children:ln(p.score)})]},f)})})]}):w("span",{children:[c," ",u?`min:${ln(t.get("minScore"))} avg:${ln(t.get("score"))} max:${ln(t.get("maxScore"))}`:ln(t.get("score"))]})]})}),bA=j(e=>l(dg,{useClientY:!0,TooltipContents:yA,...e})),Bu=j(({model:e,orientation:t})=>{const{ticks:n}=e;return n?l(jn.Axis,{...n,shadow:2,format:r=>r,style:{orient:t==="left"?jn.LEFT:jn.RIGHT}}):null}),vA=12.8;function wA(e){const{prefersOffset:t}=e,{trackLabels:n}=P.getContainingView(e),r=P.getContainingTrack(e),a=C.getConf(r,"name");return n==="overlapping"&&!t?P.measureText(a,vA)+100:10}const SA=j(({children:e,model:t,exportSVG:n})=>{if(n)return l(Z,{children:e});{const{height:r}=t;return l("svg",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",height:r,width:P.getContainingView(t).width},children:e})}}),Mo=e=>{const{color:t="rgb(255,255,255,0.8)"}=e;return l("rect",{...e,fill:t})},CA=j(({model:e})=>{const{ticks:t,scaleType:n}=e,{width:r}=P.getContainingView(e),a=`[${t.values[0]}-${t.values[1]}]`+(n==="log"?" (log scale)":""),o=P.measureText(a,14),i=25,s=r-o-i;return w(Z,{children:[l(Mo,{y:0,x:s,width:o+6,height:16}),l("text",{y:13,x:s,children:a})]})}),Iu=j(({model:e,rowHeight:t,labelWidth:n,exportSVG:r})=>{const{needsCustomLegend:a,needsScalebar:o,needsFullHeightScalebar:i,rowHeightTooSmallForScalebar:s,renderColorBoxes:c,sources:u}=e,d=Math.min(t,12),f=t>11,p=c?15:0,g=n+p+5,m=(r?10:0)||(o&&!s?50:0);return u?w(Z,{children:[i?l(Mo,{y:0,x:m,width:g,height:(u.length+.25)*t}):null,u.map((y,b)=>{const S=Math.min(20,t);return w(Z,{children:[i?null:l(Mo,{y:b*t+1,x:m,width:g,height:S}),y.color?l(Mo,{y:b*t+1,x:m,width:p,height:a?t:S,color:y.color}):null,f?l("text",{y:b*t+13,x:m+p+2,fontSize:d,children:y.name}):null]})})]}):null}),hg=j(e=>{const{model:t,orientation:n,exportSVG:r}=e,{stats:a,needsCustomLegend:o,needsFullHeightScalebar:i,rowHeightTooSmallForScalebar:s,rowHeight:c,sources:u,ticks:d}=t,f=Math.min(c,12),p=c>11,{width:g}=P.getContainingView(t),h=20;if(!(a&&u))return null;const y=Math.max(...u.map(b=>P.measureText(b.name,f)).map(b=>p?b:h)||[0]);return l(SA,{...e,children:i?w(Z,{children:[l("g",{transform:`translate(${r?0:wA(t)},0)`,children:l(Bu,{model:t,orientation:n})}),l("g",{transform:`translate(${g-y-100},0)`,children:l(Iu,{exportSVG:r,model:t,rowHeight:12,labelWidth:y})})]}):w(Z,{children:[l(Iu,{exportSVG:r,model:t,rowHeight:t.rowHeight,labelWidth:y}),s||o?l(CA,{...e}):u.map((b,S)=>l("g",{transform:`translate(0 ${c*S})`,children:l(Bu,{model:t,orientation:n})},JSON.stringify(d)+"-"+S))]})})}),_A=j(e=>{const{model:t}=e;return w("div",{children:[l(Vn,{...e}),l(hg,{model:t})]})}),TA=()=>"#000000".replace(/0/g,()=>(~~(Math.random()*16)).toString(16)),xA=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>bF),void 0)),PA=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>_F),void 0)),kA=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),MA=(e,t)=>k.compose("MultiLinearWiggleDisplay",Cr,k.model({type:k.literal("MultiLinearWiggleDisplay"),configuration:C.ConfigurationReference(t),selectedRendering:k.optional(k.string,""),resolution:k.optional(k.number,1),fill:k.maybe(k.boolean),minSize:k.maybe(k.number),height:200,color:k.maybe(k.string),posColor:k.maybe(k.string),negColor:k.maybe(k.string),summaryScoreMode:k.maybe(k.string),rendererTypeNameState:k.maybe(k.string),scale:k.maybe(k.string),autoscale:k.maybe(k.string),displayCrossHatches:k.maybe(k.boolean),layout:k.optional(k.frozen(),[]),constraints:k.optional(k.model({max:k.maybe(k.number),min:k.maybe(k.number)}),{})})).volatile(()=>({statsReady:!1,message:void 0,stats:{scoreMin:0,scoreMax:50},statsRegion:void 0,statsFetchInProgress:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0})).actions(n=>({setLayout(r){n.layout=r},clearLayout(){n.layout=[]},updateStats(r){const{scoreMin:a,scoreMax:o}=r,i=1e-6;(Math.abs(n.stats.scoreMax-o)>i||Math.abs(n.stats.scoreMin-a)>i)&&(n.stats={scoreMin:a,scoreMax:o},n.statsReady=!0)},setSources(r){Cn(r,n.sourcesVolatile)||(n.sourcesVolatile=r)},setColor(r){n.color=r},setPosColor(r){n.posColor=r},setNegColor(r){n.negColor=r},setLoading(r){const{statsFetchInProgress:a}=n;a!==void 0&&!a.signal.aborted&&a.abort(),n.statsFetchInProgress=r},selectFeature(r){const a=P.getSession(n);P.isSelectionContainer(a)&&a.setSelection(r)},setFeatureUnderMouse(r){n.featureUnderMouseVolatile=r},setResolution(r){n.resolution=r},setFill(r){r===0?(n.fill=!0,n.minSize=0):r===1?(n.fill=!1,n.minSize=1):r===2&&(n.fill=!1,n.minSize=2)},toggleLogScale(){n.scale!=="log"?n.scale="log":n.scale="linear"},setScaleType(r){n.scale=r},setSummaryScoreMode(r){n.summaryScoreMode=r},setAutoscale(r){n.autoscale=r},setMaxScore(r){n.constraints.max=r},setRendererType(r){n.rendererTypeNameState=r},setMinScore(r){n.constraints.min=r},toggleCrossHatches(){n.displayCrossHatches=!n.displayCrossHatches},setCrossHatches(r){n.displayCrossHatches=r}})).views(n=>({get featureUnderMouse(){return n.featureUnderMouseVolatile},get TooltipComponent(){return bA},get adapterTypeName(){return n.adapterConfig.type},get rendererTypeNameSimple(){return n.rendererTypeNameState||C.getConf(n,"defaultRendering")},get rendererTypeName(){const r=this.rendererTypeNameSimple,a=kA.get(r);if(!a)throw new Error(`unknown renderer ${r}`);return a},get filters(){},get scaleType(){var r;return(r=n.scale)!==null&&r!==void 0?r:C.getConf(n,"scaleType")},get maxScore(){var r;return(r=n.constraints.max)!==null&&r!==void 0?r:C.getConf(n,"maxScore")},get minScore(){var r;return(r=n.constraints.min)!==null&&r!==void 0?r:C.getConf(n,"minScore")}})).views(n=>({get rendererConfig(){const r=C.getConf(n,["renderers",n.rendererTypeName])||{},{color:a,displayCrossHatches:o,fill:i,minSize:s,negColor:c,posColor:u,summaryScoreMode:d,scaleType:f}=n;return n.rendererType.configSchema.create({...r,...f?{scaleType:f}:{},...i!==void 0?{filled:i}:{},...o!==void 0?{displayCrossHatches:o}:{},...d!==void 0?{summaryScoreMode:d}:{},...a!==void 0?{color:a}:{},...c!==void 0?{negColor:c}:{},...u!==void 0?{posColor:u}:{},...s!==void 0?{minSize:s}:{}},He(n))}})).views(n=>({get needsScalebar(){return n.rendererTypeName==="MultiXYPlotRenderer"||n.rendererTypeName==="MultiRowXYPlotRenderer"||n.rendererTypeName==="MultiLineRenderer"||n.rendererTypeName==="MultiRowLineRenderer"},get needsFullHeightScalebar(){return n.rendererTypeName==="MultiXYPlotRenderer"||n.rendererTypeName==="MultiLineRenderer"},get isMultiRow(){return n.rendererTypeName==="MultiRowXYPlotRenderer"||n.rendererTypeName==="MultiRowLineRenderer"||n.rendererTypeName==="MultiDensityRenderer"},get needsCustomLegend(){return n.rendererTypeName==="MultiDensityRenderer"},get canHaveFill(){return n.rendererTypeName==="MultiXYPlotRenderer"||n.rendererTypeName==="MultiRowXYPlotRenderer"},get renderColorBoxes(){return!(n.rendererTypeName==="MultiRowLineRenderer"||n.rendererTypeName==="MultiRowXYPlotRenderer")},get prefersOffset(){return this.isMultiRow},get sources(){var r;const a=Object.fromEntries(((r=n.sourcesVolatile)===null||r===void 0?void 0:r.map(i=>[i.name,i]))||[]),o=n.layout.length?n.layout:n.sourcesVolatile;return o==null?void 0:o.map(i=>({...a[i.name],...i})).map((i,s)=>({...i,color:i.color||(this.isMultiRow?"blue":gg[s]||TA())}))}})).views(n=>{let r=[0,0];return{get filled(){const{fill:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"filled")},get summaryScoreModeSetting(){const{summaryScoreMode:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"summaryScoreMode")},get domain(){const{stats:a,scaleType:o,minScore:i,maxScore:s}=n,{scoreMin:c,scoreMax:u}=a,d=tc({domain:[c,u],bounds:[i,s],scaleType:o});return o==="log"&&d[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(Cn(r,d)||(r=d),r)},get scaleOpts(){const{scaleType:a,stats:o}=n;return{autoscaleType:this.autoscaleType,domain:this.domain,stats:o,scaleType:a,inverted:C.getConf(n,"inverted")}},get autoscaleType(){var a;return(a=n.autoscale)!==null&&a!==void 0?a:C.getConf(n,"autoscale")},get displayCrossHatchesSetting(){const{displayCrossHatches:a,rendererConfig:o}=n;return a!=null?a:C.readConfObject(o,"displayCrossHatches")},get rowHeight(){const{sources:a,height:o,isMultiRow:i}=n;return i?o/((a==null?void 0:a.length)||1):o},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return C.getConf(n,"minimalTicks")||this.rowHeightTooSmallForScalebar}}}).views(n=>({get ticks(){const{scaleType:r,domain:a,isMultiRow:o,rowHeight:i,useMinimalTicks:s}=n,c=o?0:pn,u=jn.axisPropsFromTickScale(Mn({scaleType:r,domain:a,range:[i-c,c],inverted:C.getConf(n,"inverted")}),4);return s?{...u,values:a}:u},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get adapterCapabilities(){const{adapterTypeName:r}=n;return e.getAdapterType(r).adapterCapabilities}})).views(n=>{const{renderProps:r}=n;return{renderProps(){const a=r(),{displayCrossHatches:o,filters:i,height:s,resolution:c,rpcDriverName:u,scaleOpts:d,sources:f,statsReady:p,ticks:g,rendererConfig:h}=n;return{...a,notReady:a.notReady||!f||!p,displayModel:n,config:h,displayCrossHatches:o,filters:i,height:s,resolution:c,rpcDriverName:u,scaleOpts:d,sources:f,ticks:g,onMouseMove:(m,y)=>n.setFeatureUnderMouse(y),onMouseLeave:()=>n.setFeatureUnderMouse(void 0)}},get hasResolution(){return n.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return n.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return n.filled?0:!n.filled&&n.minSize===1?1:2}}}).views(n=>{const{trackMenuItems:r}=n,a=C.getConf(n,"defaultRendering");return{trackMenuItems(){return[...r(),...n.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>n.setResolution(n.resolution*5)},{label:"Coarser resolution",onClick:()=>n.setResolution(n.resolution/5)}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map(o=>({label:o,type:"radio",checked:n.summaryScoreModeSetting===o,onClick:()=>n.setSummaryScoreMode(o)}))}]:[],...n.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((o,i)=>({label:o,type:"radio",checked:n.fillSetting===i,onClick:()=>n.setFill(i)}))}]:[],{label:n.scaleType==="log"?"Set linear scale":"Set log scale",onClick:()=>n.toggleLogScale()},...n.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:n.displayCrossHatchesSetting,onClick:()=>n.toggleCrossHatches()}]:[],...a?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map(o=>({label:o,type:"radio",checked:n.rendererTypeNameSimple===o,onClick:()=>n.setRendererType(o)}))}]:[],{label:"Autoscale type",subMenu:[["local","Local"],...n.hasGlobalStats?[["global","Global"],["globalsd","Global \xB1 3\u03C3"]]:[],["localsd","Local \xB1 3\u03C3"]].map(([o,i])=>({label:i,type:"radio",checked:n.autoscaleType===o,onClick:()=>n.setAutoscale(o)}))},{label:"Set min/max score...",onClick:()=>{P.getSession(n).queueDialog(i=>[xA,{model:n,handleClose:i}])}},{label:"Edit colors/arrangement...",onClick:()=>{P.getSession(n).queueDialog(o=>[PA,{model:n,handleClose:o}])}}]}}}).actions(n=>{const{reload:r,renderSvg:a}=n;return{async reload(){n.setError();const o=new AbortController;let i;try{n.setLoading(o),i=await Ti(n,{signal:o.signal,...n.renderProps()}),Ye(n)&&(n.updateStats(i),r())}catch(s){n.setError(s)}},afterAttach(){nc(n),fn(n,Yt(async()=>{const{rpcManager:o}=P.getSession(n),{adapterConfig:i}=n,s=Y.getRpcSessionId(n),c=await o.call(s,"MultiWiggleGetSources",{sessionId:s,adapterConfig:i});Ye(n)&&n.setSources(c)}))},async renderSvg(o){await jr(()=>n.statsReady&&!!n.regionCannotBeRenderedText);const{offsetPx:i}=P.getContainingView(n);return w(Z,{children:[l("g",{id:"snpcov",children:await a(o)}),l("g",{transform:`translate(${Math.max(-i,0)})`,children:l(hg,{model:n,orientation:"left",exportSVG:!0})})]})}}}),RA=e=>{e.addDisplayType(()=>{const t=sA(e);return new kn({name:"MultiLinearWiggleDisplay",configSchema:t,stateModel:MA(e,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:_A})})};function AA(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,sources:i,onMouseLeave:s=()=>{},onMouseMove:c=()=>{},onFeatureClick:u=()=>{},displayModel:d}=e,[f]=t,p=M.exports.useRef(null);function g(h,m){if(!p.current)return;const y=p.current.getBoundingClientRect(),b=h-y.left,S=m-y.top,_=i[Math.floor(S/o*i.length)];if(!_)return;const T=f.reversed?a-b:b,x=f.start+r*T;let A;if(d.isMultiRow){for(const R of n.values())if(R.get("source")===_.name&&x<=R.get("end")+r&&x>=R.get("start")){A=R;break}}else{const R=[];for(const E of n.values())x<=E.get("end")+r&&x>=E.get("start")&&R.push(E);if(R.length){const E=Math.floor(x);A=new P.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(R.map($=>$.toJSON()).map($=>{const{refName:B,start:F,end:I,source:U,...z}=$;return[U,z]})),...f,start:E,end:E+1})}}return A}return l("div",{ref:p,onMouseMove:h=>{const m=g(h.clientX,h.clientY);c(h,m)},onClick:h=>{const m=g(h.clientX,h.clientY);u(h,m)},onMouseLeave:h=>s(h),style:{overflow:"visible",position:"relative",height:o},children:l(Le.PrerenderedCanvas,{...e})})}const ao=j(AA);class EA extends hn{async draw(t,n){const{sources:r,features:a}=n,o=da([...a.values()],c=>c.get("source")),i=await se(()=>import("./color.b8402d12.js").then(c=>c.i),["assets/color.b8402d12.js","assets/color-string.6cf0e789.js","assets/color-name.e7a4e1d3.js","assets/simple-swizzle.bbda63e1.js","assets/is-arrayish.e606b633.js","assets/color-convert.69e17089.js"]).then(c=>c.default);let s=[];return r.forEach(c=>{const u=o[c.name];if(!u)return;const{reducedFeatures:d}=rc(t,{...n,features:u,offset:pn,colorCallback:()=>c.color||"blue",Color:i});s=s.concat(d)}),{reducedFeatures:s}}}const $A=C.ConfigurationSchema("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:k.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:Gn,explicitlyTyped:!0}),DA=e=>{e.addRendererType(()=>new EA({name:"MultiXYPlotRenderer",ReactComponent:ao,configSchema:$A,pluginManager:e}))};class LA extends hn{async draw(t,n){const{bpPerPx:r,sources:a,regions:o,features:i}=n,[s]=o,c=da([...i.values()],g=>g.get("source")),u=n.height/Object.keys(c).length,d=(s.end-s.start)/r,f=await se(()=>import("./color.b8402d12.js").then(g=>g.i),["assets/color.b8402d12.js","assets/color-string.6cf0e789.js","assets/color-name.e7a4e1d3.js","assets/simple-swizzle.bbda63e1.js","assets/is-arrayish.e606b633.js","assets/color-convert.69e17089.js"]).then(g=>g.default);let p=[];return t.save(),a.forEach(g=>{const h=c[g.name];if(!h)return;const{reducedFeatures:m}=rc(t,{...n,features:h,height:u,colorCallback:()=>g.color||"blue",Color:f});t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,u),t.lineTo(d,u),t.stroke(),t.translate(0,u),p=p.concat(m)}),t.restore(),{reducedFeatures:p}}}const NA=C.ConfigurationSchema("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:k.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:Gn,explicitlyTyped:!0}),FA=e=>{e.addRendererType(()=>new LA({name:"MultiRowXYPlotRenderer",ReactComponent:ao,configSchema:NA,pluginManager:e}))},BA=C.ConfigurationSchema("MultiDensityRenderer",{},{baseConfiguration:Gn,explicitlyTyped:!0});class IA extends hn{async draw(t,n){const{bpPerPx:r,sources:a,regions:o,features:i}=n,[s]=o,c=da([...i.values()],p=>p.get("source")),u=n.height/Object.keys(c).length,d=(s.end-s.start)/r;let f=[];return t.save(),a.forEach(p=>{const g=c[p.name];if(!g)return;const{reducedFeatures:h}=Np(t,{...n,features:g,height:u});t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,u),t.lineTo(d,u),t.stroke(),t.translate(0,u),f=f.concat(h)}),t.restore(),{reducedFeatures:f}}}const OA=e=>{e.addRendererType(()=>new IA({name:"MultiDensityRenderer",ReactComponent:ao,configSchema:BA,pluginManager:e}))};class jA extends hn{async draw(t,n){const{sources:r,features:a}=n,o=da([...a.values()],s=>s.get("source"));let i=[];return r.forEach(s=>{const c=o[s.name];if(!c)return;const{reducedFeatures:u}=ac(t,{...n,features:c,colorCallback:()=>s.color||"blue"});i=i.concat(u)}),{reducedFeatures:i}}}const zA=C.ConfigurationSchema("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:k.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:Gn,explicitlyTyped:!0}),qA=e=>{e.addRendererType(()=>new jA({name:"MultiLineRenderer",ReactComponent:ao,configSchema:zA,pluginManager:e}))};class VA extends hn{async draw(t,n){const{bpPerPx:r,sources:a,regions:o,features:i}=n,[s]=o,c=da([...i.values()],p=>p.get("source")),u=n.height/Object.keys(c).length,d=(s.end-s.start)/r;let f=[];return t.save(),a.forEach(p=>{const{reducedFeatures:g}=ac(t,{...n,features:c[p.name],height:u,colorCallback:()=>p.color||"blue"});t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,u),t.lineTo(d,u),t.stroke(),t.translate(0,u),f=f.concat(g)}),t.restore(),{reducedFeatures:f}}}const HA=C.ConfigurationSchema("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:k.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:Gn,explicitlyTyped:!0}),WA=e=>{e.addRendererType(()=>new VA({name:"MultiRowLineRenderer",ReactComponent:ao,configSchema:HA,pluginManager:e}))},UA=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>xF),void 0));function GA(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",(t,n)=>{const{session:r}=n;return[...t,...P.isSessionWithAddTracks(r)?[{label:"Create multi-wiggle track",onClick:a=>{const o=a.selection,i=o.map(c=>C.readConfObject(c,"name"));function s(c){const u=o.map(g=>C.readConfObject(g,"adapter")).map((g,h)=>({...g,source:i[h]})),d=[...new Set(o.map(g=>C.readConfObject(g,"assemblyNames")).flat())],p=`multitrack-${+Date.now()}-sessionTrack`;P.getSession(a).addTrackConf({type:"MultiQuantitativeTrack",trackId:p,name:c.name,assemblyNames:d,adapter:{type:"MultiWiggleAdapter",subadapters:u}}),a.view.showTrack(p)}P.getSession(a).queueDialog(c=>[UA,{tracks:o,onClose:(u,d)=>{u&&d&&s(d),c()}}])}}]:[]]})}const JA=ae()(e=>({textbox:{width:"100%"},paper:{margin:e.spacing(),padding:e.spacing()},submit:{marginTop:25,marginBottom:100,display:"block"}}));function XA({model:e}){const{classes:t}=JA(),[n,r]=M.exports.useState(""),[a,o]=M.exports.useState("MultiWiggle "+Date.now());return w(Je,{className:t.paper,children:[w("ul",{children:[l("li",{children:"Enter list of URLs for bigwig files in the textbox"}),l("li",{children:"Or, use the button below the text box to select files from your computer"})]}),l(be,{multiline:!0,rows:10,value:n,onChange:i=>r(i.target.value),placeholder:"Paste list of URLs here, or use file selector below",variant:"outlined",className:t.textbox}),w(ne,{variant:"outlined",component:"label",children:["Choose Files from your computer",l("input",{type:"file",hidden:!0,multiple:!0,onChange:({target:i})=>{const s=Array.from((i==null?void 0:i.files)||[]).map(c=>({type:"BigWigAdapter",bigWigLocation:P.isElectron?{localPath:c.path,locationType:"LocalPathLocation"}:Y.storeBlobLocation({blob:c}),source:c.name}));r(JSON.stringify(s,null,2))}})]}),l(be,{value:a,onChange:i=>o(i.target.value),helperText:"Track name"}),l(ne,{variant:"contained",className:t.submit,onClick:()=>{var i;const s=P.getSession(e),c=[`${a.toLowerCase().replace(/ /g,"_")}-${Date.now()}`,`${s.adminMode?"":"-sessionTrack"}`].join("");let u;try{u=JSON.parse(n)}catch{u=n.split(`
`)}const d=typeof u[0]=="string"?{bigWigs:u}:{subadapters:u};s.addTrackConf({trackId:c,type:"MultiQuantitativeTrack",name:a,assemblyNames:[e.assembly],adapter:{type:"MultiWiggleAdapter",...d}}),(i=e.view)===null||i===void 0||i.showTrack(c),e.clearData(),s.hideWidget(e)},children:"Submit"}),l("p",{children:"Additional notes: "}),w("ul",{children:[w("li",{children:["The list of bigwig files in the text box can be a list of URLs, or a list of elements like"," ",l("code",{children:'[{"type":"BigWigAdapter","bigWigLocation":{"uri":"http://host/file.bw"}, "color":"green","source":"name for subtrack"}]'})," ","to apply e.g. the color attribute to the view"]}),l("li",{children:'Adding local files will update the textbox with JSON contents that are ready to submit with the "Submit" button'})]})]})}const YA=e=>{e.addAddTrackWorkflowType(()=>new $l.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:XA,stateModel:k.model({})}))};class KA extends Ya{constructor(){super(...arguments),this.name="WiggleGetGlobalStats"}async deserializeArguments(t,n){return{...await super.deserializeArguments(t,n),filters:t.filters?new Nl({filters:t.filters}):void 0}}async execute(t,n){const r=this.pluginManager,a=await this.deserializeArguments(t,n),{adapterConfig:o,sessionId:i}=a,{dataAdapter:s}=await br(r,i,o);return s.getGlobalStats(a)}}class QA extends Ya{constructor(){super(...arguments),this.name="WiggleGetMultiRegionStats"}async deserializeArguments(t,n){return{...await super.deserializeArguments(t,n),filters:t.filters?new Nl({filters:t.filters}):void 0}}async serializeArguments(t,n){var r,a,o;const s=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager;if(!s)return t;const c=await P.renameRegionsIfNeeded(s,{...t,filters:(o=t.filters)===null||o===void 0?void 0:o.toJSON().filters});return super.serializeArguments(c,n)}async execute(t,n){const r=this.pluginManager,a=await this.deserializeArguments(t,n),{regions:o,adapterConfig:i,sessionId:s}=a,{dataAdapter:c}=await br(r,s,i);if(c instanceof st)return c.getMultiRegionStats(o,a);throw new Error("Data adapter not found")}}class ZA extends Ya{constructor(){super(...arguments),this.name="MultiWiggleGetSources"}async deserializeArguments(t,n){return{...await super.deserializeArguments(t,n),filters:t.filters?new Nl({filters:t.filters}):void 0}}async serializeArguments(t,n){var r,a,o;const s=(a=(r=this.pluginManager.rootModel)===null||r===void 0?void 0:r.session)===null||a===void 0?void 0:a.assemblyManager;if(!s)return t;const c=await P.renameRegionsIfNeeded(s,{...t,filters:(o=t.filters)===null||o===void 0?void 0:o.toJSON().filters});return super.serializeArguments(c,n)}async execute(t,n){const r=this.pluginManager,a=await this.deserializeArguments(t,n),{regions:o,adapterConfig:i,sessionId:s}=a,{dataAdapter:c}=await br(r,s,i);return c.getSources(o,a)}}class eE extends Gt{constructor(){super(...arguments),this.name="WigglePlugin",this.exports={LinearWiggleDisplayReactComponent:mc,XYPlotRendererReactComponent:ro,XYPlotRenderer:Fp,WiggleBaseRenderer:hn,xyPlotRendererConfigSchema:Bp,utils:Jk,linearWiggleDisplayModelFactory:yc}}install(t){Uk(t),qk(t),Vk(t),Hk(t),iA(t),RA(t),eM(t),Kk(t),Yk(t),DA(t),FA(t),OA(t),qA(t),WA(t),YA(t),GA(t),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.(bw|bigwig)$/i,s="BigWigAdapter",c=Y.getFileName(r),u={type:s,bigWigLocation:r};return i.test(c)&&!o||o===s?u:n(r,a,o)}),t.addToExtensionPoint("Core-guessTrackTypeForLocation",n=>r=>r==="BigWigAdapter"?"QuantitativeTrack":n(r)),t.addRpcMethod(()=>new KA(t)),t.addRpcMethod(()=>new QA(t)),t.addRpcMethod(()=>new ZA(t))}}class tE extends hn{async draw(t,n){const{features:r,regions:a,bpPerPx:o,displayCrossHatches:i,modificationTagMap:s={},scaleOpts:c,height:u,theme:d,config:f,ticks:p}=n,g=Le.createJBrowseTheme(d),[h]=a,m=(h.end-h.start)/o,y=pn,b=u-y*2,{domain:S}=c;if(!S)return;const _={...c,range:[0,b]},T=Mn(_),x=Mn({..._,range:[0,b/2],scaleType:"linear"}),A=Vo(c.scaleType),R=C.readConfObject(f,"indicatorThreshold"),E=C.readConfObject(f,"drawInterbaseCounts"),$=C.readConfObject(f,"drawArcs"),B=C.readConfObject(f,"drawIndicators"),F=re=>b-(T(re)||0)+y,I=re=>F(A)-F(re),U=re=>b-(x(re)||0)+y,z=re=>U(Vo("linear"))-U(re),{bases:G}=g.palette,q={A:G.A.main,C:G.C.main,G:G.G.main,T:G.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red",meth:"red",unmeth:"blue",ref:"lightgrey"},J=[...r.values()],Q=J.filter(re=>re.get("type")!=="skip"),H=J.filter(re=>re.get("type")==="skip");t.fillStyle=q.total;for(let re=0;re<Q.length;re++){const ve=Q[re],[V,K]=P.featureSpanPx(ve,h,o),ie=K-V+.3,oe=ve.get("score");t.fillRect(V,F(oe),ie,I(oe))}let ce=0;const le=h.reversed?1/o:0;for(let re=0;re<Q.length;re++){const ve=Q[re],[V,K]=P.featureSpanPx(ve,h,o),ie=ve.get("score"),oe=ve.get("snpinfo"),he=Math.max(K-V+.3,1),me=oe.total,Se=Object.keys(oe.cov).sort();let yt=0;for(let We=0;We<Se.length;We++){const de=Se[We],{total:ye}=oe.cov[de];t.fillStyle=q[de]||s[de.replace("mod_","")]||"#888";const Ae=I(ie),pt=F(ie)+Ae;t.fillRect(V,pt-(ye+yt)/ie*Ae,he,ye/ie*Ae),yt+=ye}const Be=Object.keys(oe.noncov),bt=4.5;if(E){let We=0;for(let de=0;de<Be.length;de++){const ye=Be[de],{total:Ae}=oe.noncov[ye];t.fillStyle=q[ye],t.fillRect(V-.6+le,bt+z(We),1.2,z(Ae)),We+=Ae}}if(B){let We=0,de=0,ye="";for(let pt=0;pt<Be.length;pt++){const Tr=Be[pt],{total:mn}=oe.noncov[Tr];We+=mn,mn>de&&(de=mn,ye=Tr)}const Ae=Math.max(me,ce);if(We>Ae*R&&Ae>7){t.fillStyle=q[ye],t.beginPath();const pt=V+le;t.moveTo(pt-3.5,0),t.lineTo(pt+3.5,0),t.lineTo(pt,bt),t.fill()}}ce=me}if($)for(let re=0;re<H.length;re++){const ve=H[re],[V,K]=P.bpSpanPx(ve.get("start"),ve.get("end"),h,o);t.beginPath();const ie=ve.get("strand"),oe=ve.get("xs"),he="rgba(255,200,200,0.7)",me="rgba(200,200,255,0.7)",Se="rgba(200,200,200,0.7)";oe==="+"?t.strokeStyle=he:oe==="-"?t.strokeStyle=me:ie===1?t.strokeStyle=he:ie===-1?t.strokeStyle=me:t.strokeStyle=Se,t.lineWidth=Math.log(ve.get("score")+1),t.moveTo(V,b-y*2),t.bezierCurveTo(V,0,K,0,K,b-y*2),t.stroke()}i&&(t.lineWidth=1,t.strokeStyle="rgba(140,140,140,0.8)",p.values.forEach(re=>{t.beginPath(),t.moveTo(0,Math.round(F(re))),t.lineTo(m,Math.round(F(re))),t.stroke()}))}}const nE=C.ConfigurationSchema("SNPCoverageRenderer",{},{baseConfiguration:Ok,explicitlyTyped:!0});function rE(e){e.addRendererType(()=>new tE({name:"SNPCoverageRenderer",ReactComponent:ro,configSchema:nE,pluginManager:e}))}var aE=Tf();const oE=(e,t)=>{const n=Array.from(e.values()),r=[],a=[],{pos:o,type:i}=t;n.forEach(u=>{const d=u,f=d.get("start"),p=d.get("end");nl(o-1,o,f,p)?r.push(u):a.push(u)});const s=n.length?n[0].get("tags"):!1;switch(i){case"Start location":{r.sort((u,d)=>u.get("start")-d.get("start"));break}case"tag":{const u=t.tag,d=(p,g)=>s?p.get("tags")[g]:p.get(g);r[0]&&typeof d(r[0],u)=="string"?r.sort((p,g)=>d(g,u).localeCompare(d(p,u))):r.sort((p,g)=>(d(g,u)||0)-(d(p,u)||0));break}case"Base pair":{const u=[];r.forEach(f=>{f.get("mismatches").forEach(g=>{const m=f.get("start")+g.start+1,b=g.type==="insertion"||g.type==="softclip"?0:g.length;o>=m&&o<m+b&&u.push([f.id(),g])})});const d=new Map(u);r.sort((f,p)=>{const g=d.get(f.id()),h=d.get(p.id()),m=h&&h.base.toUpperCase(),y=g&&g.base.toUpperCase();return m===y&&m==="*"?g.length-h.length:(m?m.charCodeAt(0):0)-(y?y.charCodeAt(0):0)});break}case"Read strand":{r.sort((u,d)=>u.get("strand")<=d.get("strand")?1:-1);break}}return new Map(r.concat(a).map(u=>[u.id(),u]))};class iE extends ap{constructor(t){super(t),this.showSoftClip=!1,this.config=t.config}cachedLayoutIsValid(t){return super.cachedLayoutIsValid(t)&&this.showSoftClip===t.showSoftClip&&Cn(this.sortedBy,t.sortedBy)&&Cn(this.filterBy,t.filterBy)}get layout(){return(!this.cachedLayout||!this.cachedLayoutIsValid(this.cachedLayout))&&(this.cachedLayout={layout:this.makeLayout(),config:C.readConfObject(this.config),filters:this.filters,filterBy:this.filterBy,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}function nt(e,t,n,r,a,o,i){t+r<0||t>o||(i&&(e.fillStyle=i),e.fillRect(t,n,r,a))}function mg(e){const{bases:t}=e.palette;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}function sE(e){return Object.fromEntries(Object.entries(mg(e)).map(([t,n])=>[t,e.palette.getContrastText(n)]))}const Ca={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"};function lE(e){return["methylation","modifications"].includes(e||"")}function cE(e){return!0}class uE extends ip{constructor(){super(...arguments),this.supportsSVG=!0}getCharWidthHeight(t){const n=P.measureText("A"),r=P.measureText("M")-2;return{charWidth:n,charHeight:r}}layoutFeature({feature:t,layout:n,bpPerPx:r,region:a,showSoftClip:o,heightPx:i,displayMode:s}){let c=0,u=0;if(o){const g=t.get("mismatches");if(t.get("seq"))for(let m=0;m<g.length;m+=1){const{type:y,start:b,cliplen:S=0}=g[m];y==="softclip"&&(b===0?c=S:u=S)}}const[d,f]=P.bpSpanPx(t.get("start")-c,t.get("end")+u,a,r);if(s==="compact"&&(i/=3),t.get("refName")!==a.refName)throw new Error(`feature ${t.id()} is not on the current region's reference sequence ${a.refName}`);const p=n.addRect(t.id(),t.get("start")-c,t.get("end")+u,i,t);return p===null?null:{feature:t,leftPx:d,rightPx:f,topPx:s==="collapse"?0:p,heightPx:i}}getExpandedRegion(t,n){const{config:r,showSoftClip:a}=n,o=C.readConfObject(r,"maxClippingSize"),{start:i,end:s}=t,c=s-i,u=Math.max(c,a?Math.round(o):0);return{...t,start:Math.floor(Math.max(i-u,0)),end:Math.ceil(s+u)}}colorByOrientation(t,n){return Ca[this.getOrientation(t,n)||"color_nostrand"]}getOrientation(t,n){const r=C.readConfObject(n,"orientationType"),o=Nk[r][t.get("pair_orientation")];return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[o]}colorByInsertSize(t,n){return t.get("is_paired")&&t.get("seq_id")!==t.get("next_seq_id")?"#555":`hsl(${Math.abs(t.get("template_length"))/10},50%,50%)`}colorByStranded(t,n){const r=t.get("flags"),a=t.get("strand");if(r&1){const i=r&64?-1:1;return r&2?a*i===1?"color_rev_strand":"color_fwd_strand":t.get("multi_segment_next_segment_unmapped")?a*i===1?"color_rev_missing_mate":"color_fwd_missing_mate":t.get("seq_id")===t.get("next_seq_id")?a*i===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":a===1?"color_fwd_diff_chr":"color_rev_diff_chr"}return a===1?"color_fwd_strand":"color_rev_strand"}colorByPerBaseLettering({ctx:t,feat:n,region:r,bpPerPx:a,colorForBase:o,contrastForBase:i,charWidth:s,charHeight:c,canvasWidth:u}){const d=c-2,{feature:f,topPx:p,heightPx:g}=n,h=f.get("seq"),m=On(f.get("CIGAR")),y=1/a,b=f.get("start");let S=0,_=0;for(let T=0;T<m.length;T+=2){const x=+m[T],A=m[T+1];if(A==="S"||A==="I")S+=x;else if(A==="D"||A==="N")_+=x;else if(A==="M"||A==="X"||A==="="){for(let R=0;R<x;R++){const E=h[S+R],$=b+_+R,[B]=P.bpSpanPx($,$+1,r,a);nt(t,B,p,y+.5,g,u,o[E]),y>=s&&g>=d&&(t.fillStyle=i[E],t.fillText(E,B+(y-s)/2+1,p+g))}S+=x,_+=x}}}colorByPerBaseQuality({ctx:t,feat:n,region:r,bpPerPx:a,canvasWidth:o}){const{feature:i,topPx:s,heightPx:c}=n,d=(i.get("qual")||"").split(" ").map(y=>+y),f=On(i.get("CIGAR")),p=1/a,g=i.get("start");let h=0,m=0;for(let y=0;y<f.length;y+=2){const b=+f[y],S=f[y+1];if(S==="S"||S==="I")h+=b;else if(S==="D"||S==="N")m+=b;else if(S==="M"||S==="X"||S==="="){for(let _=0;_<b;_++){const T=d[h+_],[x]=P.bpSpanPx(g+m+_,g+m+_+1,r,a);nt(t,x,s,p+.5,c,o,`hsl(${T===255?150:T*1.5},55%,50%)`)}h+=b,m+=b}}}colorByModifications({ctx:t,feat:n,region:r,bpPerPx:a,renderArgs:o,canvasWidth:i}){const{feature:s,topPx:c,heightPx:u}=n,{Color:d,modificationTagMap:f={}}=o,p=nr(s,"MM","Mm")||"",g=nr(s,"ML","Ml")||[],h=g?(typeof g=="string"?g.split(",").map(A=>+A):g).map(A=>A/255):nr(s,"MP","Mp").split("").map(A=>A.charCodeAt(0)-33).map(A=>Math.min(1,A/50)),m=s.get("CIGAR"),y=s.get("start"),b=s.get("seq"),S=s.get("strand"),_=On(m),T=zo(p,b,S);let x=0;for(let A=0;A<T.length;A++){const{type:R,positions:E}=T[A],$=f[R]||"black",B=d($);for(const F of jo(_,E)){const I=y+F,[U,z]=P.bpSpanPx(I,I+1,r,a),G=h[x];nt(t,U,c,z-U+.5,u,i,G&&G!==1?B.alpha(G+.1).hsl().string():$),x++}}}colorByMethylation({ctx:t,feat:n,region:r,bpPerPx:a,renderArgs:o,canvasWidth:i}){const{regionSequence:s}=o,{feature:c,topPx:u,heightPx:d}=n,f=nr(c,"MM","Mm")||"";if(!s)throw new Error("region sequence required for methylation");const p=c.get("CIGAR"),g=c.get("start"),h=c.get("end"),m=c.get("seq"),y=c.get("strand"),b=On(p),S=new Array(r.end-r.start).fill(0),_=zo(f,m,y);for(let T=0;T<_.length;T++){const{type:x,positions:A}=_[T];if(x==="m"&&A)for(const R of jo(b,A)){const E=R+g-r.start;E>=0&&E<S.length&&(S[E]=1)}}for(let T=g;T<h;T++){const x=T-r.start;if(x>=0&&x<S.length){const A=s[x].toLowerCase(),R=s[x+1].toLowerCase();if(a>2){if(A==="c"&&R==="g"){const E=r.start+x,[$,B]=P.bpSpanPx(E,E+2,r,a);nt(t,$,u,B-$+.5,d,i,S[x]||S[x+1]?"red":"blue")}}else if(A==="c"&&R==="g"){const E=r.start+x,[$,B]=P.bpSpanPx(E,E+1,r,a);nt(t,$,u,B-$+.5,d,i,S[x]?"red":"blue");const[F,I]=P.bpSpanPx(E+1,E+2,r,a);nt(t,F,u,I-F+.5,d,i,S[x+1]?"red":"blue")}}}}drawRect(t,n,r){const{regions:a,bpPerPx:o}=r,{heightPx:i,topPx:s,feature:c}=n,[u]=a,[d,f]=P.bpSpanPx(c.get("start"),c.get("end"),u,o),p=u.reversed?-1:1,g=c.get("strand")*p;o<10?g===-1?(t.beginPath(),t.moveTo(d-5,s+i/2),t.lineTo(d,s+i),t.lineTo(f,s+i),t.lineTo(f,s),t.lineTo(d,s),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(d,s),t.lineTo(d,s+i),t.lineTo(f,s+i),t.lineTo(f+5,s+i/2),t.lineTo(f,s),t.closePath(),t.fill()):t.fillRect(d,s,f-d,i)}drawAlignmentRect({ctx:t,feat:n,renderArgs:r,colorForBase:a,contrastForBase:o,charWidth:i,charHeight:s,defaultColor:c,canvasWidth:u}){const{config:d,bpPerPx:f,regions:p,colorBy:g,colorTagMap:h={}}=r,{tag:m="",type:y=""}=g||{},{feature:b}=n,S=p[0];switch(y){case"insertSize":t.fillStyle=this.colorByInsertSize(b,d);break;case"strand":t.fillStyle=b.get("strand")===-1?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":t.fillStyle=`hsl(${b.get("mq")},50%,50%)`;break;case"pairOrientation":t.fillStyle=this.colorByOrientation(b,d);break;case"stranded":t.fillStyle=Ca[this.colorByStranded(b,d)];break;case"xs":case"tag":{const _=b.get("tags"),T=_?_[m]:b.get(m);if(m==="XS"||m==="TS"){const x={"-":"color_rev_strand","+":"color_fwd_strand"};t.fillStyle=Ca[x[T]||"color_nostrand"]}if(m==="ts"){const x={"-":b.get("strand")===-1?"color_fwd_strand":"color_rev_strand","+":b.get("strand")===-1?"color_rev_strand":"color_fwd_strand"};t.fillStyle=Ca[x[T]||"color_nostrand"]}else{const x=h[T];t.fillStyle=x||Ca.color_nostrand}break}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":b.get("flags")&16?t.fillStyle="#c8dcc8":t.fillStyle="#c8c8c8";break;case"normal":default:c?t.fillStyle="#c8c8c8":t.fillStyle=C.readConfObject(d,"color",{feature:b});break}switch(this.drawRect(t,n,r),y){case"perBaseQuality":this.colorByPerBaseQuality({ctx:t,feat:n,region:S,bpPerPx:f,canvasWidth:u});break;case"perBaseLettering":this.colorByPerBaseLettering({ctx:t,feat:n,region:S,bpPerPx:f,colorForBase:a,contrastForBase:o,charWidth:i,charHeight:s,canvasWidth:u});break;case"modifications":this.colorByModifications({ctx:t,feat:n,region:S,bpPerPx:f,renderArgs:r,canvasWidth:u});break;case"methylation":this.colorByMethylation({ctx:t,feat:n,region:S,bpPerPx:f,renderArgs:r,canvasWidth:u});break}}drawMismatches({ctx:t,feat:n,renderArgs:r,minSubfeatureWidth:a,largeInsertionIndicatorScale:o,mismatchAlpha:i,charWidth:s,charHeight:c,colorForBase:u,contrastForBase:d,canvasWidth:f,drawSNPsMuted:p,drawIndels:g=!0}){const{Color:h,bpPerPx:m,regions:y}=r,{heightPx:b,topPx:S,feature:_}=n,[T]=y,x=_.get("start"),A=Math.min(1/m,2),R=Math.max(a,A),E=_.get("mismatches"),$=c-2,B=T.reversed?1/m+1:-1;for(let F=0;F<E.length;F+=1){const I=E[F],U=x+I.start,z=I.length,G=I.base,[q,J]=P.bpSpanPx(U,U+z,T,m),Q=Math.max(a,Math.abs(q-J));if(I.type==="mismatch"){if(!p){const H=u[I.base]||"#888";nt(t,q,S,Q,b,f,i&&I.qual!==void 0?h(H).alpha(Math.min(1,I.qual/50)).hsl().string():H)}if(Q>=s&&b>=$){const H=p?"black":d[I.base]||"black";t.fillStyle=i&&I.qual!==void 0?h(H).alpha(Math.min(1,I.qual/50)).hsl().string():H,t.fillText(G,q+(Q-s)/2+1,S+b)}}else if(I.type==="deletion"&&g){nt(t,q,S,Q,b,f,u.deletion);const H=`${I.length}`,ce=P.measureText(H,10);Q>=ce&&b>=$&&(t.fillStyle=d.deletion,t.fillText(H,(q+J)/2-ce/2,S+b))}else if(I.type==="insertion"&&g){t.fillStyle="purple";const H=q+B,ce=+I.base||I.length,le=Math.max(a/2,Math.min(1.2,1/m));ce<10&&(nt(t,H,S,le,b,f,"purple"),1/m>=s&&b>=$&&(nt(t,H-le,S,le*3,1,f),nt(t,H-le,S+b-1,le*3,1,f),t.fillText(`(${I.base})`,H+3,S+b)))}else if(I.type==="hardclip"||I.type==="softclip"){const H=q+B;nt(t,H,S,R,b,f,I.type==="hardclip"?"red":"blue"),1/m>=s&&b>=$&&(nt(t,H-R,S,R*3,1,f),nt(t,H-R,S+b-1,R*3,1,f),t.fillText(`(${I.base})`,H+3,S+b))}else if(I.type==="skip"&&q+Q>0){const H=Q-(m>10?1.5:0);t.clearRect(q,S,H,b),nt(t,Math.max(0,q),S+b/2-1,H+(q<0?q:0),2,f,"#333")}}if(g)for(let F=0;F<E.length;F+=1){const I=E[F],U=x+I.start,z=I.length,[G]=P.bpSpanPx(U,U+z,T,m),q=+I.base||I.length,J=`${q}`;if(I.type==="insertion"&&q>=10)if(m>o)nt(t,G-1,S,2,b,f,"purple");else if(b>c){const Q=P.measureText(J),H=5;nt(t,G-Q/2-H,S,Q+2*H,b,f,"purple"),t.fillStyle="white",t.fillText(J,G-Q/2,S+b)}else nt(t,G-2,S,2*2,b,f,"purple")}}drawSoftClipping({ctx:t,feat:n,renderArgs:r,config:a,theme:o,canvasWidth:i}){const{feature:s,topPx:c,heightPx:u}=n,{regions:d,bpPerPx:f}=r,[p]=d,g=C.readConfObject(a,"minSubfeatureWidth"),h=s.get("mismatches"),m=s.get("seq"),{charWidth:y,charHeight:b}=this.getCharWidthHeight(t),{bases:S}=o.palette,_={A:S.A.main,C:S.C.main,G:S.G.main,T:S.T.main,deletion:"#808080"};m&&h.filter(T=>T.type==="softclip").forEach(T=>{const x=T.cliplen||0,A=s.get("start"),R=T.start===0?A-x:A+T.start;for(let E=0;E<x;E+=1){const $=m.charAt(E+T.start);if(!$)return;const[B,F]=P.bpSpanPx(R+E,R+E+1,p,f),I=Math.max(g,Math.abs(B-F)),U=_[$]||"#000000";t.fillStyle=U,nt(t,B,c,I,u,i),I>=y&&u>=b-5&&(t.fillStyle=o.palette.getContrastText(U),t.fillText($,B+(I-y)/2+1,c+u))}})}makeImageData({ctx:t,layoutRecords:n,canvasWidth:r,renderArgs:a}){const{layout:o,config:i,showSoftClip:s,colorBy:c,theme:u}=a,d=C.readConfObject(i,"mismatchAlpha"),f=C.readConfObject(i,"minSubfeatureWidth"),p=C.readConfObject(i,"largeInsertionIndicatorScale"),g=C.readConfObject(i,"color")==="#f0f",h=Le.createJBrowseTheme(u),m=mg(h),y=sE(h);if(!o)throw new Error("layout required");if(!o.addRect)throw new Error("invalid layout object");t.font="bold 10px Courier New,monospace";const{charWidth:b,charHeight:S}=this.getCharWidthHeight(t),_=lE(c==null?void 0:c.type),T=cE(c==null?void 0:c.type);for(let x=0;x<n.length;x++){const A=n[x];A!==null&&(this.drawAlignmentRect({ctx:t,feat:A,renderArgs:a,defaultColor:g,colorForBase:m,contrastForBase:y,charWidth:b,charHeight:S,canvasWidth:r}),this.drawMismatches({ctx:t,feat:A,renderArgs:a,mismatchAlpha:d,drawSNPsMuted:_,drawIndels:T,largeInsertionIndicatorScale:p,minSubfeatureWidth:f,charWidth:b,charHeight:S,colorForBase:m,contrastForBase:y,canvasWidth:r}),s&&this.drawSoftClipping({ctx:t,feat:A,renderArgs:a,config:i,theme:h,canvasWidth:r}))}}layoutFeats(t){const{layout:n,features:r,sortedBy:a,config:o,bpPerPx:i,showSoftClip:s,regions:c}=t,[u]=c;if(!n)throw new Error("layout required");if(!n.addRect)throw new Error("invalid layout object");const d=(a==null?void 0:a.type)&&u.start===a.pos?oE(r,a):r,f=C.readConfObject(o,"height"),p=C.readConfObject(o,"displayMode");return P.iterMap(d.values(),g=>this.layoutFeature({feature:g,layout:n,bpPerPx:i,region:u,showSoftClip:s,heightPx:f,displayMode:p}),d.size)}async fetchSequence(t){const{sessionId:n,regions:r,adapterConfig:a}=t,{sequenceAdapter:o}=a;if(!o)return;const{dataAdapter:i}=await br(this.pluginManager,n,o),[s]=r;return Rp(s,i)}async render(t){var n;const r=await this.getFeatures(t),a=this.createLayoutInWorker(t),{regions:o,bpPerPx:i}=t,s=this.layoutFeats({...t,features:r,layout:a}),[c]=o,u=r.size&&Ap((n=t.colorBy)===null||n===void 0?void 0:n.type)?await this.fetchSequence(t):void 0,{end:d,start:f}=c,p=(d-f)/i,g=Math.max(a.getTotalHeight(),1),h=await se(()=>import("./color.b8402d12.js").then(b=>b.i),["assets/color.b8402d12.js","assets/color-string.6cf0e789.js","assets/color-name.e7a4e1d3.js","assets/simple-swizzle.bbda63e1.js","assets/is-arrayish.e606b633.js","assets/color-convert.69e17089.js"]).then(b=>b.default),m=await aE.renderToAbstractCanvas(p,g,t,b=>this.makeImageData({ctx:b,layoutRecords:s,canvasWidth:p,renderArgs:{...t,layout:a,features:r,regionSequence:u,Color:h}}));return{...await super.render({...t,...m,features:r,layout:a,height:g,width:p}),...m,features:new Map,layout:a,height:g,width:p,maxHeightReached:a.maxHeightReached}}createSession(t){return new iE(t)}}const dE=100;function fE(e){const{onMouseMove:t,blockKey:n,displayModel:r,width:a,height:o,regions:i,bpPerPx:s,sortedBy:c,colorBy:u}=e,{selectedFeatureId:d,featureIdUnderMouse:f,contextMenuFeature:p}=r,[g]=i,h=M.exports.useRef(null),[m,y]=M.exports.useState(!1),[b,S]=M.exports.useState(!1);M.exports.useEffect(()=>{var z,G;const q=h.current;if(!q)return;const J=q.getContext("2d");if(!J)return;J.clearRect(0,0,q.width,q.height);const Q=d?(z=r.getFeatureByID)===null||z===void 0?void 0:z.call(r,n,d):void 0;if(Q){const[le,re,ve,V]=Q,[K,ie]=P.bpSpanPx(le,ve,g,s),oe=Math.round(re),he=Math.round(V-re);J.shadowColor="#222266",J.shadowBlur=10,J.lineJoin="bevel",J.lineWidth=2,J.strokeStyle="#00b8ff",J.strokeRect(K-2,oe-2,ie-K+4,he+4),J.clearRect(K,oe,ie-K,he)}const H=f||(p==null?void 0:p.id()),ce=H?(G=r.getFeatureByID)===null||G===void 0?void 0:G.call(r,n,H):void 0;if(ce){const[le,re,ve,V]=ce,[K,ie]=P.bpSpanPx(le,ve,g,s),oe=Math.round(re),he=Math.round(V-re);J.fillStyle="#0003",J.fillRect(K,oe,ie-K,he)}},[s,g,n,d,r,f,p]);function _(z){y(!0),S(!1),I("MouseDown",z)}function T(z){I("MouseEnter",z)}function x(z){I("MouseOut",z),I("MouseLeave",z)}function A(z){I("MouseOver",z)}function R(z){y(!1),I("MouseUp",z)}function E(z){b||I("Click",z)}function $(z){I("MouseOut",z),I("MouseLeave",z)}function B(z){I("ContextMenu",z)}function F(z){m&&S(!0);let G=0,q=0;const J=h.current;if(J){const{left:le,top:re}=J.getBoundingClientRect();G=le,q=re}G=z.clientX-G,q=z.clientY-q;const Q=g.reversed?a-G:G,H=g.start+s*Q,ce=r.getFeatureOverlapping(n,H,q);t&&t(z,ce)}function I(z,G){const q=e[`onFeature${z}`],J=e[`on${z}`];q&&f?q(G,f):J&&J(G,f)}const U=Math.ceil(a);return w("div",{className:"PileupRendering","data-testid":`pileup-${c||u?`${(c==null?void 0:c.type)||""}${(u==null?void 0:u.type)||""}${(u==null?void 0:u.tag)||""}`:"normal"}`,style:{position:"relative",width:U,height:o},children:[l(Le.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}}),l("canvas",{"data-testid":"pileup_overlay_canvas",width:U,height:o+dE,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:h,onMouseDown:z=>_(z),onMouseEnter:z=>T(z),onMouseOut:z=>x(z),onMouseOver:z=>A(z),onMouseUp:z=>R(z),onMouseLeave:z=>$(z),onMouseMove:z=>F(z),onClick:z=>E(z),onContextMenu:z=>B(z),onFocus:()=>{},onBlur:()=>{}})]})}const pE=j(fE),gE=C.ConfigurationSchema("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:k.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orienation. fr is normal "reads pointing at each other ---> <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:k.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:.7},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function hE(e){e.addRendererType(()=>new uE({name:"PileupRenderer",ReactComponent:pE,configSchema:gE,pluginManager:e}))}const mE=e=>{const t=e.getDisplayType("LinearPileupDisplay").configSchema,n=e.getDisplayType("LinearSNPCoverageDisplay").configSchema;return C.ConfigurationSchema("LinearAlignmentsDisplay",{pileupDisplay:t,snpCoverageDisplay:n},{baseConfiguration:Sr,explicitlyTyped:!0})},Ou=20,yE=(e,t)=>k.compose("LinearAlignmentsDisplay",ze.BaseDisplay,k.model({PileupDisplay:k.maybe(e.getDisplayType("LinearPileupDisplay").stateModel),SNPCoverageDisplay:k.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:k.literal("LinearAlignmentsDisplay"),configuration:C.ConfigurationReference(t),height:250,showCoverage:!0,showPileup:!0,userFeatureScreenDensity:k.maybe(k.number)})).volatile(()=>({scrollTop:0})).actions(n=>({toggleCoverage(){n.showCoverage=!n.showCoverage},togglePileup(){n.showPileup=!n.showPileup},setScrollTop(r){n.scrollTop=r},setSNPCoverageHeight(r){n.snpCovHeight=r}})).views(n=>{const{trackMenuItems:r}=n;return{get pileupDisplayConfig(){const a=C.getConf(n,"pileupDisplay"),o=P.getContainingTrack(n);return{...a,type:"LinearPileupDisplay",name:`${C.getConf(o,"name")} pileup`,displayId:`${n.configuration.displayId}_pileup_xyz`}},getFeatureByID(a,o){return n.PileupDisplay.getFeatureByID(a,o)},searchFeatureByID(a){return n.PileupDisplay.searchFeatureByID(a)},get features(){return n.PileupDisplay.features},get DisplayBlurb(){var a;return(a=n.PileupDisplay)===null||a===void 0?void 0:a.DisplayBlurb},get sortedBy(){return n.PileupDisplay.sortedBy},get sortedByPosition(){return n.PileupDisplay.sortedByPosition},get sortedByRefName(){return n.PileupDisplay.sortedByRefName},get snpCoverageDisplayConfig(){const a=C.getConf(n,"snpCoverageDisplay"),o=P.getContainingTrack(n);return{...a,type:"LinearSNPCoverageDisplay",name:`${C.getConf(o,"name")} snp coverage`,displayId:`${n.configuration.displayId}_snpcoverage_xyz`}},trackMenuItems(){return[...r(),{type:"subMenu",label:"Pileup settings",subMenu:n.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:n.SNPCoverageDisplay.trackMenuItems()}]}}}).actions(n=>({setSNPCoverageDisplay(r){n.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:r,height:n.snpCovHeight}},setUserFeatureScreenDensity(r){n.PileupDisplay.setUserFeatureScreenDensity(r),n.SNPCoverageDisplay.setUserFeatureScreenDensity(r)},setPileupDisplay(r){n.PileupDisplay={type:"LinearPileupDisplay",configuration:r}},setHeight(r){return r>Ou?n.height=r:n.height=Ou,n.height},resizeHeight(r){const a=n.height;return this.setHeight(n.height+r)-a}})).actions(n=>({afterAttach(){fn(n,Yt(()=>{n.SNPCoverageDisplay?Cn(n.snpCoverageDisplayConfig,gt(n.SNPCoverageDisplay.configuration))||(n.SNPCoverageDisplay.setHeight(n.snpCovHeight),n.SNPCoverageDisplay.setConfig(n.snpCoverageDisplayConfig)):n.setSNPCoverageDisplay(n.snpCoverageDisplayConfig),n.PileupDisplay?Cn(n.pileupDisplayConfig,gt(n.PileupDisplay.configuration))||n.PileupDisplay.setConfig(n.pileupDisplayConfig):n.setPileupDisplay(n.pileupDisplayConfig),n.PileupDisplay.filterBy&&!Cn(gt(n.PileupDisplay.filterBy),gt(n.SNPCoverageDisplay.filterBy))&&n.SNPCoverageDisplay.setFilterBy(gt(n.PileupDisplay.filterBy)),n.PileupDisplay.colorBy&&!Cn(gt(n.PileupDisplay.colorBy),n.SNPCoverageDisplay.colorBy?gt(n.SNPCoverageDisplay.colorBy):{})&&n.SNPCoverageDisplay.setColorBy(gt(n.PileupDisplay.colorBy))})),fn(n,Yt(()=>{n.setSNPCoverageHeight(n.SNPCoverageDisplay.height)}))},async renderSvg(r){const a=n.height-n.SNPCoverageDisplay.height;return await jr(()=>n.PileupDisplay.ready),w(Z,{children:[l("g",{children:await n.SNPCoverageDisplay.renderSvg(r)}),l("g",{transform:`translate(0 ${n.SNPCoverageDisplay.height})`,children:await n.PileupDisplay.renderSvg({...r,overrideHeight:a})})]})}})),bE=ae()(()=>({resizeHandle:{height:2,position:"absolute",zIndex:2}}));function vE({model:e}){const{PileupDisplay:t,SNPCoverageDisplay:n,showPileup:r,showCoverage:a}=e,{classes:o}=bE(),i=n.height;return w("div",{"data-testid":`display-${C.getConf(e,"displayId")}`,style:{position:"relative"},children:[a?w(Z,{children:[l("div",{"data-testid":"Blockset-snpcoverage",children:l(n.RenderingComponent,{model:n})}),l(Le.ResizeHandle,{onDrag:s=>(n.setHeight(n.height+s),s),className:o.resizeHandle,style:{top:i}})]}):null,r?l("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:a?n.height:0},children:l(t.RenderingComponent,{model:t})}):null]})}const wE=j(vE);function SE(e){e.addDisplayType(()=>{const t=mE(e);return new kn({name:"LinearAlignmentsDisplay",configSchema:t,stateModel:yE(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:wE})})}function CE(e){const t=e.getRendererType("SNPCoverageRenderer").configSchema;return C.ConfigurationSchema("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:k.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:k.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:C.ConfigurationSchema("RenderersConfiguration",{SNPCoverageRenderer:t})},{baseConfiguration:Sr,explicitlyTyped:!0})}const ls=e=>e.toLocaleString("en-US"),_E=(e=0)=>+(+e).toFixed(1),ju=(e,t)=>`${_E(e/(t||1)*100)}%`,TE=$t.forwardRef(({feature:e},t)=>{const n=e.get("start"),r=e.get("end"),a=e.get("refName"),{refbase:o,all:i,total:s,ref:c,"-1":u,"1":d,"0":f,...p}=e.get("snpinfo"),g=[a,n===r?ls(n):`${ls(n)}..${ls(r)}`].filter(h=>!!h).join(":");return l("div",{ref:t,children:w("table",{children:[l("caption",{children:g}),l("thead",{children:w("tr",{children:[l("th",{children:"Base"}),l("th",{children:"Count"}),l("th",{children:"% of Total"}),l("th",{children:"Strands"}),l("th",{children:"Source"})]})}),w("tbody",{children:[w("tr",{children:[l("td",{children:"Total"}),l("td",{children:i})]}),w("tr",{children:[w("td",{children:["REF ",o?`(${o.toUpperCase()})`:""]}),l("td",{children:c}),l("td",{children:ju(c,i)}),w("td",{children:[u?`${u}(-)`:"",d?`${d}(+)`:""]}),l("td",{})]}),Object.entries(p).map(([h,m])=>Object.entries(m).map(([y,b])=>w("tr",{children:[l("td",{children:y.toUpperCase()}),l("td",{children:b.total}),l("td",{children:y==="total"||y==="skip"?"---":ju(b.total,i)}),w("td",{children:[b[-1]?`${b[-1]}(-)`:"",b[1]?`${b[1]}(+)`:""]}),l("td",{children:h})]},y)))]})]})})}),xE=j(e=>{const{model:t}=e,{featureUnderMouse:n}=t;return n&&n.get("type")==="skip"?null:l(fg,{TooltipContents:TE,...e})});async function PE(e,t,n,r){const{rpcManager:a}=P.getSession(e),{adapterConfig:o}=e,i=Y.getRpcSessionId(e);return await a.call(Y.getRpcSessionId(e),"PileupGetGlobalValueForTag",{adapterConfig:o,tag:t.tag,sessionId:i,regions:n.contentBlocks,...r})}async function yg(e,t,n,r,a){const{rpcManager:o}=P.getSession(e),i=Y.getRpcSessionId(e);return await o.call(i,"PileupGetVisibleModifications",{adapterConfig:t,tag:n.tag,sessionId:i,regions:r.contentBlocks,...a})}const kE=new Map([["snpcoverage","SNPCoverageRenderer"]]),ME=(e,t)=>k.compose("LinearSNPCoverageDisplay",yc(e,t),k.model({type:k.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:k.maybe(k.boolean),drawIndicators:k.maybe(k.boolean),drawArcs:k.maybe(k.boolean),filterBy:k.optional(k.model({flagInclude:k.optional(k.number,0),flagExclude:k.optional(k.number,1540),readName:k.maybe(k.string),tagFilter:k.maybe(k.model({tag:k.string,value:k.string}))}),{}),colorBy:k.maybe(k.model({type:k.string,tag:k.maybe(k.string)}))})).volatile(()=>({modificationTagMap:xo.map({})})).actions(n=>({setConfig(r){n.configuration=r},setFilterBy(r){n.filterBy=Hn(r)},setColorBy(r){n.colorBy=Hn(r)},updateModificationColorMap(r){const a=["red","blue","green","orange","purple"];let o=0;r.forEach(i=>{if(!n.modificationTagMap.has(i)){const s=a[o++];n.modificationTagMap.set(i,s)}})}})).views(n=>{const{renderProps:r}=n;return{get rendererConfig(){var a,o,i;const s=C.getConf(n,["renderers",n.rendererTypeName])||{};return n.rendererType.configSchema.create({...s,drawInterbaseCounts:(a=n.drawInterbaseCounts)!==null&&a!==void 0?a:s.drawInterbaseCounts,drawIndicators:(o=n.drawIndicators)!==null&&o!==void 0?o:s.drawIndicators,drawArcs:(i=n.drawArcs)!==null&&i!==void 0?i:s.drawArcs},He(n))},get drawArcsSetting(){var a;return(a=n.drawArcs)!==null&&a!==void 0?a:C.readConfObject(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){var a;return(a=n.drawInterbaseCounts)!==null&&a!==void 0?a:C.readConfObject(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){var a;return(a=n.drawIndicators)!==null&&a!==void 0?a:C.readConfObject(this.rendererConfig,"drawIndicators")},get modificationsReady(){var a;return((a=n.colorBy)===null||a===void 0?void 0:a.type)==="modifications"?Object.keys(JSON.parse(JSON.stringify(n.modificationTagMap))).length>0:!0},renderProps(){const a=r(),{colorBy:o,filterBy:i,modificationTagMap:s}=n;return{...a,notReady:a.notReady||!this.modificationsReady,modificationTagMap:Object.fromEntries(s.toJSON()),colorBy:o?gt(o):void 0,filterBy:i?gt(i):void 0}}}}).actions(n=>({toggleDrawIndicators(){n.drawIndicators=!n.drawIndicatorsSetting},toggleDrawInterbaseCounts(){n.drawInterbaseCounts=!n.drawInterbaseCountsSetting},toggleDrawArcs(){n.drawArcs=!n.drawArcsSetting},afterAttach(){fn(n,Yt(async()=>{try{const{colorBy:r}=n,{staticBlocks:a}=P.getContainingView(n);if(!n.estimatedStatsReady||n.regionTooLarge)return;if((r==null?void 0:r.type)==="modifications"){const o=await yg(n,C.getConf(n.parentTrack,"adapter"),r,a);n.updateModificationColorMap(o)}}catch(r){console.error(r),n.setError(r)}},{delay:1e3}))}})).views(n=>{const{trackMenuItems:r}=n;return{get TooltipComponent(){return xE},get adapterConfig(){const a=C.getConf(n.parentTrack,"adapter");return{type:"SNPCoverageAdapter",subadapter:a}},get rendererTypeName(){return kE.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems(){return[]},trackMenuItems(){return[...r(),{label:"Draw insertion/clipping indicators",type:"checkbox",checked:n.drawIndicatorsSetting,onClick:()=>{n.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:n.drawInterbaseCountsSetting,onClick:()=>{n.toggleDrawInterbaseCounts()}},{label:"Draw arcs",type:"checkbox",checked:n.drawArcsSetting,onClick:()=>{n.toggleDrawArcs()}}]}}});function RE(e){e.addDisplayType(()=>{const t=CE(e);return new kn({name:"LinearSNPCoverageDisplay",configSchema:t,stateModel:ME(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:mc})})}function AE(e){const t=e.getRendererType("PileupRenderer").configSchema;return C.ConfigurationSchema("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:k.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:C.ConfigurationSchema("RenderersConfiguration",{PileupRenderer:t}),renderer:"",maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:k.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:hc(e),explicitlyTyped:!0})}function EE(e){const{model:t}=e,{sortedBy:n}=t;return n?l("div",{"data-testid":`blurb-${t.sortedBy}`,style:{backgroundColor:"white"},children:l(X,{color:"secondary",variant:"caption",children:t.sortedBy?`Sorted by ${n.type.toLowerCase()} at ${n.refName}:${n.pos}`:null})}):null}const $E=j(EE),DE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>RF),void 0)),LE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>LF),void 0)),NE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>IF),void 0)),FE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>qF),void 0)),BE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>UF),void 0)),IE=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>XF),void 0)),OE=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]),jE=e=>k.compose("LinearPileupDisplay",Cr,k.model({type:k.literal("LinearPileupDisplay"),configuration:C.ConfigurationReference(e),showSoftClipping:!1,featureHeight:k.maybe(k.number),noSpacing:k.maybe(k.boolean),fadeLikelihood:k.maybe(k.boolean),trackMaxHeight:k.maybe(k.number),mismatchAlpha:k.maybe(k.boolean),sortedBy:k.maybe(k.model({type:k.string,pos:k.number,tag:k.maybe(k.string),refName:k.string,assemblyName:k.string})),colorBy:k.maybe(k.model({type:k.string,tag:k.maybe(k.string),extra:k.frozen()})),filterBy:k.optional(k.model({flagInclude:k.optional(k.number,0),flagExclude:k.optional(k.number,1540),readName:k.maybe(k.string),tagFilter:k.maybe(k.model({tag:k.string,value:k.string}))}),{})})).volatile(()=>({colorTagMap:xo.map({}),modificationTagMap:xo.map({}),featureUnderMouseVolatile:void 0,ready:!1})).actions(t=>({setReady(n){t.ready=n},setMaxHeight(n){t.trackMaxHeight=n},setFeatureHeight(n){t.featureHeight=n},setNoSpacing(n){t.noSpacing=n},setColorScheme(n){t.colorTagMap=xo.map({}),t.colorBy=Hn(n),t.ready=!1},updateModificationColorMap(n){const r=["red","blue","green","orange","purple"];n.forEach(a=>{if(!t.modificationTagMap.has(a)){const o=[...t.modificationTagMap.keys()].length,i=r[o];t.modificationTagMap.set(a,i)}})},updateColorTagMap(n){const r=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];n.forEach(a=>{if(!t.colorTagMap.has(a)){const o=[...t.colorTagMap.keys()].length,i=r[o];t.colorTagMap.set(a,i)}})},setFeatureUnderMouse(n){t.featureUnderMouseVolatile=n}})).actions(t=>({afterAttach(){fn(t,Yt(async()=>{try{const{rpcManager:n}=P.getSession(t),r=P.getContainingView(t),{sortedBy:a,colorBy:o,parentTrack:i,adapterConfig:s,rendererType:c}=t,{staticBlocks:u,bpPerPx:d}=r;if(!t.estimatedStatsReady||t.regionTooLarge)return;if(o!=null&&o.tag){const f=await PE(t,o,u);t.updateColorTagMap(f)}if((o==null?void 0:o.type)==="modifications"){const f=C.getConf(i,["adapter"]);t.updateModificationColorMap(await yg(t,f,o,u))}if(a){const{pos:f,refName:p,assemblyName:g}=a;await t.rendererType.renderInClient(n,{assemblyName:g,regions:[{start:f,end:f+1,refName:p,assemblyName:g}],adapterConfig:s,rendererType:c.name,sessionId:Y.getRpcSessionId(t),layoutId:r.id,timeout:1e6,...t.renderProps()}),t.setReady(!0),t.setCurrBpPerPx(d)}else t.setReady(!0)}catch(n){console.error(n),t.setError(n)}},{delay:1e3})),fn(t,Yt(async()=>{var n;const r=P.getSession(t);try{const a=t.featureIdUnderMouse;if(((n=t.featureUnderMouse)===null||n===void 0?void 0:n.id())!==a)if(!a)t.setFeatureUnderMouse(void 0);else{const o=Y.getRpcSessionId(t),i=P.getContainingView(t),{feature:s}=await r.rpcManager.call(o,"CoreGetFeatureDetails",{featureId:a,sessionId:o,layoutId:i.id,rendererType:"PileupRenderer"});t.featureIdUnderMouse===s.uniqueId&&t.setFeatureUnderMouse(new P.SimpleFeature(s))}}catch(a){console.error(a),r.notify(`${a}`,"error")}}))},selectFeature(n){const r=P.getSession(t);if(P.isSessionModelWithWidgets(r)){const a=r.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:n.toJSON(),view:P.getContainingView(t)});r.showWidget(a)}r.setSelection(n)},clearSelected(){t.sortedBy=void 0},copyFeatureToClipboard(n){const{uniqueId:r,...a}=n.toJSON(),o=P.getSession(t);ja(JSON.stringify(a,null,4)),o.notify("Copied to clipboard","success")},toggleSoftClipping(){t.showSoftClipping=!t.showSoftClipping},toggleMismatchAlpha(){t.mismatchAlpha=!t.mismatchAlpha},setConfig(n){t.configuration=n},setSortedBy(n,r){const{centerLineInfo:a}=P.getContainingView(t);if(!a)return;const{refName:o,assemblyName:i,offset:s}=a,c=Math.round(s)+1;c<0||!o||(t.sortedBy={type:n,pos:c,refName:o,assemblyName:i,tag:r},t.ready=!1)},setFilterBy(n){t.filterBy=Hn(n)}})).actions(t=>{const n=t.reload;return{reload(){t.clearSelected(),n()}}}).views(t=>({get maxHeight(){const n=C.getConf(t,["renderers",t.rendererTypeName])||{};return t.trackMaxHeight!==void 0?t.trackMaxHeight:n.maxHeight},get rendererConfig(){const n=C.getConf(t,["renderers",t.rendererTypeName])||{};return t.rendererType.configSchema.create({...n,height:t.featureHeight,noSpacing:t.noSpacing,maxHeight:this.maxHeight,mismatchAlpha:t.mismatchAlpha},He(t))},get featureHeightSetting(){return t.featureHeight||C.readConfObject(this.rendererConfig,"height")},get mismatchAlphaSetting(){return t.mismatchAlpha!==void 0?t.mismatchAlpha:C.readConfObject(this.rendererConfig,"mismatchAlpha")},get featureUnderMouse(){return t.featureUnderMouseVolatile}})).views(t=>{const{trackMenuItems:n,renderProps:r}=t;return{get rendererTypeName(){const a=C.getConf(t,"defaultRendering"),o=OE.get(a);if(!o)throw new Error(`unknown alignments view name ${a}`);return o},contextMenuItems(){const a=t.contextMenuFeature;return a?[{label:"Open feature details",icon:js,onClick:()=>{t.clearFeatureSelection(),a&&t.selectFeature(a)}},{label:"Copy info to clipboard",icon:cc,onClick:()=>{a&&t.copyFeatureToClipboard(a)}}]:[]},get DisplayBlurb(){return $E},renderProps(){const a=P.getContainingView(t),{colorTagMap:o,modificationTagMap:i,sortedBy:s,colorBy:c,filterBy:u,rpcDriverName:d,currBpPerPx:f,ready:p}=t,g=r();return{...g,notReady:g.notReady||!p||s&&f!==a.bpPerPx,rpcDriverName:d,displayModel:t,sortedBy:s,colorBy:c,filterBy:JSON.parse(JSON.stringify(u)),colorTagMap:Object.fromEntries(o.toJSON()),modificationTagMap:Object.fromEntries(i.toJSON()),showSoftClip:t.showSoftClipping,config:t.rendererConfig,async onFeatureClick(h,m){const y=P.getSession(t),{rpcManager:b}=y;try{const S=m||t.featureIdUnderMouse;if(!S)t.clearFeatureSelection();else{const _=Y.getRpcSessionId(t),{feature:T}=await b.call(_,"CoreGetFeatureDetails",{featureId:S,sessionId:_,layoutId:P.getContainingView(t).id,rendererType:"PileupRenderer"});T&&t.selectFeature(new P.SimpleFeature(T))}}catch(S){console.error(S),y.notify(`${S}`)}},onClick(){t.clearFeatureSelection()},async onFeatureContextMenu(h,m){const y=P.getSession(t),{rpcManager:b}=y;try{const S=m||t.featureIdUnderMouse;if(!S)t.clearFeatureSelection();else{const _=Y.getRpcSessionId(t),{feature:T}=await b.call(_,"CoreGetFeatureDetails",{featureId:S,sessionId:_,layoutId:P.getContainingView(t).id,rendererType:"PileupRenderer"});T&&t.setContextMenuFeature(new P.SimpleFeature(T))}}catch(S){console.error(S),y.notify(`${S}`)}}}},trackMenuItems(){return[...n(),{label:"Show soft clipping",icon:Rt,type:"checkbox",checked:t.showSoftClipping,onClick:()=>{t.toggleSoftClipping(),t.showSoftClipping&&t.clearSelected()}},{label:"Sort by",icon:ab,disabled:t.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map(a=>({label:a,onClick:()=>t.setSortedBy(a)})),{label:"Sort by tag...",onClick:()=>{P.getSession(t).queueDialog(a=>[NE,{model:t,handleClose:a}])}},{label:"Clear sort",onClick:()=>t.clearSelected()}]},{label:"Color scheme",icon:ob,subMenu:[{label:"Normal",onClick:()=>{t.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:()=>{t.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:()=>{t.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:()=>{t.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:()=>{t.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:()=>{t.setColorScheme({type:"perBaseLettering"})}},{label:"Modifications or methylation",onClick:()=>{P.getSession(t).queueDialog(a=>[IE,{model:t,handleClose:a}])}},{label:"Insert size",onClick:()=>{t.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:()=>{t.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:()=>{P.getSession(t).queueDialog(a=>[DE,{model:t,handleClose:a}])}}]},{label:"Filter by",icon:ib,onClick:()=>{P.getSession(t).queueDialog(a=>[LE,{model:t,handleClose:a}])}},{label:"Set feature height",onClick:()=>{P.getSession(t).queueDialog(a=>[FE,{model:t,handleClose:a}])}},{label:"Set max height",onClick:()=>{P.getSession(t).queueDialog(a=>[BE,{model:t,handleClose:a}])}},{label:"Fade mismatches by quality",type:"checkbox",checked:t.mismatchAlphaSetting,onClick:()=>{t.toggleMismatchAlpha()}}]}}});function zE(e){e.addDisplayType(()=>{const t=AE(e);return new kn({name:"LinearPileupDisplay",configSchema:t,stateModel:jE(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Vn})})}function qE(e){return C.ConfigurationSchema("AlignmentsTrack",{},{baseConfiguration:ze.createBaseTrackConfig(e)})}function VE(e){e.addTrackType(()=>{const t=qE(e),n=new lr({name:"AlignmentsTrack",configSchema:t,stateModel:ze.createBaseTrackModel(e,"AlignmentsTrack",t)}),r=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(r),n})}const HE=C.ConfigurationSchema("AlignmentsFeatureWidget",{});function WE(e){const t=Gl(e);return k.compose(t,k.model("AlignmentsFeatureWidget",{type:k.literal("AlignmentsFeatureWidget")}))}function UE(e){e.addWidgetType(()=>new tr({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:HE,stateModel:WE(e),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>oB),void 0))}))}class GE extends Ya{constructor(){super(...arguments),this.name="PileupGetGlobalValueForTag"}async serializeArguments(t,n){var r;const{rootModel:a}=this.pluginManager,o=(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.assemblyManager;if(!o)throw new Error("no assembly manager available");const i=await P.renameRegionsIfNeeded(o,t);return super.serializeArguments(i,n)}async execute(t,n){const r=await this.deserializeArguments(t,n),{adapterConfig:a,sessionId:o,regions:i,tag:s}=r,d=await(await br(this.pluginManager,o,a)).dataAdapter.getFeaturesInMultipleRegions(i).pipe(Rn()).toPromise(),f=new Set;return d.forEach(p=>{const g=p.get("tags"),h=g?g[s]:p.get(s);h!==void 0&&f.add(`${h}`)}),[...f]}}class JE extends Ya{constructor(){super(...arguments),this.name="PileupGetVisibleModifications"}async serializeArguments(t,n){var r;const{rootModel:a}=this.pluginManager,o=(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.assemblyManager;if(!o)throw new Error("no assembly manager available");const i=await P.renameRegionsIfNeeded(o,t);return super.serializeArguments(i,n)}async execute(t,n){const r=await this.deserializeArguments(t,n),{adapterConfig:a,sessionId:o,regions:i}=r,u=await(await br(this.pluginManager,o,a)).dataAdapter.getFeaturesInMultipleRegions(i).pipe(Rn()).toPromise(),d=new Set;return u.forEach(f=>{const p=nr(f,"MM","Mm")||"";p!==void 0&&kk(p).forEach(g=>d.add(g))}),[...d]}}class XE extends Gt{constructor(){super(...arguments),this.name="AlignmentsPlugin"}install(t){[Ek,Rk,zE,RE,VE,Ik,Dk,hE,rE,SE,UE].map(n=>n(t)),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.cram$/i,s="CramAdapter",c=Y.getFileName(r),u={type:s,cramLocation:r,craiLocation:a||Y.makeIndex(r,".crai")};return i.test(c)&&!o||o===s?u:n(r,a,o)}),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.bam$/i,s="BamAdapter",c=Y.getFileName(r),u=a&&Y.getFileName(a),d={type:s,bamLocation:r,index:{location:a||Y.makeIndex(r,".bai"),indexType:Y.makeIndexType(u,"CSI","BAI")}};return i.test(c)&&!o||o===s?d:n(r,a,o)}),t.addToExtensionPoint("Core-guessTrackTypeForLocation",n=>r=>r==="BamAdapter"||r==="CramAdapter"?"AlignmentsTrack":n(r)),t.addRpcMethod(()=>new GE(t)),t.addRpcMethod(()=>new JE(t))}}const YE=C.ConfigurationSchema("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0}),KE=C.ConfigurationSchema("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:C.ConfigurationSchema("TabixIndex",{indexType:{model:k.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),QE=C.ConfigurationSchema("BedAdapter",{bedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0});class ZE extends Gt{constructor(){super(...arguments),this.name="BedPlugin"}install(t){t.addAdapterType(()=>new je({name:"BigBedAdapter",configSchema:YE,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>cB),void 0).then(n=>n.default)})),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.(bb|bigbed)$/i,s="BigBedAdapter",c=Y.getFileName(r),u={type:s,bigBedLocation:r};return i.test(c)&&!o||o===s?u:n(r,a,o)}),t.addAdapterType(()=>new je({name:"BedTabixAdapter",configSchema:KE,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>uB),void 0).then(n=>n.default)})),t.addAdapterType(()=>new je({name:"BedAdapter",configSchema:QE,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>fB),void 0).then(n=>n.default)})),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.bed\.b?gz$/i,s="BedTabixAdapter",c=Y.getFileName(r),u=a&&Y.getFileName(a);return i.test(c)||o===s?{type:s,bedGzLocation:r,index:{location:a||Y.makeIndex(r,".tbi"),indexType:Y.makeIndexType(u,"CSI","TBI")}}:n(r,a,o)}),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.bed$/i,s="BedAdapter",c=Y.getFileName(r);return i.test(c)||o===s?{type:s,bedLocation:r}:n(r,a,o)})}}const e$=e=>k.model("ConfigurationEditorWidget",{id:ut.ElementId,type:k.literal("ConfigurationEditorWidget"),target:k.safeReference(e.pluggableConfigSchemaType("track"))}).actions(t=>({setTarget(n){t.target=n}})),t$=C.ConfigurationSchema("ConfigurationEditorWidget",{}),n$=j(({model:e})=>{if(e!=null&&e.target){if(e.target.type)return l(Z,{children:`${e.target.type} settings`});if(hs(e.target)){const t=_d(e.target);if(t!=null&&t.name)return l(Z,{children:`${t.name.replace("ConfigurationSchema","")} settings`})}}return l(Z,{children:"Settings"})});class oo extends st{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"features");this.features=oo.makeFeatures(a||[])}static makeFeatures(t){const n=new Map;for(let r=0;r<t.length;r+=1)if(t[r]){const a=this.makeFeature(t[r]),o=a.get("refName");let i=n.get(o);i||(i=[],n.set(o,i)),i.push(a)}for(const r of n.values())r.sort((a,o)=>a.get("start")-o.get("start"));return n}static makeFeature(t){return new Pn(t)}async getRefNames(){return[...this.features.keys()]}async getRefNameAliases(){return Array.from(this.features.values()).map(t=>({refName:t[0].get("refName"),aliases:t[0].get("aliases")}))}getFeatures(t){const{refName:n,start:r,end:a}=t;return Ke(async o=>{const i=this.features.get(n)||[];for(let s=0;s<i.length;s++){const c=i[s];c.get("end")>r&&c.get("start")<a&&o.next(c)}o.complete()})}freeResources(){}}const r$=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"}));class a$ extends oa{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"features");this.features=oo.makeFeatures(a||[])}async getRegions(){const t=[];for(const[n,r]of this.features){let a;for(const o of r)a&&a.end>=o.get("start")&&a.start<=o.get("end")?a.end=o.get("end"):(a&&t.push(a),a={refName:n,start:o.get("start"),end:o.get("end")});a&&t.push(a)}return t.sort((n,r)=>n.refName.localeCompare(r.refName)),t}freeResources(){}}const o$=Object.freeze(Object.defineProperty({__proto__:null,default:a$},Symbol.toStringTag,{value:"Module"}));class i$ extends oo{getFeatures(t){return Ke(async n=>{const a=(await super.getFeatures(t).pipe(Rn()).toPromise())[0];n.next(new Pn({...a.toJSON(),uniqueId:`${a.id()}:${t.start}-${t.end}`,end:t.end,start:t.start,seq:a.get("seq").slice(Math.max(t.start-a.get("start"),0),Math.max(t.end-a.get("start"),0))})),n.complete()})}async getRegions(){const t=[];for(const[n,r]of this.features){let a;for(const o of r)a&&a.end>=o.get("start")&&a.start<=o.get("end")?a.end=o.get("end"):(a&&t.push(a),a={refName:n,start:o.get("start"),end:o.get("end")});a&&t.push(a)}return t}freeResources(){}}const s$=Object.freeze(Object.defineProperty({__proto__:null,default:i$},Symbol.toStringTag,{value:"Module"})),l$=C.ConfigurationSchema("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),c$=C.ConfigurationSchema("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),u$=C.ConfigurationSchema("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});class d$ extends oa{async getRefNameAliases(){const t=C.readConfObject(this.config,"location");if(t.uri===""||t.uri==="/path/to/my/aliases.txt")return[];const n=await Ce.openLocation(t).readFile("utf8"),r=C.readConfObject(this.config,"refNameColumn");return n.trim().split(`
`).filter(a=>!!a&&!a.startsWith("#")).map(a=>{const o=a.split("	"),[i]=o.splice(r,1);return{refName:i,aliases:o.filter(s=>!!s.trim())}})}async freeResources(){}}const f$=Object.freeze(Object.defineProperty({__proto__:null,default:d$},Symbol.toStringTag,{value:"Module"})),p$=C.ConfigurationSchema("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0}),g$="12px",zu='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',h$=ae()(e=>({error:{color:"red",fontSize:"0.8em"},callbackEditor:{fontFamily:zu,fontSize:g$,background:e.palette.background.default,width:800,marginTop:"16px",border:"1px solid rgba(0,0,0,0.42)"},callbackContainer:{width:"100%",overflowX:"auto"},textAreaFont:{fontFamily:zu}}));function m$({slot:e}){const{classes:t}=h$(),[n,r]=M.exports.useState(JSON.stringify(e.value,null,2)),[a,o]=M.exports.useState();return M.exports.useEffect(()=>{try{o(void 0),e.set(JSON.parse(n))}catch(i){console.error({e:i}),o(i)}},[n,e]),w(Z,{children:[a?l("p",{className:t.error,children:`${a}`}):null,w("div",{className:t.callbackContainer,children:[l(zr,{shrink:!0,htmlFor:"json-editor",children:e.name}),l(be,{id:"json-editor",className:t.callbackEditor,value:n,helperText:e.description,multiline:!0,onChange:i=>r(i.target.value),style:{background:a?"#fdd":void 0},InputProps:{classes:{input:t.textAreaFont}}})]})]})}const qu=j(m$),bc=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>EB),void 0));class y$ extends Gt{constructor(){super(...arguments),this.name="ConfigurationPlugin"}install(t){t.addAdapterType(()=>new je({name:"FromConfigAdapter",configSchema:l$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>r$),void 0).then(n=>n.default),adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})),t.addAdapterType(()=>new je({name:"FromConfigRegionsAdapter",configSchema:c$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>o$),void 0).then(n=>n.default),adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})),t.addAdapterType(()=>new je({name:"FromConfigSequenceAdapter",configSchema:u$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>s$),void 0).then(n=>n.default),adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})),t.addAdapterType(()=>new je({name:"RefNameAliasAdapter",configSchema:p$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>f$),void 0).then(n=>n.default),adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})),t.addWidgetType(()=>new tr({name:"ConfigurationEditorWidget",HeadingComponent:n$,configSchema:t$,stateModel:e$(t),ReactComponent:bc}))}}const bg=C.ConfigurationSchema("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:ze.baseConnectionConfig});async function b$(e){try{const t=await Ce.openLocation(e).readFile("utf8"),{HubFile:n}=await se(()=>import("./@gmod.89422c98.js").then(r=>r.i),["assets/@gmod.89422c98.js","assets/buffer.66f81d03.js","assets/base64-js.db0f5df9.js","assets/ieee754.6e84f04f.js","assets/abortable-promise-cache.7cb58d6d.js","assets/@babel.d3038ccc.js","assets/abortcontroller-polyfill.e0408538.js","assets/quick-lru.2e8f10dc.js","assets/pako.ae457f40.js","assets/buffer-crc32.64f36e84.js","assets/@jkbonfield.580cc4c5.js","assets/bzip2.7acc0326.js","assets/md5.e4ed9555.js","assets/crypt.894faad3.js","assets/charenc.26816e87.js","assets/is-buffer.30be6946.js","assets/long.81b4bfdc.js","assets/cross-fetch.5e5fd403.js","assets/generic-filehandle.a92b52fd.js","assets/object.entries-ponyfill.1bb02ccd.js","assets/binary-parser.62cc4542.js","assets/rxjs.bbb58625.js","assets/stream-browserify.c9806a5a.js","assets/readable-stream.b9ecb3ea.js","assets/inherits.0b103347.js","assets/string_decoder.54c7d31f.js","assets/safe-buffer.d6407320.js","assets/util-deprecate.7e67cde4.js"]);return new n(t)}catch(t){throw new Error(`Not a valid hub.txt file, got error: '${t}'`)}}async function v$(e){const t=await Ce.openLocation(e).readFile("utf8"),{GenomesFile:n}=await se(()=>import("./@gmod.89422c98.js").then(r=>r.i),["assets/@gmod.89422c98.js","assets/buffer.66f81d03.js","assets/base64-js.db0f5df9.js","assets/ieee754.6e84f04f.js","assets/abortable-promise-cache.7cb58d6d.js","assets/@babel.d3038ccc.js","assets/abortcontroller-polyfill.e0408538.js","assets/quick-lru.2e8f10dc.js","assets/pako.ae457f40.js","assets/buffer-crc32.64f36e84.js","assets/@jkbonfield.580cc4c5.js","assets/bzip2.7acc0326.js","assets/md5.e4ed9555.js","assets/crypt.894faad3.js","assets/charenc.26816e87.js","assets/is-buffer.30be6946.js","assets/long.81b4bfdc.js","assets/cross-fetch.5e5fd403.js","assets/generic-filehandle.a92b52fd.js","assets/object.entries-ponyfill.1bb02ccd.js","assets/binary-parser.62cc4542.js","assets/rxjs.bbb58625.js","assets/stream-browserify.c9806a5a.js","assets/readable-stream.b9ecb3ea.js","assets/inherits.0b103347.js","assets/string_decoder.54c7d31f.js","assets/safe-buffer.d6407320.js","assets/util-deprecate.7e67cde4.js"]);return new n(t)}async function w$(e){const t=await Ce.openLocation(e).readFile("utf8"),{TrackDbFile:n}=await se(()=>import("./@gmod.89422c98.js").then(r=>r.i),["assets/@gmod.89422c98.js","assets/buffer.66f81d03.js","assets/base64-js.db0f5df9.js","assets/ieee754.6e84f04f.js","assets/abortable-promise-cache.7cb58d6d.js","assets/@babel.d3038ccc.js","assets/abortcontroller-polyfill.e0408538.js","assets/quick-lru.2e8f10dc.js","assets/pako.ae457f40.js","assets/buffer-crc32.64f36e84.js","assets/@jkbonfield.580cc4c5.js","assets/bzip2.7acc0326.js","assets/md5.e4ed9555.js","assets/crypt.894faad3.js","assets/charenc.26816e87.js","assets/is-buffer.30be6946.js","assets/long.81b4bfdc.js","assets/cross-fetch.5e5fd403.js","assets/generic-filehandle.a92b52fd.js","assets/object.entries-ponyfill.1bb02ccd.js","assets/binary-parser.62cc4542.js","assets/rxjs.bbb58625.js","assets/stream-browserify.c9806a5a.js","assets/readable-stream.b9ecb3ea.js","assets/inherits.0b103347.js","assets/string_decoder.54c7d31f.js","assets/safe-buffer.d6407320.js","assets/util-deprecate.7e67cde4.js"]);return new n(t)}function S$(e,t,n,r){const a=[];return e.forEach((o,i)=>{const s=Array.from(o.keys()),c=["superTrack","compositeTrack","container","view"];if(s.some(g=>c.includes(g)))return;const u=[];let d=i;do d=e.get(d).get("parent"),d&&([d]=d.split(" "),u.push(e.get(d)));while(d);u.reverse();const f=u.map(g=>g.get("shortLabel")),p=C$(o,f,t,e,r);p.trackId=`ucsc-trackhub-${P.objectHash(p)}`,p.assemblyNames=[n],a.push(p)}),a}function C$(e,t,n,r,a){let o=e.get("type");o||(o=r.get(e.get("parent")).get("type"));let i=o.split(" ")[0];i==="bam"&&e.get("bigDataUrl").toLowerCase().endsWith("cram")&&(i="cram");let s;n.uri?s={uri:new URL(e.get("bigDataUrl"),n.uri).href,locationType:"UriLocation"}:s={localPath:e.get("bigDataUrl"),locationType:"LocalPathLocation"};let c;switch(i){case"bam":return n.uri?c=e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL(`${e.get("bigDataUrl")}.bai`,n.uri).href,locationType:"UriLocation"}:c=e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:`${e.get("bigDataUrl")}.bai`,locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:s,index:{location:c}}};case"bed":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"bed5FloatScore":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"bedGraph":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"bedRnaElements":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"bigBarChart":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s}};case"bigGenePred":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s}};case"bigChain":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s},renderer:{type:"SvgFeatureRenderer"}};case"bigInteract":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s},renderer:{type:"SvgFeatureRenderer"}};case"bigMaf":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s},renderer:{type:"SvgFeatureRenderer"}};case"bigPsl":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s},renderer:{type:"SvgFeatureRenderer"}};case"bigWig":return{type:"QuantitativeTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:s}};case"broadPeak":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"coloredExon":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"cram":return n.uri?c=e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL(`${e.get("bigDataUrl")}.crai`,n.uri).href,locationType:"UriLocation"}:c=e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:`${e.get("bigDataUrl")}.crai`,locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:s,craiLocation:c,sequenceAdapter:a}};case"gvf":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"ld2":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"narrowPeak":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"bigNarrowPeak":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:s}};case"peptideMapping":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"vcfTabix":return n.uri?c=e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL(`${e.get("bigDataUrl")}.tbi`,n.uri).href,locationType:"UriLocation"}:c=e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:`${e.get("bigDataUrl")}.tbi`,locationType:"LocalPathLocation"},{type:"VariantTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:s,index:{location:c}}};case"wig":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"wigMaf":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);case"hic":return{type:"HicTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:s}};case"halSnake":return Y.generateUnsupportedTrackConf(e.get("shortLabel"),i,t);default:return Y.generateUnknownTrackConf(e.get("shortLabel"),i,t)}}function _$(e){return k.compose("UCSCTrackHubConnection",ze.BaseConnectionModelFactory(e),k.model({configuration:C.ConfigurationReference(bg),type:k.literal("UCSCTrackHubConnection")}).actions(t=>({connect(){const n=C.getConf(t,"name"),r=C.getConf(t,"hubTxtLocation"),a=P.getSession(t);b$(r).then(o=>{const i=r.uri?{uri:new URL(o.get("genomesFile"),r.uri).href,locationType:"UriLocation"}:{localPath:o.get("genomesFile"),locationType:"LocalPathLocation"};return Promise.all([o,v$(i)])}).then(([o,i])=>{const s=[];for(const[c,u]of i){const d=C.getConf(t,"assemblyNames");if(d.length>0&&!d.includes(c))break;const f=a.assemblies.find(g=>C.readConfObject(g,"name")===c);if(!f)throw new Error(`Cannot find assembly for "${c}" from the genomes file for connection "${n}"`);const p=r.uri?{uri:new URL(u.get("trackDb"),new URL(o.get("genomesFile"),r.uri)).href,locationType:"UriLocation"}:{localPath:u.get("trackDb"),locationType:"LocalPathLocation"};s.push(Promise.all([p,w$(p),c,f]))}return Promise.all([...s])}).then(o=>{for(const[i,s,c,u]of o){const d=C.readConfObject(u,["sequence","adapter"]),f=S$(s,i,c,d);t.addTrackConfs(f)}}).catch(o=>{console.error(o),a.notify(`There was a problem connecting to the UCSC Track Hub "${t.name}". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "${o}"`,"error"),a.breakConnection(t.configuration)})}})))}function Vu(e=""){try{return new URL(e),!0}catch{return e.startsWith("/")}}function T$(e){return k.model("AddTrackModel",{id:ut.ElementId,type:k.literal("AddTrackWidget"),view:k.safeReference(e.pluggableMstType("view","stateModel"))}).volatile(()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0})).actions(t=>({setAdapterHint(n){t.adapterHint=n},setTrackSource(n){t.trackSource=n},setTextIndexingConf(n){t.textIndexingConf=n},setTextIndexTrack(n){t.textIndexTrack=n},setTrackData(n){t.trackData=n},setIndexTrackData(n){t.indexTrackData=n},setAssembly(n){t.altAssemblyName=n},setTrackName(n){t.altTrackName=n},setTrackType(n){t.altTrackType=n},clearData(){t.trackSource="",t.altTrackName="",t.altTrackType="",t.altAssemblyName="",t.adapterHint="",t.indexTrackData=void 0,t.trackData=void 0,t.textIndexingConf=void 0,t.textIndexTrack=!0}})).views(t=>({get trackAdapter(){const{trackData:n,indexTrackData:r,adapterHint:a}=t;return n?Y.guessAdapter(n,r,a,t):void 0},get trackName(){return t.altTrackName||(t.trackData?Y.getFileName(t.trackData):"")},get isFtp(){var n,r;const{trackData:a,indexTrackData:o}=t;return!!(((n=o==null?void 0:o.uri)===null||n===void 0?void 0:n.startsWith("ftp://"))||((r=a==null?void 0:a.uri)===null||r===void 0?void 0:r.startsWith("ftp://")))},get isRelativeTrackUrl(){var n;const r=(n=t.trackData)===null||n===void 0?void 0:n.uri;return r?!Vu(r):!1},get isRelativeIndexUrl(){var n;const r=(n=t.indexTrackData)===null||n===void 0?void 0:n.uri;return r?!Vu(r):!1},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var n,r;return(r=(n=t.trackData)===null||n===void 0?void 0:n.uri)===null||r===void 0?void 0:r.startsWith("http://")},get indexHttp(){var n,r;return(r=(n=t.indexTrackData)===null||n===void 0?void 0:n.uri)===null||r===void 0?void 0:r.startsWith("http://")},get wrongProtocol(){return window.location.protocol==="https:"&&(this.trackHttp||this.indexHttp)},get unsupported(){var n;return((n=this.trackAdapter)===null||n===void 0?void 0:n.type)===Y.UNSUPPORTED},get assembly(){var n;return t.altAssemblyName||((n=t.view.assemblyNames)===null||n===void 0?void 0:n[0])},get trackType(){return t.altTrackType||(this.trackAdapter?Y.guessTrackType(this.trackAdapter.type,t):"")}})).views(t=>({get warningMessage(){return t.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":t.isRelativeUrl?`Warning: one or more of your files do not provide the protocol e.g.
          https://, please provide an absolute URL unless you are sure a
          relative URL is intended.`:t.wrongProtocol?`Warning: You entered a http:// resources but we cannot access HTTP
          resources from JBrowse when it is running on https. Please use an
          https URL for your track, or access the JBrowse app from the http
          protocol`:""}}))}const x$=C.ConfigurationSchema("AddTrackWidget",{}),P$=k.model("AddConnectionModel",{id:ut.ElementId,type:k.literal("AddConnectionWidget")}),k$=C.ConfigurationSchema("AddConnectionWidget",{});function Ms(e=[],t=[]){return!!e.find(n=>t.includes(n))}function M$(e,t){const n=C.readConfObject(t,"category"),r=e.toLowerCase();return vg(t).toLowerCase().includes(r)||!!(n!=null&&n.filter(a=>a.toLowerCase().includes(r)).length)}function vg(e){if(!e.trackId)throw new Error("not a track");return C.readConfObject(e,"name")||`Reference sequence (${C.readConfObject(Ge(e),"displayName")||C.readConfObject(Ge(e),"name")})`}function Hu(e,t,n){const{assemblyManager:r}=P.getSession(t),{pluginManager:a}=He(t),o=r.get(n);if(!o)return[];const{allAliases:i}=o;return e.filter(s=>Ms(i,C.readConfObject(s,"assemblyNames"))).filter(s=>{const{displayTypes:c}=a.getViewType(t.view.type),u=c.map(f=>f.name),d=s.displays.map(f=>f.type);return Ms(u,d)})}function Wu(e,t,n){const r={children:[]},{filterText:a,view:o}=e;return t.filter(i=>M$(a,i)).forEach(i=>{const s=[...C.readConfObject(i,"category")||[]];i.trackId.endsWith("sessionTrack")&&s.unshift(" Session tracks");let c=r;for(let d=0;d<s.length;d++){const f=s[d],p=c.children.find(h=>h.name===f),g=s.slice(0,d+1).join(",");if(p)c=p;else{const h={children:[],name:f,id:g,isOpenByDefault:!n.get(g)};c.children.push(h),c=h}}const u=o.tracks;c.children.splice(c.children.findIndex(d=>d.children.length),0,{id:i.trackId,name:vg(i),conf:i,checked:!!u.find(d=>d.configuration===i),children:[]})}),r.children}function R$(e){return k.model("HierarchicalTrackSelectorWidget",{id:ut.ElementId,type:k.literal("HierarchicalTrackSelectorWidget"),collapsed:k.map(k.boolean),filterText:"",view:k.safeReference(e.pluggableMstType("view","stateModel"))}).volatile(()=>({selection:[]})).actions(t=>({addToSelection(n){t.selection=[...t.selection,...n]},removeFromSelection(n){t.selection=t.selection.filter(r=>!n.includes(r))},clearSelection(){t.selection=[]},setView(n){t.view=n},toggleCategory(n){t.collapsed.set(n,!t.collapsed.get(n))},clearFilterText(){t.filterText=""},setFilterText(n){t.filterText=n}})).views(t=>({getRefSeqTrackConf(n){const{assemblyManager:r}=P.getSession(t),a=r.get(n),o=a==null?void 0:a.configuration.sequence,i=e.getViewType(t.view.type);if(!!o){for(const s of o.displays)if(i.displayTypes.find(c=>c.name===s.type))return o}}})).views(t=>({trackConfigurations(n){if(!t.view)return[];const{tracks:r,assemblyManager:a}=P.getSession(t);if(!a.get(n))return[];const i=t.getRefSeqTrackConf(n);return(i?[i]:[]).concat([...Hu(r,t,n)])},get assemblyNames(){var n;return((n=t.view)===null||n===void 0?void 0:n.assemblyNames)||[]},connectionTrackConfigurations(n,r){return t.view?Hu(r.tracks,t,n):[]}})).views(t=>({hierarchy(n){const r=Wu(t,t.trackConfigurations(n),t.collapsed),a=P.getSession(t),{connectionInstances:o}=a,{assemblyManager:i}=P.getSession(t),s=i.get(n),c=s&&(o==null?void 0:o.filter(u=>Ms(s.allAliases,C.getConf(u,"assemblyNames"))).map(u=>({id:gt(u).configuration,name:C.getConf(u,"name"),children:this.connectionHierarchy(n,u),state:{expanded:!0}})))||[];return{name:"Root",id:"Root",children:[{name:"Tracks",id:"Tracks",children:r},...c]}},connectionHierarchy(n,r){return Wu(t,t.connectionTrackConfigurations(n,r),t.collapsed)}}))}const A$=C.ConfigurationSchema("HierarchicalTrackSelectorWidget",{});function E$(e){return k.model("PluginStoreModel",{id:ut.ElementId,type:k.literal("PluginStoreWidget"),filterText:"",view:k.safeReference(e.pluggableMstType("view","stateModel"))}).actions(t=>({clearFilterText(){t.filterText=""},setFilterText(n){t.filterText=n}}))}const $$=C.ConfigurationSchema("PluginStoreWidget",{}),D$=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>NB),void 0)),L$=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>GB),void 0));class N$ extends Gt{constructor(){super(...arguments),this.name="DataManagementPlugin",this.exports={AssemblyManager:L$,SetDefaultSession:D$}}install(t){t.addConnectionType(()=>new jf({name:"UCSCTrackHubConnection",configSchema:bg,stateModel:_$(t),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})),t.addWidgetType(()=>new tr({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:A$,stateModel:R$(t),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>cI),void 0))})),t.addWidgetType(()=>new tr({name:"AddTrackWidget",heading:"Add a track",configSchema:x$,stateModel:T$(t),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>MI),void 0))})),t.addWidgetType(()=>new tr({name:"AddConnectionWidget",heading:"Add a connection",configSchema:k$,stateModel:P$,ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>LI),void 0))})),t.addWidgetType(()=>new tr({name:"PluginStoreWidget",heading:"Plugin store",configSchema:$$,stateModel:E$(t),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>YI),void 0))}))}configure(t){}}const F$=C.ConfigurationSchema("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:C.ConfigurationSchema("Gff3TabixIndex",{indexType:{model:k.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),B$=C.ConfigurationSchema("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0});class I$ extends Gt{constructor(){super(...arguments),this.name="GFF3Plugin"}install(t){t.addAdapterType(()=>new je({name:"Gff3TabixAdapter",configSchema:F$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>QI),void 0).then(n=>n.default)})),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.gff3?\.b?gz$/i,s="Gff3TabixAdapter",c=Y.getFileName(r),u=a&&Y.getFileName(a);return i.test(c)||o===s?{type:s,bamLocation:r,gffGzLocation:r,index:{location:a||Y.makeIndex(r,".tbi"),indexType:Y.makeIndexType(u,"CSI","TBI")}}:n(r,a,o)}),t.addAdapterType(()=>new je({name:"Gff3Adapter",configSchema:B$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>tO),void 0).then(n=>n.default)})),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/\.gff3?$/i,s="Gff3Adapter",c=Y.getFileName(r),u={type:s,gffLocation:r};return i.test(c)&&!o||o===s?u:n(r,a,o)})}}const O$=C.ConfigurationSchema("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});class j${constructor(t){this.url=/\/$/.test(t.url)?t.url:`${t.url}/`}async readMeta(){const t=await this.loadFile("meta.json"),{compress:n,track_names:r}=t;return{hashHexCharacters:Math.ceil(t.hash_bits/4),compress:n,tracks:r}}async getHashHexCharacters(){return(await this.readMeta()).hashHexCharacters}async getCompress(){return(await this.readMeta()).compress}async getTrackNames(){return(await this.readMeta()).tracks}async get(t){return(await this.getBucket(t))[t]}async getBucket(t){const n=this.hash(t),r=await this.hexToDirPath(n);return this.loadFile(r)}async loadFile(t){const n=await fetch(`${this.url}${t}`);if(!n.ok)throw new Error(`HTTP ${n.status} ${n.statusText}`);return n.json()}async hexToDirPath(t){const n=await this.getHashHexCharacters();if(n){const r=await this.getCompress();for(;t.length<8;)t=`0${t}`;t=t.substr(8-n);const a=[];for(let o=0;o<t.length;o+=3)a.push(t.substring(o,o+3));return`${a.join("/")}.json${r?"z":""}`}return""}hash(t){return Ph(Cd.Buffer.from(t)).toString("hex").toLowerCase().replace("-","n")}}class z$ extends oa{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"namesIndexLocation");if(!a)throw new Error("must provide namesIndexLocation");this.httpMap=new j$({url:a.baseUri?new URL(a.uri,a.baseUri).href:a.uri})}async loadIndexFile(t){return this.httpMap.getBucket(t)}async searchIndex(t){const{searchType:n,queryString:r}=t,a=this.tracksNames||await this.httpMap.getTrackNames(),o=await this.loadIndexFile(r.toLowerCase());return o[r]?this.formatResults(o[r],a,n):[]}formatResults(t,n,r){return[...r==="exact"?[]:t.prefix.map(a=>new or({label:typeof a=="object"?a.name:a,matchedAttribute:"name",matchedObject:{result:a}})),...t.exact.map(a=>{const o=a[0],i=a[1],s=a[3],c=a[4],u=a[5],d=`${s||o}:${c}-${u}`;return new or({locString:d,label:o,matchedAttribute:"name",matchedObject:a,trackId:n[i]})})].filter(a=>a.getLabel()!=="too many matches")}freeResources(){}}const q$=C.ConfigurationSchema("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),wg=C.ConfigurationSchema("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:ze.baseConnectionConfig});function Uu(e){return e&&e.label&&typeof e.label=="string"}function V$(e){return e&&e.url&&typeof e.url=="string"}function vc(e,t){for(const n of Object.keys(t))n in e&&typeof t[n]=="object"&&typeof e[n]=="object"?vc(e[n],t[n]):(typeof e[n]>"u"||typeof t[n]<"u")&&(e[n]=t[n]);return e}function H$(e,t){return e.replace(/\{([\w\s.]+)\}/g,(n,r)=>{r=r.replace(/\s+/g,"");const a=xd(t,r);if(a!==void 0)return typeof a=="function"?a(r):a;if(t.callback){const o=t.callback.call(this,r);if(o!==void 0)return o}return n})}function Da(e){if(!e||typeof e!="object"||Object.prototype.toString.call(e)==="[object Function]")return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);let t,n,r;if(Array.isArray(e))for(t=[],n=0,r=e.length;n<r;++n)n in e&&(t[n]=Da(e[n]));else t=e.constructor?new e.constructor:{};return W$(t,e,Da)}function W$(e,t,n){let r,a;const o={};for(r in t)a=t[r],(!(r in e)||e[r]!==a&&(!(r in o)||o[r]!==a))&&(e[r]=n?n(a):a);return e}function U$(e,t){if(typeof e=="string"){let n;try{n=JSON.parse(e)}catch(r){throw new Error(`${r} when parsing configuration.`)}return Uo(n,t)}return Uo(e,t)}function G$(e,t){let n;try{n=X$(e,t)}catch(r){throw new Error(`${r} when parsing configuration.`)}return Uo(n,t)}function J$(e){return e==="include"}function X$(e,t){let n=[],r,a,o;const i={tracks:{}};let s;function c(){if(o!==void 0){let u;try{const d=o.match(/^json:(.+)/i);if(d?u=JSON.parse(d[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(o)?u=parseFloat(o.replace(/,/g,"")):u=o,!r)throw new Error(`Error parsing in section ${n.join(" - ")}`);const f=n.concat(r).join(".");if(a==="+="){let p=xd(i,f);p?Array.isArray(p)||(p=[p]):p=[],p.push(u),u=p}u==="true"&&(u=!0),u==="false"&&(u=!1),kh(i,f,u)}catch{throw new Error(`syntax error${t?` in ${t}`:""}${s?` at line ${s-1}`:""}`)}}}return e.split(`
`).forEach((u,d)=>{s=d+1;const f=u.replace(/^\s*#.+/,"");let p;(p=f.match(/^\s*\[([^\]]+)/))?(c(),r=void 0,o=void 0,n=p[1].trim().split(/\s*\.\s*/),n.length===1&&n[0].toLowerCase()==="general"&&(n=[])):(p=f.match(o===void 0?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/))?(c(),r=p[1].trim().split(/\s*\.\s*/),[,,a]=p,J$(n.concat(r).join("."))&&(a="+="),o=p[3].trim()):r!==void 0&&(p=f.match(/^\s{0,4}\+\s*(.+)/))?(c(),a="+=",o=p[1].trim()):o!==void 0&&(p=f.match(/^\s+(\S.*)/))?o+=o.length?` ${p[1].trim()}`:p[1].trim():(c(),r=void 0,o=void 0)}),c(),i}function Uo(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(Uu(e.tracks))e.tracks=[e.tracks];else{const r=[];for(const a of Object.keys(e.tracks)){const o=e.tracks[a];Uu(o)?r.push(o):r.push({label:a,...o})}e.tracks=r}const n=e.trackMetadata;if(n&&n.sources){if(typeof n.sources=="string"&&(n.sources=[n.sources]),V$(n.sources)&&(n.sources=[n.sources]),!Array.isArray(n.sources)){const r=[];for(const a of Object.keys(n.sources)){const o=n.sources[a];"name"in o||(o.name=a),r.push(o)}n.sources=r}n.sources=n.sources.map(r=>{if(typeof r=="string"){const a={url:r},o=r.match(/\.(\w+)$/);return o&&(a.type=o[1].toLowerCase()),a}return r})}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){const r=[];e.tracks&&r.push(...e.tracks),e.stores&&r.push(...Object.values(e.stores)),e.names&&r.push(e.names),r.forEach(a=>{a.baseUrl||(a.baseUrl=e.baseUrl||"/")}),e.refSeqs&&typeof e.refSeqs=="string"&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach(r=>{if(r.config){const o=r.config;delete r.config,r={...o,...r}}if(r.store)return;let a;r.type==="FeatureTrack"?a="JBrowse/View/Track/HTMLFeatures":r.type==="ImageTrack"?a="JBrowse/View/Track/FixedImage":r.type==="ImageTrack.Wiggle"?a="JBrowse/View/Track/FixedImage/Wiggle":r.type==="SequenceTrack"?a="JBrowse/View/Track/Sequence":a=Sg("JBrowse/View/Track",r.type),r.type=a,Gu(e,r),r.histograms&&(r.histograms.baseUrl||(r.histograms.baseUrl=r.baseUrl),Gu(e,r.histograms))}),e}function Sg(e,t){return t?(t.includes("/")||(t=`${e}/${t}`),t=t.replace(/^\//,""),t):""}function Y$(e,t){return e?e.type&&e.type.includes("/FixedImage")?`JBrowse/Store/TiledImage/Fixed${e.backendVersion===0?"_v0":""}`:/\.jsonz?$/i.test(t)?`JBrowse/Store/SeqFeature/NCList${e.backendVersion===0?"_v0":""}`:/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}function Gu(e,t){const{urlTemplate:n=""}=t;let r;if(t.storeClass?r=Sg("JBrowse/Store",t.storeClass):r=Y$(t,n),!r){console.warn(`Unable to determine an appropriate data store to use with track '${t.label}', please explicitly specify a storeClass in the configuration.`);return}const a={...t,type:r};(r==="JBrowse/Store/Sequence/StaticChunked"||r==="JBrowse/Store/Sequence/IndexedFasta"||r==="JBrowse/Store/SeqFeature/IndexedFasta"||r==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"||r==="JBrowse/Store/SeqFeature/TwoBit"||r==="JBrowse/Store/Sequence/TwoBit"||t.useAsRefSeqStore)&&!(e.stores&&e.stores.refseqs)?a.name="refseqs":a.name=`store${P.objectHash(a)}`,e.stores||(e.stores={}),e.stores[a.name]=a,t.store=a.name}function Ro(e){return e.uri!==void 0}function Ao(e){return e.localPath!==void 0}async function K$(e={uri:"",locationType:"UriLocation"},t={include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},n={uri:"",locationType:"UriLocation"}){const r="uri"in e?"uri":"localPath",a=JSON.parse(JSON.stringify(e));let o="";if(Ro(e)&&(o=e.uri),Ao(e)&&(o=e.localPath),o.endsWith("/")&&(a[r]=o.slice(0,o.length-1)),Ro(n)&&n.uri||Ao(n)&&n.localPath){const s="uri"in n?"uri":"localPath";let c="";Ro(n)&&(c=n.uri),Ao(n)&&(c=n.localPath),c.endsWith("/")&&(c=c.slice(0,c.length-1));let u={};for(const d of["jbrowse.conf","jbrowse_conf.json"]){let f=null;try{f=await Cg({[s]:`${c}/${d}`})}catch{console.error(`tried to access ${c}/${d}, but failed`)}u=La(u,f)||{}}return a[r]&&(u.dataRoot=a[r]),Ju(u)}const i=Uo(t,window.location.href);return a[r]&&(i.dataRoot=a[r]),Ju(i)}async function Ju(e,t=nD){const n=vc(Da(t),e);let r=await Z$(n);return r=La(r,e)||r,Go(r,r),rD(r),r}async function Cg(e){const t=await Ce.openLocation(e).readFile("utf8");return Ro(e)?cs(t,e.uri):Ao(e)?cs(t,e.localPath):cs(t)}function cs(e,t=""){return e.trim().startsWith("{")?U$(e,t):G$(e,t)}function La(e,t){if(t===null)return null;e===null&&(e={});for(const n of Object.keys(t))if(n==="tracks"&&n in e){const r=e[n]||[],a=t[n]||[];if(Array.isArray(r)&&Array.isArray(a))e[n]=Q$(r||[],a||[]);else throw new Error(`Track config has not been properly regularized: ${r} ${a}`)}else!tD(n)&&n in e&&typeof t[n]=="object"&&typeof e[n]=="object"?e[n]=vc(e[n],t[n]):n==="dataRoot"?(e[n]===void 0||e[n]==="data"&&t[n]!==void 0)&&(e[n]=t[n]):(e[n]===void 0||t[n]!==void 0)&&(e[n]=t[n]);return e}function Q$(e,t){if(!t.length)return e;const n={};return e.forEach((r,a)=>{r.index=a,n[r.label]=r}),t.forEach(r=>{const a=n[r.label];a?La(a,r):e.push(r)}),e}async function Z$(e){e=Da(e);async function t(n,r){const a=n.sourceUrl||n.baseUrl;if(!a)throw new Error(`Could not determine source URL: ${JSON.stringify(n)}`);const o=La(Da(r),n);if(!o)throw new Error("Problem merging configs");const i=Go(eD(n.include||[]),o);delete n.include;const s=i.map(async u=>{u.cacheBuster=e.cacheBuster;const d=await Cg({uri:new URL(u.url,a).href,locationType:"UriLocation"});return t(d,o)});return(await Promise.all(s)).forEach(u=>{n=La(n,u)||n}),n}return t(e,{})}function eD(e){return e?(Array.isArray(e)||(e=[e]),e.map(t=>(typeof t=="string"&&(t={url:t}),"format"in t||(t.format=t.url.endsWith(".conf")?"conf":"JB_json"),t.format==="JB_json"&&!("version"in t)&&(t.version=1),t))):[]}function Go(e,t){if(!e)return e;if(Array.isArray(e))for(let n=0;n<e.length;n+=1)e[n]=Go(e[n],t);else if(typeof e=="object"){const n=e;for(const r of Object.keys(n))n[r]=Go(n[r],t)}else if(typeof e=="string")return H$(e,t);return e}function tD(e){return e==="datasets"}const nD={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function rD(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}function aD(e,t,n){const r={trackId:P.objectHash(e),name:e.key||e.label},a=e.metadata&&(e.metadata.description||e.metadata.Description);a&&(r.description=a);const o=e.category||e.metadata&&e.metadata.category;r.category=o?o.split(/\s*\/\s*/):[];const{storeClass:i}=e;if(!e.urlTemplate){if(!(i&&i.endsWith("FromConfig"))){const u=e.key||e.label;return console.warn(`Could not import JBrowse1 track "${u}" because it does not have a "urlTemplate" or is not a "FromConfig" track`),Y.generateUnsupportedTrackConf(r.name,u,r.category)}return oD(e,r)}const s=u=>new URL(u,`${t}/`).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}"),c=s(e.urlTemplate);if(i){if(i==="JBrowse/Store/SeqFeature/BAM"){const u={type:"BamAdapter",bamLocation:{uri:c,locationType:"UriLocation"}};return e.baiUrlTemplate?u.index={location:{uri:s(e.baiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?u.index={location:{uri:s(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:u.index={location:{uri:`${c}.bai`,locationType:"UriLocation"}},{...r,type:"AlignmentsTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/CRAM"){const u={type:"CramAdapter",cramLocation:{uri:c,locationType:"UriLocation"},sequenceAdapter:n};return e.craiUrlTemplate?u.craiLocation={uri:s(e.craiUrlTemplate),locationType:"UriLocation"}:u.craiLocation={uri:`${c}.crai`,locationType:"UriLocation"},{...r,type:"AlignmentsTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/NCList")return{...r,type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:c,locationType:"UriLocation"}}};if(i==="JBrowse/Store/SeqFeature/BigWig"||i==="JBrowse/Store/BigWig")return e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density"),{...r,type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:c,locationType:"UriLocation"}}};if(i==="JBrowse/Store/SeqFeature/VCFTabix"){const u={type:"VcfTabixAdapter",vcfGzLocation:{uri:c,locationType:"UriLocation"}};return e.tbiUrlTemplate?u.index={location:{uri:s(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?u.index={location:{uri:s(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:u.index={location:{uri:`${c}.tbi`,locationType:"UriLocation"}},{...r,type:"VariantTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/VCFTribble")return Y.generateUnsupportedTrackConf(r.name,`VCFTribble (${c})`,r.category);if(i==="JBrowse/Store/SeqFeature/GFF3")return{...r,type:"FeatureTrack",adapter:{type:"Gff3Adapter",gffLocation:{uri:c,locationType:"UriLocation"}}};if(i==="JBrowse/Store/SeqFeature/BigBed")return{...r,type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:c,locationType:"UriLocation"}}};if(i==="JBrowse/Store/SeqFeature/GFF3Tabix"){const u={type:"Gff3TabixAdapter",gffGzLocation:{uri:c,locationType:"UriLocation"}};return e.tbiUrlTemplate?u.index={location:{uri:s(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?u.index={location:{uri:s(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:u.index={location:{uri:`${c}.tbi`,locationType:"UriLocation"}},{...r,type:"FeatureTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/BED")return Y.generateUnsupportedTrackConf(r.name,`BED (${c})`,r.category);if(i==="JBrowse/Store/SeqFeature/BEDTabix"){const u={type:"BedTabixAdapter",bedGzLocation:{uri:c,locationType:"UriLocation"}};return e.tbiUrlTemplate?u.index={location:{uri:s(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?u.index={location:{uri:s(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:u.index={location:{uri:`${c}.tbi`,locationType:"UriLocation"}},{...r,type:"FeatureTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/GTF")return{...r,type:"FeatureTrack",adapter:{type:"GtfAdapter",gtfLocation:{uri:c,locationType:"UriLocation"}}};if(i==="JBrowse/Store/SeqFeature/StaticChunked"||i==="JBrowse/Store/Sequence/StaticChunked")return Y.generateUnsupportedTrackConf(r.name,`StaticChunked (${c})`,r.category);if(i==="JBrowse/Store/SeqFeature/UnindexedFasta")return Y.generateUnsupportedTrackConf(r.name,`UnindexedFasta (${c})`,r.category);if(i==="JBrowse/Store/SeqFeature/IndexedFasta"){const u={type:"IndexedFastaAdapter",fastaLocation:{uri:c,locationType:"UriLocation"}};return e.faiUrlTemplate?u.faiLocation={uri:s(e.faiUrlTemplate),locationType:"UriLocation"}:u.faiLocation={uri:`${c}.fai`,locationType:"UriLocation"},{...r,type:"SequenceTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"){const u={type:"BgzipFastaAdapter",fastaLocation:{uri:c,locationType:"UriLocation"}};return e.faiUrlTemplate?u.faiLocation={uri:s(e.faiUrlTemplate),locationType:"UriLocation"}:u.faiLocation={uri:`${c}.fai`,locationType:"UriLocation"},e.gziUrlTemplate?u.gziLocation={uri:s(e.gziUrlTemplate),locationType:"UriLocation"}:u.gziLocation={uri:`${c}.gzi`,locationType:"UriLocation"},{...r,type:"ReferenceSequenceTrack",adapter:u}}if(i==="JBrowse/Store/SeqFeature/TwoBit")return{...r,type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:c,locationType:"UriLocation"}}}}if(r.adapter=Y.guessAdapter({uri:c,locationType:"UriLocation"},void 0,c),!r.adapter)throw new Error("Could not determine adapter");return r.adapter.type===Y.UNSUPPORTED?Y.generateUnsupportedTrackConf(r.name,c,r.category):r.adapter.type===Y.UNKNOWN?Y.generateUnknownTrackConf(r.name,c,r.category):(r.type=Y.guessTrackType(r.adapter.type),r.type==="QuantitativeTrack"&&(e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density")),r)}function oD(e,t){const r=(e.features||[]).map(a=>{const o=JSON.parse(JSON.stringify(a));return o.refName=a.seq_id,o.uniqueId=`${a.seq_id}:${a.start}-${a.end}:${a.name||""}`,o});return t.adapter={type:"FromConfigAdapter",features:r},t.type="FeatureTrack",t}function iD(e){return k.compose("JBrowse1Connection",ze.BaseConnectionModelFactory(e),k.model({configuration:C.ConfigurationReference(wg),type:k.literal("JBrowse1Connection")})).actions(t=>({connect(){const n=C.readConfObject(t.configuration,"dataDirLocation"),r=P.getSession(t);K$(n).then(a=>{var o;const i=C.readConfObject(t.configuration,"assemblyNames")[0];if(!i)throw new Error("assembly name required for JBrowse 1 connection");const s=r.assemblies.find(d=>C.readConfObject(d,"name")===i);if(!s)throw new Error(`Assembly "${i}" not found`);const c=C.readConfObject(s,["sequence","adapter"]),u=(o=a.tracks)===null||o===void 0?void 0:o.map(d=>{const f=aD(d,a.dataRoot||"",c);return f.assemblyNames=[i],f});t.setTrackConfs(u)}).catch(a=>{console.error(a),r.notify(`There was a problem connecting to the JBrowse 1 data directory "${t.name}". Please make sure you have entered a valid location. The error that was thrown is: "${a}"`,"error"),r.breakConnection(t.configuration)})}}))}class sD extends Gt{constructor(){super(...arguments),this.name="LegacyJBrowsePlugin"}install(t){t.addAdapterType(()=>new je({name:"NCListAdapter",configSchema:O$,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>oO),void 0).then(n=>n.default)})),t.addToExtensionPoint("Core-guessAdapterForLocation",n=>(r,a,o)=>{const i=/trackData.jsonz?$/i,s="NCListAdapter",c=Y.getFileName(r);return i.test(c)||o===s?{type:s,rootUrlTemplate:r}:n(r,a,o)}),t.addTextSearchAdapterType(()=>new qf({name:"JBrowse1TextSearchAdapter",configSchema:q$,AdapterClass:z$,description:"A JBrowse 1 text search adapter"})),t.addConnectionType(()=>new jf({name:"JBrowse1Connection",configSchema:wg,stateModel:iD(t),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"}))}}const lD=C.ConfigurationSchema("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0}),cD=e=>{e.addAdapterType(()=>new je({name:"TwoBitAdapter",configSchema:lD,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:()=>se(()=>Promise.resolve().then(()=>sO),void 0).then(t=>t.default)}))};function Xu(e){const{codonTable:t,seq:n,frame:r,bpPerPx:a,region:o,height:i,y:s,reverse:c=!1,theme:u}=e,d=a,f=3-o.start%3,p=(r+f+3)%3,g=n.slice(p),h=[];for(let T=0;T<g.length;T+=3){const x=g.slice(T,T+3),A=c?P.revcom(x):x,R=t[A]||"";h.push({letter:R,codon:A.toUpperCase()})}const m=1/d*3,y=o.start===0?0:m,b=1/a>=12,S=(o.end-o.start)/a,_=["#d8d8d8","#adadad","#8f8f8f"].reverse();return l(Z,{children:h.map((T,x)=>{const A=o.reversed?S-(m*(x+1)+p/d-y):m*x+p/d-y,{letter:R,codon:E}=T;return w(Z,{children:[l("rect",{x:A,y:s,width:b?m:m+.7,height:i,stroke:b?"#555":"none",fill:P.defaultStarts.includes(E)?u.palette.startCodon:P.defaultStops.includes(E)?u.palette.stopCodon:_[Math.abs(r)]}),b?l("text",{x:A+m/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle",children:R}):null]})})})}function Yu(e){const{bpPerPx:t,region:n,feature:r,theme:a,height:o,seq:i,y:s}=e,c=1/t>=12,[u,d]=P.bpSpanPx(r.get("start"),r.get("end"),n,t),f=n.reversed,p=r.get("end")-r.get("start"),g=Math.max((d-u)/p,.8);return l(Z,{children:i.split("").map((h,m)=>{const y=a.palette.bases[h.toUpperCase()],b=f?d-(m+1)*g:u+m*g;return w(Z,{children:[l("rect",{x:b,y:s,width:g,height:o,fill:y?y.main:"#aaa",stroke:c?"#555":"none"}),c?l("text",{x:b+g/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",fill:y?jl.contrastingTextColor(y.main):"black",children:h}):null]})})})}const uD=({regions:e,theme:t,features:n=new Map,showReverse:r,showForward:a,showTranslation:o,bpPerPx:i})=>{const[s]=e,c=Le.createJBrowseTheme(t),u=P.generateCodonTable(P.defaultCodonTable),d=20,[f]=[...n.values()];if(!f)return null;const p=f.get("seq");if(!p)return null;let g=-20;return w(Z,{children:[o&&(s.reversed?r:a)?[2,1,0].map(h=>l(Xu,{seq:p,y:g+=20,codonTable:u,frame:h,bpPerPx:i,region:s,theme:c,height:d,reverse:s.reversed},`translation-${h}`)):null,a?l(Yu,{height:d,y:g+=20,feature:f,region:s,seq:s.reversed?P.complement(p):p,bpPerPx:i,theme:c}):null,r?l(Yu,{height:d,y:g+=20,feature:f,region:s,seq:s.reversed?p:P.complement(p),bpPerPx:i,theme:c}):null,o&&(s.reversed?a:r)?[0,-1,-2].map(h=>l(Xu,{seq:p,y:g+=20,codonTable:u,frame:h,bpPerPx:i,region:s,theme:c,height:d,reverse:!s.reversed},`rev-translation-${h}`)):null]})},dD=({exportSVG:e,width:t,totalHeight:n,children:r})=>e?l(Z,{children:r}):l("svg",{"data-testid":"sequence_track",width:t,height:n,style:{width:t,height:n},children:r});function fD(e){const{regions:t,bpPerPx:n}=e,[r]=t,a=(r.end-r.start)/n;return l(dD,{...e,totalHeight:200,width:a,children:l(uD,{...e})})}const pD=j(fD),_g=C.ConfigurationSchema("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class gD extends rp{constructor(){super(...arguments),this.supportsSVG=!0}getExpandedRegion(t){return{...t,start:Math.max(t.start-3,0),end:t.end+3}}}const hD=e=>{e.addRendererType(()=>new gD({name:"DivSequenceRenderer",ReactComponent:pD,configSchema:_g,pluginManager:e}))},mD=C.ConfigurationSchema("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0}),yD=e=>{e.addAdapterType(()=>new je({name:"BgzipFastaAdapter",configSchema:mD,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:()=>se(()=>Promise.resolve().then(()=>uO),void 0).then(t=>t.default)}))},bD=C.ConfigurationSchema("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0}),vD=e=>{e.addAdapterType(()=>new je({name:"ChromSizesAdapter",configSchema:bD,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:()=>se(()=>Promise.resolve().then(()=>fO),void 0).then(t=>t.default)}))},wD=C.ConfigurationSchema("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0}),SD=e=>{e.addAdapterType(()=>new je({name:"IndexedFastaAdapter",configSchema:wD,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:()=>se(()=>Promise.resolve().then(()=>lO),void 0).then(t=>t.default)}))},CD=e=>C.ConfigurationSchema("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0}),_D=e=>{e.addAdapterType(()=>new je({name:"GCContentAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},configSchema:CD(e),getAdapterClass:()=>se(()=>Promise.resolve().then(()=>pO),void 0).then(t=>t.default)}))},TD=C.ConfigurationSchema("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),xD=e=>{e.addAdapterType(()=>new je({name:"SequenceSearchAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},configSchema:TD,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>hO),void 0).then(t=>t.default)}))};function PD(e){return C.ConfigurationSchema("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:k.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:"optional track name",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:t=>{const n=JSON.parse(JSON.stringify(t)),r=new Set,{displays:a=[]}=n;return n.trackId!=="placeholderId"&&(a.forEach(i=>i&&r.add(i.type)),e.getTrackType(n.type).displayTypes.forEach(i=>{r.has(i.name)||a.push({displayId:`${n.trackId}-${i.name}`,type:i.name})})),{...n,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:t=>({addDisplayConf(n){const{type:r}=n;if(!r)throw new Error(`unknown display type ${r}`);const a=t.displays.find(i=>i&&i.displayId===n.displayId);if(a)return a;const o=t.displays.push(n);return t.displays[o-1]}})})}const kD=e=>{e.addTrackType(()=>{const t=PD(e);return new lr({name:"ReferenceSequenceTrack",configSchema:t,stateModel:ze.createBaseTrackModel(e,"ReferenceSequenceTrack",t)})})},Ku=C.ConfigurationSchema("LinearReferenceSequenceDisplay",{renderer:_g},{explicitIdentifier:"displayId",explicitlyTyped:!0});function MD(e){return k.compose("LinearReferenceSequenceDisplay",Cr,k.model({type:k.literal("LinearReferenceSequenceDisplay"),configuration:C.ConfigurationReference(e),showForward:k.optional(k.boolean,!0),showReverse:k.optional(k.boolean,!0),showTranslation:k.optional(k.boolean,!0),height:180})).views(t=>{const{renderProps:n}=t;return{renderProps(){const{showForward:r,showReverse:a,showTranslation:o}=t;return{...n(),rpcDriverName:t.rpcDriverName,config:t.configuration.renderer,showForward:r,showReverse:a,showTranslation:o}},regionCannotBeRendered(){const r=P.getContainingView(t);if(r&&r.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return t.configuration.renderer.type}}}).actions(t=>({toggleShowForward(){t.showForward=!t.showForward},toggleShowReverse(){t.showReverse=!t.showReverse},toggleShowTranslation(){t.showTranslation=!t.showTranslation}})).views(t=>({trackMenuItems(){return[{label:"Show forward",type:"checkbox",checked:t.showForward,onClick:()=>{t.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:t.showReverse,onClick:()=>{t.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:t.showTranslation,onClick:()=>{t.toggleShowTranslation()}}]}}))}const RD=e=>{e.addDisplayType(()=>{const t=MD(Ku);return{name:"LinearReferenceSequenceDisplay",configSchema:Ku,stateModel:t,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:Vn}})},AD=e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",t=>(n,r,a)=>{const o=/\.2bit$/i,i="TwoBitAdapter",s=Y.getFileName(n),c={type:i,twoBitLocation:n};return o.test(s)&&!a||a===i?c:t(n,r,a)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",t=>n=>n==="TwoBitAdapter"?"ReferenceSequenceTrack":t(n)),e.addToExtensionPoint("Core-guessAdapterForLocation",t=>(n,r,a)=>{const o=/\.(fa|fasta|fas|fna|mfa)$/i,i="IndexedFastaAdapter",s=Y.getFileName(n),c={type:i,fastaLocation:n,faiLocation:r||Y.makeIndex(n,".fai")};return o.test(s)&&!a||a===i?c:t(n,r,a)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",t=>n=>n==="IndexedFastaAdapter"?"ReferenceSequenceTrack":t(n)),e.addToExtensionPoint("Core-guessAdapterForLocation",t=>(n,r,a)=>{const o=/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i,i="BgzipFastaAdapter",s=Y.getFileName(n),c={type:i,faiLocation:Y.makeIndex(n,".fai"),gziLocation:Y.makeIndex(n,".gzi")};return o.test(s)&&!a||a===i?c:t(n,r,a)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",t=>n=>n==="BgzipFastaAdapter"?"ReferenceSequenceTrack":t(n))};class ED extends Gt{constructor(){super(...arguments),this.name="SequencePlugin"}install(t){hD(t),cD(t),yD(t),vD(t),SD(t),_D(t),xD(t),kD(t),RD(t),AD(t)}}const Qu=j(({text:e,x:t,y:n,region:r,reversed:a,bpPerPx:o,exportSVG:i,feature:s,viewParams:c,color:u="black",fontHeight:d=13,featureWidth:f=0,allowedWidthExpansion:p=0,displayModel:g={}})=>{const h=f+p,m=P.measureText(e,d),y=hs(g)&&Ye(g)?P.getViewParams(g):c,b=a?y.end:y.start,[S,_]=M.exports.useState(i);if(M.exports.useEffect(()=>{_(!0)},[]),hs(r)&&!Ye(r))return null;const T=r.start,x=r.end,A=s.get("start"),R=s.get("end"),E=m*o;return b<x&&b>T&&A<b&&b+E<R?t=y.offsetPx:A<b&&b+E<R&&b+E>T&&b+E<x&&(t=y.offsetPx1),S?l("text",{x:t,y:n+d,fill:u,fontSize:d,children:m>h?`${e.slice(0,h/(d*.6))}...`:e}):null});function $D(e){var t,n,r,a;const{feature:o,rootLayout:i,config:s,name:c,description:u,shouldShowName:d,shouldShowDescription:f}=e,p=i.getSubRecord(String(o.id()));if(!p)return null;const{GlyphComponent:g}=p.data||{};return w("g",{children:[l(g,{featureLayout:p,...e}),d?l(Qu,{text:c,x:((t=i.getSubRecord("nameLabel"))===null||t===void 0?void 0:t.absolute.left)||0,y:((n=i.getSubRecord("nameLabel"))===null||n===void 0?void 0:n.absolute.top)||0,color:C.readConfObject(s,["labels","nameColor"],{feature:o}),featureWidth:p.width,...e}):null,f?l(Qu,{text:u,x:((r=i.getSubRecord("descriptionLabel"))===null||r===void 0?void 0:r.absolute.left)||0,y:((a=i.getSubRecord("descriptionLabel"))===null||a===void 0?void 0:a.absolute.top)||0,color:C.readConfObject(s,["labels","descriptionColor"],{feature:o}),featureWidth:p.width,...e}):null]})}const DD=j($D);function Zu({rect:e,region:t,bpPerPx:n,...r}){if(!e)return null;const[a,o,i,s]=e,[c,u]=P.bpSpanPx(a,i,t,n),d=Math.round(o),f=(t.end-t.start)/n,p=Math.round(s-o),g=u-c;if(c+g<0)return null;const h=Math.max(c,0),m=h-c,y=Math.max(1,Math.min(g-m,f));return l("rect",{x:h-2,y:d-2,width:y+4,height:p+4,...r})}function LD({displayModel:e={},blockKey:t,region:n,bpPerPx:r,movedDuringLastMouseDown:a,...o}){var i,s;const{selectedFeatureId:c,featureIdUnderMouse:u,contextMenuFeature:d}=e,f=u||(d==null?void 0:d.id());function p(x){const{onFeatureMouseDown:A}=o;if(!!(A&&f))return A(x,f)}function g(x){const{onFeatureMouseEnter:A}=o;if(!!(A&&f))return A(x,f)}function h(x){const{onFeatureMouseOut:A}=o;if(!!(A&&f))return A(x,f)}function m(x){const{onFeatureMouseOver:A}=o;if(!!(A&&f))return A(x,f)}function y(x){const{onFeatureMouseUp:A}=o;if(!!(A&&f))return A(x,f)}function b(x){const{onFeatureMouseLeave:A}=o;if(!!(A&&f))return A(x,f)}function S(x){const{onFeatureMouseMove:A}=o;if(!!(A&&f))return A(x,f)}function _(x){if(a)return;const{onFeatureClick:A}=o;if(!!(A&&f))return x.stopPropagation(),A(x,f)}function T(x){const{onFeatureContextMenu:A}=o;if(!!(A&&f))return A(x,f)}return w(Z,{children:[f?l(Zu,{rect:(i=e.getFeatureByID)===null||i===void 0?void 0:i.call(e,t,f),region:n,bpPerPx:r,fill:"#000",fillOpacity:"0.2",onMouseDown:p,onMouseEnter:g,onMouseOut:h,onMouseOver:m,onMouseUp:y,onMouseLeave:b,onMouseMove:S,onClick:_,onContextMenu:T,onFocus:m,onBlur:h,"data-testid":f}):null,c?l(Zu,{rect:(s=e.getFeatureByID)===null||s===void 0?void 0:s.call(e,t,c),region:n,bpPerPx:r,stroke:"#00b8ff",fill:"none"}):null]})}const ND=j(LD),FD=({feature:e,featureLayout:t,config:n,region:r})=>{const a=e.get("strand"),o=5,i=r.reversed?-1:1,s=7*a*i,{left:c=0,top:u=0,width:d=0,height:f=0}=t.absolute,p=C.readConfObject(n,"color2",{feature:e}),g=a*i===-1?c:a*i===1?c+d:null,h=u+f/2;return g?w(Z,{children:[l("line",{x1:g,x2:g+s,y1:h,y2:h,stroke:p}),l("polygon",{points:[[g+s/2,h-o/2],[g+s/2,h+o/2],[g+s,h]].toString(),stroke:p})]}):null},Tg=j(FD),ed=.65;function BD(e){const{feature:t,region:n,config:r,featureLayout:a,bpPerPx:o,topLevel:i}=e,{start:s,end:c}=n,u=(c-s)/o,d=(t.get("end")-t.get("start"))/o,{left:f=0}=a.absolute;let{top:p=0,height:g=0}=a.absolute;if(f+d<0)return null;td(t)&&(p+=(1-ed)/2*g,g*=ed);const h=Math.max(f,0),m=h-f,y=Math.max(2,Math.min(d-m,u));return t.parent()&&t.get("type")==="intron"?null:w(Z,{children:[i?l(Tg,{...e}):null,l("rect",{"data-testid":`box-${t.id()}`,x:h,y:p,width:y,height:g,fill:td(t)?C.readConfObject(r,"color3",{feature:t}):C.readConfObject(r,"color1",{feature:t}),stroke:C.readConfObject(r,"outline",{feature:t})})]})}const xg=j(BD);function ID(e){const{feature:t,featureLayout:n,selected:r,config:a,subfeatures:o=t.get("subfeatures")}=e,i=C.readConfObject(a,"color2",{feature:t}),{left:s=0,top:c=0,width:u=0,height:d=0}=n.absolute,f=c+d/2;return w(Z,{children:[l("line",{"data-testid":t.id(),x1:s,y1:f,y2:f,x2:s+u,stroke:i}),o==null?void 0:o.map(p=>{const g=String(p.id()),h=n.getSubRecord(g);if(!h)return null;const{GlyphComponent:m}=h.data||{};return l(m,{...e,feature:p,topLevel:!1,featureLayout:h,selected:r},`glyph-${g}`)}),l(Tg,{...e})]})}const Pg=j(ID);function kg(e){const{feature:t,config:n}=e,r=Rg(t,n);return l(Pg,{...e,subfeatures:r})}function OD(e="subParts",t){let n=C.readConfObject(t,e);return typeof n=="string"&&(n=n.split(/\s*,\s*/)),r=>n.map(a=>a.toLowerCase()).includes(r.get("type").toLowerCase())}function jD(e,t){return OD("subParts",t)(e)}function Mg(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function zD(e,t){const n=[...t];let r=1/0,a=-1/0,o,i;const s=[];for(let f=0;f<n.length;f++){const p=n[f].get("type");/^cds/i.test(p)?(r>n[f].get("start")&&(r=n[f].get("start")),a<n[f].get("end")&&(a=n[f].get("end"))):/exon/i.test(p)?s.push(n[f]):Mg(n[f])&&(o=n[f].get("start")===e.get("start"),i=n[f].get("end")===e.get("end"))}if(!(s.length&&r<1/0&&a>-1/0))return n;s.sort((f,p)=>f.get("start")-p.get("start"));const c=e.get("strand");let u,d;if(!o)for(let f=0;f<s.length&&(u=s[f].get("start"),!(u>=r));f++){d=r>s[f].get("end")?s[f].get("end"):r;const p=c>=0?"five_prime_UTR":"three_prime_UTR";n.unshift(new P.SimpleFeature({parent:e,id:`${e.id()}_${p}_${f}`,data:{start:u,end:d,strand:c,type:p}}))}if(!i)for(let f=s.length-1;f>=0&&(d=s[f].get("end"),!(d<=a));f--){u=a<s[f].get("start")?s[f].get("start"):a;const p=c>=0?"three_prime_UTR":"five_prime_UTR";n.push(new P.SimpleFeature({parent:e,id:`${e.id()}_${p}_${f}`,data:{start:u,end:d,strand:c,type:p}}))}return n}function Rg(e,t){let n=e.get("subfeatures");if(!n||!n.length)return[];const r=!!n.find(i=>Mg(i)),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||C.readConfObject(t,"impliedUTRs"))&&(n=zD(e,n)),n.filter(i=>jD(i,t))}kg.layOut=({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o})=>{const i=Sc({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),s=Rg(t,a);return Eg({layout:i,subfeatures:s,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),i};const qD=j(kg);function Ag(e){var t;const{feature:n,featureLayout:r,selected:a}=e;return l(Z,{children:(t=n.get("subfeatures"))===null||t===void 0?void 0:t.map(o=>{const i=String(o.id()),s=r.getSubRecord(i);if(!s)return null;const{GlyphComponent:c}=s.data||{};return l(c,{...e,feature:o,featureLayout:s,selected:a},`glyph-${i}`)})})}Ag.layOut=({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o})=>{var i;const s=Sc({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),c=C.readConfObject(a,"displayMode");if(c!=="reducedRepresentation"){let u=0;(i=t.get("subfeatures"))===null||i===void 0||i.forEach(d=>{const f=Mi(d,o),p=C.readConfObject(a,"height",{feature:d});(f.layOut||wc)({layout:s,feature:d,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}).move(0,u),u+=c==="collapse"?0:(c==="compact"?p/3:p)+2})}return s};const VD=j(Ag);function Mi(e,t){var n;const r=e.get("type"),a=e.get("subfeatures");if(a&&r!=="CDS"){const o=a.find(i=>!!i.get("subfeatures"));return["mRNA","transcript","primary_transcript"].includes(r)&&a.find(i=>i.get("type")==="CDS")?qD:!e.parent()&&o?VD:Pg}return((n=t==null?void 0:t.find(o=>o.validator(e)))===null||n===void 0?void 0:n.glyph)||xg}function wc({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}){const i=C.readConfObject(a,"displayMode"),s=Sc({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o});return i!=="reducedRepresentation"&&Eg({layout:s,subfeatures:t.get("subfeatures")||[],bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),s}function Sc(e){const{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e,s=C.readConfObject(o,"displayMode"),c=s==="reducedRepresentation"?xg:Mi(n,i),u=n.parent();let d=0;u&&(d=(a?u.get("end")-n.get("end"):n.get("start")-u.get("start"))/r);const f=C.readConfObject(o,"height",{feature:n}),p=(n.get("end")-n.get("start"))/r,g=t.parent,h=g?g.top:0;return t.addChild(String(n.id()),d,s==="collapse"?0:h,Math.max(p,1),s==="compact"?f/2:f,{GlyphComponent:c})}function Eg(e){const{layout:t,subfeatures:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e;n.forEach(s=>{(Mi(s,i).layOut||wc)({layout:t,feature:s,bpPerPx:r,reversed:a,config:o,extraGlyphs:i})})}function td(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}const HD=2,nd=2,WD=100;function UD(e){const{feature:t,detectRerender:n,bpPerPx:r,region:a,config:o,displayMode:i,layout:s,extraGlyphs:c}=e;n==null||n();const{reversed:u}=a,d=t.get(u?"end":"start"),f=P.bpToPx(d,a,r),p=i!=="compact"&&i!=="collapsed",g=new zl.SceneGraph("root",0,0,0,0),m=(Mi(t,c).layOut||wc)({layout:g,feature:t,bpPerPx:r,reversed:u,config:o,extraGlyphs:c});let y=!1,b=!1,S="",_="",T=0,x=0;if(p){const R=C.readConfObject(o,"showLabels"),E=C.readConfObject(o,"showDescriptions");T=C.readConfObject(o,["labels","fontSize"],{feature:t}),x=C.readConfObject(o,"maxFeatureGlyphExpansion")||0,S=String(C.readConfObject(o,["labels","name"],{feature:t})||""),y=/\S/.test(S)&&R;const $=B=>{const F=g.width+x,I=P.measureText(B,T);return Math.round(Math.min(I,F))+HD};if(_=String(C.readConfObject(o,["labels","description"],{feature:t})||""),b=/\S/.test(_)&&R&&E,y&&g.addChild("nameLabel",0,m.bottom+nd,$(S),T),b){const B=y?g.getSubRecord("nameLabel"):m;g.addChild("descriptionLabel",0,B.bottom+nd,$(_),T)}}const A=s.addRect(t.id(),t.get("start"),t.get("start")+g.width*r,g.height);return A===null?null:(g.move(f,A),l(DD,{rootLayout:g,name:S,shouldShowName:y,description:_,shouldShowDescription:b,fontHeight:T,allowedWidthExpansion:x,reversed:a.reversed,topLevel:!0,...e}))}const rd=j(e=>{const{features:t=new Map,isFeatureDisplayed:n}=e;return l(Z,{children:[...t.values()].filter(r=>n?n(r):!0).map(r=>l(UD,{feature:r,...e},r.id()))})});function GD(e){const{layout:t,blockKey:n,regions:r,bpPerPx:a,config:o,displayModel:i={},exportSVG:s,featureDisplayHandler:c,onMouseOut:u,onMouseDown:d,onMouseLeave:f,onMouseEnter:p,onMouseOver:g,onMouseMove:h,onMouseUp:m,onClick:y}=e,[b]=r||[],S=(b.end-b.start)/a,_=C.readConfObject(o,"displayMode"),T=M.exports.useRef(null),[x,A]=M.exports.useState(!1),[R,E]=M.exports.useState(0),[$,B]=M.exports.useState(!1),F=M.exports.useCallback(G=>(A(!0),B(!1),d==null?void 0:d(G)),[d]),I=M.exports.useCallback(G=>(A(!1),m==null?void 0:m(G)),[m]),U=M.exports.useCallback(G=>{var q;if(!T.current)return;x&&B(!0);const{left:J,top:Q}=T.current.getBoundingClientRect(),H=G.clientX-J,ce=G.clientY-Q,le=b.reversed?S-H:H,re=b.start+a*le,ve=(q=i.getFeatureOverlapping)===null||q===void 0?void 0:q.call(i,n,re,ce);h&&h(G,ve)},[n,a,x,h,b.reversed,b.start,i,S]),z=M.exports.useCallback(G=>{$||y==null||y(G)},[$,y]);return M.exports.useEffect(()=>{E(t.getTotalHeight())},[t]),s?l(rd,{displayMode:_,isFeatureDisplayed:c,region:b,...e}):w("svg",{ref:T,"data-testid":"svgfeatures",width:S,height:R+WD,onMouseDown:F,onMouseUp:I,onMouseEnter:p,onMouseLeave:f,onMouseOver:g,onMouseOut:u,onMouseMove:U,onClick:z,children:[l(rd,{displayMode:_,region:b,movedDuringLastMouseDown:$,isFeatureDisplayed:c,...e}),l(ND,{...e,region:b,movedDuringLastMouseDown:$})]})}const JD=j(GD),XD=C.ConfigurationSchema("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"black",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:C.ConfigurationSchema("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"black",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:k.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0});class YD extends ip{constructor(){super(...arguments),this.supportsSVG=!0}}class KD extends Gt{constructor(){super(...arguments),this.name="SVGPlugin"}install(t){t.addRendererType(()=>new YD({name:"SvgFeatureRenderer",ReactComponent:JD,configSchema:XD,pluginManager:t}))}}const QD=C.ConfigurationSchema("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),ZD=e=>{e.addAdapterType(()=>new je({name:"VcfAdapter",configSchema:QD,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>bO),void 0).then(t=>t.default)}))},eL=C.ConfigurationSchema("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:C.ConfigurationSchema("VcfIndex",{indexType:{model:k.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0}),tL=e=>{e.addAdapterType(()=>new je({name:"VcfTabixAdapter",configSchema:eL,getAdapterClass:()=>se(()=>Promise.resolve().then(()=>wO),void 0).then(t=>t.default)}))},nL=e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",t=>(n,r,a)=>{const o=/\.vcf\.b?gz$/i,i="VcfTabixAdapter",s=Y.getFileName(n),c=r&&Y.getFileName(r),u={type:i,vcfGzLocation:n,index:{location:r||Y.makeIndex(n,".tbi"),indexType:Y.makeIndexType(c,"CSI","TBI")}};return o.test(s)&&!a||a===i?u:t(n,r,a)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",t=>n=>n==="VcfTabixAdapter"||n==="VcfAdapter"?"VariantTrack":t(n)),e.addToExtensionPoint("Core-guessAdapterForLocation",t=>(n,r,a)=>{const o=/\.vcf$/i,i="VcfAdapter",s=Y.getFileName(n);return o.test(s)||a===i?{type:i,vcfLocation:n}:t(n,r,a)})},rL=e=>{e.addTrackType(()=>{const t=C.ConfigurationSchema("VariantTrack",{},{baseConfiguration:ze.createBaseTrackConfig(e)});return new lr({name:"VariantTrack",configSchema:t,stateModel:ze.createBaseTrackModel(e,"VariantTrack",t)})})},aL=ae()(e=>{const{primary:r,secondary:a,tertiary:o,quaternary:i}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:`$dash ${1.4}s ease-in-out infinite, $colors ${1.4*4}s ease-in-out infinite`},"@keyframes colors":{"0%":{stroke:r.light},"25%":{stroke:a.light},"50%":{stroke:o.light},"75%":{stroke:i.light},"100%":{stroke:r.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:2/4,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}),oL=j(({model:{renderProps:{radius:e}}})=>{const{classes:t}=aL(),[n,r]=M.exports.useState(!1);return M.exports.useEffect(()=>{const a=setTimeout(()=>r(!0),400);return()=>clearTimeout(a)}),n?w("g",{children:[l("defs",{children:l("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:l("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),l("circle",{cx:"0",cy:"0",r:e,fill:"#f1f1f1"}),l("circle",{cx:"0",cy:"0",r:e,fill:"url(#diagonalHatch)"}),l("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading\u2026"}),l("circle",{className:t.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null}),iL=j(({model:e})=>{const{renderProps:{radius:t},error:n}=e;return w("g",{children:[l("defs",{children:l("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:l("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),l("circle",{cx:"0",cy:"0",r:t,fill:"#ffb4b4"}),l("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),l("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(n)})]})});function sL({model:e}){const{data:t,html:n,filled:r,renderingComponent:a}=e,o=M.exports.useRef(null);return M.exports.useEffect(()=>{const i=o.current;function s(){i&&r&&(i.innerHTML&&(i.style.display="none",xa.exports.unmountComponentAtNode(i)),i.style.outline="none",i.innerHTML=n,P.rIC(()=>{if(!Ye(e))return;const c=$t.createElement(a,{...t,...e.renderProps()},null);P.rIC(()=>{!Ye(e)||xa.exports.hydrate(c,i)})}))}return s(),()=>{i&&xa.exports.unmountComponentAtNode(i)}}),l("g",{ref:o})}const lL=j(sL);function cL({display:e}){return e.error?l(iL,{model:e}):e.filled?l(lL,{model:e}):l(oL,{model:e})}const uL=j(cL);function dL(e){var t;const n=P.getContainingView(e),{rendererType:r}=e,{rpcManager:a}=P.getSession(n);return{rendererType:r,rpcManager:a,renderProps:e.renderProps(),renderArgs:{assemblyName:(t=n.displayedRegions[0])===null||t===void 0?void 0:t.assemblyName,adapterConfig:JSON.parse(JSON.stringify(e.adapterConfig)),rendererType:r.name,regions:JSON.parse(JSON.stringify(n.displayedRegions)),blockDefinitions:e.blockDefinitions,sessionId:Y.getRpcSessionId(e),timeout:1e6}}}async function fL(e,t,n){if(!e)throw new Error("cannot render with no props");const{rendererType:r,rpcManager:a,cannotBeRenderedReason:o,renderArgs:i,renderProps:s}=e;if(o)return{message:o};if(!e.renderProps.radius||!e.renderArgs.regions||!e.renderArgs.regions.length)return{message:"Skipping render"};if(!n.isCompatibleWithRenderer(r))throw new Error(`renderer ${r.name} is not compatible with this display type`);const{html:c,...u}=await r.renderInClient(a,{...i,...s,signal:t});return{html:c,data:u,renderingComponent:r.ReactComponent}}const pL=k.compose("BaseChordDisplay",ze.BaseDisplay,k.model({bezierRadiusRatio:.1,assemblyName:k.maybe(k.string)})).volatile(()=>({filled:!1,reactElement:void 0,data:void 0,message:"",renderingComponent:void 0,refNameMap:void 0})).actions(e=>{const{pluginManager:t}=He(e),n=e;return{onChordClick(r){C.getConf(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}}).views(e=>({get blockDefinitions(){const t=P.getContainingView(e).staticSlices;if(!e.refNameMap)return t;const n=JSON.parse(JSON.stringify(t));return n.forEach(r=>{(r.region.elided?r.region.regions:[r.region]).forEach(o=>{var i;const s=(i=e.refNameMap)===null||i===void 0?void 0:i[o.refName];s&&o.refName!==s&&(o.refName=s)})}),n},renderProps(){const t=P.getContainingView(e);return{...Y.getParentRenderProps(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){const t=e,{pluginManager:n}=He(e),r=n.getRendererType(e.rendererTypeName);if(!r)throw new Error(`renderer "${t.rendererTypeName}" not found`);if(!r.ReactComponent)throw new Error(`renderer ${t.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`);return r},isCompatibleWithRenderer(t){return t instanceof sp},get selectedFeatureId(){if(!Ye(e))return;const t=P.getSession(e);if(!t)return;const{selection:n}=t;if(tl(n))return n.id()}})).actions(e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:n,reactElement:r,renderingComponent:a}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=r,e.data=n,e.error=void 0,e.renderingComponent=a)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}})).actions(e=>({afterAttach(){P.makeAbortableReaction(e,dL,fL,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),P.makeAbortableReaction(e,()=>({assemblyNames:Y.getTrackAssemblyNames(e.parentTrack),adapter:C.getConf(Ge(e,2),"adapter"),assemblyManager:P.getSession(e).assemblyManager}),async({assemblyNames:t,adapter:n,assemblyManager:r},a)=>r.getRefNameMapForAdapter(n,t[0],{signal:a,sessionId:Y.getRpcSessionId(e)}),{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},()=>{},t=>{e.setRefNameMap(t)},t=>{console.error(t),e.setError(t)})}})),gL=C.ConfigurationSchema("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),hL=e=>{const t=C.ConfigurationSchema("ChordVariantDisplay",{renderer:k.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:gL,explicitlyTyped:!0});return{stateModel:k.compose("ChordVariantDisplay",pL,k.model({type:k.literal("ChordVariantDisplay"),configuration:C.ConfigurationReference(t)})).views(r=>({get rendererTypeName(){return r.configuration.renderer.type},renderProps(){const a=P.getContainingView(r);return{...Y.getParentRenderProps(r),rpcDriverName:r.rpcDriverName,displayModel:r,bezierRadius:a.radiusPx*r.bezierRadiusRatio,radius:a.radiusPx,blockDefinitions:this.blockDefinitions,config:r.configuration.renderer,onChordClick:r.onChordClick}}})),configSchema:t}},mL=e=>{const{load:t}=e,{stateModel:n,configSchema:r}=t(hL);return new kn({name:"ChordVariantDisplay",configSchema:r,stateModel:n,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:uL})};function yL(e){const t=hc(e);return C.ConfigurationSchema("LinearVariantDisplay",{},{baseConfiguration:t,explicitlyTyped:!0})}function bL(e){return k.compose("LinearVariantDisplay",ug(e),k.model({type:k.literal("LinearVariantDisplay"),configuration:C.ConfigurationReference(e)})).actions(t=>({async selectFeature(n){const r=P.getSession(t);if(P.isSessionModelWithWidgets(r)){const{rpcManager:a}=r,o=Y.getRpcSessionId(t),i=P.getContainingTrack(t),s=C.getConf(i,"adapter"),c=await a.call(o,"CoreGetMetadata",{adapterConfig:s}),u=r.addWidget("VariantFeatureWidget","variantFeature",{featureData:n.toJSON(),view:P.getContainingView(t),descriptions:c});r.showWidget(u)}r.setSelection(n)}}))}const vL=e=>{e.addDisplayType(()=>{const t=yL(e);return new kn({name:"LinearVariantDisplay",configSchema:t,stateModel:bL(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:Vn})})};function ad(e,t){const n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}const wL=j(function({feature:t,blocksForRefs:n,radius:r,config:a,bezierRadius:o,selected:i,onClick:s}){var c,u,d,f,p;const g=n[t.get("refName")];if(!g)return null;let h;t.get("INFO")?[h]=t.get("INFO").SVTYPE||[]:t.get("mate")&&(h="mate");let m,y;const b=(c=t.get("ALT"))===null||c===void 0?void 0:c[0],S=b&&Hs(b);if(S){const _=S.MatePosition.split(":");m=+_[1],y=n[_[0]]}else if(b==="<TRA>"){const _=(d=(u=t.get("INFO"))===null||u===void 0?void 0:u.CHR2)===null||d===void 0?void 0:d[0],T=(p=(f=t.get("INFO"))===null||f===void 0?void 0:f.END)===null||p===void 0?void 0:p[0];m=parseInt(T,10),y=n[_]}else if(h==="mate"){const _=t.get("mate"),T=_.refName;m=_.start,y=n[T]}if(y){const _=t.get("start"),T=ad(g,_),x=ad(y,m),A=P.polarToCartesian(r,T),R=P.polarToCartesian(r,x),E=P.polarToCartesian(o,(x+T)/2),$=i?C.readConfObject(a,"strokeColorSelected",{feature:t}):C.readConfObject(a,"strokeColor",{feature:t}),B=C.readConfObject(a,"strokeColorHover",{feature:t});return l("path",{"data-testid":`chord-${t.id()}`,d:["M",...A,"Q",...E,...R].join(" "),style:{stroke:$},onClick:F=>{y&&g&&s(t,g.region,y.region,F)},onMouseOver:F=>{i||(F.target.style.stroke=B,F.target.style.strokeWidth=3)},onMouseOut:F=>{i||(F.target.style.stroke=$,F.target.style.strokeWidth=1)}})}return null});function SL(e){const{features:t,config:n,displayModel:r,blockDefinitions:a,radius:o,bezierRadius:i,displayModel:{selectedFeatureId:s},onChordClick:c}=e,u=M.exports.useMemo(()=>{const p={};return a.forEach(g=>{(g.region.elided?g.region.regions:[g.region]).forEach(m=>{p[m.refName]=g})}),p},[a]),d=[];for(const[p,g]of t){const h=String(s)===String(g.id());d.push(l(wL,{feature:g,config:n,radius:o,bezierRadius:i,blocksForRefs:u,selected:h,onClick:c},p))}const f=`chords-${r.id}`;return w("g",{id:f,"data-testid":"structuralVariantChordRenderer",children:[l("style",{dangerouslySetInnerHTML:{__html:`
          #${f} > path {
            cursor: crosshair;
            fill: none;
          }
`}}),d]})}const CL=j(SL),_L=e=>{const t=C.ConfigurationSchema("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});return new sp({name:"StructuralVariantChordRenderer",ReactComponent:CL,configSchema:t,pluginManager:e})},TL=C.ConfigurationSchema("VariantFeatureWidget",{});function xL(e){const t=Gl(e);return k.compose(t,k.model("VariantFeatureWidget",{type:k.literal("VariantFeatureWidget"),descriptions:k.frozen()}))}const PL=e=>{e.addWidgetType(()=>new tr({name:"VariantFeatureWidget",heading:"Feature details",configSchema:TL,stateModel:xL(e),ReactComponent:M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>RO),void 0))}))};class io{constructor(t){this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}get(t){return t==="samples"?this.variant.SAMPLES:this.data[t]||this.variant[t]}set(){}parent(){}children(){}tags(){return[...Object.keys(this.data),...Object.keys(this.variant),"samples"]}id(){return this._id}dataFromVariant(t){const{REF:n,ALT:r,POS:a,CHROM:o,INFO:i,ID:s}=t,c=a-1,[u,d]=this._getSOTermAndDescription(n,r),f=r==null?void 0:r.some(g=>g==="<TRA>"),p=r==null?void 0:r.some(g=>g.indexOf("<")!==-1);return{refName:o,start:c,end:p&&i.END&&!f?+i.END[0]:c+n.length,description:d,type:u,name:s==null?void 0:s.join(","),aliases:s&&s.length>1?t.ID.slice(1):void 0}}_getSOTermAndDescription(t,n){if(!n||n.length===0)return["remark","no alternative alleles"];const r=new Set;let a=new Set;if(n.forEach(o=>{let[i,s]=this._getSOAndDescFromAltDefs(t,o);i||([i,s]=this._getSOAndDescByExamination(t,o)),i&&s&&(r.add(i),a.add(s))}),a.size>1){const i=[...new Set([...a].map(s=>{const c=s.split("->");return c[1]?c[0]:s}))].map(s=>{const c=[...a].map(u=>{const d=u.split("-> ");return d[1]&&d[0]===s?d[1]:""}).filter(u=>!!u);return c.length?s+"-> "+c.join(","):[...a].join(",")});a=new Set(i)}return r.size?[[...r].join(","),[...a].join(",")]:[void 0,void 0]}_getSOAndDescFromAltDefs(t,n){if(typeof n=="string"&&!n.startsWith("<"))return[void 0,void 0];let r=io._altTypeToSO[n];if(!r&&this.parser.getMetadata("ALT",n)&&(r="sequence_variant"),r)return[r,n];const a=n.split(":");return a.length>1?this._getSOAndDescFromAltDefs(t,`<${a.slice(0,a.length-1).join(":")}>`):[void 0,void 0]}_getSOAndDescByExamination(t,n){return Hs(n)?["breakend",n]:t.length===1&&n.length===1?["SNV",this._makeDescriptionString("SNV",t,n)]:n==="<INS>"?["insertion",n]:n==="<DEL>"?["deletion",n]:n==="<INV>"?["deletion",n]:n==="<TRA>"?["translocation",n]:n.includes("<")?["sv",n]:t.length===n.length?t.split("").reverse().join("")===n?["inversion",this._makeDescriptionString("inversion",t,n)]:["substitution",this._makeDescriptionString("substitution",t,n)]:t.length<=n.length?["insertion",this._makeDescriptionString("insertion",t,n)]:t.length>n.length?["deletion",this._makeDescriptionString("deletion",t,n)]:["indel",this._makeDescriptionString("indel",t,n)]}_makeDescriptionString(t,n,r){return`${t} ${n} -> ${r}`}toJSON(){return{uniqueId:this._id,...this.variant,...this.data,samples:this.variant.SAMPLES}}}io._altTypeToSO={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};class kL extends Gt{constructor(){super(...arguments),this.name="VariantsPlugin"}install(t){ZD(t),tL(t),PL(t),rL(t),nL(t),vL(t),t.addRendererType(()=>t.jbrequire(_L)),t.addDisplayType(()=>t.jbrequire(mL))}}function od(e){try{return decodeURIComponent(e)}catch{return e}}function id(e,t,n=15){const r=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,r-n)>0?"...":"")+e.slice(Math.max(0,r-n),r+t.length+n).trim()+(r+t.length<e.length?"...":"")}class ML extends oa{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"ixFilePath"),o=C.readConfObject(t,"ixxFilePath");if(!a)throw new Error("must provide out.ix");if(!o)throw new Error("must provide out.ixx");this.trixJs=new Rb(Ce.openLocation(o),Ce.openLocation(a),1500)}async searchIndex(t){const n=t.queryString.toLowerCase(),r=n.split(" "),o=(await this.trixJs.search(n)).filter(([,i])=>r.every(s=>od(i).toLowerCase().includes(s))).map(([i,s])=>{const c=JSON.parse(s.replace(/\|/g,",")),[u,d,...f]=c.map(_=>od(_)),p=f.findIndex(_=>!!_),g=f.map(_=>_.toLowerCase()).findIndex(_=>_.indexOf(i.toLowerCase())!==-1),h=f[p],m=f[g],y=g!==-1?id(m,i):void 0,b=id(h,i),S=!y||b.toLowerCase()===y.toLowerCase()?b:`${b} (${y})`;return new or({locString:u,label:h,displayString:S,matchedObject:c.map(_=>decodeURIComponent(_)),trackId:d})});return t.searchType==="exact"?o.filter(i=>i.getLabel().toLowerCase()===t.queryString.toLowerCase()):o}freeResources(){}}const RL=C.ConfigurationSchema("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"});class AL extends Gt{constructor(){super(...arguments),this.name="TrixPlugin"}install(t){t.addTextSearchAdapterType(()=>new qf({name:"TrixTextSearchAdapter",configSchema:RL,AdapterClass:ML,description:"Trix adapter"}))}}const EL=[KD,XE,ZE,y$,N$,I$,sD,QR,ED,kL,eE,AL];function $L(e,t){return k.model("Configuration",{configuration:C.ConfigurationSchema("Root",{rpc:Pp.configSchema,highResolutionScaling:{type:"number",defaultValue:2},theme:{type:"frozen",defaultValue:{}}}),assembly:t,tracks:k.array(e.pluggableConfigSchemaType("track")),connections:k.array(e.pluggableConfigSchemaType("connection")),aggregateTextSearchAdapters:k.array(e.pluggableConfigSchemaType("text search adapter")),plugins:k.frozen()}).views(n=>({get assemblies(){return[n.assembly]},get assemblyName(){return C.readConfObject(n.assembly,"name")},get rpcManager(){return Ge(n).rpcManager}}))}var $g={};Object.defineProperty($g,"__esModule",{value:!0});const DL=dr;function LL(e){return{views:{get snackbarMessages(){return e}},actions:{notify(t,n,r){this.pushSnackbarMessage(t,n,r),(n==="info"||n==="success")&&setTimeout(()=>{this.removeSnackbarMessage(t)},5e3)},pushSnackbarMessage(t,n,r){return e.push([t,n,r])},popSnackbarMessage(){return e.pop()},removeSnackbarMessage(t){const n=e.find(r=>r[0]===t);n&&e.remove(n)}}}}function NL(e){return e.extend(()=>{const t=DL.observable.array();return LL(t)})}var FL=$g.default=NL;const Dg="2.1.5";var Lg={},BL=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),IL=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),OL=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&BL(t,e,n);return IL(t,e),t},Ng=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Lg,"__esModule",{value:!0});const Tt=OL(M.exports),jL=Ng(ja),$r=tt,zL=Ng(ea),qL=ft,Dr=C,VL=Ee(),To=_t,HL=(0,qL.makeStyles)()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},content:{minWidth:800}}));function WL({config:e,handleClose:t}){const{classes:n}=HL(),[r,a]=(0,Tt.useState)(),[o,i]=(0,Tt.useState)(),[s,c]=(0,Tt.useState)(!1),u=(0,VL.getSession)(e),{rpcManager:d}=u,f=(0,Dr.readConfObject)(e);(0,Tt.useEffect)(()=>{const h=new AbortController,{signal:m}=h;let y=!1;return(async()=>{try{const b=(0,Dr.readConfObject)(e,"adapter"),S=await d.call(e.trackId,"CoreGetInfo",{adapterConfig:b,signal:m});y||a(S)}catch(b){y||(console.error(b),i(b))}})(),()=>{h.abort(),y=!0}},[e,d]);let p=(0,Dr.readConfObject)(e,"name");if((0,Dr.readConfObject)(e,"type")==="ReferenceSequenceTrack"){const h=u.assemblies.find(m=>m.sequence===e.configuration);p=h?`Reference Sequence (${(0,Dr.readConfObject)(h,"displayName")||(0,Dr.readConfObject)(h,"name")})`:"Reference Sequence"}const g=typeof r=="string"?{header:`<pre>${r.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>`}:r||{};return Tt.default.createElement($r.Dialog,{open:!0,onClose:t,maxWidth:"xl"},Tt.default.createElement($r.DialogTitle,null,p,Tt.default.createElement($r.IconButton,{className:n.closeButton,onClick:()=>t(),size:"large"},Tt.default.createElement(zL.default,null))),Tt.default.createElement($r.DialogContent,{className:n.content},Tt.default.createElement(To.BaseCard,{title:"Configuration"},Tt.default.createElement($r.Button,{variant:"contained",style:{float:"right"},onClick:()=>{(0,jL.default)(JSON.stringify(f,null,2)),c(!0),setTimeout(()=>c(!1),1e3)}},s?"Copied to clipboard!":"Copy config"),Tt.default.createElement(To.Attributes,{attributes:f,omit:["displays","baseUri","refNames"]})),r!==null?Tt.default.createElement(To.BaseCard,{title:"File info"},o?Tt.default.createElement($r.Typography,{color:"error"},`${o}`):r===void 0?"Loading file data...":Tt.default.createElement(To.Attributes,{attributes:g})):null))}var UL=Lg.default=WL;function GL(e){const t=k.model("ReactLinearGenomeViewSession",{name:k.identifier,margin:0,view:e.getViewType("LinearGenomeView").stateModel,widgets:k.map(e.pluggableMstType("widget","stateModel")),activeWidgets:k.map(k.safeReference(e.pluggableMstType("widget","stateModel"))),connectionInstances:k.array(e.pluggableMstType("connection","stateModel")),sessionTracks:k.array(e.pluggableConfigSchemaType("track"))}).volatile(()=>({selection:void 0,task:void 0,queueOfDialogs:[]})).views(n=>({get disableAddTracks(){return Ge(n).disableAddTracks},get DialogComponent(){var r;if(n.queueOfDialogs.length)return(r=n.queueOfDialogs[0])===null||r===void 0?void 0:r[0]},get DialogProps(){var r;if(n.queueOfDialogs.length)return(r=n.queueOfDialogs[0])===null||r===void 0?void 0:r[1]},get textSearchManager(){return Ge(n).textSearchManager},get rpcManager(){return Ge(n).rpcManager},get configuration(){return Ge(n).config.configuration},get assemblies(){return[Ge(n).config.assembly]},get assemblyNames(){return[Ge(n).config.assemblyName]},get tracks(){return Ge(n).config.tracks},get aggregateTextSearchAdapters(){return Ge(n).config.aggregateTextSearchAdapters},get connections(){return Ge(n).config.connections},get adminMode(){return!1},get assemblyManager(){return Ge(n).assemblyManager},get version(){return Dg},get views(){return[n.view]},renderProps(){return{theme:C.readConfObject(this.configuration,"theme")}},get visibleWidget(){if(Ye(n))return Array.from(n.activeWidgets.values())[n.activeWidgets.size-1]},getReferring(r){const a=[];return Rh(Ge(n),o=>{if(Ah(_d(o))){const i=Td(o);Object.entries(i.properties).forEach(([s,c])=>{Eh(c)&&o[s]===r&&a.push({node:o,key:s})})}}),a}})).actions(n=>({addTrackConf(r){const{trackId:a,type:o}=r;if(!o)throw new Error(`unknown track type ${o}`);const i=n.sessionTracks.find(c=>c.trackId===a);if(i)return i;const s=n.sessionTracks.push(r);return n.sessionTracks[s-1]},queueDialog(r){const[a,o]=r(()=>{this.removeActiveDialog()});n.queueOfDialogs=[...n.queueOfDialogs,[a,o]]},removeActiveDialog(){n.queueOfDialogs=n.queueOfDialogs.slice(1)},makeConnection(r,a={}){const{type:o}=r;if(!o)throw new Error("track configuration has no `type` listed");const i=C.readConfObject(r,"name");if(!e.getConnectionType(o))throw new Error(`unknown connection type ${o}`);const c={...a,name:i,type:o,configuration:r},u=n.connectionInstances.push(c);return n.connectionInstances[u-1]},removeReferring(r,a,o,i){r.forEach(({node:s})=>{let c=!1;try{const u="open track(s)",d=P.getContainingView(s);o.push(()=>d.hideTrack(a.trackId)),c=!0,i[u]||(i[u]=0),i[u]+=1}catch{}if(this.hasWidget(s)){const u="configuration editor widget(s)";o.push(()=>this.hideWidget(s)),c=!0,i[u]||(i[u]=0),i[u]+=1}if(!c)throw new Error(`Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(gt(s))}`)})},prepareToBreakConnection(r){const a=[],o={},i=C.readConfObject(r,"name");return n.connectionInstances.find(u=>u.name===i).tracks.forEach(u=>{const d=n.getReferring(u);this.removeReferring(d,u,a,o)}),[()=>{a.forEach(u=>u()),this.breakConnection(r)},o]},breakConnection(r){const a=C.readConfObject(r,"name"),o=n.connectionInstances.find(i=>i.name===a);n.connectionInstances.remove(o)},addView(r,a={}){if(!e.getElementType("view",r))throw new Error(`unknown view type ${r}`);return n.view={...a,type:r},n.view},removeView(){},addWidget(r,a,o={},i={type:r}){if(!e.getElementType("widget",r))throw new Error(`unknown widget type ${r}`);const c={...o,id:a,type:r,configuration:i};return n.widgets.set(a,c),n.widgets.get(a)},showWidget(r){n.activeWidgets.has(r.id)&&n.activeWidgets.delete(r.id),n.activeWidgets.set(r.id,r)},hasWidget(r){return n.activeWidgets.has(r.id)},hideWidget(r){n.activeWidgets.delete(r.id)},hideAllWidgets(){n.activeWidgets.clear()},setSelection(r){n.selection=r},clearSelection(){n.selection=void 0},clearConnections(){n.connectionInstances.length=0},renameCurrentSession(r){return Ge(n).renameCurrentSession(r)}})).views(n=>({getTrackActionMenuItems(r){return[{label:"About track",onClick:()=>{n.queueDialog(a=>[UL,{config:r,handleClose:a}])},icon:sb}]}}));return FL(t)}function JL(e){const t=new ZP([...EL,...e].map(i=>new i));t.createPluggableElements();const n=GL(t),r=wl.assemblyConfigSchemaFactory(t),a=JC(r,t);return{model:k.model("ReactLinearGenomeView",{config:$L(t,r),session:n,assemblyManager:k.optional(a,{}),disableAddTracks:k.optional(k.boolean,!1)}).volatile(()=>({error:void 0})).actions(i=>({setSession(s){i.session=Hn(s)},renameCurrentSession(s){if(i.session){const c=JSON.parse(JSON.stringify(gt(i.session)));c.name=s,this.setSession(c)}},setError(s){i.error=s}})).views(i=>({get jbrowse(){return i.config}})).volatile(i=>({rpcManager:new Pp(t,i.config.configuration.rpc,{MainThreadRpcDriver:{}}),textSearchManager:new Ck(t)})),pluginManager:t}}function J2(e){const{assembly:t,tracks:n,configuration:r,aggregateTextSearchAdapters:a,plugins:o,location:i,onChange:s,disableAddTracks:c=!1}=e,{model:u,pluginManager:d}=JL(o||[]);let{defaultSession:f}=e;f||(f={name:"this session",view:{id:"linearGenomeView",type:"LinearGenomeView"}});const p={config:{configuration:r,assembly:t,tracks:n,aggregateTextSearchAdapters:a,defaultSession:f},disableAddTracks:c,session:f},g=u.create(p,{pluginManager:d});return d.setRootModel(g),d.configure(),i&&Yt(h=>{if(g.assemblyManager.allPossibleRefNames&&g.assemblyManager.allPossibleRefNames.length&&g.session.view.initialized){if(typeof i=="string"){const m=g.assemblyManager.assemblies[0].name;g.session.view.navToLocString(i,m)}else g.session.view.navTo(i);h.dispose()}}),s&&$h(g,s),g}var cn={},Fg=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(cn,"__esModule",{value:!0});cn.isCJSPluginDefinition=cn.isESMPluginDefinition=cn.isUMDPluginDefinition=cn.PluginSourceConfigurationSchema=void 0;const XL=Fg(t0),YL=C,KL=Fg(ci),sd=Ee();cn.PluginSourceConfigurationSchema=(0,YL.ConfigurationSchema)("PluginSource",{name:{type:"string",defaultValue:""},url:{type:"string",defaultValue:""}});function Bg(e){return(e.umdUrl!==void 0||e.url!==void 0)&&e.name!==void 0}cn.isUMDPluginDefinition=Bg;function Ig(e){return e.esmUrl!==void 0}cn.isESMPluginDefinition=Ig;function Rs(e){return e.cjsUrl!==void 0}cn.isCJSPluginDefinition=Rs;function _a(){return typeof self=="object"&&self.self===self&&self||typeof v=="object"&&v.global===v&&v||this}function QL(e){return Boolean("WorkerGlobalScope"in e)}class ZL{constructor(t=[],n){this.definitions=[],this.fetchESM=n==null?void 0:n.fetchESM,this.fetchCJS=n==null?void 0:n.fetchCJS,this.definitions=JSON.parse(JSON.stringify(t))}loadScript(t){const n=_a();if(!QL(n))return(0,XL.default)(t);if(n&&n.importScripts)return new Promise((r,a)=>{try{n.importScripts(t)}catch(o){a(o||new Error(`failed to load ${t}`));return}r()});throw new Error("cannot figure out how to load external JS scripts in this environment")}async loadCJSPlugin({cjsUrl:t}){let n;try{n=new URL(t,_a().location.href)}catch(r){throw console.error(r),new Error(`Error parsing URL: ${t}`)}if(n.protocol!=="http:"&&n.protocol!=="https:")throw new Error(`Cannot load plugins using protocol "${n.protocol}"`);if(!this.fetchCJS)throw new Error("No fetchCJS callback provided");return this.fetchCJS(n.href)}async loadESMPlugin(t){var n;let r;try{r=new URL(t.esmUrl,_a().location.href)}catch(o){throw console.error(o),new Error(`Error parsing URL: ${t.esmUrl}`)}if(r.protocol!=="http:"&&r.protocol!=="https:")throw new Error(`cannot load plugins using protocol "${r.protocol}"`);const a=await((n=this.fetchESM)===null||n===void 0?void 0:n.call(this,r.href));if(!a)throw new Error(`Could not load ESM plugin: ${r}`);return a}async loadUMDPlugin(t){const n="url"in t?t.url:t.umdUrl;let r;try{r=new URL(n,_a().location.href)}catch(c){throw console.error(c),new Error(`Error parsing URL: ${n}`)}if(r.protocol!=="http:"&&r.protocol!=="https:")throw new Error(`cannot load plugins using protocol "${r.protocol}"`);await this.loadScript(r.href);const a=t.name,o=`JBrowsePlugin${a}`,i=_a(),s=i[o];if(!s)throw new Error(`Failed to load UMD bundle for ${a}, ${i.constructor.name}.${o} is undefined`);return s}async loadPlugin(t){let n;if(sd.isElectron&&Rs(t))n=await this.loadCJSPlugin(t);else if(Ig(t))n=await this.loadESMPlugin(t);else if(Bg(t))n=await this.loadUMDPlugin(t);else throw!sd.isElectron&&Rs(t)?new Error(`Only CommonJS plugin found, but not in a NodeJS environment: ${JSON.stringify(t)}`):new Error(`Could not determine plugin type: ${JSON.stringify(t)}`);return n.default}installGlobalReExports(t){t.JBrowseExports=Object.fromEntries(Object.entries(KL.default).map(([n,r])=>[n,r]))}async load(){return Promise.all(this.definitions.map(async t=>({plugin:await this.loadPlugin(t),definition:t})))}}cn.default=ZL;const eN=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},content:{minWidth:800}}));function tN({open:e,onClose:t}){const{classes:n}=eN();return w(De,{open:e,onClose:t,maxWidth:"xl",children:[w(Ne,{children:["JBrowse v",Dg,l(pe,{className:n.closeButton,onClick:()=>t(),size:"large",children:l($e,{})})]}),w(Fe,{className:n.content,children:[l(X,{children:"JBrowse is a GMOD project \xA9 2019-2021, The Evolutionary Software Foundation"}),l(X,{children:"Here are some resources and documentation. Please report the version number above when asking questions. Thanks!"}),w("ul",{children:[l("li",{children:l(Et,{href:"https://github.com/GMOD/jbrowse-components/discussions",target:"_blank",rel:"noopener noreferrer",children:"Question & answer forum"})}),l("li",{children:l(Et,{href:"https://github.com/GMOD/jbrowse-components/issues/new/choose",target:"_blank",rel:"noopener noreferrer",children:"Report a bug"})}),l("li",{children:l(Et,{href:"https://jbrowse.org/jb2/docs/user_guide",target:"_blank",rel:"noopener noreferrer",children:"User guide"})}),l("li",{children:l(Et,{href:"https://jbrowse.org/jb2/docs/",target:"_blank",rel:"noopener noreferrer",children:"Documentation"})})]})]})]})}const nN=Object.freeze(Object.defineProperty({__proto__:null,default:tN},Symbol.toStringTag,{value:"Module"}));class Cc{constructor(t,n){this.record=t,this._store=n}_get_name(){return this.record.readName}_get_start(){return this.record.alignmentStart-1}_get_end(){return this.record.alignmentStart+this.record.lengthOnRef-1}_get_cram_read_features(){return this.record.readFeatures}_get_type(){return"match"}_get_score(){return this.record.mappingQuality}_get_flags(){return this.record.flags}_get_strand(){return this.record.isReverseComplemented()?-1:1}_read_group_id(){const t=this._store.samHeader.readGroups;return t?t[this.record.readGroupId]:void 0}_get_qual(){return(this.record.qualityScores||[]).join(" ")}qualRaw(){return this.record.qualityScores}_get_seq_id(){return this._store.refIdToName(this.record.sequenceId)}_get_refName(){return this._get_seq_id()}_get_is_paired(){return!!this.record.mate}_get_pair_orientation(){return this.record.isPaired()?this.record.getPairOrientation():void 0}_get_template_length(){return this.record.templateLength||this.record.templateSize}_get_next_seq_id(){return this.record.mate?this._store.refIdToName(this.record.mate.sequenceId):void 0}_get_next_pos(){return this.record.mate?this.record.mate.alignmentStart:void 0}_get_next_segment_position(){return this.record.mate?`${this._store.refIdToName(this.record.mate.sequenceId)}:${this.record.mate.alignmentStart}`:void 0}_get_tags(){const t=this._read_group_id(),{tags:n}=this.record;return t!==void 0?{...n,RG:t}:n}_get_seq(){return this.record.getReadBases()}_get_CIGAR(){let t="",n="",r="M",a=0;const o=this.record._refRegion.seq,i=this.record._refRegion.start;let s=this.record.alignmentStart,c=0;if(typeof this.record.readFeatures<"u")for(let u=0;u<this.record.readFeatures.length;u++){const{code:d,refPos:f,sub:p,data:g}=this.record.readFeatures[u];if(c=f-s,t+=o.substring(s-i,f-i),s=f,a&&r!=="M"&&(n+=a+r,a=0),c&&(r="M",a+=c),d==="b"){const h=g.split(","),m=String.fromCharCode(...h);t+=m,s+=m.length,a+=m.length}else d==="B"||d==="X"?(t+=p,s++,a++):d==="D"||d==="N"?(s+=g,a&&(n+=a+r),n+=g+d,a=0):d==="I"||d==="S"?(t+=g,a&&(n+=a+r),n+=g.length+d,a=0):d==="i"?(t+=g,a&&(n+=a+r),n+=`${1}I`,a=0):d==="P"?(a&&(n+=a+r),n+=`${g}P`):d==="H"&&(a&&(n+=a+r),n+=`${g}H`,a=0)}else c=this.record.readLength-t.length;return t.length!==this.record.readLength&&(c=this.record.readLength-t.length,t+=o.substring(s-i,s-i+c),a&&r!=="M"&&(n+=a+r,a=0),r="M",a+=c),a&&(n+=a+r),n}tags(){return Object.getOwnPropertyNames(Cc.prototype).filter(n=>n.startsWith("_get_")&&n!=="_get_mismatches"&&n!=="_get_cram_read_features").map(n=>n.replace("_get_",""))}id(){return`${this._store.id}-${this.record.uniqueId}`}get(t){const n=`_get_${t}`;if(this[n])return this[n]()}parent(){}children(){}set(){}pairedFeature(){return!1}_get_clipPos(){const t=this.get("mismatches");if(t.length){const n=this.get("strand")===-1?t[t.length-1]:t[0],{type:r,cliplen:a}=n;if(r==="softclip"||r==="hardclip")return a}return 0}toJSON(){const t={};return this.tags().forEach(n=>{const r=this.get(n);r!==void 0&&(t[n]=r)}),{...t,name:this.get("name"),type:this.get("type"),uniqueId:this.id()}}_get_mismatches(){const t=this.get("cram_read_features"),n=this.qualRaw();if(!t)return[];const r=this.get("start"),a=new Array(t.length);let o=0;for(let i=0;i<t.length;i++){const s=t[i],{code:c,pos:u,data:d,sub:f,ref:p}=s,g=s.refPos-1-r;if(c==="X")a[o++]={start:g,length:1,base:f,qual:n==null?void 0:n[u],altbase:p,type:"mismatch"};else if(c==="I")a[o++]={start:g,type:"insertion",base:`${d.length}`,length:0};else if(c==="N")a[o++]={type:"skip",length:d,start:g,base:"N"};else if(c==="S"){const h=d.length;a[o++]={start:g,type:"softclip",base:`S${h}`,cliplen:h,length:1}}else if(c!=="P")if(c==="H"){const h=d;a[o++]={start:g,type:"hardclip",base:`H${h}`,cliplen:h,length:1}}else c==="D"?a[o++]={type:"deletion",length:d,start:g,base:"*"}:c==="b"||c==="q"||c==="B"||c==="i"&&(a[o++]={start:g,type:"insertion",base:d,length:1})}return a.slice(0,o)}}class rN extends st{constructor(){super(...arguments),this.samHeader={},this.seqIdToOriginalRefName=[]}async configure(){const t=this.getConf("cramLocation"),n=this.getConf("craiLocation");if(!t)throw new Error("missing cramLocation argument");if(!n)throw new Error("missing craiLocation argument");const r=new Ab({cramFilehandle:Ce.openLocation(t,this.pluginManager),index:new Eb({filehandle:Ce.openLocation(n,this.pluginManager)}),seqFetch:this.seqFetch.bind(this),checkSequenceMD5:!1,fetchSizeLimit:2e8}),a=this.getConf(["sequenceAdapter","type"]);if(!this.getSubAdapter)throw new Error("Error getting subadapter");const o=this.getConf("sequenceAdapter"),{dataAdapter:i}=await this.getSubAdapter(o);if(!(i instanceof st))throw new Error(`CRAM feature adapters cannot use sequence adapters of type '${a}'`);return{cram:r,sequenceAdapter:i}}async getHeader(t){const{cram:n}=await this.configure();return n.cram.getHeaderText(t)}async seqFetch(t,n,r){n-=1;const{sequenceAdapter:a}=await this.configure(),o=this.refIdToOriginalName(t)||this.refIdToName(t);if(!o)return;const s=(await a.getFeatures({refName:o,start:n,end:r,assemblyName:""}).pipe(Rn()).toPromise()).sort((c,u)=>c.get("start")-u.get("start")).map(c=>{const u=c.get("start"),d=c.get("end"),f=Math.max(n-u,0),g=Math.min(r-u,d-u)-f;return(c.get("seq")||c.get("residues")).substr(f,g)}).join("");if(s.length!==r-n)throw new Error(`sequence fetch failed: fetching ${o}:${(n-1).toLocaleString()}-${r.toLocaleString()} returned ${s.length.toLocaleString()} bases, but should have returned ${(r-n).toLocaleString()}`);return s}async setupPre(t){const{statusCallback:n=()=>{}}=t||{},r=await this.configure();n("Downloading index");const{cram:a}=r,o=await a.cram.getSamHeader(t==null?void 0:t.signal),i=[],s={};o.filter(d=>d.tag==="SQ").forEach((d,f)=>{d.data.forEach(p=>{if(p.tag==="SN"){const g=p.value;s[g]=f,i[f]=g}})});const c=o.filter(d=>d.tag==="RG").map(d=>{var f;return(f=d.data.find(p=>p.tag==="ID"))===null||f===void 0?void 0:f.value}),u={idToName:i,nameToId:s,readGroups:c};return n(""),this.samHeader=u,{samHeader:u,...r}}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(n=>{throw this.setupP=void 0,n})),this.setupP}async getRefNames(t){const{samHeader:n}=await this.setup(t);if(!n.idToName)throw new Error("CRAM file has no header lines");return n.idToName}refNameToId(t){if(this.samHeader.nameToId)return this.samHeader.nameToId[t];if(this.seqIdToRefName)return this.seqIdToRefName.indexOf(t)}refIdToName(t){if(this.samHeader.idToName)return this.samHeader.idToName[t];if(this.seqIdToRefName)return this.seqIdToRefName[t]}refIdToOriginalName(t){return this.seqIdToOriginalRefName[t]}getFeatures(t,n){const{signal:r,filterBy:a,statusCallback:o=()=>{}}=n||{},{refName:i,start:s,end:c,originalRefName:u}=t;return Ke(async d=>{const{cram:f,sequenceAdapter:p}=await this.setup(n);o("Downloading alignments"),this.seqIdToRefName||(this.seqIdToRefName=await p.getRefNames(n));const g=this.refNameToId(i);if(g!==void 0){u&&(this.seqIdToOriginalRefName[g]=u);const h=await f.getRecordsForRange(g,s,c,n);P.checkAbortSignal(r);const{flagInclude:m=0,flagExclude:y=0,tagFilter:b,readName:S}=a||{};let _=h.filter(T=>{const x=T.flags;return(x&m)===m&&!(x&y)});b&&(_=_.filter(T=>{const x=T[b.tag];return x==="*"?x!==void 0:x===b.value})),S&&(_=_.filter(T=>T.readName===S)),_.forEach(T=>{d.next(this.cramRecordToFeature(T))})}else console.warn("Unknown refName",i);o(""),d.complete()},r)}freeResources(){}cramRecordToFeature(t){return new Cc(t,this)}async estimateRegionsStats(t,n){const r=await this.bytesForRegions(t,n),a=this.getConf("fetchSizeLimit");return{bytes:r,fetchSizeLimit:a}}async bytesForRegions(t,n){const{cram:r}=await this.configure();return(await Promise.all(t.map(o=>{const{refName:i,start:s,end:c}=o,u=this.refNameToId(i);return r.index.getEntriesForRange(u,s,c)}))).flat().reduce((o,i)=>o+i.sliceBytes,0)}}const aN=Object.freeze(Object.defineProperty({__proto__:null,default:rN},Symbol.toStringTag,{value:"Module"}));class _c{constructor(t,n,r){this.record=t,this.adapter=n,this.ref=r}_get_name(){return this.record.get("name")}_get_type(){return"match"}_get_score(){return this.record.get("mq")}_get_flags(){return this.record.flags}_get_strand(){return this.record.isReverseComplemented()?-1:1}_get_pair_orientation(){return this.record.isPaired()?this.record.getPairOrientation():void 0}_get_next_seq_id(){return this.record._next_refid()}_get_seq_id(){return this.record._refID}_get_next_refName(){return this.adapter.refIdToName(this.record._next_refid())}_get_next_segment_position(){const{record:t,adapter:n}=this;return t.isPaired()?`${n.refIdToName(t._next_refid())}:${t._next_pos()+1}`:void 0}_get_seq(){return this.record.getReadBases()}qualRaw(){return this.record.qualRaw()}set(){}tags(){const t=Object.getOwnPropertyNames(_c.prototype);return[...new Set(t.filter(n=>n.startsWith("_get_")&&n!=="_get_mismatches"&&n!=="_get_tags"&&n!=="_get_next_seq_id"&&n!=="_get_seq_id").map(n=>n.replace("_get_","")).concat(this.record._tags()))]}id(){return`${this.adapter.id}-${this.record.id()}`}get(t){const n=`_get_${t}`;return this[n]?this[n]():this.record.get(t)}_get_refName(){return this.adapter.refIdToName(this.record.seq_id())}parent(){}children(){}pairedFeature(){return!1}toJSON(){return{...Object.fromEntries(this.tags().map(t=>[t,this.get(t)]).filter(t=>t[1]!==void 0)),uniqueId:this.id()}}_get_mismatches(){return Pk(this.get("CIGAR"),this.get("MD"),this.get("seq"),this.ref,this.qualRaw())}_get_clipPos(){const t=this.get("CIGAR")||"";return this.get("strand")===-1?+(t.match(/(\d+)[SH]$/)||[])[1]||0:+(t.match(/^(\d+)([SH])/)||[])[1]||0}}class Og extends st{async configure(){if(!this.configured){const t=C.readConfObject(this.config,"bamLocation"),n=C.readConfObject(this.config,["index","location"]),r=C.readConfObject(this.config,["index","indexType"]),a=new $b({bamFilehandle:Ce.openLocation(t,this.pluginManager),csiFilehandle:r==="CSI"?Ce.openLocation(n,this.pluginManager):void 0,baiFilehandle:r!=="CSI"?Ce.openLocation(n,this.pluginManager):void 0,chunkSizeLimit:1/0,fetchSizeLimit:1/0,yieldThreadTime:1/0}),o=C.readConfObject(this.config,"sequenceAdapter");o&&this.getSubAdapter?this.configured=this.getSubAdapter(o).then(({dataAdapter:i})=>({bam:a,sequenceAdapter:i})):this.configured=Promise.resolve({bam:a})}return this.configured}async getHeader(t){const{bam:n}=await this.configure();return n.getHeaderText(t)}async setupPre(t){const{statusCallback:n=()=>{}}=t||{},{bam:r}=await this.configure();return this.samHeader=await P.updateStatus("Downloading index",n,async()=>{const a=await r.getHeader(t),o=[],i={};return a.filter(s=>s.tag==="SQ").forEach((s,c)=>{s.data.forEach(u=>{if(u.tag==="SN"){const d=u.value;i[d]=c,o[c]=d}})}),{idToName:o,nameToId:i}}),this.samHeader}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(n=>{throw this.setupP=void 0,n})),this.setupP}async getRefNames(t){const{idToName:n}=await this.setup(t);return n}async seqFetch(t,n,r){const{sequenceAdapter:a}=await this.configure(),o=a;if(!o||!t)return;const s=await o.getFeatures({refName:t,start:n,end:r,assemblyName:""}).pipe(Rn()).toPromise();let c="";if(s.sort((u,d)=>u.get("start")-d.get("start")).forEach(u=>{const d=u.get("start"),f=u.get("end"),p=Math.max(n-d,0),h=Math.min(r-d,f-d)-p;c+=(u.get("seq")||u.get("residues")).substr(p,h)}),c.length!==r-n)throw new Error(`sequence fetch failed: fetching ${t}:${(n-1).toLocaleString()}-${r.toLocaleString()} returned ${c.length.toLocaleString()} bases, but should have returned ${(r-n).toLocaleString()}`);return c}getFeatures(t,n){const{refName:r,start:a,end:o,originalRefName:i}=t,{signal:s,filterBy:c,statusCallback:u=()=>{}}=n||{};return Ke(async d=>{const{bam:f}=await this.configure();await this.setup(n),u("Downloading alignments");const p=await f.getRecordsForRange(r,a,o,n),{flagInclude:g=0,flagExclude:h=0,tagFilter:m,readName:y}=c||{};for(const b of p){let S;b.get("MD")||(S=await this.seqFetch(i||r,b.get("start"),b.get("end")));const _=b.flags;if((_&g)===g&&!(_&h)){if(m){const T=b.get(m.tag);if(!(T==="*"?T!==void 0:T===m.value))continue}y&&b.get("name")!==y||d.next(new _c(b,this,S))}}u(""),d.complete()},s)}async estimateRegionsStats(t,n){const{bam:r}=await this.configure();if(r.index.filehandle!=="?"){const a=await P.bytesForRegions(t,r),o=C.readConfObject(this.config,"fetchSizeLimit");return{bytes:a,fetchSizeLimit:o}}else return super.estimateRegionsStats(t,n)}freeResources(){}refIdToName(t){var n;return(n=this.samHeader)===null||n===void 0?void 0:n.idToName[t]}}const oN=Object.freeze(Object.defineProperty({__proto__:null,default:Og},Symbol.toStringTag,{value:"Module"}));class iN extends Og{async configure(){if(!this.configured){const t=C.readConfObject(this.config,"htsgetBase"),n=C.readConfObject(this.config,"htsgetTrackId"),r=new Db({baseUrl:t,trackId:n}),a=C.readConfObject(this.config,"sequenceAdapter");a&&this.getSubAdapter&&(this.configured=this.getSubAdapter(a).then(({dataAdapter:o})=>({bam:r,sequenceAdapter:o}))),this.configured=Promise.resolve({bam:r})}return this.configured}}const sN=Object.freeze(Object.defineProperty({__proto__:null,default:iN},Symbol.toStringTag,{value:"Module"}));class jg extends st{async setupPre(t){const{statusCallback:n=()=>{}}=t||{},r=new Lb({filehandle:Ce.openLocation(this.getConf("bigWigLocation"),this.pluginManager)}),a=await P.updateStatus("Downloading bigwig header",n,()=>r.getHeader(t));return{bigwig:r,header:a}}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(n=>{throw this.setupP=void 0,n})),this.setupP}async getRefNames(t){const{header:{refsByName:n}}=await this.setup(t);return Object.keys(n)}async refIdToName(t){var n;const{header:{refsByNumber:r}}=await this.setup();return(n=r[t])===null||n===void 0?void 0:n.name}async getGlobalStats(t){const{header:{totalSummary:n}}=await this.setup(t);return Wf(n)}getFeatures(t,n={}){const{refName:r,start:a,end:o}=t,{bpPerPx:i=0,signal:s,resolution:c=1,statusCallback:u=()=>{}}=n;return Ke(async d=>{u("Downloading bigwig data");const f=this.getConf("source"),{bigwig:p}=await this.setup(n),g=await p.getFeatures(r,a,o,{...n,basesPerSpan:i/c});for(let h=0;h<g.length;h++){const m=g[h];f&&(m.source=f);const y=`${f}:${t.refName}:${m.start}-${m.end}`;m.refName=r,m.uniqueId=y,d.next({get:b=>m[b],id:()=>y,toJSON:()=>m})}d.complete()},s)}async estimateRegionsStats(t){return{featureDensity:0}}freeResources(){}}jg.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];const lN=Object.freeze(Object.defineProperty({__proto__:null,default:jg},Symbol.toStringTag,{value:"Module"}));function cN(e){const t=e.slice(e.lastIndexOf("/")+1);return t.slice(0,t.lastIndexOf("."))}class zg extends st{async getAdapters(){const t=this.getSubAdapter;if(!t)throw new Error("no getSubAdapter available");let n=this.getConf("subadapters");return n!=null&&n.length||(n=this.getConf("bigWigs").map(a=>({type:"BigWigAdapter",source:cN(a),bigWigLocation:{uri:a}}))),Promise.all(n.map(async r=>{const a=(await t(r)).dataAdapter;return{source:r.name||a.id,...r,dataAdapter:a}}))}async getRefNames(t){const n=await this.getAdapters(),r=await Promise.all(n.map(a=>a.dataAdapter.getRefNames(t)));return[...new Set(r.flat())]}async getGlobalStats(t){const n=await this.getAdapters(),r=(await Promise.all(n.map(i=>{var s,c;return(c=(s=i.dataAdapter).getGlobalStats)===null||c===void 0?void 0:c.call(s,t)}))).filter(i=>!!i),a=Math.min(...r.map(i=>i.scoreMin)),o=Math.max(...r.map(i=>i.scoreMax));return{scoreMin:a,scoreMax:o}}getFeatures(t,n={}){return Ke(async r=>{const a=await this.getAdapters();Th(...a.map(o=>o.dataAdapter.getFeatures(t,n).pipe(Sd(i=>i.get("source")?i:new P.SimpleFeature({...i.toJSON(),uniqueId:o.source+"-"+i.id(),source:o.source}))))).subscribe(r)},n.signal)}async estimateRegionsStats(t){return{featureDensity:0}}async getSources(){return(await this.getAdapters()).map(({dataAdapter:n,source:r,name:a,...o})=>({name:r,__name:a,...o}))}freeResources(){}}zg.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];const uN=Object.freeze(Object.defineProperty({__proto__:null,default:zg},Symbol.toStringTag,{value:"Module"})),dN=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function fN({handleClose:e}){const{classes:t}=dN();return w(De,{open:!0,maxWidth:"xl",onClose:e,children:[w(Ne,{children:["Using the search box",e?l(pe,{className:t.closeButton,onClick:()=>e(),children:l($e,{})}):null]}),l(un,{}),w(Fe,{children:[l("h3",{children:"Searching"}),w("ul",{children:[l("li",{children:"Jump to a feature or reference sequence by typing its name in the location box and pressing Enter."}),w("li",{children:["Jump to a specific region by typing the region into the location box as: ",l("code",{children:"ref:start..end"})," or ",l("code",{children:"ref:start-end"}),". Commas are allowed in the start and end coordinates. A space-separated list of locstrings can be used to open up multiple chromosomes at a time"]})]}),l("h3",{children:"Example Searches"}),w("ul",{children:[w("li",{children:[l("code",{children:"BRCA"})," - searches for the feature named BRCA"]}),w("li",{children:[l("code",{children:"chr4"})," - jumps to chromosome 4"]}),w("li",{children:[l("code",{children:"chr4:79,500,000..80,000,000"})," - jumps the region on chromosome 4 between 79.5Mb and 80Mb."]}),w("li",{children:[l("code",{children:"chr1:1-100 chr2:1-100"})," - create a split view of chr1:1-100 and chr2:1-100"]}),w("li",{children:[l("code",{children:"chr1 chr2 chr3"})," - open up multiple chromosomes at once"]}),w("li",{children:[l("code",{children:"chr1:1-100[rev] chr2:1-100"})," - open up the first region in the horizontally flipped orientation"]}),w("li",{children:[l("code",{children:"chr1 100 200"})," - use whitespace separated refname, start, end"]})]})]}),l(un,{}),l(qe,{children:l(ne,{onClick:()=>e(),color:"primary",children:"Close"})})]})}const pN=Object.freeze(Object.defineProperty({__proto__:null,default:fN},Symbol.toStringTag,{value:"Module"})),gN=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"40em"}}));function hN({model:e,handleClose:t}){const{classes:n}=gN(),[r,a]=M.exports.useState(""),[o,i]=M.exports.useState(!0),[s,c]=M.exports.useState(!0),[u,d]=M.exports.useState(!0);let f;try{new RegExp(r)}catch(p){f=p}return w(De,{maxWidth:"xl",open:!0,onClose:t,children:[w(Ne,{children:["Sequence search",t?l(pe,{className:n.closeButton,onClick:()=>t(),size:"large",children:l($e,{})}):null]}),l(un,{}),w(Fe,{className:n.dialogContent,children:[l(X,{children:"Supply a sequence to search for. A track will be created with the resulting matches once submitted. You can also supply regex style expressions e.g. AACT(C|T)."}),l(be,{value:r,onChange:p=>a(p.target.value),helperText:"Sequence search pattern"}),w(Yo,{children:[l(Pt,{control:l(jt,{checked:o,onChange:p=>i(p.target.checked)}),label:"Search forward strand"}),l(Pt,{control:l(jt,{checked:s,onChange:p=>c(p.target.checked)}),label:"Search reverse strand"}),l(Pt,{control:l(jt,{checked:u,onChange:p=>d(p.target.checked)}),label:"Case insensitive"})]}),f?l(X,{color:"error",children:`${f}`}):null]}),w(qe,{children:[l(ne,{onClick:()=>{var p;if(r){const g=`sequence_search_${+Date.now()}`,h=P.getSession(e),{assemblyManager:m}=h,y=e.assemblyNames[0];h.addTrackConf({trackId:g,name:`Sequence search ${r}`,assemblyNames:[y],type:"FeatureTrack",adapter:{type:"SequenceSearchAdapter",search:r,searchForward:o,searchReverse:s,caseInsensitive:u,sequenceAdapter:gt((p=m.get(y))===null||p===void 0?void 0:p.configuration.sequence.adapter)}}),e.toggleTrack(g)}t()},variant:"contained",color:"primary",children:"Submit"}),l(ne,{onClick:()=>t(),variant:"contained",color:"secondary",children:"Close"})]})]})}const mN=j(hN),yN=Object.freeze(Object.defineProperty({__proto__:null,default:mN},Symbol.toStringTag,{value:"Module"})),bN=ae()(e=>({root:{width:500},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}));function vN({model:e,handleClose:t}){const{classes:n}=bN(),{maxHeight:r=""}=e,[a,o]=M.exports.useState(`${r}`);return w(De,{open:!0,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[w(Ne,{id:"alert-dialog-title",children:["Filter options",l(pe,{"aria-label":"close",className:n.closeButton,onClick:t,size:"large",children:l($e,{})})]}),w(Fe,{className:n.root,children:[l(X,{children:'Set max height for the track. For example, you can increase this if the layout says "Max height reached"'}),l(be,{value:a,onChange:i=>o(i.target.value),placeholder:"Enter max score"}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,onClick:()=>{e.setMaxHeight(a!==""&&!Number.isNaN(+a)?+a:void 0),t()},children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>t(),children:"Cancel"})]})]})]})}const wN=j(vN),SN=Object.freeze(Object.defineProperty({__proto__:null,default:wN},Symbol.toStringTag,{value:"Module"})),CN=ae()(e=>({root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function _N(e){const{classes:t}=CN(),{model:n,handleClose:r}=e,{minScore:a,maxScore:o,scaleType:i}=n,[s,c]=M.exports.useState(`${a!==Number.MIN_VALUE?a:""}`),[u,d]=M.exports.useState(`${o!==Number.MAX_VALUE?o:""}`),f=s!==""&&u!==""&&!Number.isNaN(+s)&&!Number.isNaN(+u)?+u>+s:!0,p=i==="log"&&s!==""&&!Number.isNaN(+s)?+s>0:!0;return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Set min/max score for track",l(pe,{className:t.closeButton,onClick:r,children:l($e,{})})]}),l(Fe,{style:{overflowX:"hidden"},children:w("div",{className:t.root,children:[l(X,{children:"Enter min/max score: "}),f?null:l(X,{color:"error",children:"Max is greater than or equal to min"}),p?null:l(X,{color:"error",children:"Min score should be greater than 0 for log scale"}),l(be,{value:s,onChange:g=>{c(g.target.value)},placeholder:"Enter min score"}),l(be,{value:u,onChange:g=>{d(g.target.value)},placeholder:"Enter max score"}),l(ne,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},disabled:!f,onClick:()=>{n.setMinScore(s!==""&&!Number.isNaN(+s)?+s:void 0),n.setMaxScore(u!==""&&!Number.isNaN(+u)?+u:void 0),r()},children:"Submit"})]})})]})}const TN=Object.freeze(Object.defineProperty({__proto__:null,default:_N},Symbol.toStringTag,{value:"Module"}));var ir={},ke={},xN=v&&v.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),PN=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),kN=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&xN(t,e,n);return PN(t,e),t};Object.defineProperty(ke,"__esModule",{value:!0});ke.setNonce=ke.RgbaStringColorPicker=ke.RgbaColorPicker=ke.RgbStringColorPicker=ke.RgbColorPicker=ke.HsvaStringColorPicker=ke.HsvaColorPicker=ke.HsvStringColorPicker=ke.HsvColorPicker=ke.HslaStringColorPicker=ke.HslaColorPicker=ke.HslStringColorPicker=ke.HslColorPicker=ke.HexColorPicker=ke.HexColorInput=void 0;const ue=kN(M.exports);function lt(){return(lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function so(e,t){if(e==null)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}function Na(e){const t=(0,ue.useRef)(e),n=(0,ue.useRef)(r=>{t.current&&t.current(r)});return t.current=e,n.current}const Kr=(e,t=0,n=1)=>e>n?n:e<t?t:e,Ra=e=>"touches"in e,As=e=>e&&e.ownerDocument.defaultView||self,ld=(e,t,n)=>{const r=e.getBoundingClientRect(),a=Ra(t)?((o,i)=>{for(let s=0;s<o.length;s++)if(o[s].identifier===i)return o[s];return o[0]})(t.touches,n):t;return{left:Kr((a.pageX-(r.left+As(e).pageXOffset))/r.width),top:Kr((a.pageY-(r.top+As(e).pageYOffset))/r.height)}},cd=e=>{!Ra(e)&&e.preventDefault()},Tc=ue.default.memo(e=>{let{onMove:t,onKey:n}=e,r=so(e,["onMove","onKey"]);const a=(0,ue.useRef)(null),o=Na(t),i=Na(n),s=(0,ue.useRef)(null),c=(0,ue.useRef)(!1),[u,d,f]=(0,ue.useMemo)(()=>{const p=m=>{cd(m),(Ra(m)?m.touches.length>0:m.buttons>0)&&a.current?o(ld(a.current,m,s.current)):h(!1)},g=()=>h(!1);function h(m){const y=c.current,b=As(a.current),S=m?b.addEventListener:b.removeEventListener;S(y?"touchmove":"mousemove",p),S(y?"touchend":"mouseup",g)}return[({nativeEvent:m})=>{const y=a.current;if(y&&(cd(m),!((b,S)=>S&&!Ra(b))(m,c.current)&&y)){if(Ra(m)){c.current=!0;const b=m.changedTouches||[];b.length&&(s.current=b[0].identifier)}y.focus(),o(ld(y,m,s.current)),h(!0)}},m=>{const y=m.which||m.keyCode;y<37||y>40||(m.preventDefault(),i({left:y===39?.05:y===37?-.05:0,top:y===40?.05:y===38?-.05:0}))},h]},[i,o]);return(0,ue.useEffect)(()=>f,[f]),ue.default.createElement("div",lt({},r,{onTouchStart:u,onMouseDown:u,className:"react-colorful__interactive",ref:a,onKeyDown:d,tabIndex:0,role:"slider"}))}),lo=e=>e.filter(Boolean).join(" "),xc=({className:e,color:t,left:n,top:r=.5})=>{const a=lo(["react-colorful__pointer",e]);return ue.default.createElement("div",{className:a,style:{top:100*r+"%",left:100*n+"%"}},ue.default.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},it=(e,t=0,n=Math.pow(10,t))=>Math.round(n*e)/n,MN={grad:.9,turn:360,rad:360/(2*Math.PI)},us=e=>(e[0]==="#"&&(e=e.substr(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:1}:{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:1}),qg=(e,t="deg")=>Number(e)*(MN[t]||1),Vg=e=>{const t=/hsla?\(?\s*(-?\d*\.?\d+)(deg|rad|grad|turn)?[,\s]+(-?\d*\.?\d+)%?[,\s]+(-?\d*\.?\d+)%?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i.exec(e);return t?Pc({h:qg(t[1],t[2]),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)}):{h:0,s:0,v:0,a:1}},RN=Vg,Pc=({h:e,s:t,l:n,a:r})=>({h:e,s:(t*=(n<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:r}),Ri=({h:e,s:t,v:n,a:r})=>{const a=(200-t)*n/100;return{h:it(e),s:it(a>0&&a<200?t*n/100/(a<=100?a:200-a)*100:0),l:it(a/2),a:it(r,2)}},Jo=e=>{const{h:t,s:n,l:r}=Ri(e);return`hsl(${t}, ${n}%, ${r}%)`},Eo=e=>{const{h:t,s:n,l:r,a}=Ri(e);return`hsla(${t}, ${n}%, ${r}%, ${a})`},co=({h:e,s:t,v:n,a:r})=>{e=e/360*6,t/=100,n/=100;const a=Math.floor(e),o=n*(1-t),i=n*(1-(e-a)*t),s=n*(1-(1-e+a)*t),c=a%6;return{r:it(255*[n,i,o,o,s,n][c]),g:it(255*[s,n,n,i,o,o][c]),b:it(255*[o,o,s,n,n,i][c]),a:it(r,2)}},Hg=e=>{const t=/hsva?\(?\s*(-?\d*\.?\d+)(deg|rad|grad|turn)?[,\s]+(-?\d*\.?\d+)%?[,\s]+(-?\d*\.?\d+)%?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i.exec(e);return t?uo({h:qg(t[1],t[2]),s:Number(t[3]),v:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)}):{h:0,s:0,v:0,a:1}},AN=Hg,Wg=e=>{const t=/rgba?\(?\s*(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i.exec(e);return t?Ai({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):{h:0,s:0,v:0,a:1}},EN=Wg,ds=e=>{const t=e.toString(16);return t.length<2?"0"+t:t},Ai=({r:e,g:t,b:n,a:r})=>{const a=Math.max(e,t,n),o=a-Math.min(e,t,n),i=o?a===e?(t-n)/o:a===t?2+(n-e)/o:4+(e-t)/o:0;return{h:it(60*(i<0?i+6:i)),s:it(a?o/a*100:0),v:it(a/255*100),a:r}},uo=e=>({h:it(e.h),s:it(e.s),v:it(e.v),a:it(e.a,2)}),Ug=ue.default.memo(({className:e,hue:t,onChange:n})=>{const r=lo(["react-colorful__hue",e]);return ue.default.createElement("div",{className:r},ue.default.createElement(Tc,{onMove:a=>{n({h:360*a.left})},onKey:a=>{n({h:Kr(t+360*a.left,0,360)})},"aria-label":"Hue","aria-valuetext":it(t)},ue.default.createElement(xc,{className:"react-colorful__hue-pointer",left:t/360,color:Jo({h:t,s:100,v:100,a:1})})))}),Gg=ue.default.memo(({hsva:e,onChange:t})=>{const n={backgroundColor:Jo({h:e.h,s:100,v:100,a:1})};return ue.default.createElement("div",{className:"react-colorful__saturation",style:n},ue.default.createElement(Tc,{onMove:r=>{t({s:100*r.left,v:100-100*r.top})},onKey:r=>{t({s:Kr(e.s+100*r.left,0,100),v:Kr(e.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":`Saturation ${it(e.s)}%, Brightness ${it(e.v)}%`},ue.default.createElement(xc,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:Jo(e)})))}),Jn=(e,t)=>{if(e===t)return!0;for(const n in e)if(e[n]!==t[n])return!1;return!0},fa=(e,t)=>e.replace(/\s/g,"")===t.replace(/\s/g,"");function Jg(e,t,n){const r=Na(n),[a,o]=(0,ue.useState)(()=>e.toHsva(t)),i=(0,ue.useRef)({color:t,hsva:a});(0,ue.useEffect)(()=>{if(!e.equal(t,i.current.color)){const c=e.toHsva(t);i.current={hsva:c,color:t},o(c)}},[t,e]),(0,ue.useEffect)(()=>{let c;Jn(a,i.current.hsva)||e.equal(c=e.fromHsva(a),i.current.color)||(i.current={hsva:a,color:c},r(c))},[a,e,r]);const s=(0,ue.useCallback)(c=>{o(u=>Object.assign({},u,c))},[]);return[a,s]}const $N=typeof window<"u"?ue.useLayoutEffect:ue.useEffect;let Xg;const DN=()=>Xg||(typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0),LN=e=>{Xg=e},ud=new Map,Yg=e=>{$N(()=>{const t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!ud.has(t)){const n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,ud.set(t,n);const r=DN();r&&n.setAttribute("nonce",r),t.head.appendChild(n)}},[])},_r=e=>{let{className:t,colorModel:n,color:r=n.defaultColor,onChange:a}=e,o=so(e,["className","colorModel","color","onChange"]);const i=(0,ue.useRef)(null);Yg(i);const[s,c]=Jg(n,r,a),u=lo(["react-colorful",t]);return ue.default.createElement("div",lt({},o,{ref:i,className:u}),ue.default.createElement(Gg,{hsva:s,onChange:c}),ue.default.createElement(Ug,{hue:s.h,onChange:c,className:"react-colorful__last-control"}))},NN={defaultColor:"000",toHsva:e=>Ai(us(e)),fromHsva:e=>(({r:t,g:n,b:r})=>"#"+ds(t)+ds(n)+ds(r))(co(e)),equal:(e,t)=>e.toLowerCase()===t.toLowerCase()||Jn(us(e),us(t))},FN=e=>ue.default.createElement(_r,lt({},e,{colorModel:NN})),BN=({className:e,hsva:t,onChange:n})=>{const r={backgroundImage:`linear-gradient(90deg, ${Eo(Object.assign({},t,{a:0}))}, ${Eo(Object.assign({},t,{a:1}))})`},a=lo(["react-colorful__alpha",e]);return ue.default.createElement("div",{className:a},ue.default.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),ue.default.createElement(Tc,{onMove:o=>{n({a:o.left})},onKey:o=>{n({a:Kr(t.a+o.left)})},"aria-label":"Alpha","aria-valuetext":`${it(100*t.a)}%`},ue.default.createElement(xc,{className:"react-colorful__alpha-pointer",left:t.a,color:Eo(t)})))},pa=e=>{let{className:t,colorModel:n,color:r=n.defaultColor,onChange:a}=e,o=so(e,["className","colorModel","color","onChange"]);const i=(0,ue.useRef)(null);Yg(i);const[s,c]=Jg(n,r,a),u=lo(["react-colorful",t]);return ue.default.createElement("div",lt({},o,{ref:i,className:u}),ue.default.createElement(Gg,{hsva:s,onChange:c}),ue.default.createElement(Ug,{hue:s.h,onChange:c}),ue.default.createElement(BN,{hsva:s,onChange:c,className:"react-colorful__last-control"}))},IN={defaultColor:{h:0,s:0,l:0,a:1},toHsva:Pc,fromHsva:Ri,equal:Jn},ON=e=>ue.default.createElement(pa,lt({},e,{colorModel:IN})),jN={defaultColor:"hsla(0, 0%, 0%, 1)",toHsva:Vg,fromHsva:Eo,equal:fa},zN=e=>ue.default.createElement(pa,lt({},e,{colorModel:jN})),qN={defaultColor:{h:0,s:0,l:0},toHsva:({h:e,s:t,l:n})=>Pc({h:e,s:t,l:n,a:1}),fromHsva:e=>(({h:t,s:n,l:r})=>({h:t,s:n,l:r}))(Ri(e)),equal:Jn},VN=e=>ue.default.createElement(_r,lt({},e,{colorModel:qN})),HN={defaultColor:"hsl(0, 0%, 0%)",toHsva:RN,fromHsva:Jo,equal:fa},WN=e=>ue.default.createElement(_r,lt({},e,{colorModel:HN})),UN={defaultColor:{h:0,s:0,v:0,a:1},toHsva:e=>e,fromHsva:uo,equal:Jn},GN=e=>ue.default.createElement(pa,lt({},e,{colorModel:UN})),JN={defaultColor:"hsva(0, 0%, 0%, 1)",toHsva:Hg,fromHsva:e=>{const{h:t,s:n,v:r,a}=uo(e);return`hsva(${t}, ${n}%, ${r}%, ${a})`},equal:fa},XN=e=>ue.default.createElement(pa,lt({},e,{colorModel:JN})),YN={defaultColor:{h:0,s:0,v:0},toHsva:({h:e,s:t,v:n})=>({h:e,s:t,v:n,a:1}),fromHsva:e=>{const{h:t,s:n,v:r}=uo(e);return{h:t,s:n,v:r}},equal:Jn},KN=e=>ue.default.createElement(_r,lt({},e,{colorModel:YN})),QN={defaultColor:"hsv(0, 0%, 0%)",toHsva:AN,fromHsva:e=>{const{h:t,s:n,v:r}=uo(e);return`hsv(${t}, ${n}%, ${r}%)`},equal:fa},ZN=e=>ue.default.createElement(_r,lt({},e,{colorModel:QN})),eF={defaultColor:{r:0,g:0,b:0,a:1},toHsva:Ai,fromHsva:co,equal:Jn},tF=e=>ue.default.createElement(pa,lt({},e,{colorModel:eF})),nF={defaultColor:"rgba(0, 0, 0, 1)",toHsva:Wg,fromHsva:e=>{const{r:t,g:n,b:r,a}=co(e);return`rgba(${t}, ${n}, ${r}, ${a})`},equal:fa},rF=e=>ue.default.createElement(pa,lt({},e,{colorModel:nF})),aF={defaultColor:{r:0,g:0,b:0},toHsva:({r:e,g:t,b:n})=>Ai({r:e,g:t,b:n,a:1}),fromHsva:e=>(({r:t,g:n,b:r})=>({r:t,g:n,b:r}))(co(e)),equal:Jn},oF=e=>ue.default.createElement(_r,lt({},e,{colorModel:aF})),iF={defaultColor:"rgb(0, 0, 0)",toHsva:EN,fromHsva:e=>{const{r:t,g:n,b:r}=co(e);return`rgb(${t}, ${n}, ${r})`},equal:fa},sF=e=>ue.default.createElement(_r,lt({},e,{colorModel:iF})),lF=/^#?([0-9A-F]{3,8})$/i,cF=e=>{const{color:t="",onChange:n,onBlur:r,escape:a,validate:o,format:i,process:s}=e,c=so(e,["color","onChange","onBlur","escape","validate","format","process"]),[u,d]=(0,ue.useState)(()=>a(t)),f=Na(n),p=Na(r),g=(0,ue.useCallback)(m=>{const y=a(m.target.value);d(y),o(y)&&f(s?s(y):y)},[a,s,o,f]),h=(0,ue.useCallback)(m=>{o(m.target.value)||d(a(t)),p(m)},[t,a,o,p]);return(0,ue.useEffect)(()=>{d(a(t))},[t,a]),ue.default.createElement("input",lt({},c,{value:i?i(u):u,spellCheck:"false",onChange:g,onBlur:h}))},dd=e=>"#"+e,uF=e=>{const{prefixed:t,alpha:n}=e,r=so(e,["prefixed","alpha"]),a=(0,ue.useCallback)(i=>i.replace(/([^0-9A-F]+)/gi,"").substr(0,n?8:6),[n]),o=(0,ue.useCallback)(i=>((s,c)=>{const u=lF.exec(s),d=u?u[1].length:0;return d===3||d===6||!!c&&d===4||!!c&&d===8})(i,n),[n]);return ue.default.createElement(cF,lt({},r,{escape:a,format:t?dd:void 0,process:dd,validate:o}))};ke.setNonce=LN;ke.HexColorPicker=FN;ke.HslaColorPicker=ON;ke.HslaStringColorPicker=zN;ke.HslColorPicker=VN;ke.HslStringColorPicker=WN;ke.HsvaColorPicker=GN;ke.HsvaStringColorPicker=XN;ke.HsvColorPicker=KN;ke.HsvStringColorPicker=ZN;ke.RgbaColorPicker=tF;ke.RgbaStringColorPicker=rF;ke.RgbColorPicker=oF;ke.RgbStringColorPicker=sF;ke.HexColorInput=uF;(function(e){var t=v&&v.__createBinding||(Object.create?function(y,b,S,_){_===void 0&&(_=S);var T=Object.getOwnPropertyDescriptor(b,S);(!T||("get"in T?!b.__esModule:T.writable||T.configurable))&&(T={enumerable:!0,get:function(){return b[S]}}),Object.defineProperty(y,_,T)}:function(y,b,S,_){_===void 0&&(_=S),y[_]=b[S]}),n=v&&v.__setModuleDefault||(Object.create?function(y,b){Object.defineProperty(y,"default",{enumerable:!0,value:b})}:function(y,b){y.default=b}),r=v&&v.__importStar||function(y){if(y&&y.__esModule)return y;var b={};if(y!=null)for(var S in y)S!=="default"&&Object.prototype.hasOwnProperty.call(y,S)&&t(b,y,S);return n(b,y),b},a=v&&v.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(e,"__esModule",{value:!0}),e.ColorPicker=e.ColorPopover=e.PopoverPicker=void 0;const o=r(M.exports),i=a(r0),s=tt,c=ft,u=r(Ze),d=Ee(),f=ke,p=(0,c.makeStyles)()({picker:{position:"relative"},swatches:{display:"flex",padding:12,flexWrap:"wrap"},swatch:{width:24,height:24,margin:4,border:"none",padding:0,cursor:"pointer",outline:"none"}}),g=({color:y,onChange:b})=>{const[S,_]=(0,o.useState)(null),{classes:T}=p();return o.default.createElement("div",{className:T.picker},o.default.createElement("div",{className:T.swatch,style:{backgroundColor:y},onClick:x=>_(x.currentTarget)}),o.default.createElement(h,{anchorEl:S,onClose:()=>_(null),color:y,onChange:b}))};e.PopoverPicker=g;function h({anchorEl:y,onChange:b,onClose:S,color:_}){return o.default.createElement(s.Popover,{open:!!y,anchorEl:y,onClose:S},o.default.createElement(m,{color:_,onChange:b}))}e.ColorPopover=h;function m({onChange:y,color:b}){const{classes:S}=p(),[_,T]=(0,d.useLocalStorage)("colorPickerPalette","set1"),x=u[_],A=Object.keys(u),[R,E]=(0,o.useState)(b),$=(0,i.default)(b).rgb().toString(),B=F=>{E(F);try{y((0,i.default)(F).rgb().toString())}catch{}};return o.default.createElement("div",{style:{display:"flex",padding:10}},o.default.createElement("div",{style:{width:200,margin:5}},o.default.createElement(f.RgbaStringColorPicker,{color:$,onChange:B})),o.default.createElement("div",{style:{width:200,margin:5}},o.default.createElement(s.Select,{value:_,onChange:F=>{const I=F.target.value;T(I)}},A.map(F=>o.default.createElement(s.MenuItem,{value:F,key:F},F))),o.default.createElement("div",{className:S.swatches},x.map((F,I)=>o.default.createElement("button",{key:F+"-"+I,className:S.swatch,style:{background:F},onClick:()=>B(F)}))),o.default.createElement(s.TextField,{helperText:"Manually set color (hex, rgb, or css color name)",value:R,onChange:F=>B(F.target.value)})))}e.ColorPicker=m,e.default=e.PopoverPicker})(ir);const Kg=Jd(ir),dF=g0({__proto__:null,default:Kg},[ir]),fF=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function pF({model:e,handleClose:t}){const{classes:n}=fF(),[r,a]=M.exports.useState(!1);return w(De,{open:!0,onClose:t,children:[w(Ne,{children:["Select either an overall color, or the positive/negative colors. Note that density renderers only work properly with positive/negative colors",l(pe,{"aria-label":"close",className:n.closeButton,onClick:t,children:l($e,{})})]}),w(Fe,{children:[l(Pt,{checked:!r,onClick:()=>a(!1),control:l(Ec,{}),label:"Overall color"}),l(Pt,{checked:r,onClick:()=>a(!0),control:l(Ec,{}),label:"Positive/negative color"}),r?w(Z,{children:[l(X,{children:"Positive color"}),l(ir.ColorPicker,{color:e.posColor||"black",onChange:o=>{e.setPosColor(o),e.setColor(void 0)}}),l(X,{children:"Negative color"}),l(ir.ColorPicker,{color:e.negColor||"black",onChange:o=>{e.setNegColor(o),e.setColor(void 0)}})]}):w(Z,{children:[l(X,{children:"Overall color"}),l(ir.ColorPicker,{color:e.color||"black",onChange:o=>e.setColor(o)})]})]}),w(qe,{children:[l(ne,{onClick:()=>{e.setPosColor(void 0),e.setNegColor(void 0),e.setColor(void 0)},color:"secondary",variant:"contained",children:"Restore default"}),l(ne,{variant:"contained",color:"primary",type:"submit",onClick:()=>t(),children:"Submit"})]})]})}const gF=j(pF),hF=Object.freeze(Object.defineProperty({__proto__:null,default:gF},Symbol.toStringTag,{value:"Module"})),mF=ae()(e=>({root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function yF(e){const{classes:t}=mF(),{model:n,handleClose:r}=e,{minScore:a,maxScore:o,scaleType:i}=n,[s,c]=M.exports.useState(`${a!==Number.MIN_VALUE?a:""}`),[u,d]=M.exports.useState(`${o!==Number.MAX_VALUE?o:""}`),f=s!==""&&u!==""&&!Number.isNaN(+s)&&!Number.isNaN(+u)?+u>+s:!0,p=i==="log"&&s!==""&&!Number.isNaN(+s)?+s>0:!0;return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Set min/max score for track",l(pe,{className:t.closeButton,onClick:r,children:l($e,{})})]}),l(Fe,{style:{overflowX:"hidden"},children:w("div",{className:t.root,children:[l(X,{children:"Enter min/max score: "}),f?null:l(X,{color:"error",children:"Max is greater than or equal to min"}),p?null:l(X,{color:"error",children:"Min score should be greater than 0 for log scale"}),l(be,{value:s,onChange:g=>{c(g.target.value)},placeholder:"Enter min score"}),l(be,{value:u,onChange:g=>{d(g.target.value)},placeholder:"Enter max score"}),l(ne,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},disabled:!f,onClick:()=>{n.setMinScore(s!==""&&!Number.isNaN(+s)?+s:void 0),n.setMaxScore(u!==""&&!Number.isNaN(+u)?+u:void 0),r()},children:"Submit"})]})})]})}const bF=Object.freeze(Object.defineProperty({__proto__:null,default:yF},Symbol.toStringTag,{value:"Module"}));function fd(e,t,n=1){const r=t.map(o=>e.findIndex(i=>i.name===o)).sort((o,i)=>o-i);let a=0;for(let o=0;o<r.length;o++){const i=r[o],s=Math.max(a,i-n);s>=a&&e.splice(s,0,e.splice(i,1)[0]),a=a+1}return e}function pd(e,t,n=1){const r=t.map(o=>e.findIndex(i=>i.name===o)).sort((o,i)=>i-o);let a=e.length-1;for(let o=0;o<r.length;o++){const i=r[o],s=Math.min(a,i+n);s<=a&&e.splice(s,0,e.splice(i,1)[0]),a=a-1}return e}const vF=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},content:{minWidth:800}}));function wF(e){return l(n0.exports,{handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]',children:l(Je,{...e})})}function SF({model:e,handleClose:t}){const{classes:n}=vF(),{sources:r}=e,[a,o]=M.exports.useState(Xd(r||[])),[i,s]=P.useLocalStorage("multiwiggle-showTips",!0);return w(De,{PaperComponent:wF,open:!0,onClose:t,maxWidth:"xl","aria-labelledby":"draggable-dialog-title",children:[w(Ne,{style:{cursor:"move"},id:"draggable-dialog-title",children:["Multi-wiggle color/arrangement editor"," ",l(pe,{className:n.closeButton,onClick:t,children:l($e,{})})]}),w(Fe,{className:n.content,children:[l(ne,{variant:"contained",style:{float:"right"},onClick:()=>s(!i),children:i?"Hide tips":"Show tips"}),l("br",{}),i?w(Z,{children:["Helpful tips",w("ul",{children:[l("li",{children:"You can select rows in the table with the checkboxes"}),l("li",{children:"Multi-select is enabled with shift-click and control-click"}),l("li",{children:'The "Move selected items up/down" can re-arrange subtracks'}),l("li",{children:"Sorting the data grid itself can also re-arrange subtracks"}),l("li",{children:"Changes are applied when you hit Submit"}),l("li",{children:"You can click and drag the dialog box to move it on the screen"}),l("li",{children:"Columns in the table can be hidden using a vertical '...' menu on the right side of each column"})]})]}):null,l(CF,{rows:a,onChange:o,showTips:i})]}),w(qe,{children:[l(ne,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{e.clearLayout(),o(e.sources||[])},children:"Clear custom settings"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>{t(),o([...e.sources||[]])},children:"Cancel"}),l(ne,{variant:"contained",color:"primary",type:"submit",onClick:()=>{e.setLayout(a),t()},children:"Submit"})]})]})}function CF({rows:e,onChange:t,showTips:n}){const[r,a]=M.exports.useState(null),[o,i]=M.exports.useState([]),{name:s,color:c,baseUri:u,...d}=e[0],f=[{field:"color",headerName:"Color",renderCell:y=>{const{value:b,id:S}=y;return l(Kg,{color:b||"blue",onChange:_=>{const T=e.find(x=>x.name===S);T&&(T.color=_),t([...e])}})}},{field:"name",sortingOrder:[null],headerName:"Name",width:P.measureGridWidth(e.map(y=>y.name))},...Object.keys(d).map(y=>({field:y,sortingOrder:[null],renderCell:b=>{const{value:S}=b;return P.isUriLocation(S)?l(_t.UriLink,{value:S}):P.getStr(S)},width:P.measureGridWidth(e.map(b=>b[y]))}))],[p,g]=M.exports.useState("blue"),[h,m]=M.exports.useState({idx:0,field:null});return w("div",{children:[l(ne,{disabled:!o.length,onClick:y=>a(y.currentTarget),children:"Change color of selected items"}),w(ne,{onClick:()=>t(fd([...e],o)),disabled:!o.length,children:[l(lb,{}),n?"Move selected items up":null]}),w(ne,{onClick:()=>t(pd([...e],o)),disabled:!o.length,children:[l(Ld,{}),n?"Move selected items down":null]}),w(ne,{onClick:()=>t(fd([...e],o,e.length)),disabled:!o.length,children:[l(cb,{}),n?"Move selected items to top":null]}),w(ne,{onClick:()=>t(pd([...e],o,e.length)),disabled:!o.length,children:[l(ub,{}),n?"Move selected items to bottom":null]}),l(ir.ColorPopover,{anchorEl:r,color:p,onChange:y=>{g(y),o.forEach(b=>{const S=e.find(_=>_.name===b);S&&(S.color=y)}),t([...e])},onClose:()=>a(null)}),l("div",{style:{height:400,width:"100%"},children:l(qs,{getRowId:y=>y.name,checkboxSelection:!0,disableSelectionOnClick:!0,onSelectionModelChange:y=>i(y),rows:e,rowHeight:25,headerHeight:33,columns:f,sortModel:[],onSortModelChange:y=>{const b=y[0],S=(h.idx+1)%2,_=(b==null?void 0:b.field)||h.field;m({idx:S,field:_}),t(_?[...e].sort((T,x)=>{const A=P.getStr(T[_]),R=P.getStr(x[_]);return S===1?A.localeCompare(R):R.localeCompare(A)}):e)}})})]})}const _F=Object.freeze(Object.defineProperty({__proto__:null,default:SF},Symbol.toStringTag,{value:"Module"})),TF=({tracks:e,onClose:t})=>{const[n,r]=M.exports.useState("MultiWiggle "+Date.now()),a=e.every(o=>o.type==="QuantitativeTrack");return w(De,{open:!0,onClose:()=>t(!1),children:[l(Ne,{children:"Confirm multi-wiggle track create"}),w(Fe,{children:[w(X,{children:[a?null:"Not every track looks like a QuantitativeTrack. This could have unexpected behavior, confirm if it looks ok.","Listing:"]}),l("ul",{children:e.map(o=>w("li",{children:[C.readConfObject(o,"name")," - ",o.type]},o.trackId))}),l(be,{value:n,onChange:o=>r(o.target.value),helperText:"Track name"}),l(X,{children:"Confirm creation of track?"})]}),w(qe,{children:[l(ne,{onClick:()=>t(!1),color:"primary",children:"Cancel"}),l(ne,{onClick:()=>t(!0,{name:n}),color:"primary",variant:"contained",autoFocus:!0,children:"Submit"})]})]})},xF=Object.freeze(Object.defineProperty({__proto__:null,default:TF},Symbol.toStringTag,{value:"Module"})),PF=ae()(e=>({root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function kF(e){const{classes:t}=PF(),{model:n,handleClose:r}=e,[a,o]=M.exports.useState(""),i=a.match(/^[A-Za-z][A-Za-z0-9]$/);return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Color by tag",l(pe,{"aria-label":"close",className:t.closeButton,onClick:r,children:l($e,{})})]}),w(Fe,{style:{overflowX:"hidden"},children:[l(X,{children:"Enter tag to color by: "}),l(X,{color:"textSecondary",children:"Examples: XS or TS for RNA-seq inferred read strand, ts (lower-case) for minimap2 read strand, HP for haplotype, RG for read group, etc."}),l(be,{value:a,onChange:s=>o(s.target.value),placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"color-tag-name-input"},error:a.length===2&&!i,helperText:a.length===2&&!i?"Not a valid tag":"",autoComplete:"off","data-testid":"color-tag-name"}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",onClick:()=>{n.setColorScheme({type:"tag",tag:a}),r()},disabled:!i,children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:r,children:"Cancel"})]})]})]})}const MF=j(kF),RF=Object.freeze(Object.defineProperty({__proto__:null,default:MF},Symbol.toStringTag,{value:"Module"})),AF=ae()(e=>({paper:{padding:e.spacing(2),margin:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}})),EF=["read paired","read mapped in proper pair","read unmapped","mate unmapped","read reverse strand","mate reverse strand","first in pair","second in pair","not primary alignment","read fails platform/vendor quality checks","read is PCR or optical duplicate","supplementary alignment"];function gd(e){const{flag:t=0,setFlag:n}=e;return w(Z,{children:[l(be,{type:"number",value:t,onChange:r=>n(+r.target.value)}),EF.map((r,a)=>{const o=t&1<<a,i=`${r}_${o}`;return w("div",{children:[l("input",{type:"checkbox",checked:Boolean(o),onChange:s=>{s.target.checked?n(t|1<<a):n(t&~(1<<a))}}),l("label",{htmlFor:i,children:r})]},i)})]})}function $F(e){var t,n;const{model:r,handleClose:a}=e,{classes:o}=AF(),{filterBy:i}=r,[s,c]=M.exports.useState(i==null?void 0:i.flagInclude),[u,d]=M.exports.useState(i==null?void 0:i.flagExclude),[f,p]=M.exports.useState(((t=i==null?void 0:i.tagFilter)===null||t===void 0?void 0:t.tag)||""),[g,h]=M.exports.useState(((n=i==null?void 0:i.tagFilter)===null||n===void 0?void 0:n.value)||""),[m,y]=M.exports.useState((i==null?void 0:i.readName)||""),b=f.match(/^[A-Za-z][A-Za-z0-9]$/),S="https://broadinstitute.github.io/picard/explain-flags.html";return w(De,{open:!0,onClose:a,children:[w(Ne,{children:["Filter options",l(pe,{"aria-label":"close",className:o.closeButton,onClick:a,children:l($e,{})})]}),w(Fe,{children:[w(X,{children:["Set filter bitmask options. Refer to ",l(Et,{href:S,children:S})," ","for details"]}),l(Je,{className:o.paper,variant:"outlined",children:w("div",{style:{display:"flex"},children:[w("div",{children:[l(X,{children:"Read must have ALL these flags"}),l(gd,{flag:s,setFlag:c})]}),w("div",{children:[l(X,{children:"Read must have NONE of these flags"}),l(gd,{flag:u,setFlag:d})]})]})}),w(Je,{className:o.paper,variant:"outlined",children:[l(X,{children:"Filter by tag name and value. Use * in the value field to get all reads containing any value for that tag. Example: filter tag name SA with value * to get all split/supplementary reads. Other examples include HP for haplotype, or RG for read group"}),l(be,{className:o.field,value:f,onChange:_=>{p(_.target.value)},placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"color-tag-name-input"},error:f.length===2&&!b,helperText:f.length===2&&!b?"Not a valid tag":"","data-testid":"color-tag-name"}),l(be,{className:o.field,value:g,onChange:_=>{h(_.target.value)},placeholder:"Enter tag value",inputProps:{"data-testid":"color-tag-name-input"},"data-testid":"color-tag-value"})]}),w(Je,{className:o.paper,variant:"outlined",children:[l(X,{children:"Filter by read name"}),l(be,{className:o.field,value:m,onChange:_=>{y(_.target.value)},placeholder:"Enter read name",inputProps:{"data-testid":"color-tag-readname-input"},"data-testid":"color-tag-readname"})]}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",autoFocus:!0,type:"submit",onClick:()=>{r.setFilterBy({flagInclude:s,flagExclude:u,readName:m,tagFilter:f!==""?{tag:f,value:g}:void 0}),a()},children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>a(),children:"Cancel"})]})]})]})}const DF=j($F),LF=Object.freeze(Object.defineProperty({__proto__:null,default:DF},Symbol.toStringTag,{value:"Module"})),NF=ae()(e=>({root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function FF(e){const{classes:t}=NF(),{model:n,handleClose:r}=e,[a,o]=M.exports.useState(""),i=a.match(/^[A-Za-z][A-Za-z0-9]$/);return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Sort by tag",l(pe,{"aria-label":"close",className:t.closeButton,onClick:r,children:l($e,{})})]}),w(Fe,{children:[l(X,{children:"Set the tag to sort by"}),l(X,{color:"textSecondary",children:"Examples: HP for haplotype, RG for read group, etc."}),l(be,{value:a,onChange:s=>o(s.target.value),placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"sort-tag-name-input"},error:a.length===2&&!i,helperText:a.length===2&&!i?"Not a valid tag":"",autoComplete:"off","data-testid":"sort-tag-name"}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,onClick:()=>{n.setSortedBy("tag",a),r()},children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>r(),children:"Cancel"})]})]})]})}const BF=j(FF),IF=Object.freeze(Object.defineProperty({__proto__:null,default:BF},Symbol.toStringTag,{value:"Module"})),OF=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}));function jF(e){const{classes:t}=OF(),{model:n,handleClose:r}=e,{featureHeightSetting:a,noSpacing:o}=n,[i,s]=M.exports.useState(`${a}`),[c,u]=M.exports.useState(o),d=i!==""&&!Number.isNaN(+i);return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Set feature height",l(pe,{className:t.closeButton,onClick:r,children:l($e,{})})]}),w(Fe,{children:[l(X,{children:"Adjust the feature height and whether there is any spacing between features. Setting feature height to 1 and removing spacing makes the display very compact."}),l(be,{value:i,helperText:"Feature height",onChange:f=>{s(f.target.value)}}),l(Pt,{control:l(jt,{checked:!!c,onChange:()=>u(f=>!f)}),label:"Remove spacing between features in y-direction?"}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,disabled:!d,onClick:()=>{n.setFeatureHeight(i!==""&&!Number.isNaN(+i)?+i:void 0),n.setNoSpacing(c),r()},children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>r(),children:"Cancel"})]})]})]})}const zF=j(jF),qF=Object.freeze(Object.defineProperty({__proto__:null,default:zF},Symbol.toStringTag,{value:"Module"})),VF=ae()(e=>({root:{width:500},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}));function HF(e){const{model:t,handleClose:n}=e,{classes:r}=VF(),{maxHeight:a=""}=t,[o,i]=M.exports.useState(`${a}`);return w(De,{open:!0,onClose:n,children:[w(Ne,{children:["Filter options",l(pe,{"aria-label":"close",className:r.closeButton,onClick:n,children:l($e,{})})]}),w(Fe,{className:r.root,children:[l(X,{children:'Set max height for the track. For example, you can increase this if the layout says "Max height reached"'}),l(be,{value:o,onChange:s=>{i(s.target.value)},placeholder:"Enter max height for layout"}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,onClick:()=>{t.setMaxHeight(o!==""&&!Number.isNaN(+o)?+o:void 0),n()},children:"Submit"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>n(),children:"Cancel"})]})]})]})}const WF=j(HF),UF=Object.freeze(Object.defineProperty({__proto__:null,default:WF},Symbol.toStringTag,{value:"Module"})),Qg=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},table:{border:"1px solid #888",margin:e.spacing(4),"& td":{padding:e.spacing(1)}}}));function hd({modifications:e}){const{classes:t}=Qg();return l("table",{className:t.table,children:l("tbody",{children:e.map(([n,r])=>w("tr",{children:[l("td",{children:n}),l("td",{children:r}),l("td",{style:{width:"1em",background:r}})]},n))})})}function GF(e){const{classes:t}=Qg(),{model:n,handleClose:r}=e,{colorBy:a,modificationTagMap:o}=n,i=[...o.entries()];return w(De,{open:!0,onClose:r,children:[w(Ne,{children:["Color by modifications",l(pe,{"aria-label":"close",className:t.closeButton,onClick:r,children:l($e,{})})]}),w(Fe,{children:[l(X,{children:"You can choose to color the modifications in the BAM/CRAM MM/ML specification using this dialog. Choosing modifications colors the modified positions and can color multiple modification types. Choosing the methylation setting colors methylated and unmethylated CpG."}),l(X,{children:"Note: you can revisit this dialog to see the current mapping of colors to modification type for the modification coloring mode"}),w("div",{style:{margin:20},children:[(a==null?void 0:a.type)==="modifications"?l("div",{children:i.length?w(Z,{children:["Current modification-type-to-color mapping",l(hd,{modifications:[...o.entries()]})]}):w("div",{children:[l(X,{children:"Note: color by modifications is already enabled. Loading current modifications..."}),l(Ba,{size:15})]})}):null,(a==null?void 0:a.type)==="methylation"?l(hd,{modifications:[["methylated","red"],["unmethylated","blue"]]}):null]}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",style:{margin:5},onClick:()=>{n.setColorScheme({type:"modifications"}),r()},children:"Modifications"}),l(ne,{variant:"contained",color:"primary",style:{margin:5},onClick:()=>{n.setColorScheme({type:"methylation"}),r()},children:"Methylation"}),l(ne,{variant:"contained",color:"secondary",style:{margin:5},onClick:()=>r(),children:"Cancel"})]})]})]})}const JF=j(GF),XF=Object.freeze(Object.defineProperty({__proto__:null,default:JF},Symbol.toStringTag,{value:"Module"})),YF=ae()(()=>({compact:{paddingRight:0,paddingTop:0,paddingBottom:0}})),KF=["clipPos","flags"];function QF(e){const{classes:t}=YF(),{feature:n}=e,{flags:r}=n,a=["read paired","read mapped in proper pair","read unmapped","mate unmapped","read reverse strand","mate reverse strand","first in pair","second in pair","not primary alignment","read fails platform/vendor quality checks","read is PCR or optical duplicate","supplementary alignment"];return w(_t.BaseCard,{...e,title:"Flags",children:[l(_t.SimpleValue,{name:"Flag",value:r}),l(Yo,{children:a.map((o,i)=>{const s=r&1<<i,c=`${o}_${s}`;return l(Pt,{control:l(jt,{className:t.compact,checked:Boolean(s),name:o,readOnly:!0}),label:o},c)})})]})}function ZF({value:e}){const[t,n]=M.exports.useState(!1),[r,a]=M.exports.useState(!1),o=String(e);return o.length>100?w(Z,{children:[l("button",{type:"button",onClick:()=>{ja(o),a(!0),setTimeout(()=>{a(!1)},700)},children:r?"Copied to clipboard":"Copy"}),l("button",{type:"button",onClick:()=>n(i=>!i),children:t?"Show less":"Show more"}),l("div",{children:t?o:`${o.slice(0,100)}...`})]}):l("div",{children:o})}function eB(e){const t=On(e);let n=0;for(let r=0;r<t.length;r+=2){const a=+t[r],o=t[r+1];o!=="H"&&o!=="S"&&o!=="I"&&(n+=a)}return n}function tB(e){const{tag:t,model:n}=e,r=P.getSession(n);return w(_t.BaseCard,{...e,title:"Supplementary alignments",children:[l(X,{children:"List of supplementary alignment locations"}),l("ul",{children:t.split(";").filter(a=>!!a).map((a,o)=>{const[i,s,c,u]=a.split(","),d=eB(u),f=Math.floor(d/5),p=+s,g=+s+d,h=`${i}:${Math.max(1,p-f)}-${g+f}`,m=p.toLocaleString("en-US"),y=g.toLocaleString("en-US"),b=`${i}:${m}-${y} (${c})`;return l("li",{children:l(Et,{onClick:S=>{S.preventDefault();const{view:_}=n;try{if(_)_.navToLocString(h);else throw new Error("No view associated with this view anymore")}catch(T){console.error(T),r.notify(`${T}`)}},href:"#",children:b})},`${h}-${o}`)})})]})}function nB({locString:e,model:t}){const n=P.getSession(t);return l(Et,{onClick:()=>{const{view:r}=t;try{r?r.navToLocString(e):n.notify("No view associated with this feature detail panel anymore","warning")}catch(a){console.error(a),n.notify(`${a}`)}},href:"#",children:e})}function rB(e){const{model:t}=e,n=JSON.parse(JSON.stringify(t.featureData)),r=n.tags&&n.tags.SA||n.SA;return w(Je,{"data-testid":"alignment-side-drawer",children:[l(_t.FeatureDetails,{...e,omit:KF,feature:n,formatter:(a,o)=>o==="next_segment_position"?l(nB,{model:t,locString:a}):l(ZF,{value:a})}),r?l(tB,{model:t,tag:r}):null,l(QF,{feature:n,...e})]})}const aB=j(rB),oB=Object.freeze(Object.defineProperty({__proto__:null,default:aB},Symbol.toStringTag,{value:"Module"}));function Zg(e){const t=e.children(),n=e.get("thickStart"),r=e.get("thickEnd");if(!n&&!r)return e;const a=t?t.filter(c=>c.get("type")==="block").sort((c,u)=>c.get("start")-u.get("start")):[],o=[];a.forEach(c=>{const u=c.get("start"),d=c.get("end");if(n>=d){const f=e.get("strand")>0?"five":"three";o.push({type:`${f}_prime_UTR`,start:u,end:d})}else if(n>u&&n<d&&r>=d){const f=e.get("strand")>0?"five":"three";o.push({type:`${f}_prime_UTR`,start:u,end:n},{type:"CDS",start:n,end:d})}else if(n<=u&&r>=d)o.push({type:"CDS",start:u,end:d});else if(n>u&&n<d&&r<d){const f=e.get("strand")>0?"five":"three",p=e.get("strand")>0?"three":"five";o.push({type:`${f}_prime_UTR`,start:u,end:n},{type:"CDS",start:n,end:r},{type:`${p}_prime_UTR`,start:r,end:d})}else if(n<=u&&r>u&&r<d){const f=e.get("strand")>0?"three":"five";o.push({type:"CDS",start:u,end:r},{type:`${f}_prime_UTR`,start:r,end:d})}else if(r<=u){const f=e.get("strand")>0?"three":"five";o.push({type:`${f}_prime_UTR`,start:u,end:d})}});const i=Object.fromEntries(e.tags().map(c=>[c,e.get(c)]));return i.subfeatures=o,i.type="mRNA",i.uniqueId=e.id(),delete i.chromStarts,delete i.chromStart,delete i.chromEnd,delete i.chrom,delete i.blockStarts,delete i.blockSizes,delete i.blockCount,delete i.thickStart,delete i.thickEnd,new P.SimpleFeature({data:i,id:e.id()})}function iB(e,t){return Object.fromEntries(t.split("	").map((n,r)=>[e[r],n]))}function eh(e,t,n,r,a,o,i,s){const c=e.split("	"),u=c[t],d=+c[n],f=n===r?1:0,p=+c[r]+f,g=s?iB(s,e):o.parseLine(e,{uniqueId:i}),{blockCount:h,blockSizes:m,blockStarts:y,chromStarts:b}=g;if(h){const _=b||y||[],T=m,x=d;g.subfeatures=[];for(let A=0;A<h;A+=1){const R=(_[A]||0)+x,E=R+(T[A]||0);g.subfeatures.push({uniqueId:`${i}-${A}`,start:R,end:E,type:"block"})}}a&&(g.score=+g[a]),delete g.chrom,delete g.chromStart,delete g.chromEnd;const S=new P.SimpleFeature({...g,start:d,end:p,refName:u,uniqueId:i});return S.get("thickStart")?Zg(S):S}function sB(e){return e.get("thickStart")&&e.get("blockCount")&&e.get("strand")!==0}class lB extends st{async configurePre(t){const n=new Nb({filehandle:Ce.openLocation(C.readConfObject(this.config,"bigBedLocation"),this.pluginManager)}),r=await n.getHeader(t),a=new Ws({autoSql:r.autoSql});return{bigbed:n,header:r,parser:a}}async configure(t){return this.cached||(this.cached=this.configurePre(t).catch(n=>{throw this.cached=void 0,n})),this.cached}async getRefNames(t){const{header:n}=await this.configure(t);return Object.keys(n.refsByName)}async getHeader(t){const{parser:n,header:r}=await this.configure(t),{version:a,fileType:o}=r,{fields:i,...s}=n.autoSql;return{version:a,fileType:o,autoSql:{...s},fields:Object.fromEntries(i.map(({name:c,comment:u})=>[c,u]))}}getFeatures(t,n={}){const{refName:r,start:a,end:o}=t,{signal:i}=n;return Ke(async s=>{try{const{parser:c,bigbed:u}=await this.configure(n);(await u.getFeatureStream(r,a,o,{signal:i,basesPerSpan:o-a})).pipe(xh(),Sd(f=>{const p=c.parseLine(`${r}	${f.start}	${f.end}	${f.rest}`,{uniqueId:f.uniqueId}),{blockCount:g,blockSizes:h,blockStarts:m,chromStarts:y}=p;if(g){const A=y||m||[],R=h,E=f.start;p.subfeatures=[];for(let $=0;$<g;$+=1){const B=(A[$]||0)+E,F=B+(R[$]||0);p.subfeatures.push({uniqueId:`${f.uniqueId}-${$}`,start:B,end:F,type:"block"})}}if(f.uniqueId===void 0)throw new Error("invalid bbi feature");const{chromStart:b,chromEnd:S,chrom:_,...T}=p,x=new Pn({id:`${this.id}-${f.uniqueId}`,data:{...T,start:f.start,end:f.end,refName:r}});return sB(x)?Zg(x):x})).subscribe(s)}catch(c){s.error(c)}},n.signal)}freeResources(){}}const cB=Object.freeze(Object.defineProperty({__proto__:null,default:lB},Symbol.toStringTag,{value:"Module"}));class th extends st{constructor(t,n,r){super(t,n,r);const a=this.getConf("bedGzLocation"),o=this.getConf(["index","indexType"]),i=this.getConf(["index","location"]),s=this.getConf("autoSql"),c=this.pluginManager;this.bed=new Us({filehandle:Ce.openLocation(a,c),csiFilehandle:o==="CSI"?Ce.openLocation(i,c):void 0,tbiFilehandle:o!=="CSI"?Ce.openLocation(i,c):void 0,chunkCacheSize:50*2**20}),this.columnNames=this.getConf("columnNames"),this.scoreColumn=this.getConf("scoreColumn"),this.parser=new Ws({autoSql:s})}async getRefNames(t={}){return this.bed.getReferenceSequenceNames(t)}async getHeader(){return this.bed.getHeader()}async getNames(){if(this.columnNames.length)return this.columnNames;const n=(await this.bed.getHeader()).split(`
`).filter(a=>!!a),r=n[n.length-1];return r!=null&&r.includes("	")?r.slice(1).split("	").map(a=>a.trim()):void 0}getFeatures(t,n={}){return Ke(async r=>{const a=await this.bed.getMetadata(),{columnNumbers:o}=a,i=o.ref-1,s=o.start-1,c=o.end-1,u=await this.getNames();await this.bed.getLines(t.refName,t.start,t.end,{lineCallback:(d,f)=>{r.next(eh(d,i,s,c,this.scoreColumn,this.parser,`${this.id}-${f}`,u))},signal:n.signal}),r.complete()},n.signal)}freeResources(){}}th.capabilities=["getFeatures","getRefNames"];const uB=Object.freeze(Object.defineProperty({__proto__:null,default:th},Symbol.toStringTag,{value:"Module"}));function dB(e){return e[0]===31&&e[1]===139&&e[2]===8}class nh extends st{constructor(){super(...arguments),this.intervalTrees={}}async loadDataP(t={}){const n=this.pluginManager,r=this.getConf("bedLocation"),a=await Ce.openLocation(r,n).readFile(t),o=dB(a)?await Gs(a):a;if(o.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const s=new TextDecoder("utf8",{fatal:!0}).decode(o).split(`
`).filter(_=>!!_),c=[];let u=0;for(;u<s.length&&s[u].startsWith("#");u++)c.push(s[u]);const d=c.join(`
`),f={};for(;u<s.length;u++){const _=s[u],T=_.indexOf("	"),x=_.slice(0,T);f[x]||(f[x]=[]),f[x].push(_)}const p=this.getConf("autoSql"),g=new Ws({autoSql:p}),h=this.getConf("columnNames"),m=this.getConf("scoreColumn"),y=this.getConf("colRef"),b=this.getConf("colStart"),S=this.getConf("colEnd");return{header:d,features:f,parser:g,columnNames:h,scoreColumn:m,colRef:y,colStart:b,colEnd:S}}async loadData(t={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(t).catch(n=>{throw this.bedFeatures=void 0,n})),this.bedFeatures}async getRefNames(t={}){const{features:n}=await this.loadData(t);return Object.keys(n)}async getHeader(t={}){const{header:n}=await this.loadData(t);return n}async getNames(){const{header:t,columnNames:n}=await this.loadData();if(n.length)return n;const r=t.split(`
`).filter(o=>!!o),a=r[r.length-1];return a!=null&&a.includes("	")?a.slice(1).split("	").map(o=>o.trim()):void 0}async loadFeatureIntervalTreeHelper(t){const{colRef:n,colStart:r,colEnd:a,features:o,parser:i,scoreColumn:s}=await this.loadData(),c=o[t];if(!c)return;const u=await this.getNames(),d=new Xs,f=c.map((p,g)=>{const h=`${this.id}-${t}-${g}`;return eh(p,n,r,a,s,i,h,u)});for(let p=0;p<f.length;p++){const g=f[p];d.insert([g.get("start"),g.get("end")],g)}return d}async loadFeatureIntervalTree(t){return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch(n=>{throw this.intervalTrees[t]=void 0,n})),this.intervalTrees[t]}getFeatures(t,n={}){return Ke(async r=>{const{start:a,end:o,refName:i}=t,s=await this.loadFeatureIntervalTree(i);s==null||s.search([a,o]).forEach(c=>r.next(c)),r.complete()},n.signal)}freeResources(){}}nh.capabilities=["getFeatures","getRefNames"];const fB=Object.freeze(Object.defineProperty({__proto__:null,default:nh},Symbol.toStringTag,{value:"Module"})),rh=j(({slot:e})=>{const[t,n]=M.exports.useState(""),[r,a]=M.exports.useState(!1);return w(Z,{children:[e.name?l(zr,{children:e.name}):null,w(Ko,{disablePadding:!0,children:[e.value.map((o,i)=>l(qr,{disableGutters:!0,children:l(be,{value:o,onChange:s=>e.setAtIndex(i,s.target.value),InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{color:"secondary",onClick:()=>e.removeAtIndex(i),children:l(Ia,{})})})}})},i)),r?l(qr,{disableGutters:!0,children:l(be,{value:t,placeholder:"add new",onChange:o=>n(o.target.value),InputProps:{endAdornment:l(Tn,{position:"end",children:w(Z,{children:[l(ne,{color:"primary",variant:"contained",style:{margin:2},"data-testid":`stringArrayAdd-${e.name}`,onClick:()=>{a(!1),e.add(t),n("")},children:"OK"}),l(ne,{color:"primary",variant:"contained",style:{margin:2},onClick:()=>{a(!1),n("")},children:"Cancel"})]})})}})}):null,l(ne,{color:"primary",variant:"contained",style:{margin:4},disabled:r,onClick:()=>a(!0),children:"Add item"})]}),l(Oa,{children:e.description})]})}),md='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',pB=ae()(e=>({callbackEditor:{marginTop:"16px",borderBottom:`1px solid ${e.palette.divider}`,width:"100%",fontFamily:md},textAreaFont:{fontFamily:md},callbackContainer:{width:"100%",overflowX:"auto"},error:{color:"red",fontSize:"0.8em"}}));function gB({slot:e}){const{classes:t}=pB(),[n,r]=M.exports.useState(e.value),[a,o]=M.exports.useState(),i=P.useDebounce(n,400);return M.exports.useEffect(()=>{var s;try{const c=i.startsWith("jexl:")?i:`jexl:${i}`;if(c==="jexl:")throw new Error("Empty jexl expression is not valid");cf(c,(s=He(e).pluginManager)===null||s===void 0?void 0:s.jexl),e.set(c),o(void 0)}catch(c){console.error({e:c}),o(c)}},[i,e]),w(Z,{children:[a?l("p",{className:t.error,children:`${a}`}):null,w("div",{className:t.callbackContainer,children:[l(be,{multiline:!0,className:t.callbackEditor,value:n.startsWith("jexl:")?n.split("jexl:")[1]:n,onChange:s=>r(s.target.value),style:{background:a?"#fdd":void 0},InputProps:{classes:{input:t.textAreaFont}}}),l("p",{children:e.description}),l(fr,{title:w("div",{children:["Callbacks are written in Jexl format. Click to learn more.",l("br",{})," Names of available context items: ",e.contextVariable]}),arrow:!0,children:l(pe,{color:"primary",onClick:()=>{const s=window.open("https://github.com/TomFrost/Jexl","_blank","noopener,noreferrer");s&&(s.opener=null)},children:l(Dd,{})})})]})]})}const hB=j(gB),mB=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>dF),void 0)),yB=e=>{const{value:t="#000",label:n="",TextFieldProps:r={},onChange:a}=e,[o,i]=M.exports.useState(!1);return w("div",{style:{display:"flex"},children:[l(be,{value:t,label:n,onClick:()=>i(!o),onChange:s=>a(s.target.value),...r}),l("div",{style:{marginTop:10},children:l($t.Suspense,{fallback:l("div",{}),children:l(mB,{color:t,onChange:s=>a(s)})})})]})};function bB(e){const{slot:t}=e;return l(yB,{label:t.name,value:t.value,onChange:n=>t.set(n),TextFieldProps:{helperText:t.description,fullWidth:!0}})}const vB=j(bB);function Ei(e){const{helperText:t}=e;return l(be,{...e,helperText:l(Le.SanitizedHTML,{html:t||""}),FormHelperTextProps:{component:"div"},fullWidth:!0})}const ah=j(({slot:e})=>l(Ei,{label:e.name,helperText:e.description,value:e.value,onChange:t=>e.set(t.target.value)})),wB=j(({slot:e})=>l(be,{label:e.name,helperText:e.description,multiline:!0,value:e.value,onChange:t=>e.set(t.target.value)})),SB=()=>l(fb,{children:l("path",{d:"M20.41,3C21.8,5.71 22.35,8.84 22,12C21.8,15.16 20.7,18.29 18.83,21L17.3,20C18.91,17.57 19.85,14.8 20,12C20.34,9.2 19.89,6.43 18.7,4L20.41,3M5.17,3L6.7,4C5.09,6.43 4.15,9.2 4,12C3.66,14.8 4.12,17.57 5.3,20L3.61,21C2.21,18.29 1.65,15.17 2,12C2.2,8.84 3.3,5.71 5.17,3M12.08,10.68L14.4,7.45H16.93L13.15,12.45L15.35,17.37H13.09L11.71,14L9.28,17.33H6.76L10.66,12.21L8.53,7.45H10.8L12.08,10.68Z"})}),oh=ae()(e=>({card:{marginTop:e.spacing(1)}})),CB=j(({slot:e})=>{const{classes:t}=oh(),[n,r]=M.exports.useState("");return w(Z,{children:[l(zr,{children:e.name}),Array.from(e.value,([a,o])=>w(Vr,{raised:!0,className:t.card,children:[l(Lo,{title:a,action:l(pe,{color:"secondary",onClick:()=>e.remove(a),children:l(Ia,{})})}),l(Qo,{children:l(rh,{slot:{name:e.name,value:o,description:`Values associated with entry ${a}`,setAtIndex:(i,s)=>e.setAtKeyIndex(a,i,s),removeAtIndex:i=>e.removeAtKeyIndex(a,i),add:i=>e.addToKey(a,i)}})})]},a)),l(Vr,{raised:!0,className:t.card,children:l(Lo,{disableTypography:!0,title:l(be,{fullWidth:!0,value:n,placeholder:"add new",onChange:a=>r(a.target.value),InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{disabled:n==="",onClick:()=>{e.add(n,[]),r("")},color:"secondary",children:l(pr,{})})})}})})}),l(Oa,{children:e.description})]})}),_B=j(({slot:e})=>{const{classes:t}=oh(),[n,r]=M.exports.useState("");return w(Z,{children:[l(zr,{children:e.name}),Array.from(e.value,([a,o])=>w(Vr,{raised:!0,className:t.card,children:[l(Lo,{title:a,action:l(pe,{color:"secondary",onClick:()=>e.remove(a),children:l(Ia,{})})}),l(Qo,{children:l(ih,{slot:{value:o,set:i=>e.add(a,i)}})})]},a)),l(Vr,{raised:!0,className:t.card,children:l(Lo,{disableTypography:!0,title:l(be,{fullWidth:!0,value:n,placeholder:"add new",onChange:a=>r(a.target.value),InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{disabled:n==="",onClick:()=>{e.add(n,0),r("")},color:"secondary",children:l(pr,{})})})}})})}),l(Oa,{children:e.description})]})}),ih=j(({slot:e})=>{const[t,n]=M.exports.useState(e.value);return M.exports.useEffect(()=>{var r;const a=parseFloat(t);Number.isNaN(a)?(r=e.reset)===null||r===void 0||r.call(e):e.set(a)},[e,t]),l(Ei,{label:e.name,helperText:e.description,value:t,type:"number",onChange:r=>n(r.target.value)})}),TB=j(({slot:e})=>{const[t,n]=M.exports.useState(e.value);return M.exports.useEffect(()=>{const r=parseInt(t,10);Number.isNaN(r)||e.set(r)},[e,t]),l(Ei,{label:e.name,helperText:e.description,value:t,type:"number",onChange:r=>n(r.target.value)})}),xB=j(({slot:e})=>w(Vs,{children:[l(Pt,{label:e.name,control:l(jt,{checked:e.value,onChange:t=>e.set(t.target.checked)})}),l(Oa,{children:e.description})]})),PB=j(({slot:e,slotSchema:t})=>{const n=Dh(bs(t)),r=vs(vs(bs(df(n,"value")))[1]).map(a=>a.value);return l(Ei,{value:e.value,label:e.name,select:!0,helperText:e.description,onChange:a=>e.set(a.target.value),children:r.map(a=>l(Kt,{value:a,children:a},a))})}),kB=j(({slot:e})=>{var t;return l(Le.FileSelector,{location:e.value,setLocation:n=>e.set(n),name:e.name,description:e.description,rootModel:(t=He(e).pluginManager)===null||t===void 0?void 0:t.rootModel})}),yd={string:ah,text:wB,fileLocation:kB,stringArray:rh,stringArrayMap:CB,numberMap:_B,number:ih,integer:TB,color:vB,stringEnum:PB,boolean:xB,frozen:qu,configRelationships:qu},sh=ae()(e=>({paper:{display:"flex",marginBottom:e.spacing(2),position:"relative"},paperContent:{width:"100%"},slotModeSwitch:{width:24,background:e.palette.secondary.light,display:"flex",justifyContent:"center",alignItems:"center"}})),MB=j(({slot:e,slotSchema:t})=>{const{classes:n}=sh(),{type:r}=e;let a=e.isCallback?hB:yd[r];return a||(console.warn(`no slot editor defined for ${r}, editing as string`),a=ah),r in yd||console.warn(`SlotEditor needs to implement ${r}`),w(Je,{className:n.paper,children:[l("div",{className:n.paperContent,children:l(a,{slot:e,slotSchema:t})}),l("div",{className:n.slotModeSwitch,children:e.contextVariable.length?l(pe,{onClick:()=>e.isCallback?e.convertToValue():e.convertToCallback(),title:`convert to ${e.isCallback?"regular value":"callback"}`,color:"secondary",children:e.isCallback?l(SB,{}):l(db,{})}):null})]})}),RB=j(({typeNameChoices:e,slot:t,slotName:n,onChange:r})=>{const{classes:a}=sh();return l(Je,{className:a.paper,children:l("div",{className:a.paperContent,children:l(be,{value:t.type,label:"Type",select:!0,helperText:`Type of ${n} to use`,fullWidth:!0,onChange:r,children:e.map(o=>l(Kt,{value:o,children:o},o))})})})}),lh=ae()(e=>({expandIcon:{color:"#fff"},root:{padding:e.spacing(1,3,1,1)},expansionPanelDetails:{display:"block",padding:e.spacing(1)},accordion:{border:`1px solid ${e.palette.text.primary}`},noOverflow:{width:"100%",overflowX:"auto"}})),ch=j(e=>{const{classes:t}=lh(),{slotName:n,slotSchema:r,schema:a,slot:o=a[n],path:i=[]}=e;let s;if(C.isConfigurationSchemaType(r)){if(o.length)return o.map((u,d)=>{const f=`${a0.exports.singular(n)} ${d+1}`;return M.exports.createElement(ch,{...e,key:f,slot:u,slotName:f})});const c=C.getTypeNamesFromExplicitlyTypedUnion(r);return c.length&&(s=l(RB,{typeNameChoices:c,slotName:n,slot:o,onChange:u=>{u.target.value!==o.type&&a.setSubschema(n,{type:u.target.value})}})),w(No,{defaultExpanded:!0,className:t.accordion,children:[l(Fo,{expandIcon:l(Ea,{className:t.expandIcon}),children:l(X,{children:[...i,n].join("\u2794")})}),w(zd,{className:t.expansionPanelDetails,children:[s,l(Yo,{className:t.noOverflow,children:l(uh,{schema:o,path:[...i,n]})})]})]})}return C.isConfigurationSlotType(r)?l(MB,{slot:o,slotSchema:r},n):null}),uh=j(({schema:e,path:t=[]})=>{const n=Td(e).properties;return l(Z,{children:Object.entries(n).map(([r,a])=>l(ch,{slotName:r,slotSchema:a,path:t,schema:e},r))})}),AB=j(({model:e})=>{const{classes:t}=lh(),{target:n}=e,r=n&&C.readConfObject(n,"trackId"),a=n&&C.readConfObject(n,"name");return w(Z,{children:[w(No,{defaultExpanded:!0,className:t.accordion,children:[l(Fo,{expandIcon:l(Ea,{className:t.expandIcon}),children:l(X,{children:a!=null?a:"Configuration"})}),l(zd,{className:t.expansionPanelDetails,"data-testid":"configEditor",children:n?l(uh,{schema:n}):"no target set"})]},r),l("div",{style:{height:300}})]})}),EB=Object.freeze(Object.defineProperty({__proto__:null,default:AB},Symbol.toStringTag,{value:"Module"}));function $B(e){return typeof e=="object"&&!!e&&"jbrowse"in e}const DB=j(({rootModel:e,onClose:t})=>{if(!e)return null;if(!$B(e))return console.error("Incorrect rootmodel"),null;const{jbrowse:n,session:r}=e;return w(De,{open:!0,onClose:t,children:[l(Ne,{children:"Set default session"}),l(Fe,{children:l(X,{children:'Select "Set current session as default" to make your current session saved to the config file. You can also hit "Clear default session", which would remove the default session from the config.'})}),w(qe,{children:[l(ne,{variant:"contained",onClick:()=>{n.setDefaultSessionConf({name:"New session"}),t()},children:"Clear default session"}),l(ne,{color:"secondary",variant:"contained",onClick:()=>t(),children:"Cancel"}),l(ne,{color:"primary",variant:"contained",onClick:()=>{n.setDefaultSessionConf(r),t()},children:"Set current session as default"})]})]})}),LB=DB,NB=Object.freeze(Object.defineProperty({__proto__:null,default:LB},Symbol.toStringTag,{value:"Module"})),FB=ae()(()=>({table:{minWidth:500,minHeight:150},buttonCell:{padding:3},button:{display:"inline-block",padding:3,minHeight:0,minWidth:0}})),BB=j(({rootModel:e,setIsAssemblyBeingEdited:t,setAssemblyBeingEdited:n})=>{const{classes:r}=FB();function a(i){e.jbrowse.removeAssemblyConf(i)}const o=e.jbrowse.assemblies.map(i=>{const s=C.readConfObject(i,"name"),c=C.readConfObject(i,"displayName"),u=C.readConfObject(i,"aliases");return w(Do,{children:[l(St,{children:s}),l(St,{children:c}),l(St,{children:u?u.toString():""}),w(St,{className:r.buttonCell,children:[l(pe,{"data-testid":`${s}-edit`,className:r.button,onClick:()=>{t(!0),n(i)},children:l(pb,{color:"primary"})}),l(pe,{"data-testid":`${s}-delete`,className:r.button,onClick:()=>{a(s)},children:l(Ia,{color:"error"})})]})]},s)});return l(Bd,{component:Je,children:w(Id,{className:r.table,children:[l(Od,{children:w(Do,{children:[l(St,{children:l(X,{variant:"h5",children:"Name"})}),l(St,{children:l(X,{variant:"h5",children:"Display name"})}),l(St,{children:l(X,{variant:"h5",children:"Aliases"})}),l(St,{children:l(X,{variant:"h5",children:"Actions"})})]})}),l(jd,{children:o})]})})}),IB=ae()(e=>({root:{flexGrow:1,overflow:"hidden",padding:e.spacing(0,3)},paper:{margin:`${e.spacing(1)}px auto`,padding:e.spacing(2)},createButton:{marginTop:"1em",justifyContent:"center"},paperContent:{flex:"auto",margin:`${e.spacing(1)}px auto`,padding:e.spacing(1),overflow:"auto"}})),OB=j(({adapterSelection:e,setAdapterSelection:t,adapterTypes:n})=>l(be,{value:e,label:"Type",select:!0,helperText:"Type of adapter to use",fullWidth:!0,onChange:r=>{t(r.target.value)},children:n.map(r=>l(Kt,{value:r,children:r},r))})),jB=j(({adapterSelection:e,fastaLocation:t,setFastaLocation:n,faiLocation:r,setFaiLocation:a,gziLocation:o,setGziLocation:i,twoBitLocation:s,setTwoBitLocation:c,chromSizesLocation:u,setChromSizesLocation:d})=>e==="IndexedFastaAdapter"||e==="BgzipFastaAdapter"?w(Ft,{container:!0,spacing:2,children:[l(Ft,{item:!0,children:l(va,{name:"fastaLocation",location:t,setLocation:f=>n(f)})}),l(Ft,{item:!0,children:l(va,{name:"faiLocation",location:r,setLocation:f=>a(f)})}),e==="BgzipFastaAdapter"?l(Ft,{item:!0,children:l(va,{name:"gziLocation",location:o,setLocation:f=>i(f)})}):null]}):e==="TwoBitAdapter"?w(Ft,{container:!0,spacing:2,children:[l(Ft,{item:!0,children:l(va,{name:"twoBitLocation",location:s,setLocation:f=>c(f)})}),l(Ft,{item:!0,children:l(va,{name:"chromSizesLocation (optional, can be added to speed up loading 2bit files with many contigs)",location:u,setLocation:f=>d(f)})})]}):null),Ta={uri:""},zB=j(({rootModel:e,setFormOpen:t})=>{const{classes:n}=IB(),r=["IndexedFastaAdapter","BgzipFastaAdapter","TwoBitAdapter"],[a,o]=M.exports.useState(""),[i,s]=M.exports.useState(""),[c,u]=M.exports.useState(r[0]),[d,f]=M.exports.useState(Ta),[p,g]=M.exports.useState(Ta),[h,m]=M.exports.useState(Ta),[y,b]=M.exports.useState(Ta),[S,_]=M.exports.useState(Ta);function T(){if(a==="")e.session.notify("Can't create an assembly without a name");else{t(!1);let x;c==="IndexedFastaAdapter"?x={name:a,displayName:i,sequence:{adapter:{type:"IndexedFastaAdapter",fastaLocation:d,faiLocation:p}}}:c==="BgzipFastaAdapter"?x={name:a,displayName:i,sequence:{adapter:{type:"BgzipFastaAdapter",fastaLocation:d,faiLocation:p,gziLocation:h}}}:c==="TwoBitAdapter"&&(x={name:a,displayName:i,sequence:{adapter:{type:"TwoBitAdapter",twoBitLocation:y,chromSizesLocation:S}}}),e.jbrowse.addAssemblyConf(x),e.session.notify(`Successfully added ${a} assembly to JBrowse 2`,"success")}}return w("div",{className:n.root,children:[w(Je,{className:n.paper,children:[l(be,{id:"assembly-name",inputProps:{"data-testid":"assembly-name"},label:"Assembly name",helperText:"The assembly name e.g. hg38",variant:"outlined",value:a,onChange:x=>o(x.target.value)}),l(be,{id:"assembly-name",inputProps:{"data-testid":"assembly-display-name"},label:"Assembly display name",helperText:'A human readable display name for the assembly e.g. "Homo sapiens (hg38)"',variant:"outlined",value:i,onChange:x=>s(x.target.value)}),l(OB,{adapterSelection:c,setAdapterSelection:u,adapterTypes:r}),l("div",{className:n.paperContent,children:l(jB,{adapterSelection:c,fastaLocation:d,setFastaLocation:f,faiLocation:p,setFaiLocation:g,gziLocation:h,setGziLocation:m,twoBitLocation:y,setTwoBitLocation:b,chromSizesLocation:S,setChromSizesLocation:_})})]}),l(Ft,{container:!0,className:n.createButton,children:l(Ft,{item:!0,children:l(ne,{variant:"contained",color:"secondary",startIcon:l(pr,{}),onClick:T,children:"Create new assembly"})})})]})}),qB=j(({assembly:e})=>l(bc,{model:{target:e}})),VB=ae()(e=>({titleBox:{color:"#fff",backgroundColor:e.palette.primary.main,textAlign:"center"},dialogContent:{width:"100%"},backButton:{color:"#fff",position:"absolute",left:e.spacing(4),top:e.spacing(4)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}})),HB=j(({rootModel:e,onClose:t})=>{const{classes:n}=VB(),[r,a]=M.exports.useState(!1),[o,i]=M.exports.useState(!1),[s,c]=M.exports.useState(),u=!r&&!o;return w(De,{open:!0,onClose:()=>t(!1),children:[w(Ne,{className:n.titleBox,children:[u?"Assembly manager":null,r?w(Z,{children:[l(pe,{"aria-label":"back",className:n.backButton,onClick:()=>a(!1),children:l($c,{})}),"Add new assembly"]}):null,o?w(Z,{children:[l(pe,{"aria-label":"back",className:n.backButton,onClick:()=>i(!1),children:l($c,{})}),WB(s)]}):null,l(pe,{"aria-label":"close",className:n.closeButton,onClick:()=>t(!1),children:l($e,{})})]}),l(Fe,{children:w("div",{className:n.dialogContent,children:[u?l(BB,{rootModel:e,setIsAssemblyBeingEdited:i,setAssemblyBeingEdited:c}):null,o?l(qB,{assembly:s}):null,r?l(zB,{rootModel:e,setFormOpen:a}):null]})}),l(qe,{children:u?w(Z,{children:[l(ne,{color:"secondary",variant:"contained",onClick:()=>t(!1),children:"Close"}),l(ne,{variant:"contained",color:"secondary",startIcon:l(pr,{}),onClick:()=>a(!0),children:"Add new assembly"})]}):null})]})});function WB(e){return e!==void 0?e.name:null}const UB=HB,GB=Object.freeze(Object.defineProperty({__proto__:null,default:UB},Symbol.toStringTag,{value:"Module"})),JB=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>$O),void 0)),XB=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>NO),void 0)),YB=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>OO),void 0)),KB=M.exports.lazy(()=>se(()=>Promise.resolve().then(()=>VO),void 0)),QB=ae()(e=>({searchBox:{margin:e.spacing(2)},menuIcon:{marginRight:e.spacing(1),marginBottom:0}}));function ZB({model:e,setHeaderHeight:t,setAssemblyIdx:n,assemblyIdx:r}){const{classes:a}=QB(),o=P.getSession(e),[i,s]=M.exports.useState(),[c,u]=M.exports.useState(),[d,f]=M.exports.useState(),[p,g]=M.exports.useState(),[h,m]=M.exports.useState(),[y,b]=M.exports.useState(!1),[S,_]=M.exports.useState(!1),{assemblyNames:T}=e;function x(B,F){const I=C.readConfObject(B,"name"),U=o.prepareToBreakConnection(B);if(U){const[z,G]=U;Object.keys(G).length>0?g({connectionConf:B,safelyBreakConnection:z,dereferenceTypeCount:G,name:I}):z()}F&&m({name:I,connectionConf:B})}const A=[{label:"Turn on/off connections...",onClick:()=>_(!0)}];P.isSessionModelWithConnections(o)&&(A.unshift({label:"Add connection",onClick:()=>{P.isSessionModelWithWidgets(o)&&o.showWidget(o.addWidget("AddConnectionWidget","addConnectionWidget"))}}),A.push({label:"Delete connections...",onClick:()=>b(!0)}));const R=T.length>1?[{label:"Select assembly...",subMenu:T.map((B,F)=>({label:B,onClick:()=>n(F)}))}]:[],E=[{label:"Add track...",onClick:()=>{P.isSessionModelWithWidgets(o)&&o.showWidget(o.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}},...R],$=He(e).pluginManager.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:o});return w("div",{ref:B=>t((B==null?void 0:B.getBoundingClientRect().height)||0),"data-testid":"hierarchical_track_selector",children:[w("div",{style:{display:"flex"},children:[P.isSessionWithAddTracks(o)&&l(pe,{className:a.menuIcon,onClick:B=>f(B.currentTarget),children:l(Rd,{})}),o.makeConnection&&l(pe,{className:a.menuIcon,onClick:B=>s(B.currentTarget),children:l(zp,{})}),e.selection.length?l(pe,{className:a.menuIcon,onClick:B=>u(B.currentTarget),children:l(gb,{badgeContent:e.selection.length,color:"primary",children:l(hb,{})})}):null,l(be,{className:a.searchBox,label:"Filter tracks",value:e.filterText,onChange:B=>e.setFilterText(B.target.value),fullWidth:!0,InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{color:"secondary",onClick:e.clearFilterText,children:l(qd,{})})})}})]}),l(Or,{anchorEl:i,open:Boolean(i),onMenuItemClick:(B,F)=>{F(),s(void 0)},onClose:()=>s(void 0),menuItems:A}),l(Or,{anchorEl:d,open:Boolean(d),onMenuItemClick:(B,F)=>{F(),f(void 0)},onClose:()=>f(void 0),menuItems:E}),l(Or,{anchorEl:c,open:Boolean(c),onMenuItemClick:(B,F)=>{F(),u(void 0)},onClose:()=>u(void 0),menuItems:[{label:"Clear",onClick:()=>e.clearSelection()},...$.map(B=>({...B,..."onClick"in B?{onClick:()=>B.onClick(e)}:{}}))]}),w(M.exports.Suspense,{fallback:l("div",{}),children:[p?l(JB,{modalInfo:p,setModalInfo:g}):null,h?l(XB,{handleClose:()=>m(void 0),deleteDialogDetails:h,session:o}):null,y?l(YB,{handleClose:()=>b(!1),breakConnection:x,session:o}):null,S?l(KB,{handleClose:()=>_(!1),session:o,breakConnection:x}):null]})]})}const eI=j(ZB);function Es(e){return((e==null?void 0:e.children.map(t=>t.children.length?Es(t):t.conf))||[]).flat(1/0)}const tI=ae()(e=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:"#eee"}},contrastColor:{color:e.palette.secondary.contrastText},accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5},accordionText:{margin:"auto 0"}}));function $s(e,t=new Map){e.id&&e.children.length&&t.set(e.id,e);for(let n=0;n<e.children.length;n++){const r=e.children[n];$s(r,t)}return t}function nI(e=""){return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}function rI(e){var t,n;const{data:r,isOpen:a,style:o,setOpen:i}=e,{checked:s,conf:c,drawerPosition:u,id:d,isLeaf:f,model:p,name:g,nestingLevel:h,onChange:m,selected:y,toggleCollapse:b,tree:S}=r,{classes:_}=tI(),T=10,[x,A]=M.exports.useState(null),[R,E]=M.exports.useState(),$=h*T+(f?T:0),B=c&&C.readConfObject(c,["description"])||"";return w("div",{style:o,className:f?void 0:_.accordionBase,children:[new Array(h).fill(0).map((F,I)=>l("div",{style:{left:I*T+4,height:o==null?void 0:o.height},className:_.nestingLevelMarker},`mark-${I}`)),l("div",{className:f?void 0:_.accordionCard,onClick:()=>{x||(b(d),i(!a))},style:{marginLeft:$,whiteSpace:"nowrap",width:"100%"},children:w("div",{className:f?void 0:_.accordionColor,children:[f?w(Z,{children:[l(fr,{title:B+(y?" (in selection)":""),placement:u==="left"?"right":"left",children:l(Pt,{className:_.checkboxLabel,control:l(jt,{className:_.compactCheckbox,checked:s,onChange:()=>m(d),disabled:nI(g),inputProps:{"data-testid":`htsTrackEntry-${d}`}}),label:l("div",{style:{background:y?"#cccc":void 0,padding:1},children:g})})}),l(pe,{onClick:F=>E({target:F.currentTarget,id:d,conf:c}),style:{padding:0},color:"secondary","data-testid":`htsTrackEntryMenu-${d}`,children:l(Dc,{})})]}):l("div",{className:_.accordionText,children:w(X,{children:[a?l(mb,{}):l(yb,{}),g,l(pe,{onClick:F=>{A(F.currentTarget),F.stopPropagation()},className:_.contrastColor,children:l(Dc,{})})]})}),x?l(Or,{anchorEl:x,menuItems:[{label:"Add to selection",onClick:()=>p.addToSelection(Es($s(S).get(d)))},{label:"Remove from selection",onClick:()=>p.removeFromSelection(Es($s(S).get(d)))}],onMenuItemClick:(F,I)=>{I(),A(null)},open:Boolean(x),onClose:()=>A(null)}):null,R?l(Or,{anchorEl:R==null?void 0:R.target,menuItems:[...((n=(t=P.getSession(p)).getTrackActionMenuItems)===null||n===void 0?void 0:n.call(t,R.conf))||[],{label:"Add to selection",onClick:()=>p.addToSelection([R.conf])},...y?[{label:"Remove from selection",onClick:()=>p.removeFromSelection([R.conf])}]:[]],onMenuItemClick:(F,I)=>{I(),E(void 0)},open:Boolean(R),onClose:()=>E(void 0)}):null]})})]})}const aI=ae()(e=>({fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}}));function bd(e,t,n,r){const a=!!e.conf,o=!!r[e.id];return{data:{defaultHeight:a?22:40,isLeaf:a,isOpenByDefault:!0,nestingLevel:t,selected:o,...e,...n},nestingLevel:t,node:e}}const vd=j(({height:e,tree:t,model:n})=>{const{filterText:r,selection:a,view:o}=n,i=M.exports.useRef(null),s=P.getSession(n),{drawerPosition:c}=s,u=M.exports.useMemo(()=>Object.fromEntries(a.map(p=>[p.trackId,p])),[a]),d=M.exports.useMemo(()=>({onChange:p=>o.toggleTrack(p),toggleCollapse:p=>n.toggleCategory(p),tree:t,model:n,drawerPosition:c}),[o,n,c,t]),f=M.exports.useCallback(function*(){for(let g=0;g<t.children.length;g++){const h=t.children[g];yield bd(h,0,d,u)}for(;;){const g=yield;for(let h=0;h<g.node.children.length;h++){const m=g.node.children[h];yield bd(m,g.nestingLevel+1,d,u)}}},[t,d,u]);return M.exports.useEffect(()=>{i.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,r]),l(Z,{children:l(i0,{ref:i,treeWalker:f,height:e,children:rI})})}),oI=({tree:e,model:t,offset:n})=>typeof jest>"u"?l(o0,{disableWidth:!0,children:({height:r})=>l(vd,{height:r-n,model:t,tree:e})}):l(vd,{height:9e3,model:t,tree:e}),iI=({overrideDimensions:e,children:t})=>e?l("div",{style:{...e},children:t}):l(Z,{children:t}),sI=j(({model:e,toolbarHeight:t,overrideDimensions:n})=>{const{classes:r}=aI(),a=P.getSession(e),[o,i]=M.exports.useState(null);function s(){i(null)}const c=P.isSessionModelWithConnections(a),u=P.isSessionWithAddTracks(a);return w(iI,{overrideDimensions:n,children:[l(lI,{model:e,toolbarHeight:t}),u||c?w(Z,{children:[l(bb,{color:"secondary",className:r.fab,onClick:d=>i(d.currentTarget),children:l(pr,{})}),w(vb,{anchorEl:o,open:Boolean(o),onClose:()=>i(null),children:[c?l(Kt,{onClick:()=>{s(),P.isSessionModelWithWidgets(a)&&a.showWidget(a.addWidget("AddConnectionWidget","addConnectionWidget"))},children:"Add connection"}):null,u?l(Kt,{onClick:()=>{s(),P.isSessionModelWithWidgets(a)&&a.showWidget(a.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))},children:"Add track"}):null]})]}):null]})}),lI=j(({model:e,toolbarHeight:t=0})=>{const[n,r]=M.exports.useState(0),[a,o]=M.exports.useState(0),{assemblyNames:i}=e,s=i[n];return s?w(Z,{children:[l(eI,{model:e,setHeaderHeight:o,setAssemblyIdx:r,assemblyIdx:n}),l(oI,{tree:e.hierarchy(s),model:e,offset:t+a})]}):null}),cI=Object.freeze(Object.defineProperty({__proto__:null,default:sI},Symbol.toStringTag,{value:"Module"})),ga=ae()(e=>({spacing:{marginBottom:e.spacing(3)},paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},spacer:{height:e.spacing(8)},card:{marginTop:e.spacing(1)}}));function uI({trackAdapter:e,trackType:t}){var n;const{classes:r}=ga();return e.type==="SNPCoverageAdapter"?w(X,{className:r.spacing,children:["Selected ",l("code",{children:t}),". Using adapter"," ",l("code",{children:e.type})," with subadapter"," ",l("code",{children:(n=e.subadapter)===null||n===void 0?void 0:n.type}),". Please enter a track name and, if necessary, update the track type."]}):w(X,{className:r.spacing,children:["Using adapter ",l("code",{children:e.type})," and guessing track type"," ",l("code",{children:t}),". Please enter a track name and, if necessary, update the track type."]})}function dI(e){let t="";const n=[];return e.forEach(r=>{var a,o,i,s,c,u,d,f;!((a=r.adapterMetadata)===null||a===void 0)&&a.category&&(t!==((o=r.adapterMetadata)===null||o===void 0?void 0:o.category)&&(t=(i=r.adapterMetadata)===null||i===void 0?void 0:i.category,n.push(l(wb,{value:(c=r.adapterMetadata)===null||c===void 0?void 0:c.category,children:(u=r.adapterMetadata)===null||u===void 0?void 0:u.category},(s=r.adapterMetadata)===null||s===void 0?void 0:s.category))),n.push(l(Kt,{value:r.name,children:!((d=r.adapterMetadata)===null||d===void 0)&&d.displayName?(f=r.adapterMetadata)===null||f===void 0?void 0:f.displayName:r.name},r.name)))}),n}function fI(e){return e.getElementTypesInGroup("adapter")}function pI(e){return e.getElementTypesInGroup("track")}const gI=j(({model:e})=>{const{classes:t}=ga(),[n,r]=M.exports.useState(""),[a,o]=M.exports.useState(""),[i,s]=M.exports.useState(["Name","ID"]),[c,u]=M.exports.useState(["CDS","exon"]),d=[{label:"Indexing attributes",values:i},{label:"Feature types to exclude",values:c}];return M.exports.useEffect(()=>{e.setTextIndexingConf({attributes:i,exclude:c})},[e,i,c]),w(Je,{className:t.paper,children:[l(zr,{children:"Indexing configuration"}),d.map((f,p)=>l(Vr,{raised:!0,className:t.card,children:w(Qo,{children:[l(zr,{children:f.label}),w(Ko,{disablePadding:!0,children:[f.values.map((g,h)=>l(qr,{disableGutters:!0,children:l(be,{value:g,InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{color:"secondary",onClick:()=>{const m=f.values.filter((y,b)=>b!==h);p===0?s(m):u(m)},children:l(Ia,{})})})}})},h)),l(qr,{disableGutters:!0,children:l(be,{value:p===0?n:a,placeholder:"add new",onChange:g=>{p===0?r(g.target.value):o(g.target.value)},InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{onClick:()=>{if(p===0){const g=i;g.push(n),s(g),r("")}else{const g=c;g.push(a),u(g),o("")}},disabled:p===0?n==="":a==="",color:"secondary","data-testid":"stringArrayAdd-Feat",children:l(pr,{})})})}})})]})]})},f.label))]})}),dh=j(({model:e})=>{const{classes:t}=ga(),{trackAdapter:n}=e,{pluginManager:r}=He(e),a=fI(r);return w(be,{className:t.spacing,value:(n==null?void 0:n.type)!=="UNKNOWN"?n==null?void 0:n.type:"",label:"adapterType",helperText:"Select an adapter type",select:!0,fullWidth:!0,onChange:o=>e.setAdapterHint(o.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}},children:[a.filter(o=>{var i,s;return!(!((i=o.adapterMetadata)===null||i===void 0)&&i.hiddenFromGUI)&&!(!((s=o.adapterMetadata)===null||s===void 0)&&s.category)}).map(o=>{var i,s;return l(Kt,{value:o.name,children:!((i=o.adapterMetadata)===null||i===void 0)&&i.displayName?(s=o.adapterMetadata)===null||s===void 0?void 0:s.displayName:o.name},o.name)}),dI(a.filter(o=>{var i;return!(!((i=o.adapterMetadata)===null||i===void 0)&&i.hiddenFromGUI)}))]})});function hI({model:e}){const{classes:t}=ga();return w(Z,{children:[w(X,{className:t.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",l(Et,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer",children:"check for new releases"})," ","of JBrowse to see if they support this data type or"," ",l(Et,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer",children:"file an issue"})," ","and add a feature request for this data type."]}),l(dh,{model:e})]})}const mI=j(({model:e})=>{const{classes:t}=ga(),n=P.getSession(e),{trackType:r}=e,a=pI(He(n).pluginManager);return l(be,{className:t.spacing,value:r,label:"trackType",helperText:"Select a track type",select:!0,fullWidth:!0,onChange:o=>{e.setTrackType(o.target.value)},SelectProps:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}},children:a.map(({name:o})=>l(Kt,{value:o,children:o},o))})}),yI=j(({model:e})=>{const t=P.getSession(e),{assembly:n}=e;return l(be,{value:n,label:"assemblyName",helperText:"Assembly to which the track will be added",select:!0,fullWidth:!0,onChange:r=>e.setAssembly(r.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}},children:t.assemblies.map(r=>C.readConfObject(r,"name")).map(r=>l(Kt,{value:r,children:r},r))})});function bI({model:e}){const{classes:t}=ga(),[n,r]=M.exports.useState(!0),{trackName:a,trackAdapter:o,trackType:i,warningMessage:s,adapterHint:c}=e;if(e.unsupported)return w(X,{className:t.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",l(Et,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer",children:"check for new releases"})," ","of JBrowse or"," ",l(Et,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer",children:"file an issue"})," ","and add a feature request for this data type."]});if((o==null?void 0:o.type)===Y.UNKNOWN)return l(hI,{model:e});if(c===""&&o&&e.setAdapterHint(o.type),!(o!=null&&o.type))return l(X,{children:"Could not recognize this data type."});const u=P.supportedIndexingAdapters(o==null?void 0:o.type);return w("div",{children:[o?l(uI,{trackAdapter:o,trackType:i}):null,s?l(X,{style:{color:"orange"},children:s}):null,l(be,{className:t.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:a,onChange:d=>e.setTrackName(d.target.value),inputProps:{"data-testid":"trackNameInput"}}),l(dh,{model:e}),l(mI,{model:e}),l(yI,{model:e}),P.isElectron&&u&&l(Vs,{children:l(Pt,{label:"Index track for text searching?",control:l(jt,{checked:n,onChange:d=>{r(d.target.checked),e.setTextIndexTrack(d.target.checked)}})})}),P.isElectron&&n&&u?l(gI,{model:e}):null]})}const vI=j(bI),wI=ae()(e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},spacer:{height:e.spacing(8)}}));function SI({model:e}){const{classes:t}=wI(),n=Aa(e);return w(Je,{className:t.paper,children:[l(Le.FileSelector,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,setName:e.setTrackName,rootModel:n}),l("div",{className:t.spacer}),l(Le.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,setName:e.setTrackName,rootModel:n})]})}const CI=j(SI),_I=ae()(e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginTop:e.spacing(1),marginRight:e.spacing(1)},actionsContainer:{marginBottom:e.spacing(2)},stepContent:{margin:e.spacing(1)},alertContainer:{padding:`${e.spacing(2)}px 0px ${e.spacing(2)}px 0px`}})),fs=["Enter track data","Confirm track type"];function TI({model:e}){const[t,n]=M.exports.useState(0),{classes:r}=_I(),{pluginManager:a}=He(e),{rootModel:o}=a,{jobsManager:i}=o,s=P.getSession(e),{assembly:c,trackAdapter:u,trackData:d,trackName:f,trackType:p,textIndexTrack:g,textIndexingConf:h}=e,[m,y]=M.exports.useState();function b(x){switch(x){case 0:return l(CI,{model:e});case 1:return l(vI,{model:e});default:return l(X,{children:"Unknown step"})}}async function S(){if(t!==fs.length-1){n(t+1);return}const x=[`${f.toLowerCase().replace(/ /g,"_")}-${Date.now()}`,`${s.adminMode?"":"-sessionTrack"}`].join(""),A=s.assemblyManager.get(c);if(u&&u.type!=="UNKNOWN"){if(s.addTrackConf({trackId:x,type:p,name:f,assemblyNames:[c],adapter:{...u,sequenceAdapter:C.getConf(A,["sequence","adapter"])}}),e.view){if(e.view.showTrack(x),P.isElectron&&g&&P.supportedIndexingAdapters(u.type)){const R=h||{attributes:["Name","ID"],exclude:["CDS","exon"]},E=f+"-index",$={indexingParams:{...R,assemblies:[c],tracks:[x],indexType:"perTrack",name:E,timestamp:new Date().toISOString()},name:E,cancelCallback:()=>i.abortJob()};i.queueJob($)}}else s.notify("Open a new view, or use the track selector in an existing view, to view this track","info");e.clearData(),s.hideWidget(e)}else y(`Failed to add track.
The configuration of this file is not currently supported.`)}function _(){y(void 0),n(t-1)}function T(){switch(t){case 0:return!d;case 1:return!(f&&p&&(u==null?void 0:u.type)&&c);default:return!0}}return l("div",{className:r.root,children:l(Vd,{className:r.stepper,activeStep:t,orientation:"vertical",children:fs.map((x,A)=>w(Hd,{children:[l(Wd,{children:x}),w(Ud,{children:[b(A),w("div",{className:r.actionsContainer,children:[l(ne,{disabled:t===0,onClick:_,className:r.button,children:"Back"}),l(ne,{disabled:T(),variant:"contained",color:"primary",onClick:S,className:r.button,"data-testid":"addTrackNextButton",children:t===fs.length-1?"Add":"Next"})]}),m?l("div",{className:r.alertContainer,children:l(Ed,{severity:"error",children:m})}):null]})]},x))})})}const xI=j(TI);function PI({model:e}){const[t,n]=P.useLocalStorage("trackSelector-choice","Default"),{pluginManager:r}=He(e),a=r.getElementTypesInGroup("add track workflow"),o={Default:xI,...Object.fromEntries(a.map(c=>[c.name,c.ReactComponent]))},i=o[t]?t:"Default",s=o[i];return w(Z,{children:[w(Vs,{children:[l(Sb,{value:i,onChange:c=>n(c.target.value),children:Object.keys(o).map(c=>l(Kt,{value:c,children:c},c))}),l(Oa,{children:"Type of add track workflow"})]}),l("br",{}),l(s,{model:e})]})}const kI=j(PI),MI=Object.freeze(Object.defineProperty({__proto__:null,default:kI},Symbol.toStringTag,{value:"Module"})),RI=j(e=>{const{connectionType:t,model:n,session:r}=e,a=t.configEditorComponent||bc;return l(M.exports.Suspense,{fallback:l("div",{children:"Loading..."}),children:l(a,{model:{target:n},session:r})})});function AI(e){const{connectionTypeChoices:t,connectionType:n,setConnectionType:r}=e;return M.exports.useEffect(()=>{n||r(t[0])}),l("form",{autoComplete:"off",children:n?l(be,{value:n.name,label:"connectionType",helperText:n.description?w(Z,{children:[n.description,n.url?l(pe,{href:n.url,rel:"noopener noreferrer",target:"_blank",color:"secondary",children:l(Cb,{})}):null]}):null,select:!0,fullWidth:!0,onChange:a=>r(t.find(o=>o.name===a.target.value)),variant:"outlined",children:t.map(a=>l(Kt,{value:a.name,children:a.displayName||a.name},a.name))}):null})}const EI=ae()(e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginTop:e.spacing(1),marginRight:e.spacing(1)},actionsContainer:{marginBottom:e.spacing(2)}})),ps=["Select a Connection Type","Configure Connection"];function $I({model:e}){const[t,n]=M.exports.useState(),[r,a]=M.exports.useState(),[o,i]=M.exports.useState(0),{classes:s}=EI(),c=P.getSession(e),{pluginManager:u}=He(c);function d(){switch(o){case 0:return l(AI,{connectionTypeChoices:u.getElementTypesInGroup("connection"),connectionType:t,setConnectionType:m=>{n(m),m&&a(m.configSchema.create({connectionId:`${m.name}-${Date.now()}`},He(e)))}});case 1:return t&&r?l(RI,{connectionType:t,model:r,session:c}):null;default:return l(X,{children:"Unknown step"})}}function f(){o===ps.length-1?g():i(o+1)}function p(){i(o-1)}function g(){const m=c.addConnectionConf(r);c.makeConnection&&c.makeConnection(m),c.hideWidget(e)}function h(){return o===0&&t||o===1&&r}return l("div",{className:s.root,children:l(Vd,{className:s.stepper,activeStep:o,orientation:"vertical",children:ps.map(m=>w(Hd,{children:[l(Wd,{children:m}),w(Ud,{children:[d(),w("div",{className:s.actionsContainer,children:[l(ne,{disabled:o===0,onClick:p,className:s.button,children:"Back"}),l(ne,{disabled:!h(),variant:"contained",color:"primary",onClick:f,className:s.button,"data-testid":"addConnectionNext",children:o===ps.length-1?"Connect":"Next"})]})]})]},m))})})}const DI=j($I),LI=Object.freeze(Object.defineProperty({__proto__:null,default:DI},Symbol.toStringTag,{value:"Module"})),fh=ae()(()=>({closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},lockedPluginTooltip:{marginRight:"0.5rem"}}));function NI(){const{classes:e}=fh();return l(fr,{className:e.lockedPluginTooltip,title:"This plugin was installed by an administrator, you cannot remove it.",children:l(_b,{})})}function FI({onClose:e,plugin:t}){const{classes:n}=fh();return w(De,{open:!0,onClose:()=>e(),children:[l(Ne,{children:l(pe,{className:n.closeDialog,"aria-label":"close-dialog",onClick:()=>e(),children:l($e,{})})}),w(Fe,{children:[w(X,{children:["Please confirm that you want to remove ",t,". Note: if any resources in this session still use this plugin, it may cause your session to crash"]}),w(qe,{children:[l(ne,{variant:"contained",color:"primary",onClick:()=>{window.setTimeout(()=>{e(t)},500)},children:"Confirm"}),l(ne,{variant:"contained",color:"secondary",onClick:()=>{e()},children:"Cancel"})]})]})]})}function BI({plugin:e,model:t,pluginManager:n}){const[r,a]=M.exports.useState(),o=P.getSession(t),{sessionPlugins:i}=o,s=i==null?void 0:i.some(f=>n.pluginMetadata[e.name].url===f.url),c=Ge(t,3),{jbrowse:u,adminMode:d}=c;return w(Z,{children:[r?l(FI,{plugin:r,onClose:f=>{if(f){const p=n.pluginMetadata[e.name];d?u.removePlugin(p):Ut.isSessionWithSessionPlugins(o)&&o.removeSessionPlugin(p)}a(void 0)}}):null,w(qr,{children:[d||s?l(pe,{"aria-label":"removePlugin","data-testid":`removePlugin-${e.name}`,onClick:()=>a(e.name),children:l($e,{})}):l(NI,{}),l(X,{children:e.name})]},e.name)]})}const II=j(BI);function OI({pluginManager:e,model:t}){const{plugins:n}=e,r=n.filter(o=>{var i;return(i=e.pluginMetadata[o.name])===null||i===void 0?void 0:i.isCore}).map(o=>o.name),a=n.filter(o=>!r.includes(o.name));return l(Ko,{children:a.length?a.filter(o=>o.name.toLowerCase().includes(t.filterText.toLowerCase())).map(o=>l(II,{plugin:o,model:t,pluginManager:e},o.name)):l(X,{children:"No plugins currently installed"})})}const jI=j(OI),zI=ae()(()=>({card:{margin:"1em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center",margin:"0.4em 0em"}}));function qI({plugin:e,model:t,adminMode:n}){const{classes:r}=zI(),a=P.getSession(t),{pluginManager:o}=He(t),i=Boolean(o.runtimePluginDefinitions.find(p=>p.url===e.url)),[s,c]=M.exports.useState(!1),u=i||s,d=Ge(t,3),{jbrowse:f}=d;return w(Vr,{variant:"outlined",className:r.card,children:[w(Qo,{children:[l("div",{className:r.dataField,children:l(X,{variant:"h5",children:l(Et,{href:`${e.location}#readme`,target:"_blank",rel:"noopener",children:e.name})})}),w("div",{className:r.dataField,children:[l(Tb,{style:{marginRight:"0.5em"}}),l(X,{children:e.authors.join(", ")})]}),l(X,{className:r.bold,children:"Description:"}),l(X,{children:e.description})]}),l(xb,{children:l(ne,{variant:"contained",color:"primary",disabled:u,startIcon:i?l(Pb,{}):l(pr,{}),onClick:()=>{n?f.addPlugin({name:e.name,url:e.url}):Ut.isSessionWithSessionPlugins(a)&&a.addSessionPlugin(e),c(!0)},children:i?"Installed":"Install"})})]},e.name)}const VI=j(qI),HI=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1)},dialogContent:{display:"flex",flexDirection:"column"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"}}));function WI({open:e,onClose:t,model:n}){const{classes:r,cx:a}=HI(),[o,i]=M.exports.useState(""),[s,c]=M.exports.useState(""),[u,d]=M.exports.useState(""),[f,p]=M.exports.useState(""),[g,h]=M.exports.useState(!1);function m(x){const{name:A,value:R}=x.target;A==="umdName"&&i(R),A==="umdUrl"&&c(R),A==="esmUrl"&&d(R),A==="cjsUrl"&&p(R)}function y(){h(!g)}const{jbrowse:b}=Aa(n),S=Boolean(o&&s||u||f);function _(){if(!S)return;const x={};o&&s&&(x.name=o,x.umdUrl=s),u&&(x.esmUrl=u),f&&(x.cjsUrl=f),b.addPlugin(x)}function T(){i(""),c(""),d(""),p(""),t()}return w(De,{open:e,onClose:T,children:[w(Ne,{children:["Add custom plugin",l(pe,{size:"medium",className:r.closeButton,onClick:()=>t(),children:l($e,{})})]}),w("form",{onSubmit:_,children:[w(Fe,{className:r.dialogContent,children:[l(Ir,{children:"Enter the name of the plugin and its URL. The name should match what is defined in the plugin's build."}),l(be,{id:"umd-name-input",name:"umdName",label:"Plugin name",variant:"outlined",value:o,onChange:m}),l(be,{id:"umd-url-input",name:"umdUrl",label:"Plugin URL",variant:"outlined",value:s,onChange:m}),w(Ir,{onClick:y,children:[l(pe,{className:a(r.expand,{[r.expandOpen]:g}),"aria-expanded":g,"aria-label":"show more",children:l(Ea,{})}),"Advanced options"]}),l(kb,{in:g,children:w("div",{className:r.dialogContent,children:[l(Ir,{children:"The above fields assume that the plugin is built in UMD format. If your plugin is in another format, or you have additional builds you want to add (such as a CJS build for using NodeJS APIs in desktop), you can enter the URLs for those builds below."}),l(be,{id:"esm-url-input",name:"esmUrl",label:"ESM build URL",variant:"outlined",value:u,onChange:m}),l(be,{id:"cjs-url-input",name:"cjsUrl",label:"CJS build URL",variant:"outlined",value:f,onChange:m})]})})]}),w(qe,{children:[l(ne,{variant:"contained",onClick:T,children:"Cancel"}),l(ne,{variant:"contained",color:"primary",onClick:_,disabled:!S,children:"Submit"})]})]})]})}const UI=j(WI),GI=ae()(e=>({root:{margin:e.spacing(1)},expandIcon:{color:"#fff"},adminBadge:{margin:"0.5em",borderRadius:3,backgroundColor:e.palette.quaternary.main,padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"0.5em",display:"flex",justifyContent:"center"}}));function JI({model:e}){const{classes:t}=GI(),[n,r]=M.exports.useState(),[a,o]=M.exports.useState(),[i,s]=M.exports.useState(!1),{adminMode:c}=P.getSession(e),{pluginManager:u}=He(e);return M.exports.useEffect(()=>{const d=new AbortController,{signal:f}=d;return(async()=>{try{const p=await fetch("https://jbrowse.org/plugin-store/plugins.json",{signal:f});if(!p.ok){const h=await p.text();throw new Error(`Failed to fetch plugin data: ${p.status} ${p.statusText} ${h}`)}const g=await p.json();f.aborted||r(g.plugins)}catch(p){console.error(p),o(p)}})(),()=>{d.abort()}},[]),w("div",{className:t.root,children:[c&&w(Z,{children:[!P.isElectron&&w("div",{className:t.adminBadge,children:[l(Mb,{style:{marginRight:"0.3em"}}),w(X,{children:["You are using the ",l("code",{children:"admin-server"}),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store."]})]}),l("div",{className:t.customPluginButton,children:l(ne,{variant:"contained",color:"primary",onClick:()=>s(!0),children:"Add custom plugin"})}),l(UI,{open:i,onClose:()=>s(!1),model:e})]}),l(be,{label:"Filter plugins",value:e.filterText,onChange:d=>e.setFilterText(d.target.value),fullWidth:!0,InputProps:{endAdornment:l(Tn,{position:"end",children:l(pe,{color:"secondary",onClick:()=>e.clearFilterText(),children:l(qd,{})})})}}),w(No,{defaultExpanded:!0,children:[l(Fo,{expandIcon:l(Ea,{className:t.expandIcon}),children:l(X,{variant:"h5",children:"Installed plugins"})}),l("div",{style:{margin:"1em"},children:l(jI,{pluginManager:u,model:e})})]}),w(No,{defaultExpanded:!0,children:[l(Fo,{expandIcon:l(Ea,{className:t.expandIcon}),children:l(X,{variant:"h5",children:"Available plugins"})}),a?l(X,{color:"error",children:`${a}`}):n?n.filter(d=>!P.isElectron&&!(d.esmUrl||d.url||d.umdUrl)?!1:d.name.toLowerCase().includes(e.filterText.toLowerCase())).map(d=>l(VI,{plugin:d,model:e,adminMode:!!c},d.name)):l(X,{children:"Loading..."})]})]})}const XI=j(JI),YI=Object.freeze(Object.defineProperty({__proto__:null,default:XI},Symbol.toStringTag,{value:"Module"}));class KI extends st{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"gffGzLocation"),o=C.readConfObject(t,["index","indexType"]),i=C.readConfObject(t,["index","location"]),s=C.readConfObject(t,"dontRedispatch");this.dontRedispatch=s||["chromosome","contig","region"],this.gff=new Us({filehandle:Ce.openLocation(a,this.pluginManager),csiFilehandle:o==="CSI"?Ce.openLocation(i,this.pluginManager):void 0,tbiFilehandle:o!=="CSI"?Ce.openLocation(i,this.pluginManager):void 0,chunkCacheSize:50*2**20,renameRefSeqs:c=>c})}async getRefNames(t={}){return this.gff.getReferenceSequenceNames(t)}async getHeader(){return this.gff.getHeader()}getFeatures(t,n={}){return Ke(async r=>{const a=await this.gff.getMetadata();this.getFeaturesHelper(t,n,a,r,!0)},n.signal)}async getFeaturesHelper(t,n={},r,a,o,i=t){try{const s=[];if(await this.gff.getLines(t.refName,t.start,t.end,(d,f)=>{s.push(this.parseLine(r.columnNumbers,d,f))}),o&&s.length){let d=1/0,f=-1/0;if(s.forEach(p=>{const g=p.fields[2];if(!this.dontRedispatch.includes(g)){const h=p.start-1;h<d&&(d=h),p.end>f&&(f=p.end)}}),f>t.end||d<t.start){this.getFeaturesHelper({...t,start:d,end:f},n,r,a,!1,t);return}}const c=s.map(d=>(d.fields[8]&&d.fields[8]!=="."?d.fields[8].includes("_lineHash")||(d.fields[8]+=`;_lineHash=${d.lineHash}`):d.fields[8]=`_lineHash=${d.lineHash}`,d.fields.join("	"))).join(`
`);Gd.parseStringSync(c,{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1}).forEach(d=>this.formatFeatures(d).forEach(f=>{nl(f.get("start"),f.get("end"),i.start,i.end)&&a.next(f)})),a.complete()}catch(s){a.error(s)}}parseLine(t,n,r){const a=n.split("	");return{start:+a[t.start-1],end:+a[t.end-1],lineHash:r,fields:a}}formatFeatures(t){return t.map(n=>new Pn({data:this.featureData(n),id:`${this.id}-offset-${n.attributes._lineHash[0]}`}))}featureData(t){const n={...t};n.start-=1,t.strand==="+"?n.strand=1:t.strand==="-"?n.strand=-1:t.strand==="."?n.strand=0:n.strand=void 0,n.phase=Number(t.phase),n.refName=t.seq_id,t.score===null&&delete n.score,t.phase===null&&delete n.score;const r=["start","end","seq_id","score","type","source","phase","strand"],a=t.attributes||{};return Object.keys(a).forEach(o=>{let i=o.toLowerCase();if(r.includes(i)&&(i+="2"),a[o]!==null){let s=a[o];Array.isArray(s)&&s.length===1&&([s]=s),n[i]=s}}),n.refName=n.seq_id,t.child_features&&t.child_features.length&&(n.subfeatures=t.child_features.map(o=>o.map(i=>this.featureData(i))).flat()),delete n.child_features,delete n.data,delete n.derived_features,delete n._linehash,delete n.attributes,delete n.seq_id,n}freeResources(){}}const QI=Object.freeze(Object.defineProperty({__proto__:null,default:KI},Symbol.toStringTag,{value:"Module"}));function ZI(e){return e[0]===31&&e[1]===139&&e[2]===8}class eO extends st{async loadDataP(){const t=this.pluginManager,n=await Ce.openLocation(this.getConf("gffLocation"),t).readFile(),r=ZI(n)?await Gs(n):n;if(r.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const a=new TextDecoder("utf8",{fatal:!0}).decode(r),o=a.split(`
`),i=[];for(let d=0;d<o.length&&o[d].startsWith("#");d++)i.push(o[d]);const s=i.join(`
`),u=Gd.parseStringSync(a,{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1}).flat().map((d,f)=>new Pn({data:this.featureData(d),id:`${this.id}-offset-${f}`})).reduce((d,f)=>{const p=f.get("refName");return d[p]||(d[p]=new Xs),d[p].insert([f.get("start"),f.get("end")],f),d},{});return{header:s,intervalTree:u}}async loadData(){return this.gffFeatures||(this.gffFeatures=this.loadDataP().catch(t=>{throw this.gffFeatures=void 0,t})),this.gffFeatures}async getRefNames(t={}){const{intervalTree:n}=await this.loadData();return Object.keys(n)}async getHeader(){const{header:t}=await this.loadData();return t}getFeatures(t,n={}){return Ke(async r=>{var a;try{const{start:o,end:i,refName:s}=t,{intervalTree:c}=await this.loadData();(a=c[s])===null||a===void 0||a.search([o,i]).forEach(u=>r.next(u)),r.complete()}catch(o){r.error(o)}},n.signal)}featureData(t){const n={...t};n.start-=1,t.strand==="+"?n.strand=1:t.strand==="-"?n.strand=-1:t.strand==="."?n.strand=0:n.strand=void 0,n.phase=Number(t.phase),n.refName=t.seq_id,t.score===null&&delete n.score,t.phase===null&&delete n.score;const r=["start","end","seq_id","score","type","source","phase","strand"],a=t.attributes||{};return Object.keys(a).forEach(o=>{let i=o.toLowerCase();if(r.includes(i)&&(i+="2"),a[o]!==null){let s=a[o];Array.isArray(s)&&s.length===1&&([s]=s),n[i]=s}}),n.refName=n.seq_id,t.child_features&&t.child_features.length&&(n.subfeatures=t.child_features.map(o=>o.map(i=>this.featureData(i))).flat()),delete n.child_features,delete n.data,delete n.derived_features,delete n.attributes,delete n.seq_id,n}freeResources(){}}const tO=Object.freeze(Object.defineProperty({__proto__:null,default:eO},Symbol.toStringTag,{value:"Module"})),nO={refName:"seq_id"},rO={seq_id:"refName"};class Xo{constructor(t,n,r){this.ncFeature=t,this.uniqueId=r||t.id(),this.parentHandle=n}set(){throw new Error("not implemented")}jb2TagToJb1Tag(t){return(nO[t]||t).toLowerCase()}jb1TagToJb2Tag(t){const n=t.toLowerCase();return rO[n]||n}get(t){const n=this.ncFeature.get(this.jb2TagToJb1Tag(t));return n&&t==="subfeatures"?n.map(r=>new Xo(r,this)):n}tags(){return this.ncFeature.tags().map(t=>this.jb1TagToJb2Tag(t))}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const t={uniqueId:this.id()};return this.ncFeature.tags().forEach(n=>{const r=this.jb1TagToJb2Tag(n),a=this.ncFeature.get(n);r==="subfeatures"?t.subfeatures=(a||[]).map(o=>new Xo(o,this).toJSON()):t[r]=a}),t}}class aO extends st{constructor(t,n,r){super(t,n,r);const a=C.readConfObject(t,"refNames"),o=C.readConfObject(t,"rootUrlTemplate");this.configRefNames=a,this.nclist=new Fb({baseUrl:"",urlTemplate:o.uri,readFile:i=>new s0(String(o.baseUri?new URL(i,o.baseUri).toString():i)).readFile()})}getFeatures(t,n={}){return Ke(async r=>{const{signal:a}=n;for await(const o of this.nclist.getFeatures(t,n))P.checkAbortSignal(a),r.next(this.wrapFeature(o));r.complete()})}wrapFeature(t){return new Xo(t,void 0,`${this.id}-${t.id()}`)}async hasDataForRefName(t){const n=await this.nclist.getDataRoot(t);return!!(n&&n.stats&&n.stats.featureCount)}getRefNames(){return Promise.resolve(this.configRefNames||[])}freeResources(){}}const oO=Object.freeze(Object.defineProperty({__proto__:null,default:aO},Symbol.toStringTag,{value:"Module"}));class iO extends kl{constructor(t,n,r){super(t,n,r),this.chromSizesData=this.initChromSizes(),this.twobit=new Bb({filehandle:Ce.openLocation(C.readConfObject(t,"twoBitLocation"),this.pluginManager)})}async initChromSizes(){const t=C.readConfObject(this.config,"chromSizesLocation");if(t.uri!=="/path/to/default.chrom.sizes"&&t.uri!==""){const r=await Ce.openLocation(t,this.pluginManager).readFile("utf8");return Object.fromEntries(r==null?void 0:r.split(`
`).filter(a=>!!a.trim()).map(a=>{const[o,i]=a.split("	");return[o,+i]}))}}async getRefNames(){const t=await this.chromSizesData;return t?Object.keys(t):this.twobit.getSequenceNames()}async getRegions(){const t=await this.chromSizesData;if(t)return Object.keys(t).map(r=>({refName:r,start:0,end:t[r]}));const n=await this.twobit.getSequenceSizes();return Object.keys(n).map(r=>({refName:r,start:0,end:n[r]}))}getFeatures({refName:t,start:n,end:r}){return Ke(async a=>{const o=await this.twobit.getSequenceSize(t),i=o!==void 0?Math.min(o,r):r,s=await this.twobit.getSequence(t,n,i);s&&a.next(new Pn({id:`${t} ${n}-${i}`,data:{refName:t,start:n,end:i,seq:s}})),a.complete()})}freeResources(){}}const sO=Object.freeze(Object.defineProperty({__proto__:null,default:iO},Symbol.toStringTag,{value:"Module"}));class ph extends kl{constructor(t,n,r){super(t,n,r),this.seqCache=new Ub({cache:new RC({maxSize:200}),fill:async(a,o)=>{const{refName:i,start:s,end:c,fasta:u}=a;return u.getSequence(i,s,c,{...a,signal:o})}})}async getRefNames(t){const{fasta:n}=await this.setup();return n.getSequenceNames(t)}async getRegions(t){const{fasta:n}=await this.setup(),r=await n.getSequenceSizes(t);return Object.keys(r).map(a=>({refName:a,start:0,end:r[a]}))}async setupPre(){const t=this.getConf("fastaLocation"),n=this.getConf("faiLocation");return{fasta:new Ib({fasta:Ce.openLocation(t,this.pluginManager),fai:Ce.openLocation(n,this.pluginManager)})}}async getHeader(){const t=this.getConf("metadataLocation");return t.uri===""||t.uri==="/path/to/fa.metadata.yaml"?null:Ce.openLocation(t).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(t=>{throw this.setupP=void 0,t})),this.setupP}getFeatures(t,n){const{refName:r,start:a,end:o}=t;return Ke(async i=>{const{fasta:s}=await this.setup(),c=await s.getSequenceSize(r,n),u=c!==void 0?Math.min(c,o):o,d=[],f=128e3,p=a-a%f,g=o+(f-o%f);for(let m=p;m<g;m+=f){const y={refName:r,start:m,end:m+f};d.push(this.seqCache.get(JSON.stringify(y),{...y,fasta:s},n==null?void 0:n.signal))}const h=(await Promise.all(d)).join("").slice(a-p).slice(0,o-a);h&&i.next(new P.SimpleFeature({id:`${r} ${a}-${u}`,data:{refName:r,start:a,end:u,seq:h}})),i.complete()})}freeResources(){}}const lO=Object.freeze(Object.defineProperty({__proto__:null,default:ph},Symbol.toStringTag,{value:"Module"}));class cO extends ph{async setupPre(){const t=this.getConf("fastaLocation"),n=this.getConf("faiLocation"),r=this.getConf("gziLocation"),a={fasta:Ce.openLocation(t,this.pluginManager),fai:Ce.openLocation(n,this.pluginManager),gzi:Ce.openLocation(r,this.pluginManager)};return{fasta:new Ob(a)}}}const uO=Object.freeze(Object.defineProperty({__proto__:null,default:cO},Symbol.toStringTag,{value:"Module"}));class dO extends oa{async setupPre(){const t=this.pluginManager,r=await Ce.openLocation(this.getConf("chromSizesLocation"),t).readFile("utf8");return Object.fromEntries(r.split(`
`).map(a=>a.trim()).filter(a=>!!a).map(a=>{const[o,i]=a.split("	");return[o,+i]}))}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(t=>{throw this.setupP=void 0,t})),this.setupP}async getRegions(){const t=await this.setup();return Object.keys(t).map(n=>({refName:n,start:0,end:t[n]}))}getHeader(){return{}}freeResources(){}}const fO=Object.freeze(Object.defineProperty({__proto__:null,default:dO},Symbol.toStringTag,{value:"Module"}));class gh extends st{constructor(){super(...arguments),this.windowSize=1e3,this.windowDelta=1e3,this.gcMode="content"}async configure(){var t;const n=await((t=this.getSubAdapter)===null||t===void 0?void 0:t.call(this,this.getConf("sequenceAdapter")));if(!n)throw new Error("Error getting subadapter");return n.dataAdapter}async getRefNames(){return(await this.configure()).getRefNames()}getFeatures(t,n){return Ke(async r=>{var a;const o=await this.configure(),i=this.windowSize===1?1:this.windowSize/2,s=this.windowSize===1;let{start:c,end:u}=t;if(c=Math.max(0,c-i),u+=i,u<0||c>u){r.complete();return}const p=((a=(await o.getFeatures({...t,start:c,end:u},n).pipe(Rn()).toPromise())[0])===null||a===void 0?void 0:a.get("seq"))||"";for(let g=i;g<p.length-i;g+=this.windowDelta){const h=s?p[g]:p.slice(g-i,g+i);let m=0,y=0,b=0;for(let T=0;T<h.length;T++)h[T]==="c"||h[T]==="C"?m++:(h[T]==="g"||h[T]==="G")&&y++,h[T]!=="N"&&b++;const S=c;let _;this.gcMode==="content"?_=(y+m)/(b||1):this.gcMode==="skew"&&(_=(y-m)/(y+m||1)),r.next(new P.SimpleFeature({uniqueId:`${this.id}_${S+g}`,start:S+g,end:S+g+this.windowDelta,score:_}))}r.complete()})}freeResources(){}}gh.capabilities=["hasLocalStats"];const pO=Object.freeze(Object.defineProperty({__proto__:null,default:gh},Symbol.toStringTag,{value:"Module"}));class gO extends st{async configure(){var t;const n=await((t=this.getSubAdapter)===null||t===void 0?void 0:t.call(this,this.getConf("sequenceAdapter")));if(!n)throw new Error("Error getting subadapter");return n.dataAdapter}async getRefNames(){return(await this.configure()).getRefNames()}getFeatures(t,n){return Ke(async r=>{var a;const o=await this.configure(),i=1e3;let{start:s,end:c}=t;if(s=Math.max(0,s-i),c+=i,c<0||s>c){r.complete();return}const f=((a=(await o.getFeatures({...t,start:s,end:c},n).pipe(Rn()).toPromise())[0])===null||a===void 0?void 0:a.get("seq"))||"",p=this.getConf("search"),g=this.getConf("searchForward"),h=this.getConf("searchReverse"),m=this.getConf("caseInsensitive"),y=new RegExp(p,"g"+(m?"i":""));if(p){if(g){const b=f.matchAll(y);for(const S of b){const _=s+(S.index||0);P.doesIntersect2(_,_+p.length,t.start,t.end)&&r.next(new P.SimpleFeature({uniqueId:`${this.id}-match-${_}-p`,refName:t.refName,start:_,end:_+S[0].length,name:S[0],strand:1}))}}if(h){const b=P.revcom(f).matchAll(y);for(const S of b){const _=c-(S.index||0);P.doesIntersect2(_,_+p.length,t.start,t.end)&&r.next(new P.SimpleFeature({uniqueId:`${this.id}-match-${_}-n`,refName:t.refName,start:_-S[0].length,name:S[0],end:_,strand:-1}))}}}r.complete()})}freeResources(){}}const hO=Object.freeze(Object.defineProperty({__proto__:null,default:gO},Symbol.toStringTag,{value:"Module"})),mO=e=>{const t=[],n=[];return e.split(`
`).map(r=>r.trim()).filter(r=>!!r).forEach(r=>{r.startsWith("#")?t.push(r):r&&n.push(r)}),{header:t.join(`
`),lines:n}};function yO(e){return e[0]===31&&e[1]===139&&e[2]===8}class hh extends st{async getHeader(){const{header:t}=await this.setup();return t}async getMetadata(){const{header:t}=await this.setup();return new ms({header:t}).getMetadata()}async setupP(){const t=this.pluginManager,n=await Ce.openLocation(this.getConf("vcfLocation"),t).readFile(),r=yO(n)?await Gs(n):n;if(r.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const a=new TextDecoder().decode(r),{header:o,lines:i}=mO(a),s=i.map((c,u)=>{var d;const[f,p,,g,,,,h]=c.split("	"),m=+p-1,y=+(((d=h.match(/END=(\d+)/))===null||d===void 0?void 0:d[1].trim())||m+g.length);return{line:c,refName:f,start:m,end:y,id:u}}).reduce((c,u)=>{const d=u.refName;return c[d]||(c[d]=new Xs),c[d].insert([u.start,u.end],u),c},{});return{header:o,intervalTree:s}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch(t=>{throw this.vcfFeatures=void 0,t})),this.vcfFeatures}async getRefNames(t={}){const{intervalTree:n}=await this.setup();return Object.keys(n)}getFeatures(t,n={}){return Ke(async r=>{var a;try{const{start:o,end:i,refName:s}=t,{header:c,intervalTree:u}=await this.setup(),d=new ms({header:c});(a=u[s])===null||a===void 0||a.search([o,i]).forEach(f=>r.next(new io({variant:d.parseLine(f.line),parser:d,id:`${this.id}-${f.id}`}))),r.complete()}catch(o){r.error(o)}},n.signal)}freeResources(){}}hh.capabilities=["getFeatures","getRefNames"];const bO=Object.freeze(Object.defineProperty({__proto__:null,default:hh},Symbol.toStringTag,{value:"Module"}));class vO extends st{async configurePre(){const t=C.readConfObject(this.config,"vcfGzLocation"),n=C.readConfObject(this.config,["index","location"]),r=C.readConfObject(this.config,["index","indexType"]),a=Ce.openLocation(t,this.pluginManager),o=r==="CSI",i=new Us({filehandle:a,csiFilehandle:o?Ce.openLocation(n,this.pluginManager):void 0,tbiFilehandle:o?void 0:Ce.openLocation(n,this.pluginManager),chunkCacheSize:50*2**20,chunkSizeLimit:1e9}),s=await i.getHeader();return{filehandle:a,vcf:i,parser:new ms({header:s})}}async configure(){return this.configured||(this.configured=this.configurePre().catch(t=>{throw this.configured=void 0,t})),this.configured}async getRefNames(t={}){const{vcf:n}=await this.configure();return n.getReferenceSequenceNames(t)}async getHeader(){const{vcf:t}=await this.configure();return t.getHeader()}async getMetadata(){const{parser:t}=await this.configure();return t.getMetadata()}getFeatures(t,n={}){return Ke(async r=>{const{refName:a,start:o,end:i}=t,{vcf:s,parser:c}=await this.configure();await s.getLines(a,o,i,{lineCallback:(u,d)=>{r.next(new io({variant:c.parseLine(u),parser:c,id:`${this.id}-vcf-${d}`}))},...n}),r.complete()},n.signal)}getFeaturesInMultipleRegions(t,n={}){return Ke(async r=>{const{vcf:a}=await this.configure(),o=await P.bytesForRegions(t,a.index),{filehandle:i}=await this.configure(),s=await i.stat();let c=Math.round(o/s.size*100);c>100&&(c=100),c>60&&console.warn(`getFeaturesInMultipleRegions fetching ${c}% of VCF file, but whole-file streaming not yet implemented`),super.getFeaturesInMultipleRegions(t,n).subscribe(r)})}freeResources(){}}const wO=Object.freeze(Object.defineProperty({__proto__:null,default:vO},Symbol.toStringTag,{value:"Module"}));function SO(e){const{feature:t,descriptions:n}=e,[r,a]=M.exports.useState({}),[o,i]=M.exports.useState(!1),{samples:s={}}=t,c=Object.entries(s);if(!c.length)return null;const u=["sample",...Object.keys(c[0][1])].map(g=>{var h,m;return{field:g,description:(m=(h=n.FORMAT)===null||h===void 0?void 0:h[g])===null||m===void 0?void 0:m.Description}});let d,f=[];const p=Object.keys(r);try{f=c.map(g=>({...Object.fromEntries(Object.entries(g[1]).map(h=>[h[0],String(h[1])])),sample:g[0],id:g[0]})).filter(g=>p.length?p.every(h=>{const m=g[h],y=r[h];return y?m.match(new RegExp(y,"i")):!0}):!0)}catch(g){d=g}return w(_t.BaseCard,{...e,title:"Samples",children:[d?l(X,{color:"error",children:`${d}`}):null,l(Pt,{control:l(jt,{checked:o,onChange:()=>i(g=>!g)}),label:"Show sample filters"}),o?w(Z,{children:[l(X,{children:"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"}),u.map(({field:g})=>l(be,{placeholder:`Filter ${g}`,value:r[g]||"",onChange:h=>a({...r,[g]:h.target.value})},`filter-${g}`))]}):null,l("div",{style:{height:600,width:"100%",overflow:"auto"},children:l(qs,{rows:f,columns:u,disableSelectionOnClick:!0,rowHeight:25,disableColumnMenu:!0})})]})}function mh({rows:e,columns:t}){const r=e.length<100,a=80;return e.length?l("div",{style:{height:Math.min(e.length,100)*25+a+(r?0:50),width:"100%"},children:l(qs,{rowHeight:25,rows:e,columns:t})}):null}function CO({feature:e,descriptions:t}){var n,r,a,o;const i=((o=(a=(r=(n=t==null?void 0:t.INFO)===null||n===void 0?void 0:n.CSQ)===null||r===void 0?void 0:r.Description)===null||a===void 0?void 0:a.match(/.*Format: (.*)/))===null||o===void 0?void 0:o[1].split("|"))||[],s=e.INFO.CSQ||[],c=s.map((d,f)=>({id:f,...Object.fromEntries(d.split("|").map((p,g)=>[i[g],p]))}))||[],u=i.map(d=>({field:d}));return s.length?l(_t.BaseCard,{title:"CSQ table",children:l(mh,{rows:c,columns:u})}):null}function _O({feature:e,descriptions:t}){var n,r,a,o;const i=((o=(a=(r=(n=t==null?void 0:t.INFO)===null||n===void 0?void 0:n.ANN)===null||r===void 0?void 0:r.Description)===null||a===void 0?void 0:a.match(/.*Functional annotations:'(.*)'$/))===null||o===void 0?void 0:o[1].split("|"))||[],s=e.INFO.ANN||[],c=s.map((d,f)=>({id:f,...Object.fromEntries(d.split("|").map((p,g)=>[i[g],p]))}))||[],u=i.map(d=>({field:d}));return s.length?l(_t.BaseCard,{title:"ANN table",children:l(mh,{rows:c,columns:u})}):null}const TO=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},block:{display:"block"}}));function xO({model:e,handleClose:t,feature:n,viewType:r}){const{classes:a}=TO(),[o,i]=M.exports.useState(!0),[s,c]=M.exports.useState(!0);return w(De,{open:!0,onClose:t,children:[w(Ne,{children:["Breakpoint split view options",t?l(pe,{className:a.closeButton,onClick:()=>t(),children:l($e,{})}):null]}),l(un,{}),w(Fe,{children:[l(Pt,{className:a.block,control:l(jt,{checked:o,onChange:()=>i(u=>!u)}),label:"Copy tracks into the new view"}),l(Pt,{className:a.block,control:l(jt,{checked:s,onChange:()=>c(u=>!u)}),label:"Mirror tracks vertically in vertically stacked view"})]}),w(qe,{children:[l(ne,{onClick:()=>{const{view:u}=e,d=P.getSession(e);try{const f=r.snapshotFromBreakendFeature(n,u);f.views[0].offsetPx-=u.width/2+100,f.views[1].offsetPx-=u.width/2+100,f.featureData=n;const p=gt(u.tracks);f.views[0].tracks=p,f.views[1].tracks=s?p.slice().reverse():p,d.addView("BreakpointSplitView",f)}catch(f){console.error(f),d.notify(`${f}`)}t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),l(ne,{onClick:()=>t(),color:"secondary",variant:"contained",children:"Cancel"})]})]})}const PO=j(xO);function wd(e){const{model:t,locStrings:n,feature:r}=e,a=P.getSession(t),{pluginManager:o}=He(a),[i,s]=M.exports.useState(!1);let c;try{c=o.getViewType("BreakpointSplitView")}catch{}const u=new Pn(r);return w(_t.BaseCard,{...e,title:"Breakends",children:[l(X,{children:"Link to linear view of breakend endpoints"}),l("ul",{children:n.map(d=>l("li",{children:l(Et,{href:"#",onClick:f=>{var p;f.preventDefault();const{view:g}=t;try{if(g)(p=g.navToLocString)===null||p===void 0||p.call(g,d);else throw new Error("No view associated with this feature detail panel anymore")}catch(h){console.error(h),a.notify(`${h}`)}},children:`LGV - ${d}`})},`${JSON.stringify(d)}`))}),c?w("div",{children:[l(X,{children:"Launch split views with breakend source and target"}),l("ul",{children:n.map(d=>l("li",{children:l(Et,{href:"#",onClick:f=>{f.preventDefault(),s(!0)},children:`${r.refName}:${r.start} // ${d} (split view)`})},`${JSON.stringify(d)}`))}),i?l(PO,{model:t,feature:u,viewType:c,handleClose:()=>{s(!1)}}):null]}):null]})}function kO(e){const{model:t}=e,{featureData:n,descriptions:r}=t,a=JSON.parse(JSON.stringify(n)),{samples:o,...i}=a,s={CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:"alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"};return w(Je,{"data-testid":"variant-side-drawer",children:[l(_t.FeatureDetails,{feature:i,descriptions:{...s,...r},...e}),l(un,{}),l(CO,{feature:i,descriptions:r}),l(un,{}),l(_O,{feature:i,descriptions:r}),l(un,{}),a.type==="breakend"?l(wd,{feature:a,locStrings:a.ALT.map(c=>{var u;return((u=Hs(c))===null||u===void 0?void 0:u.MatePosition)||""}),model:t}):null,a.type==="translocation"?l(wd,{feature:a,model:t,locStrings:[`${a.INFO.CHR2[0]}:${a.INFO.END}`]}):null,l(SO,{feature:a,...e,descriptions:r})]})}const MO=j(kO),RO=Object.freeze(Object.defineProperty({__proto__:null,default:MO},Symbol.toStringTag,{value:"Module"}));function AO({modalInfo:e={},setModalInfo:t}){const{name:n,dereferenceTypeCount:r,safelyBreakConnection:a}=e;return w(De,{open:!0,children:[w(Ne,{children:['Close connection "',n,'"']}),w(Fe,{children:[r?w(Z,{children:[l(Ir,{children:"Closing this connection will close:"}),l(Ko,{children:Object.entries(r).map(([o,i])=>l(qr,{children:`${i} ${o}`},o))})]}):null,l(Ir,{children:"Are you sure you want to close this connection?"})]}),w(qe,{children:[l(ne,{onClick:()=>t(),color:"primary",children:"Cancel"}),l(ne,{variant:"contained",onClick:e?()=>{a==null||a(),t()}:()=>{},color:"primary",children:"OK"})]})]})}const EO=j(AO),$O=Object.freeze(Object.defineProperty({__proto__:null,default:EO},Symbol.toStringTag,{value:"Module"}));function DO({deleteDialogDetails:e,session:t,handleClose:n}){const{connectionConf:r,name:a}=e;return w(De,{open:!0,children:[w(Ne,{children:['Delete connection "',a,'"']}),l(Fe,{children:l(Ir,{children:"Are you sure you want to delete this connection?"})}),w(qe,{children:[l(ne,{onClick:()=>n(),color:"primary",children:"Cancel"}),l(ne,{variant:"contained",color:"primary",onClick:()=>{var o;r&&((o=t.deleteConnection)===null||o===void 0||o.call(t,r)),n()},children:"OK"})]})]})}const LO=j(DO),NO=Object.freeze(Object.defineProperty({__proto__:null,default:LO},Symbol.toStringTag,{value:"Module"})),FO=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},connectionContainer:{margin:e.spacing(4),width:500}}));function BO({session:e,handleClose:t,breakConnection:n}){const{classes:r}=FO(),{adminMode:a,connections:o,sessionConnections:i}=e;return w(De,{open:!0,onClose:t,maxWidth:"lg",children:[w(Ne,{children:["Delete connections",l(pe,{className:r.closeButton,onClick:()=>t(),children:l($e,{})})]}),w(Fe,{children:[l(X,{children:"Click the X icon to delete the connection from your config completely"}),w("div",{className:r.connectionContainer,children:[o.map(s=>{const c=C.readConfObject(s,"name");return w(X,{children:[a||(i==null?void 0:i.includes(s))?l(pe,{onClick:()=>n(s,!0),children:l($e,{color:"error"})}):l(fr,{title:"Unable to delete connection in config file as non-admin user",children:l(pe,{children:l($e,{color:"disabled"})})}),c]},`conn-${c}`)}),o.length?null:l(X,{children:"No connections found"})]})]}),l(qe,{children:l(ne,{onClick:()=>t(),variant:"contained",color:"primary",children:"Close"})})]})}const IO=j(BO),OO=Object.freeze(Object.defineProperty({__proto__:null,default:IO},Symbol.toStringTag,{value:"Module"}));function yh(e){return e.length>20?`${e.slice(0,20)}...`:e}const jO=ae()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},connectionContainer:{width:500,margin:e.spacing(4)}}));function zO({session:e,handleClose:t,breakConnection:n}){const{classes:r}=jO(),{connections:a,connectionInstances:o=[]}=e;return w(De,{open:!0,onClose:t,maxWidth:"lg",children:[w(Ne,{children:["Turn on/off connections",l(pe,{className:r.closeButton,onClick:()=>t(),children:l($e,{})})]}),w(Fe,{children:[l(X,{children:"Use the checkbox to turn on/off connections"}),w("div",{className:r.connectionContainer,children:[a.map(i=>{const s=C.readConfObject(i,"name"),c=C.readConfObject(i,"assemblyNames"),u=o.find(d=>s===d.name);return l(Pt,{control:l(jt,{checked:!!u,onChange:()=>{var d;u?n(i):(d=e.makeConnection)===null||d===void 0||d.call(e,i)},color:"primary"}),label:`${s} (${yh(c.join(","))})`},i.connectionId)}),a.length?null:l(X,{children:"No connections found"})]})]}),l(qe,{children:l(ne,{onClick:()=>t(),variant:"contained",color:"primary",children:"Close"})})]})}const qO=j(zO),VO=Object.freeze(Object.defineProperty({__proto__:null,ellipses:yh,default:qO},Symbol.toStringTag,{value:"Module"}));export{Z as F,G2 as J,se as _,l as a,U2 as b,J2 as c,w as j};
