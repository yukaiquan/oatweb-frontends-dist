import{f as L,i as x,h as g,j as b,k as G}from"./@babel.d3038ccc.js";var M={exports:{}},y={},T;function K(){if(T)return y;T=1;var t=x.exports,n=t(L()),r={functions:"Jexl Function",transforms:"Transform"};return y.ArrayLiteral=function(e){return this.evalArray(e.value)},y.BinaryExpression=function(e){var s=this,o=this._grammar.elements[e.operator];if(o.evalOnDemand){var l=function(u){return{eval:function(){return s.eval(u)}}};return o.evalOnDemand(l(e.left),l(e.right))}return this.Promise.all([this.eval(e.left),this.eval(e.right)]).then(function(a){return o.eval(a[0],a[1])})},y.ConditionalExpression=function(e){var s=this;return this.eval(e.test).then(function(o){return o?e.consequent?s.eval(e.consequent):o:s.eval(e.alternate)})},y.FilterExpression=function(e){var s=this;return this.eval(e.subject).then(function(o){return e.relative?s._filterRelative(o,e.expr):s._filterStatic(o,e.expr)})},y.Identifier=function(e){return e.from?this.eval(e.from).then(function(s){if(s!=null)return Array.isArray(s)&&(s=s[0]),s[e.value]}):e.relative?this._relContext[e.value]:this._context[e.value]},y.Literal=function(e){return e.value},y.ObjectLiteral=function(e){return this.evalMap(e.value)},y.FunctionCall=function(e){var s=r[e.pool];if(!s)throw new Error("Corrupt AST: Pool '".concat(e.pool,"' not found"));var o=this._grammar[e.pool],l=o[e.name];if(!l)throw new Error("".concat(s," ").concat(e.name," is not defined."));return this.evalArray(e.args||[]).then(function(a){return l.apply(void 0,(0,n.default)(a))})},y.UnaryExpression=function(e){var s=this;return this.eval(e.right).then(function(o){return s._grammar.elements[e.operator].eval(o)})},y}var k,w;function z(){if(w)return k;w=1;var t=x.exports,n=t(g()),r=t(b()),e=K(),s=function(){function o(l,a,u){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Promise;(0,n.default)(this,o),this._grammar=l,this._context=a||{},this._relContext=u||this._context,this.Promise=c}return(0,r.default)(o,[{key:"eval",value:function(a){var u=this;return this.Promise.resolve().then(function(){return e[a.type].call(u,a)})}},{key:"evalArray",value:function(a){var u=this;return this.Promise.all(a.map(function(c){return u.eval(c)}))}},{key:"evalMap",value:function(a){var u=this,c=Object.keys(a),h={},v=c.map(function(f){return u.eval(a[f])});return this.Promise.all(v).then(function(f){return f.forEach(function(i,p){h[c[p]]=i}),h})}},{key:"_filterRelative",value:function(a,u){var c=this,h=[];return Array.isArray(a)||(a=a===void 0?[]:[a]),a.forEach(function(v){var f=new o(c._grammar,c._context,v,c.Promise);h.push(f.eval(u))}),this.Promise.all(h).then(function(v){var f=[];return v.forEach(function(i,p){i&&f.push(a[p])}),f})}},{key:"_filterStatic",value:function(a,u){return this.eval(u).then(function(c){return typeof c=="boolean"?c?a:void 0:a[c]})}}]),o}();return k=s,k}var S,A;function J(){if(A)return S;A=1;var t=x.exports,n=t(g()),r=t(b()),e=/^-?(?:(?:[0-9]*\.[0-9]+)|[0-9]+)$/,s=/^[a-zA-Zа-яА-Я_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$][a-zA-Zа-яА-Я0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$]*$/,o=/\\\\/,l=/^\s*$/,a=["'(?:(?:\\\\')|[^'])*'",'"(?:(?:\\\\")|[^"])*"',"\\s+","\\btrue\\b","\\bfalse\\b"],u=["[a-zA-Z\u0430-\u044F\u0410-\u042F_\xC0-\xD6\xD8-\xF6\xF8-\xFF\\$][a-zA-Z0-9\u0430-\u044F\u0410-\u042F_\xC0-\xD6\xD8-\xF6\xF8-\xFF\\$]*","(?:(?:[0-9]*\\.[0-9]+)|[0-9]+)"],c=["binaryOp","unaryOp","openParen","openBracket","question","colon"],h=function(){function v(f){(0,n.default)(this,v),this._grammar=f}return(0,r.default)(v,[{key:"getElements",value:function(i){var p=this._getSplitRegex();return i.split(p).filter(function(d){return d})}},{key:"getTokens",value:function(i){for(var p=[],d=!1,m=0;m<i.length;m++)this._isWhitespace(i[m])?p.length&&(p[p.length-1].raw+=i[m]):i[m]==="-"&&this._isNegative(p)?d=!0:(d&&(i[m]="-"+i[m],d=!1),p.push(this._createToken(i[m])));return d&&p.push(this._createToken("-")),p}},{key:"tokenize",value:function(i){var p=this.getElements(i);return this.getTokens(p)}},{key:"_createToken",value:function(i){var p={type:"literal",value:i,raw:i};if(i[0]==='"'||i[0]==="'")p.value=this._unquote(i);else if(i.match(e))p.value=parseFloat(i);else if(i==="true"||i==="false")p.value=i==="true";else if(this._grammar.elements[i])p.type=this._grammar.elements[i].type;else if(i.match(s))p.type="identifier";else throw new Error("Invalid expression token: ".concat(i));return p}},{key:"_escapeRegExp",value:function(i){return i=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i.match(s)&&(i="\\b"+i+"\\b"),i}},{key:"_getSplitRegex",value:function(){var i=this;if(!this._splitRegex){var p=Object.keys(this._grammar.elements).sort(function(d,m){return m.length-d.length}).map(function(d){return i._escapeRegExp(d)},this);this._splitRegex=new RegExp("("+[a.join("|"),p.join("|"),u.join("|")].join("|")+")")}return this._splitRegex}},{key:"_isNegative",value:function(i){return i.length?c.some(function(p){return p===i[i.length-1].type}):!0}},{key:"_isWhitespace",value:function(i){return!!i.match(l)}},{key:"_unquote",value:function(i){var p=i[0],d=new RegExp("\\\\"+p,"g");return i.substr(1,i.length-2).replace(d,p).replace(o,"\\")}}]),v}();return S=h,S}var _={},F;function H(){return F||(F=1,_.argVal=function(t){t&&this._cursor.args.push(t)},_.arrayStart=function(){this._placeAtCursor({type:"ArrayLiteral",value:[]})},_.arrayVal=function(t){t&&this._cursor.value.push(t)},_.binaryOp=function(t){for(var n=this._grammar.elements[t.value].precedence||0,r=this._cursor._parent;r&&r.operator&&this._grammar.elements[r.operator].precedence>=n;)this._cursor=r,r=r._parent;var e={type:"BinaryExpression",operator:t.value,left:this._cursor};this._setParent(this._cursor,e),this._cursor=r,this._placeAtCursor(e)},_.dot=function(){this._nextIdentEncapsulate=this._cursor&&this._cursor.type!=="UnaryExpression"&&(this._cursor.type!=="BinaryExpression"||this._cursor.type==="BinaryExpression"&&this._cursor.right),this._nextIdentRelative=!this._cursor||this._cursor&&!this._nextIdentEncapsulate,this._nextIdentRelative&&(this._relative=!0)},_.filter=function(t){this._placeBeforeCursor({type:"FilterExpression",expr:t,relative:this._subParser.isRelative(),subject:this._cursor})},_.functionCall=function(){this._placeBeforeCursor({type:"FunctionCall",name:this._cursor.value,args:[],pool:"functions"})},_.identifier=function(t){var n={type:"Identifier",value:t.value};this._nextIdentEncapsulate?(n.from=this._cursor,this._placeBeforeCursor(n),this._nextIdentEncapsulate=!1):(this._nextIdentRelative&&(n.relative=!0,this._nextIdentRelative=!1),this._placeAtCursor(n))},_.literal=function(t){this._placeAtCursor({type:"Literal",value:t.value})},_.objKey=function(t){this._curObjKey=t.value},_.objStart=function(){this._placeAtCursor({type:"ObjectLiteral",value:{}})},_.objVal=function(t){this._cursor.value[this._curObjKey]=t},_.subExpression=function(t){this._placeAtCursor(t)},_.ternaryEnd=function(t){this._cursor.alternate=t},_.ternaryMid=function(t){this._cursor.consequent=t},_.ternaryStart=function(){this._tree={type:"ConditionalExpression",test:this._tree},this._cursor=this._tree},_.transform=function(t){this._placeBeforeCursor({type:"FunctionCall",name:t.value,args:[this._cursor],pool:"transforms"})},_.unaryOp=function(t){this._placeAtCursor({type:"UnaryExpression",operator:t.value})}),_}var E={},j;function N(){if(j)return E;j=1;var t=H();return E.states={expectOperand:{tokenTypes:{literal:{toState:"expectBinOp"},identifier:{toState:"identifier"},unaryOp:{},openParen:{toState:"subExpression"},openCurl:{toState:"expectObjKey",handler:t.objStart},dot:{toState:"traverse"},openBracket:{toState:"arrayVal",handler:t.arrayStart}}},expectBinOp:{tokenTypes:{binaryOp:{toState:"expectOperand"},pipe:{toState:"expectTransform"},dot:{toState:"traverse"},question:{toState:"ternaryMid",handler:t.ternaryStart}},completable:!0},expectTransform:{tokenTypes:{identifier:{toState:"postTransform",handler:t.transform}}},expectObjKey:{tokenTypes:{identifier:{toState:"expectKeyValSep",handler:t.objKey},closeCurl:{toState:"expectBinOp"}}},expectKeyValSep:{tokenTypes:{colon:{toState:"objVal"}}},postTransform:{tokenTypes:{openParen:{toState:"argVal"},binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},postArgs:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},identifier:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},openParen:{toState:"argVal",handler:t.functionCall},pipe:{toState:"expectTransform"},question:{toState:"ternaryMid",handler:t.ternaryStart}},completable:!0},traverse:{tokenTypes:{identifier:{toState:"identifier"}}},filter:{subHandler:t.filter,endStates:{closeBracket:"identifier"}},subExpression:{subHandler:t.subExpression,endStates:{closeParen:"expectBinOp"}},argVal:{subHandler:t.argVal,endStates:{comma:"argVal",closeParen:"postArgs"}},objVal:{subHandler:t.objVal,endStates:{comma:"expectObjKey",closeCurl:"expectBinOp"}},arrayVal:{subHandler:t.arrayVal,endStates:{comma:"arrayVal",closeBracket:"expectBinOp"}},ternaryMid:{subHandler:t.ternaryMid,endStates:{colon:"ternaryEnd"}},ternaryEnd:{subHandler:t.ternaryEnd,completable:!0}},E}var O,B;function U(){if(B)return O;B=1;var t=x.exports,n=t(g()),r=t(b()),e=H(),s=N().states,o=function(){function l(a,u,c){(0,n.default)(this,l),this._grammar=a,this._state="expectOperand",this._tree=null,this._exprStr=u||"",this._relative=!1,this._stopMap=c||{}}return(0,r.default)(l,[{key:"addToken",value:function(u){if(this._state==="complete")throw new Error("Cannot add a new token to a completed Parser");var c=s[this._state],h=this._exprStr;if(this._exprStr+=u.raw,c.subHandler){this._subParser||this._startSubExpression(h);var v=this._subParser.addToken(u);if(v){if(this._endSubExpression(),this._parentStop)return v;this._state=v}}else if(c.tokenTypes[u.type]){var f=c.tokenTypes[u.type],i=e[u.type];f.handler&&(i=f.handler),i&&i.call(this,u),f.toState&&(this._state=f.toState)}else{if(this._stopMap[u.type])return this._stopMap[u.type];throw new Error("Token ".concat(u.raw," (").concat(u.type,") unexpected in expression: ").concat(this._exprStr))}return!1}},{key:"addTokens",value:function(u){u.forEach(this.addToken,this)}},{key:"complete",value:function(){if(this._cursor&&!s[this._state].completable)throw new Error("Unexpected end of expression: ".concat(this._exprStr));return this._subParser&&this._endSubExpression(),this._state="complete",this._cursor?this._tree:null}},{key:"isRelative",value:function(){return this._relative}},{key:"_endSubExpression",value:function(){s[this._state].subHandler.call(this,this._subParser.complete()),this._subParser=null}},{key:"_placeAtCursor",value:function(u){this._cursor?(this._cursor.right=u,this._setParent(u,this._cursor)):this._tree=u,this._cursor=u}},{key:"_placeBeforeCursor",value:function(u){this._cursor=this._cursor._parent,this._placeAtCursor(u)}},{key:"_setParent",value:function(u,c){Object.defineProperty(u,"_parent",{value:c,writable:!0})}},{key:"_startSubExpression",value:function(u){var c=s[this._state].endStates;c||(this._parentStop=!0,c=this._stopMap),this._subParser=new l(this._grammar,u,c)}}]),l}();return O=o,O}var C,D;function Z(){if(D)return C;D=1;var t=x.exports,n=t(g()),r=t(b()),e=function(){function s(o){(0,n.default)(this,s),o(this._resolve.bind(this),this._reject.bind(this))}return(0,r.default)(s,[{key:"catch",value:function(l){if(this.error)try{this._resolve(l(this.error))}catch(a){this._reject(a)}return this}},{key:"then",value:function(l,a){if(!this.error)try{this._resolve(l(this.value))}catch(u){this._reject(u)}return a&&this.catch(a),this}},{key:"_reject",value:function(l){this.value=void 0,this.error=l}},{key:"_resolve",value:function(l){l instanceof s?l.error?this._reject(l.error):this._resolve(l.value):(this.value=l,this.error=void 0)}}]),s}();return e.all=function(s){return new e(function(o){var l=s.map(function(a){for(;a instanceof e;){if(a.error)throw Error(a.error);a=a.value}return a});o(l)})},e.resolve=function(s){return new e(function(o){return o(s)})},e.reject=function(s){return new e(function(o,l){return l(s)})},C=e,C}var P,V;function W(){if(V)return P;V=1;var t=x.exports,n=t(g()),r=t(b()),e=z(),s=J(),o=U(),l=Z(),a=function(){function u(c,h){(0,n.default)(this,u),this._grammar=c,this._exprStr=h,this._ast=null}return(0,r.default)(u,[{key:"compile",value:function(){var h=new s(this._grammar),v=new o(this._grammar),f=h.tokenize(this._exprStr);return v.addTokens(f),this._ast=v.complete(),this}},{key:"eval",value:function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._eval(h,Promise)}},{key:"evalSync",value:function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=this._eval(h,l);if(v.error)throw v.error;return v.value}},{key:"_eval",value:function(h,v){var f=this;return v.resolve().then(function(){var i=f._getAst(),p=new e(f._grammar,h,void 0,v);return p.eval(i)})}},{key:"_getAst",value:function(){return this._ast||this.compile(),this._ast}}]),u}();return P=a,P}var R={},I;function Q(){return I||(I=1,R.getGrammar=function(){return{elements:{".":{type:"dot"},"[":{type:"openBracket"},"]":{type:"closeBracket"},"|":{type:"pipe"},"{":{type:"openCurl"},"}":{type:"closeCurl"},":":{type:"colon"},",":{type:"comma"},"(":{type:"openParen"},")":{type:"closeParen"},"?":{type:"question"},"+":{type:"binaryOp",precedence:30,eval:function(n,r){return n+r}},"-":{type:"binaryOp",precedence:30,eval:function(n,r){return n-r}},"*":{type:"binaryOp",precedence:40,eval:function(n,r){return n*r}},"/":{type:"binaryOp",precedence:40,eval:function(n,r){return n/r}},"//":{type:"binaryOp",precedence:40,eval:function(n,r){return Math.floor(n/r)}},"%":{type:"binaryOp",precedence:50,eval:function(n,r){return n%r}},"^":{type:"binaryOp",precedence:50,eval:function(n,r){return Math.pow(n,r)}},"==":{type:"binaryOp",precedence:20,eval:function(n,r){return n==r}},"!=":{type:"binaryOp",precedence:20,eval:function(n,r){return n!=r}},">":{type:"binaryOp",precedence:20,eval:function(n,r){return n>r}},">=":{type:"binaryOp",precedence:20,eval:function(n,r){return n>=r}},"<":{type:"binaryOp",precedence:20,eval:function(n,r){return n<r}},"<=":{type:"binaryOp",precedence:20,eval:function(n,r){return n<=r}},"&&":{type:"binaryOp",precedence:10,evalOnDemand:function(n,r){return n.eval().then(function(e){return e&&r.eval()})}},"||":{type:"binaryOp",precedence:10,evalOnDemand:function(n,r){return n.eval().then(function(e){return e||r.eval()})}},in:{type:"binaryOp",precedence:20,eval:function(n,r){return typeof r=="string"?r.indexOf(n)!==-1:Array.isArray(r)?r.some(function(e){return e===n}):!1}},"!":{type:"unaryOp",precedence:1/0,eval:function(n){return!n}}},functions:{},transforms:{}}}),R}var q=x.exports,X=q(G()),Y=q(g()),ee=q(b()),re=W(),te=Q(),ne=te.getGrammar,$=function(){function t(){(0,Y.default)(this,t),this.expr=this.expr.bind(this),this._grammar=ne()}return(0,ee.default)(t,[{key:"addBinaryOp",value:function(r,e,s,o){this._addGrammarElement(r,(0,X.default)({type:"binaryOp",precedence:e},o?"evalOnDemand":"eval",s))}},{key:"addFunction",value:function(r,e){this._grammar.functions[r]=e}},{key:"addFunctions",value:function(r){for(var e in r)this._grammar.functions[e]=r[e]}},{key:"addUnaryOp",value:function(r,e){this._addGrammarElement(r,{type:"unaryOp",weight:1/0,eval:e})}},{key:"addTransform",value:function(r,e){this._grammar.transforms[r]=e}},{key:"addTransforms",value:function(r){for(var e in r)this._grammar.transforms[e]=r[e]}},{key:"compile",value:function(r){var e=this.createExpression(r);return e.compile()}},{key:"createExpression",value:function(r){return new re(this._grammar,r)}},{key:"getFunction",value:function(r){return this._grammar.functions[r]}},{key:"getTransform",value:function(r){return this._grammar.transforms[r]}},{key:"eval",value:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.createExpression(r);return s.eval(e)}},{key:"evalSync",value:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.createExpression(r);return s.evalSync(e)}},{key:"expr",value:function(r){for(var e=arguments.length,s=new Array(e>1?e-1:0),o=1;o<e;o++)s[o-1]=arguments[o];var l=r.reduce(function(a,u,c){var h=c<s.length?s[c]:"";return a+=u+h,a},"");return this.createExpression(l)}},{key:"removeOp",value:function(r){this._grammar.elements[r]&&(this._grammar.elements[r].type==="binaryOp"||this._grammar.elements[r].type==="unaryOp")&&delete this._grammar.elements[r]}},{key:"_addGrammarElement",value:function(r,e){this._grammar.elements[r]=e}}]),t}();M.exports=new $;M.exports.Jexl=$;export{M as J};
