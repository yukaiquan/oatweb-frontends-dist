import{g as V}from"./@babel.d3038ccc.js";var Z={value:function(){}};function J(){for(var n=0,t=arguments.length,r={},e;n<t;++n){if(!(e=arguments[n]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new P(r)}function P(n){this._=n}function j(n,t){return n.trim().split(/^|\s+/).map(function(r){var e="",o=r.indexOf(".");if(o>=0&&(e=r.slice(o+1),r=r.slice(0,o)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:e}})}P.prototype=J.prototype={constructor:P,on:function(n,t){var r=this._,e=j(n+"",r),o,f=-1,h=e.length;if(arguments.length<2){for(;++f<h;)if((o=(n=e[f]).type)&&(o=d(r[o],n.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++f<h;)if(o=(n=e[f]).type)r[o]=G(r[o],n.name,t);else if(t==null)for(o in r)r[o]=G(r[o],n.name,null);return this},copy:function(){var n={},t=this._;for(var r in t)n[r]=t[r].slice();return new P(n)},call:function(n,t){if((o=arguments.length-2)>0)for(var r=new Array(o),e=0,o,f;e<o;++e)r[e]=arguments[e+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(f=this._[n],e=0,o=f.length;e<o;++e)f[e].value.apply(t,r)},apply:function(n,t,r){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var e=this._[n],o=0,f=e.length;o<f;++o)e[o].value.apply(t,r)}};function d(n,t){for(var r=0,e=n.length,o;r<e;++r)if((o=n[r]).name===t)return o.value}function G(n,t,r){for(var e=0,o=n.length;e<o;++e)if(n[e].name===t){n[e]=Z,n=n.slice(0,e).concat(n.slice(e+1));break}return r!=null&&n.push({name:t,value:r}),n}const tt=Object.freeze(Object.defineProperty({__proto__:null,dispatch:J},Symbol.toStringTag,{value:"Module"})),nt=V(tt);var rt=nt.dispatch,$=Math.PI/180,C=1<<11>>5,q=1<<11,pt=function(){var n=[256,256],t=et,r=ot,e=at,o=H,f=H,h=it,p=ut,w=K,M=[],x=1/0,c=rt("word","end"),v=null,z=Math.random,i={},k=yt;i.canvas=function(a){return arguments.length?(k=I(a),i):k},i.start=function(){var a=D(k()),u=xt((n[0]>>5)*n[1]),y=null,m=M.length,S=-1,T=[],g=M.map(function(s,l){return s.text=t.call(this,s,l),s.font=r.call(this,s,l),s.style=o.call(this,s,l),s.weight=f.call(this,s,l),s.rotate=h.call(this,s,l),s.size=~~e.call(this,s,l),s.padding=p.call(this,s,l),s}).sort(function(s,l){return l.size-s.size});return v&&clearInterval(v),v=setInterval(b,0),b(),i;function b(){for(var s=Date.now();Date.now()-s<x&&++S<m&&v;){var l=g[S];l.x=n[0]*(z()+.5)>>1,l.y=n[1]*(z()+.5)>>1,lt(a,l,g,S),l.hasText&&E(u,l,y)&&(T.push(l),c.call("word",i,l),y?st(y,l):y=[{x:l.x+l.x0,y:l.y+l.y0},{x:l.x+l.x1,y:l.y+l.y1}],l.x-=n[0]>>1,l.y-=n[1]>>1)}S>=m&&(i.stop(),c.call("end",i,T,y))}},i.stop=function(){return v&&(clearInterval(v),v=null),i};function D(a){a.width=a.height=1;var u=Math.sqrt(a.getContext("2d").getImageData(0,0,1,1).data.length>>2);a.width=(C<<5)/u,a.height=q/u;var y=a.getContext("2d");return y.fillStyle=y.strokeStyle="red",y.textAlign="center",{context:y,ratio:u}}function E(a,u,y){n[0],n[1];for(var m=u.x,S=u.y,T=Math.sqrt(n[0]*n[0]+n[1]*n[1]),g=w(n),b=z()<.5?1:-1,s=-b,l,A,F;(l=g(s+=b))&&(A=~~l[0],F=~~l[1],!(Math.min(Math.abs(A),Math.abs(F))>=T));)if(u.x=m+A,u.y=S+F,!(u.x+u.x0<0||u.y+u.y0<0||u.x+u.x1>n[0]||u.y+u.y1>n[1])&&(!y||!ft(u,a,n[0]))&&(!y||ct(u,y))){for(var L=u.sprite,O=u.width>>5,N=n[0]>>5,B=u.x-(O<<4),X=B&127,Q=32-X,U=u.y1-u.y0,Y=(u.y+u.y0)*N+(B>>5),R,W=0;W<U;W++){R=0;for(var _=0;_<=O;_++)a[Y+_]|=R<<Q|(_<O?(R=L[W*O+_])>>>X:0);Y+=N}return delete u.sprite,!0}return!1}return i.timeInterval=function(a){return arguments.length?(x=a==null?1/0:a,i):x},i.words=function(a){return arguments.length?(M=a,i):M},i.size=function(a){return arguments.length?(n=[+a[0],+a[1]],i):n},i.font=function(a){return arguments.length?(r=I(a),i):r},i.fontStyle=function(a){return arguments.length?(o=I(a),i):o},i.fontWeight=function(a){return arguments.length?(f=I(a),i):f},i.rotate=function(a){return arguments.length?(h=I(a),i):h},i.text=function(a){return arguments.length?(t=I(a),i):t},i.spiral=function(a){return arguments.length?(w=vt[a]||a,i):w},i.fontSize=function(a){return arguments.length?(e=I(a),i):e},i.padding=function(a){return arguments.length?(p=I(a),i):p},i.random=function(a){return arguments.length?(z=a,i):z},i.on=function(){var a=c.on.apply(c,arguments);return a===c?i:a},i};function et(n){return n.text}function ot(){return"serif"}function H(){return"normal"}function at(n){return Math.sqrt(n.value)}function it(){return(~~(Math.random()*6)-3)*30}function ut(){return 1}function lt(n,t,r,e){if(!t.sprite){var o=n.context,f=n.ratio;o.clearRect(0,0,(C<<5)/f,q/f);var h=0,p=0,w=0,M=r.length;for(--e;++e<M;){t=r[e],o.save(),o.font=t.style+" "+t.weight+" "+~~((t.size+1)/f)+"px "+t.font;var x=o.measureText(t.text+"m").width*f,c=t.size<<1;if(t.rotate){var v=Math.sin(t.rotate*$),z=Math.cos(t.rotate*$),i=x*z,k=x*v,D=c*z,E=c*v;x=Math.max(Math.abs(i+E),Math.abs(i-E))+31>>5<<5,c=~~Math.max(Math.abs(k+D),Math.abs(k-D))}else x=x+31>>5<<5;if(c>w&&(w=c),h+x>=C<<5&&(h=0,p+=w,w=0),p+c>=q)break;o.translate((h+(x>>1))/f,(p+(c>>1))/f),t.rotate&&o.rotate(t.rotate*$),o.fillText(t.text,0,0),t.padding&&(o.lineWidth=2*t.padding,o.strokeText(t.text,0,0)),o.restore(),t.width=x,t.height=c,t.xoff=h,t.yoff=p,t.x1=x>>1,t.y1=c>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,h+=x}for(var a=o.getImageData(0,0,(C<<5)/f,q/f).data,u=[];--e>=0;)if(t=r[e],!!t.hasText){for(var x=t.width,y=x>>5,c=t.y1-t.y0,m=0;m<c*y;m++)u[m]=0;if(h=t.xoff,h==null)return;p=t.yoff;for(var S=0,T=-1,g=0;g<c;g++){for(var m=0;m<x;m++){var b=y*g+(m>>5),s=a[(p+g)*(C<<5)+(h+m)<<2]?1<<31-m%32:0;u[b]|=s,S|=s}S?T=g:(t.y0++,c--,g--,p++)}t.y1=t.y0+T,t.sprite=u.slice(0,(t.y1-t.y0)*y)}}}function ft(n,t,r){r>>=5;for(var e=n.sprite,o=n.width>>5,f=n.x-(o<<4),h=f&127,p=32-h,w=n.y1-n.y0,M=(n.y+n.y0)*r+(f>>5),x,c=0;c<w;c++){x=0;for(var v=0;v<=o;v++)if((x<<p|(v<o?(x=e[c*o+v])>>>h:0))&t[M+v])return!0;M+=r}return!1}function st(n,t){var r=n[0],e=n[1];t.x+t.x0<r.x&&(r.x=t.x+t.x0),t.y+t.y0<r.y&&(r.y=t.y+t.y0),t.x+t.x1>e.x&&(e.x=t.x+t.x1),t.y+t.y1>e.y&&(e.y=t.y+t.y1)}function ct(n,t){return n.x+n.x1>t[0].x&&n.x+n.x0<t[1].x&&n.y+n.y1>t[0].y&&n.y+n.y0<t[1].y}function K(n){var t=n[0]/n[1];return function(r){return[t*(r*=.1)*Math.cos(r),r*Math.sin(r)]}}function ht(n){var t=4,r=t*n[0]/n[1],e=0,o=0;return function(f){var h=f<0?-1:1;switch(Math.sqrt(1+4*h*f)-h&3){case 0:e+=r;break;case 1:o+=t;break;case 2:e-=r;break;default:o-=t;break}return[e,o]}}function xt(n){for(var t=[],r=-1;++r<n;)t[r]=0;return t}function yt(){return document.createElement("canvas")}function I(n){return typeof n=="function"?n:function(){return n}}var vt={archimedean:K,rectangular:ht};export{pt as d};
